"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,i,r){r===void 0&&(r=i);var a=Object.getOwnPropertyDescriptor(t,i);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,a)}:function(e,t,i,r){r===void 0&&(r=i),e[r]=t[i]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var i in e)i!=="default"&&Object.prototype.hasOwnProperty.call(e,i)&&__createBinding(t,e,i);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.validatePagination=void 0;const joi_1=__importStar(require("joi")),lodash_1=__importDefault(require("lodash")),core_1=require("@sequelize/core"),validator_1=require("./validator"),validatePagination=(e={})=>{let t;e.filter?(t=e.filter(joi_1.default),t=(0,joi_1.isSchema)(t)?t:joi_1.default.object(t).optional()):t=joi_1.default.object().optional();const i=r=>{if(!e.format)return;const{filter:a,sorter:u,pagination:{current:s,pageSize:l}}=r.mergedParams;let f=[];u&&(f=[[u.field,u.order]]);const o={};return a&&(lodash_1.default.forEach(e.format.like,n=>{o[n]={[core_1.Op.like]:`%${a[n]}%`}}),lodash_1.default.forEach(e.format.equal,n=>{o[n]={[core_1.Op.eq]:`%${a[n]}%`}})),{limit:l,offset:(s-1)*l,order:f,where:o}};return(0,validator_1.validator)(r=>r.object({pagination:r.object({current:r.number().integer().min(1),pageSize:r.number().integer().min(1).max(100)}),filter:t,sorter:r.object({field:e.sorter?r.string().valid(...e.sorter):r.string(),order:r.string().valid("ASC","DESC","asc","desc")}).optional()}),{formatData:i})};exports.validatePagination=validatePagination;