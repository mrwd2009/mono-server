"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.initialize=exports.measure=void 0;const dayjs_1=__importDefault(require("dayjs")),uuid_1=require("uuid"),config_1=__importDefault(require("../../config")),logger_1=__importDefault(require("../../lib/logger")),measure=async(e,u)=>{const o=(0,dayjs_1.default)().valueOf();e.state.requestId=(0,uuid_1.v4)();let t=!1,a=null;try{config_1.default.isDev||(a=logger_1.default.startTimer()),await u()}catch(l){throw t=!0,l}finally{const i=(0,dayjs_1.default)().valueOf()-o;if(config_1.default.isDev){let r="";i>200?r=`\x1B[38;2;205;0;205m(${i}ms)\x1B[0m`:r=`(${i}ms)`;let s="";t?s=`\x1B[38;2;255;77;79m${e.method} ${e.originalUrl} ${r}\x1B[0m`:s=`\x1B[38;2;82;196;26m${e.method} ${e.originalUrl} ${r}\x1B[0m`,console.info(`\x1B[38;2;0;204;204mResponse Time(${e.state.requestId}): \x1B[0m ${s}
`)}a?.done({level:"info",message:`${e.method}${e.originalUrl}`,trackId:e.state.requestId,user:e.state.user?.email||"ananymity"})}};exports.measure=measure;const initialize=async e=>{await e.use(exports.measure)};exports.initialize=initialize,exports.default=exports.initialize;