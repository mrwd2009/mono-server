"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2888],{2888:(e,t,i)=>{i.r(t),i.d(t,{default:()=>T});var s=i(5863),l=i(2954),r=i(3802),n=i(1576),a=i(710),c=i(3821),o=i(8798),d=i(9766),m=i(1677),p=i(4839),u=i(4326),P=i(386),I=i(9254),f=i(4206);const y=({clientId:e,resourceId:t,preSelected:i})=>{const{t:l}=(0,r.$G)("clients"),{adminClient:c}=(0,o.K3)(),{control:d,setValue:m,formState:{errors:p}}=(0,n.Gc)(),[u,P]=(0,s.eJ)([]),[I,f]=(0,s.eJ)(""),[y,h]=(0,s.eJ)(!1),E=(0,s.sO)(!0),Z=e=>e.map((e=>s.ZP.createElement(a.$m,{key:e.id,value:e.id},e.name)));return(0,o.ib)((async()=>t?(t&&!E.current&&m("scopes",[]),E.current=!1,c.clients.listScopesByResource({id:e,resourceName:t})):c.clients.listAllScopes(Object.assign({id:e,first:0,max:10,deep:!1},""===I?null:{name:I}))),P,[t,I]),s.ZP.createElement(n.Qr,{name:"scopes",defaultValue:i?[i]:[],control:d,rules:{validate:e=>e.length>0},render:({onChange:e,value:t})=>s.ZP.createElement(a.Ph,{toggleId:"scopes",variant:a.TM.typeaheadMulti,onToggle:h,onFilter:(e,t)=>(f(t),Z(u)),onClear:()=>{e([]),f("")},selections:t,onSelect:(i,s)=>{const l=s.toString(),r=t.find((e=>e===l))?t.filter((e=>e!==l)):[...t,l];e(r),f("")},isOpen:y,"aria-labelledby":l("scopes"),validated:p.scopes?"error":"default",isDisabled:!!i,typeAheadAriaLabel:l("scopes")},Z(u))})};var h=i(8336),E=i(3172),Z=i(1786),b=i(4036);const g=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"];function T(){const{t:e}=(0,r.$G)("clients"),t=(0,n.cI)({shouldUnregister:!1,mode:"onChange"}),{register:i,control:T,reset:v,errors:S,handleSubmit:x}=t,w=(0,l.k6)(),{id:C,realm:R,permissionType:F,permissionId:L,selectedId:k}=(0,l.UO)(),{adminClient:B}=(0,o.K3)(),{addAlert:q,addError:N}=(0,u.Z7)(),[A,M]=(0,s.eJ)(),[O,U]=(0,s.eJ)(!1);(0,o.ib)((async()=>{if(!L)return{};const[t,i,s,l]=await Promise.all([B.clients.findOnePermission({id:C,type:F,permissionId:L}),B.clients.getAssociatedResources({id:C,permissionId:L}),B.clients.getAssociatedPolicies({id:C,permissionId:L}),B.clients.getAssociatedScopes({id:C,permissionId:L})]);if(!t)throw new Error(e("common:notFound"));return{permission:t,resources:i.map((e=>e._id)),policies:s.map((e=>e.id)),scopes:l.map((e=>e.id))}}),(({permission:e,resources:t,policies:i,scopes:s})=>{v({...e,resources:t,policies:i,scopes:s}),e&&"resourceType"in e&&U(!!e.resourceType),M({...e,resources:t,policies:i})}),[]);const[V,K]=(0,d.W)({titleKey:"clients:deletePermission",messageKey:e("deletePermissionConfirm",{permission:A?.name}),continueButtonVariant:a.Wu.danger,continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await B.clients.delPermission({id:C,type:F,permissionId:L}),q(e("permissionDeletedSuccess"),a.Ux.success),w.push((0,f.M)({realm:R,clientId:C,tab:"permissions"}))}catch(e){N("clients:permissionDeletedError",e)}}}),D=(0,n.qo)({control:T,name:"resources",defaultValue:[]});return A?s.ZP.createElement(s.ZP.Fragment,null,s.ZP.createElement(K,null),s.ZP.createElement(m.t,{titleKey:L?A.name:`clients:create${(0,h.LO)(F)}BasedPermission`,dropdownItems:L?[s.ZP.createElement(a.hP,{key:"delete","data-testid":"delete-resource",onClick:()=>V()},e("common:delete"))]:void 0}),s.ZP.createElement(a.NP,{variant:"light"},s.ZP.createElement(p.N,{isHorizontal:!0,role:"view-clients",onSubmit:x((async t=>{try{if(L)await B.clients.updatePermission({id:C,type:F,permissionId:L},t);else{const e=await B.clients.createPermission({id:C,type:F},t);w.push((0,c.n)({realm:R,id:C,permissionType:F,permissionId:e.id}))}q(e((L?"update":"create")+"PermissionSuccess"),a.Ux.success)}catch(e){N("clients:permissionSaveError",e)}}))},s.ZP.createElement(n.RV,{...t},s.ZP.createElement(a.cw,{label:e("common:name"),isRequired:!0,helperTextInvalid:e("common:required"),validated:S.name?"error":"default",fieldId:"name",labelIcon:s.ZP.createElement(P.B,{helpText:"clients-help:permissionName",fieldLabelId:"name"})},s.ZP.createElement(Z.F,{id:"name",name:"name",ref:i({required:!0}),validated:S.name?"error":"default"})),s.ZP.createElement(a.cw,{label:e("common:description"),fieldId:"description",labelIcon:s.ZP.createElement(P.B,{helpText:"clients-help:permissionDescription",fieldLabelId:"description"}),validated:S.description?"error":"default",helperTextInvalid:S.description?.message},s.ZP.createElement(b.Q,{id:"description",name:"description",ref:i({maxLength:{value:255,message:e("common:maxLength",{length:255})}}),validated:S.description?"error":"default"})),s.ZP.createElement(a.cw,{label:e("applyToResourceTypeFlag"),fieldId:"applyToResourceTypeFlag",labelIcon:s.ZP.createElement(P.B,{helpText:"clients-help:applyToResourceTypeFlag",fieldLabelId:"clients:applyToResourceTypeFlag"})},s.ZP.createElement(a.rs,{id:"applyToResourceTypeFlag",name:"applyToResourceTypeFlag",label:e("common:on"),labelOff:e("common:off"),isChecked:O,onChange:U})),O?s.ZP.createElement(a.cw,{label:e("resourceType"),fieldId:"name",labelIcon:s.ZP.createElement(P.B,{helpText:"clients-help:resourceType",fieldLabelId:"resourceType"}),isRequired:"scope"===F},s.ZP.createElement(Z.F,{id:"resourceType",name:"resourceType",ref:i({required:"scope"===F})})):s.ZP.createElement(a.cw,{label:e("resources"),fieldId:"resources",labelIcon:s.ZP.createElement(P.B,{helpText:"clients-help:permissionResources",fieldLabelId:"clients:resources"}),helperTextInvalid:e("common:required"),validated:S.resources?"error":"default",isRequired:"scope"!==F},s.ZP.createElement(I.p,{name:"resources",clientId:C,permissionId:L,preSelected:"scope"===F?void 0:k,variant:"scope"===F?a.TM.typeahead:a.TM.typeaheadMulti,isRequired:"scope"!==F})),"scope"===F&&s.ZP.createElement(a.cw,{label:e("authorizationScopes"),fieldId:"scopes",labelIcon:s.ZP.createElement(P.B,{helpText:"clients-help:permissionScopes",fieldLabelId:"clients:scopesSelect"}),helperTextInvalid:e("common:required"),validated:S.scopes?"error":"default",isRequired:!0},s.ZP.createElement(y,{clientId:C,resourceId:D?.[0],preSelected:k})),s.ZP.createElement(a.cw,{label:e("policies"),fieldId:"policies",labelIcon:s.ZP.createElement(P.B,{helpText:"clients-help:permissionPolicies",fieldLabelId:"clients:policies"})},s.ZP.createElement(I.p,{name:"policies",clientId:C,permissionId:L})),s.ZP.createElement(a.cw,{label:e("decisionStrategy"),labelIcon:s.ZP.createElement(P.B,{helpText:"clients-help:permissionDecisionStrategy",fieldLabelId:"clients:decisionStrategy"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0},s.ZP.createElement(n.Qr,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:g[0],control:T,render:({onChange:t,value:i})=>s.ZP.createElement(s.ZP.Fragment,null,g.map((l=>s.ZP.createElement(a.Y8,{id:l,key:l,"data-testid":l,isChecked:i===l,name:"decisionStrategies",onChange:()=>t(l),label:e(`decisionStrategies.${l}`),className:"pf-u-mb-md"}))))})),s.ZP.createElement(a.WK,null,s.ZP.createElement("div",{className:"pf-u-mt-md"},s.ZP.createElement(a.zx,{variant:a.Wu.primary,type:"submit","data-testid":"save"},e("common:save")),s.ZP.createElement(a.zx,{variant:"link","data-testid":"cancel",component:e=>s.ZP.createElement(l.rU,{...e,to:(0,f.M)({realm:R,clientId:C,tab:"permissions"})})},e("common:cancel")))))))):s.ZP.createElement(E.g,null)}}}]);