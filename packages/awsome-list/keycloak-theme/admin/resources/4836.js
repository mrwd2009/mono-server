"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4836],{2901:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var l=n(5863),c=n(2954),a=n(3802),o=n(710),i=n(8798),r=n(4326),s=n(1677),d=n(3172),p=n(8336),m=n(2820),u=n(1576),P=n(240),E=n(386),f=n(9280),g=n(764),y=n(8707),Z=n(6516),h=n(4839),b=n(1786),S=n(4036);const I=({clientScope:e,save:t})=>{const{t:n}=(0,a.$G)("client-scopes"),{t:i}=(0,a.$G)("clients"),{register:r,control:s,handleSubmit:d,setValue:m,formState:{errors:I}}=(0,u.cI)({defaultValues:{attributes:{"display.on.consent.screen":"true"}}}),{realm:w}=(0,g.PL)(),v=(0,f.RN)(),[T,k]=(0,l.eJ)(!1),[x,C]=(0,l.eJ)(!1),{id:L}=(0,c.UO)(),O=(0,u.qo)({control:s,name:"attributes.display.on.consent.screen",defaultValue:e.attributes?.["display.on.consent.screen"]??"true"});return(0,l.d4)((()=>{(0,p.Fz)(e,m)}),[e]),l.ZP.createElement(h.N,{isHorizontal:!0,onSubmit:d(t),role:"manage-clients"},l.ZP.createElement(o.cw,{label:n("common:name"),labelIcon:l.ZP.createElement(E.B,{helpText:"client-scopes-help:name",fieldLabelId:"name"}),fieldId:"kc-name",isRequired:!0,validated:I.name?o.LD.error:o.LD.default,helperTextInvalid:n("common:required")},l.ZP.createElement(b.F,{ref:r({required:!0,validate:e=>!!e.trim()||n("common:required").toString()}),type:"text",id:"kc-name",name:"name",validated:I.name?o.LD.error:o.LD.default})),l.ZP.createElement(o.cw,{label:n("common:description"),labelIcon:l.ZP.createElement(E.B,{helpText:"client-scopes-help:description",fieldLabelId:"description"}),fieldId:"kc-description",validated:I.description?o.LD.error:o.LD.default,helperTextInvalid:n("common:maxLength",{length:255})},l.ZP.createElement(b.F,{ref:r({maxLength:255}),validated:I.description?o.LD.error:o.LD.default,type:"text",id:"kc-description",name:"description"})),l.ZP.createElement(o.cw,{label:n("type"),labelIcon:l.ZP.createElement(E.B,{helpText:"client-scopes-help:type",fieldLabelId:"client-scopes:type"}),fieldId:"type"},l.ZP.createElement(u.Qr,{name:"type",defaultValue:P.LL[0],control:s,render:({onChange:e,value:t})=>l.ZP.createElement(o.Ph,{id:"type",variant:o.TM.single,isOpen:x,selections:t,onToggle:C,onSelect:(t,n)=>{e(n),C(!1)}},(0,P.cr)(n,P.LL))})),!L&&l.ZP.createElement(o.cw,{label:n("protocol"),labelIcon:l.ZP.createElement(E.B,{helpText:"client-scopes-help:protocol",fieldLabelId:"client-scopes:protocol"}),fieldId:"kc-protocol"},l.ZP.createElement(u.Qr,{name:"protocol",defaultValue:v[0],control:s,render:({onChange:e,value:t})=>l.ZP.createElement(o.Ph,{toggleId:"kc-protocol",required:!0,onToggle:k,onSelect:(t,n)=>{e(n),k(!1)},selections:t,variant:o.TM.single,"aria-label":n("selectEncryptionType"),isOpen:T},v.map((e=>l.ZP.createElement(o.$m,{selected:e===t,key:e,value:e,"data-testid":`option-${e}`},(0,y.K9)(i,e)))))})),l.ZP.createElement(o.cw,{hasNoPaddingTop:!0,label:n("displayOnConsentScreen"),labelIcon:l.ZP.createElement(E.B,{helpText:"client-scopes-help:displayOnConsentScreen",fieldLabelId:"client-scopes:displayOnConsentScreen"}),fieldId:"kc-display.on.consent.screen"},l.ZP.createElement(u.Qr,{name:"attributes.display.on.consent.screen",control:s,defaultValue:O,render:({onChange:e,value:t})=>l.ZP.createElement(o.rs,{id:"kc-display.on.consent.screen-switch",label:n("common:on"),labelOff:n("common:off"),isChecked:"true"===t,onChange:t=>e(""+t)})})),"true"===O&&l.ZP.createElement(o.cw,{label:n("consentScreenText"),labelIcon:l.ZP.createElement(E.B,{helpText:"client-scopes-help:consentScreenText",fieldLabelId:"client-scopes:consentScreenText"}),fieldId:"kc-consent-screen-text"},l.ZP.createElement(S.Q,{ref:r,type:"text",id:"kc-consent-screen-text",name:"attributes.consent.screen.text"})),l.ZP.createElement(o.cw,{hasNoPaddingTop:!0,label:n("includeInTokenScope"),labelIcon:l.ZP.createElement(E.B,{helpText:"client-scopes-help:includeInTokenScope",fieldLabelId:"client-scopes:includeInTokenScope"}),fieldId:"includeInTokenScope"},l.ZP.createElement(u.Qr,{name:"attributes.include.in.token.scope",control:s,defaultValue:"true",render:({onChange:e,value:t})=>l.ZP.createElement(o.rs,{id:"includeInTokenScope-switch",label:n("common:on"),labelOff:n("common:off"),isChecked:"true"===t,onChange:t=>e(""+t)})})),l.ZP.createElement(o.cw,{label:n("guiOrder"),labelIcon:l.ZP.createElement(E.B,{helpText:"client-scopes-help:guiOrder",fieldLabelId:"client-scopes:guiOrder"}),fieldId:"kc-gui-order"},l.ZP.createElement(u.Qr,{name:"attributes.gui.order",defaultValue:"",control:s,render:({onChange:e,value:t})=>l.ZP.createElement(b.F,{id:"kc-gui-order",type:"number",value:t,"data-testid":"displayOrder",min:0,onChange:e})})),l.ZP.createElement(o.WK,null,l.ZP.createElement(o.zx,{variant:"primary",type:"submit"},n("common:save")),l.ZP.createElement(o.zx,{variant:"link",component:e=>l.ZP.createElement(c.rU,{...e,to:(0,Z.W)({realm:w})})},n("common:cancel"))))};var w=n(9766),v=n(2931),T=n(4836),k=n(8007),x=n(7092),C=n(7482);function L(){const{t:e}=(0,a.$G)("client-scopes"),[t,n]=(0,l.eJ)(),u=(0,c.k6)(),{realm:E}=(0,g.PL)(),[f,y]=(0,T.Z)(),{adminClient:Z}=(0,i.K3)(),{id:h,type:b}=(0,c.UO)(),{addAlert:S,addError:L}=(0,r.Z7)(),[O,B]=(0,l.eJ)(0),M=()=>B((new Date).getTime());(0,i.ib)((async()=>{if(h){const t=await Z.clientScopes.findOne({id:h});if(!t)throw new Error(e("common:notFound"));return{...t,type:b}}}),(e=>{n(e)}),[O,h]);const D=async t=>{try{if(t.name=t.name?.trim().replace(/ /g,"_"),t=(0,p.a)(t),h)await Z.clientScopes.update({id:h},t),(0,P.Wr)(Z,{...t,id:h,type:b},t.type);else{await Z.clientScopes.create(t);const n=await Z.clientScopes.findOneByName({name:t.name});if(!n)throw new Error(e("common:notFound"));(0,P.Wr)(Z,{...t,id:n.id},t.type),u.push((0,x.w)({realm:E,id:n.id,type:t.type||"none",tab:"settings"}))}S(e((h?"update":"create")+"Success"),o.Ux.success)}catch(e){L(`client-scopes:${h?"update":"create"}Error`,e)}},[U,K]=(0,w.W)({titleKey:e("deleteClientScope",{count:1,name:t?.name}),messageKey:"client-scopes:deleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:o.Wu.danger,onConfirm:async()=>{try{await Z.clientScopes.del({id:h}),S(e("deletedSuccess"),o.Ux.success)}catch(e){L("client-scopes:deleteError",e)}}});if(h&&!t)return l.ZP.createElement(d.g,null);const N=e=>(0,C.w)({to:(0,x.w)({realm:E,id:h,tab:e,type:b}),history:u});return l.ZP.createElement(l.ZP.Fragment,null,l.ZP.createElement(K,null),l.ZP.createElement(s.t,{titleKey:t?t.name:"client-scopes:createClientScope",dropdownItems:t?[l.ZP.createElement(o.hP,{key:"delete",onClick:U},e("common:delete"))]:void 0,badges:[{text:t?t.protocol:void 0}],divider:!h}),l.ZP.createElement(o.NP,{variant:"light",className:"pf-u-p-0"},!h&&l.ZP.createElement(o.NP,{variant:"light"},l.ZP.createElement(I,{save:D,clientScope:{}})),h&&t&&l.ZP.createElement(C.U,{isBox:!0},l.ZP.createElement(o.OK,{id:"settings","data-testid":"settings",title:l.ZP.createElement(o.TP,null,e("common:settings")),...N("settings")},l.ZP.createElement(o.NP,{variant:"light"},l.ZP.createElement(I,{save:D,clientScope:t}))),l.ZP.createElement(o.OK,{id:"mappers","data-testid":"mappers",title:l.ZP.createElement(o.TP,null,e("common:mappers")),...N("mappers")},l.ZP.createElement(m.t,{model:t,onAdd:async n=>{if(Array.isArray(n))try{await Z.clientScopes.addMultipleProtocolMappers({id:t.id},n),M(),S(e("common:mappingCreatedSuccess"),o.Ux.success)}catch(e){L("common:mappingCreatedError",e)}else{const e=n;u.push((0,k.J)({realm:E,id:t.id,type:b,mapperId:e.id}))}},onDelete:async n=>{try{await Z.clientScopes.delProtocolMapper({id:t.id,mapperId:n.id}),S(e("common:mappingDeletedSuccess"),o.Ux.success),M()}catch(e){L("common:mappingDeletedError",e)}return!0},detailLink:e=>(0,k.J)({realm:E,id:t.id,type:b,mapperId:e})})),l.ZP.createElement(o.OK,{id:"scope","data-testid":"scopeTab",title:l.ZP.createElement(o.TP,null,e("scope")),...N("scope")},l.ZP.createElement(v.Bo,{id:h,name:t.name,type:"clientScopes",loader:async()=>{const e=(await Z.clientScopes.listRealmScopeMappings({id:h})).map((e=>({role:e}))),t=(await Z.clientScopes.listCompositeRealmScopeMappings({id:h})).map((e=>({role:e}))),n=await Z.clients.find(),l=(await Promise.all(n.map((async e=>{const t=(await Z.clientScopes.listClientScopeMappings({id:h,client:e.id})).map((t=>({role:t,client:e}))),n=(await Z.clientScopes.listCompositeClientScopeMappings({id:h,client:e.id})).map((t=>({role:t,client:e})));return(0,v.cc)(t,n,f)})))).flat();return[...(0,v.cc)(e,t,f),...l]},save:async t=>{try{const n=t.filter((e=>void 0===e.client)).map((e=>e.role)).flat();await Z.clientScopes.addRealmScopeMappings({id:h},n),await Promise.all(t.filter((e=>void 0!==e.client)).map((e=>Z.clientScopes.addClientScopeMappings({id:h,client:e.client.id},[e.role])))),S(e("roleMappingUpdatedSuccess"),o.Ux.success)}catch(e){L("client-scopes:roleMappingUpdatedError",e)}},onHideRolesToggle:y})))))}}}]);