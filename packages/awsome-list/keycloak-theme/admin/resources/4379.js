"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4379],{4379:(e,t,r)=>{r.r(t),r.d(t,{default:()=>J});var a=r(5863),n=r(2954),s=r(3802),o=r(710),l=r(1677),i=r(8798),c=r(4326),m=r(764),u=r(8312),d=r(2688),p=r(192),g=r(1586),P=r(1576),y=r(1786);const h=({id:e,rename:t,handleModalToggle:r,refresh:n})=>{const{t:l}=(0,s.$G)("groups"),{adminClient:m}=(0,i.K3)(),{addAlert:u,addError:d}=(0,c.Z7)(),{register:p,handleSubmit:g,formState:{errors:h}}=(0,P.cI)({defaultValues:{name:t}});return a.ZP.createElement(o.u_,{variant:o.vE.small,title:l(t?"renameAGroup":"createAGroup"),isOpen:!0,onClose:r,actions:[a.ZP.createElement(o.zx,{"data-testid":(t?"rename":"create")+"Group",key:"confirm",variant:"primary",type:"submit",form:"group-form"},l(t?"rename":"create")),a.ZP.createElement(o.zx,{id:"modal-cancel","data-testid":"cancel",key:"cancel",variant:o.Wu.link,onClick:()=>{r()}},l("common:cancel"))]},a.ZP.createElement(o.l0,{id:"group-form",isHorizontal:!0,onSubmit:g((async a=>{a.name=a.name?.trim();try{e?t?await m.groups.update({id:e},a):await m.groups.setOrCreateChild({id:e},a):await m.groups.create(a),n(t?a:void 0),r(),u(l(t?"groupUpdated":"groupCreated"),o.Ux.success)}catch(e){d("groups:couldNotCreateGroup",e)}}))},a.ZP.createElement(o.cw,{name:"create-modal-group",label:l("common:name"),fieldId:"group-id",helperTextInvalid:l("common:required"),validated:h.name?o.LD.error:o.LD.default,isRequired:!0},a.ZP.createElement(y.F,{"data-testid":"groupNameInput","aria-label":"group name input",ref:p({required:!0}),autoFocus:!0,type:"text",id:"create-group-name",name:"name",validated:h.name?o.LD.error:o.LD.default}))))},E=e=>{const t=e.substr(1).split("/");return t.length>1?t.splice(2):void 0},Z=e=>{const t=E(e);return t?t[t.length-1]:void 0};var b=r(8326),f=r(9766),G=r(9623),C=r(8670);const v=()=>{const{t:e}=(0,s.$G)("groups"),{adminClient:t}=(0,i.K3)(),{addAlert:r,addError:l}=(0,c.Z7)(),{realm:P}=(0,m.PL)(),[y,E]=(0,a.eJ)(!1),[v,w]=(0,a.eJ)(!1),[k,K]=(0,a.eJ)([]),[U,x]=(0,a.eJ)(),{subGroups:T,currentGroup:I,setSubGroups:M}=(0,u.D)(),[A,F]=(0,a.eJ)(0),S=()=>F((new Date).getTime()),R=(0,n.k6)(),D=(0,n.TH)(),L=Z(D.pathname),{hasAccess:J}=(0,C.md)(),N=J("manage-users")||I()?.access?.manage,O=J("query-groups","view-users")||J("manage-users","query-groups"),$=()=>{w(!v)},[q,z]=(0,f.W)({titleKey:e("deleteConfirmTitle",{count:k.length}),messageKey:e("deleteConfirm",{count:k.length}),continueButtonLabel:"common:delete",continueButtonVariant:o.Wu.danger,onConfirm:async()=>{try{for(const e of k)await t.groups.del({id:e.id});r(e("groupDeleted",{count:k.length}),o.Ux.success),K([])}catch(e){l("groups:groupDeleteError",e)}S()}});return a.ZP.createElement(a.ZP.Fragment,null,a.ZP.createElement(z,null),a.ZP.createElement(p.B,{key:`${L}${A}`,onSelect:e=>K([...e]),canSelectAll:!0,loader:async()=>{let r;if(L){const a=await t.groups.findOne({id:L});if(!a)throw new Error(e("common:notFound"));r=a.subGroups}else r=await t.groups.find({briefRepresentation:!1});return r||R.push((0,G.J)({realm:P})),r||[]},ariaLabelKey:"groups:groups",searchPlaceholderKey:"groups:searchForGroups",toolbarItem:N&&a.ZP.createElement(a.ZP.Fragment,null,a.ZP.createElement(o.Eg,null,a.ZP.createElement(o.zx,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:$},e("createGroup"))),a.ZP.createElement(o.Eg,null,a.ZP.createElement(o.Lt,{toggle:a.ZP.createElement(o.ax,{onToggle:()=>E(!y),isDisabled:0===k.length}),isOpen:y,isPlain:!0,dropdownItems:[a.ZP.createElement(o.hP,{key:"action",component:"button",onClick:()=>{q(),E(!1)}},e("common:delete"))]}))),actions:N?[{title:e("moveTo"),onRowClick:async e=>(x(e),!1)},{title:e("common:delete"),onRowClick:async e=>(K([e]),q(),!0)}]:[],columns:[{name:"name",displayKey:"groups:groupName",cellRenderer:e=>O?a.ZP.createElement(n.rU,{key:e.id,to:`${D.pathname}/${e.id}`,onClick:async()=>{const r=await t.groups.findOne({id:e.id});M([...T,r])}},e.name):a.ZP.createElement("span",null,e.name),transforms:[(0,d.dY)(90)]}],emptyState:a.ZP.createElement(g.M,{hasIcon:!0,message:e("noGroupsInThis"+(L?"SubGroup":"Realm")),instructions:e(`noGroupsInThis${L?"SubGroup":"Realm"}Instructions`),primaryActionText:e("createGroup"),onPrimaryAction:$})}),v&&a.ZP.createElement(h,{id:L,handleModalToggle:$,refresh:S}),U&&a.ZP.createElement(b.p,{type:"selectOne",filterGroups:[U.name],text:{title:"groups:moveToGroup",ok:"groups:moveHere"},onClose:()=>x(void 0),onConfirm:async a=>{try{if(void 0!==a)try{await t.groups.setOrCreateChild({id:a[0].id},U)}catch(e){if(e.response)throw e}else{await t.groups.del({id:U.id});const{id:e}=await t.groups.create({...U,id:void 0});U.subGroups&&await Promise.all(U.subGroups.map((r=>t.groups.setOrCreateChild({id:e},{...r,id:void 0}))))}x(void 0),S(),r(e("moveGroupSuccess"),o.Ux.success)}catch(e){l("groups:moveGroupError",e)}}}))};var w=r(390),k=r(8336);const K=({groupId:e,onClose:t})=>{const{t:r}=(0,s.$G)("groups"),{adminClient:n}=(0,i.K3)(),{addAlert:l,addError:m}=(0,c.Z7)(),[u,d]=(0,a.eJ)([]);return a.ZP.createElement(o.u_,{variant:o.vE.large,title:r("addMember"),isOpen:!0,onClose:t,actions:[a.ZP.createElement(o.zx,{"data-testid":"add",key:"confirm",variant:"primary",onClick:async()=>{try{await Promise.all(u.map((t=>n.users.addToGroup({id:t.id,groupId:e})))),t(),l(r("usersAdded",{count:u.length}),o.Ux.success)}catch(e){m("groups:usersAddedError",e)}}},r("common:add")),a.ZP.createElement(o.zx,{"data-testid":"cancel",key:"cancel",variant:"link",onClick:t},r("common:cancel"))]},a.ZP.createElement(p.B,{loader:async(t,r,a)=>{const s=await n.groups.listMembers({id:e}),o={first:t,max:r+s.length,search:a||""};try{const e=await n.users.find({...o});return(0,w.mz)(e,s,"id").slice(0,r)}catch(e){return m("groups:noUsersFoundError",e),[]}},isPaginated:!0,ariaLabelKey:"users:title",searchPlaceholderKey:"users:searchForUser",canSelectAll:!0,onSelect:e=>d([...e]),emptyState:a.ZP.createElement(g.M,{message:r("users:noUsersFound"),instructions:r("users:emptyInstructions")}),columns:[{name:"username",displayKey:"users:username"},{name:"email",displayKey:"users:email"},{name:"lastName",displayKey:"users:lastName",cellFormatters:[(0,k.CU)()]},{name:"firstName",displayKey:"users:firstName",cellFormatters:[(0,k.CU)()]}]}))};var U=r(2432),x=r(4467);const T=()=>{const{t:e}=(0,s.$G)("groups"),{adminClient:t}=(0,i.K3)(),{realm:r}=(0,m.PL)(),{addAlert:l,addError:d}=(0,c.Z7)(),P=(0,n.TH)(),y=Z(P.pathname),[h,E]=(0,a.eJ)(!1),{currentGroup:b}=(0,u.D)(),[f,G]=(0,a.eJ)(!1),[v,T]=(0,a.eJ)(!1),[I,M]=(0,a.eJ)([]),{hasAccess:A}=(0,C.md)(),F=A("manage-users")||b().access.manageMembership,[S,R]=(0,a.eJ)(0),D=()=>R((new Date).getTime()),L=e=>{let t=[];for(const r of e){t.push(r);const e=L(r.subGroups);t=t.concat(e)}return t};return a.ZP.createElement(a.ZP.Fragment,null,f&&a.ZP.createElement(K,{groupId:y,onClose:()=>{G(!1),D()}}),a.ZP.createElement(p.B,{"data-testid":"members-table",key:`${y}${S}${h}`,loader:async(e,r)=>{let a=await t.groups.listMembers({id:y,first:e,max:r});if(h){const e=L(b()?.subGroups);for(const r of e)a=a.concat(await t.groups.listMembers({id:r.id}));a=(0,w.mN)(a,(e=>e.username))}const n=await Promise.all(a.map((e=>(async e=>await t.users.listGroups({id:e}))(e.id))));return a.map(((e,t)=>({...e,membership:n[t]})))},ariaLabelKey:"groups:members",isPaginated:!0,canSelectAll:!0,onSelect:e=>M([...e]),toolbarItem:F&&a.ZP.createElement(a.ZP.Fragment,null,a.ZP.createElement(o.Eg,null,a.ZP.createElement(o.zx,{"data-testid":"addMember",variant:"primary",onClick:()=>G(!0)},e("addMember"))),a.ZP.createElement(o.Eg,null,a.ZP.createElement(o.XZ,{"data-testid":"includeSubGroupsCheck",label:e("includeSubGroups"),id:"kc-include-sub-groups",isChecked:h,onChange:()=>E(!h)})),a.ZP.createElement(o.Eg,null,a.ZP.createElement(o.Lt,{toggle:a.ZP.createElement(o.ax,{onToggle:()=>T(!v),isDisabled:0===I.length}),isOpen:v,isPlain:!0,dropdownItems:[a.ZP.createElement(o.hP,{key:"action",component:"button",onClick:async()=>{try{await Promise.all(I.map((e=>t.users.delFromGroup({id:e.id,groupId:y})))),T(!1),l(e("usersLeft",{count:I.length}),o.Ux.success)}catch(e){d("groups:usersLeftError",e)}D()}},e("leave"))]}))),actions:F?[{title:e("leave"),onRowClick:async r=>{try{await t.users.delFromGroup({id:r.id,groupId:y}),l(e("usersLeft",{count:1}),o.Ux.success)}catch(e){d("groups:usersLeftError",e)}return!0}}]:[],columns:[{name:"username",displayKey:"common:name",cellRenderer:e=>a.ZP.createElement(n.rU,{key:e.id,to:(0,x.Z)({realm:r,id:e.id,tab:"settings"})},e.username)},{name:"email",displayKey:"groups:email",cellFormatters:[(0,k.CU)()]},{name:"firstName",displayKey:"groups:firstName",cellFormatters:[(0,k.CU)()]},{name:"lastName",displayKey:"groups:lastName",cellFormatters:[(0,k.CU)()]},{name:"membership",displayKey:"groups:membership",cellRenderer:e=>a.ZP.createElement(a.ZP.Fragment,null,e.membership.map(((t,r)=>a.ZP.createElement(a.ZP.Fragment,null,a.ZP.createElement(U.g,{key:t.id,group:t}),e.membership[r+1]?", ":""))))}],emptyState:a.ZP.createElement(g.M,{message:e("users:noUsersFound"),instructions:F?e("users:emptyInstructions"):void 0,primaryActionText:F?e("addMember"):void 0,onPrimaryAction:()=>G(!0)})}))};var I=r(5482),M=r(5260);const A=()=>{const{t:e}=(0,s.$G)("groups"),{adminClient:t}=(0,i.K3)(),{addAlert:r,addError:l}=(0,c.Z7)(),m=(0,P.cI)({mode:"onChange",shouldUnregister:!1}),d=(0,n.TH)(),p=Z(d.pathname),{currentGroup:g,subGroups:y,setSubGroups:h}=(0,u.D)(),E=e=>(0,M.q)(e||g()?.attributes);return(0,a.d4)((()=>{m.setValue("attributes",E())}),[y]),a.ZP.createElement(o.NP,{variant:o.Dk.light},a.ZP.createElement(I.m,{form:m,save:async a=>{try{const n=g(),s=(0,M.Y)(a.attributes);await t.groups.update({id:p},{...n,attributes:s}),h([...y.slice(0,y.length-1),{...n,attributes:s}]),r(e("groupUpdated"),o.Ux.success)}catch(e){l("groups:groupUpdateError",e)}},fineGrainedAccess:g()?.access?.manage,reset:()=>m.reset({attributes:E()})}))};var F=r(994),S=r(2931);const R=({id:e,name:t})=>{const{t:r}=(0,s.$G)("clients"),{adminClient:n}=(0,i.K3)(),{addAlert:l,addError:m}=(0,c.Z7)(),[u,d]=(0,a.eJ)(!1);return a.ZP.createElement(S.Bo,{name:t,id:e,type:"groups",loader:async()=>{const[t,r]=await Promise.all([n.groups.listRealmRoleMappings({id:e}).then((e=>e.map((e=>({role:e}))))),n.groups.listCompositeRealmRoleMappings({id:e}).then((e=>e.map((e=>({role:e})))))]),a=await n.clients.find(),s=(await Promise.all(a.map((async t=>{const[r,a]=await Promise.all([n.groups.listClientRoleMappings({id:e,clientUniqueId:t.id}).then((e=>e.map((e=>({role:e,client:t}))))),n.groups.listCompositeClientRoleMappings({id:e,clientUniqueId:t.id}).then((e=>e.map((e=>({role:e,client:t})))))]);return(0,S.cc)(r,a,u)})))).flat();return[...(0,S.cc)(t,r,u),...s]},save:async t=>{try{const a=t.filter((e=>void 0===e.client)).map((e=>e.role)).flat();await n.groups.addRealmRoleMappings({id:e,roles:a}),await Promise.all(t.filter((e=>void 0!==e.client)).map((t=>n.groups.addClientRoleMappings({id:e,clientUniqueId:t.client.id,roles:[t.role]})))),l(r("roleMappingUpdatedSuccess"),o.Ux.success)}catch(e){m("clients:roleMappingUpdatedError",e)}},onHideRolesToggle:()=>d(!u)})};var D=r(9176),L=r(860);function J(){const{t:e}=(0,s.$G)("groups"),[t,r]=(0,a.eJ)(0),{adminClient:d}=(0,i.K3)(),{subGroups:p,setSubGroups:g,currentGroup:P}=(0,u.D)(),{addAlert:y,addError:b}=(0,c.Z7)(),{realm:f}=(0,m.PL)(),[w,k]=(0,a.eJ)(),K=(0,n.k6)(),U=(0,n.TH)(),x=Z(U.pathname),{hasAccess:I}=(0,C.md)(),M=I("manage-authorization","manage-users","manage-clients"),S=I("manage-users")||P()?.access?.manage,J=I("manage-users");(0,i.ib)((async()=>{const t=E(U.pathname);if(t&&t.length>p.length){const r=[];for(const a of t){const t="search"!==a?await d.groups.findOne({id:a}):{name:e("searchGroups"),id:"search"};if(!t)throw new Error(e("common:notFound"));r.push(t)}return r}return[]}),(e=>{e.length&&g(e)}),[x]);const N=a.ZP.createElement(o.hP,{key:"searchGroup",component:a.ZP.createElement(n.rU,{"data-testid":"searchGroup",to:(0,F.R)({realm:f})},e("searchGroup"))});return a.ZP.createElement(a.ZP.Fragment,null,w&&a.ZP.createElement(h,{id:x,rename:w,refresh:e=>g([...p.slice(0,p.length-1),e]),handleModalToggle:()=>k(void 0)}),a.ZP.createElement(l.t,{titleKey:x?P()?.name:"groups:groups",subKey:x?"":"groups:groupsDescription",helpUrl:x?"":D.Z.groupsUrl,divider:!x,dropdownItems:x&&S?[N,a.ZP.createElement(o.hP,{"data-testid":"renameGroupAction",key:"renameGroup",onClick:()=>k(P()?.name)},e("renameGroup")),a.ZP.createElement(o.hP,{"data-testid":"deleteGroup",key:"deleteGroup",onClick:async()=>{await(async t=>{try{await d.groups.del({id:t.id}),y(e("groupDeleted",{count:1}),o.Ux.success)}catch(e){b("groups:groupDeleteError",e)}return!0})({id:x}),K.push((0,G.J)({realm:f}))}},e("deleteGroup"))]:[N]}),a.ZP.createElement(o.NP,{variant:o.Dk.light,className:"pf-u-p-0"},p.length>0&&a.ZP.createElement(o.mQ,{inset:{default:"insetNone",md:"insetSm",xl:"insetLg","2xl":"inset2xl"},activeKey:t,onSelect:(e,t)=>r(t),isBox:!0},a.ZP.createElement(o.OK,{"data-testid":"groups",eventKey:0,title:a.ZP.createElement(o.TP,null,e("childGroups"))},a.ZP.createElement(v,null)),a.ZP.createElement(o.OK,{"data-testid":"members",eventKey:1,title:a.ZP.createElement(o.TP,null,e("members"))},a.ZP.createElement(T,null)),a.ZP.createElement(o.OK,{"data-testid":"attributes",eventKey:2,title:a.ZP.createElement(o.TP,null,e("common:attributes"))},a.ZP.createElement(A,null)),J&&a.ZP.createElement(o.OK,{eventKey:3,"data-testid":"role-mapping-tab",title:a.ZP.createElement(o.TP,null,e("roleMapping"))},a.ZP.createElement(R,{id:x,name:P()?.name})),M&&a.ZP.createElement(o.OK,{eventKey:4,"data-testid":"permissionsTab",title:a.ZP.createElement(o.TP,null,e("common:permissions"))},a.ZP.createElement(L.y,{id:x,type:"groups"}))),0===p.length&&a.ZP.createElement(v,null)))}}}]);