"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1935],{1935:(e,t,a)=>{a.r(t),a.d(t,{default:()=>oe,providerConditionFilter:()=>le});var n=a(5863),i=a(2954),l=a(3802),o=a(710),c=a(7973),r=a(1677),d=a(8798),s=a(1586),m=a(6853),u=a(3227);const p=({list:e,setValue:t})=>n.ZP.createElement(o.NP,{variant:"light",className:"pf-u-py-lg"},n.ZP.createElement(o.l0,{isHorizontal:!0},e?.map((a=>n.ZP.createElement(o.Y8,{id:a.id,key:a.id,name:"provider",label:a.displayName,"data-testid":a.id,description:a.description,onChange:(a,n)=>{const{id:i}=n.currentTarget,l=e.find((e=>e.id===i));t(l)}}))))),E=({name:e,type:t,onSelect:a})=>{const{t:i}=(0,l.$G)("authentication"),{adminClient:c}=(0,d.K3)(),[r,s]=(0,n.eJ)(),[E,P]=(0,n.eJ)(),[h,g]=(0,n.eJ)(10),[Z,f]=(0,n.eJ)(0),y=(0,u.Z)();(0,d.ib)((async()=>{switch(t){case"client":return c.authenticationManagement.getClientAuthenticatorProviders();case"form":return c.authenticationManagement.getFormActionProviders();case"condition":return(await c.authenticationManagement.getAuthenticatorProviders()).filter(le);default:return(await c.authenticationManagement.getAuthenticatorProviders()).filter((e=>!le(e)))}}),(e=>P(e)),[]);const w=(0,n.Ye)((()=>y(E??[],(0,u.x)("displayName")).slice(Z,Z+h+1)),[E,Z,h]);return n.ZP.createElement(o.u_,{variant:o.vE.medium,isOpen:!0,title:i("addStepTo",{name:e}),onClose:()=>a(),actions:[n.ZP.createElement(o.zx,{id:"modal-add","data-testid":"modal-add",key:"add",onClick:()=>a(r)},i("common:add")),n.ZP.createElement(o.zx,{"data-testid":"cancel",id:"modal-cancel",key:"cancel",variant:o.Wu.link,onClick:()=>{a()}},i("common:cancel"))]},E&&E.length>h&&n.ZP.createElement(m.a,{count:w.length||0,first:Z,max:h,onNextClick:f,onPreviousClick:f,onPerPageSelect:(e,t)=>{f(e),g(t)}},n.ZP.createElement(p,{list:w,setValue:s})),E&&E.length<=h&&n.ZP.createElement(p,{list:E,setValue:s}))};var P=a(1576),h=a(386),g=a(1786);const Z=["basic-flow","form-flow"],f=({name:e,onConfirm:t,onCancel:a})=>{const{t:i}=(0,l.$G)("authentication"),{register:c,control:r,handleSubmit:s,formState:{errors:m}}=(0,P.cI)(),[u,p]=(0,n.eJ)(!1),[E,f]=(0,n.eJ)(!1),[y,w]=(0,n.eJ)(),{adminClient:x}=(0,d.K3)();return(0,d.ib)((()=>x.authenticationManagement.getFormProviders()),(e=>w(e)),[]),n.ZP.createElement(o.u_,{variant:o.vE.medium,isOpen:!0,title:i("addStepTo",{name:e}),onClose:()=>a(),actions:[n.ZP.createElement(o.zx,{id:"modal-add","data-testid":"modal-add",key:"add",type:"submit",form:"sub-flow-form"},i("common:add")),n.ZP.createElement(o.zx,{"data-testid":"cancel",id:"modal-cancel",key:"cancel",variant:o.Wu.link,onClick:()=>{a()}},i("common:cancel"))]},n.ZP.createElement(o.l0,{id:"sub-flow-form",isHorizontal:!0,onSubmit:s(t)},n.ZP.createElement(o.cw,{label:i("common:name"),fieldId:"name",helperTextInvalid:i("common:required"),validated:m.name?o.LD.error:o.LD.default,isRequired:!0,labelIcon:n.ZP.createElement(h.B,{helpText:"authentication-help:name",fieldLabelId:"name"})},n.ZP.createElement(g.F,{type:"text",id:"name",name:"name","data-testid":"name",ref:c({required:!0}),validated:m.name?o.LD.error:o.LD.default})),n.ZP.createElement(o.cw,{label:i("common:description"),fieldId:"description",labelIcon:n.ZP.createElement(h.B,{helpText:"authentication-help:description",fieldLabelId:"description"})},n.ZP.createElement(g.F,{type:"text",id:"description",name:"description","data-testid":"description",ref:c})),n.ZP.createElement(o.cw,{label:i("flowType"),labelIcon:n.ZP.createElement(h.B,{helpText:"authentication-help:flowType",fieldLabelId:"authentication:flowType"}),fieldId:"flowType"},n.ZP.createElement(P.Qr,{name:"type",defaultValue:Z[0],control:r,render:({onChange:e,value:t})=>n.ZP.createElement(o.Ph,{menuAppendTo:"parent",toggleId:"flowType",onToggle:p,onSelect:(t,a)=>{e(a),p(!1)},selections:i(`flow-type.${t}`),variant:o.TM.single,"aria-label":i("flowType"),isOpen:u},Z.map((e=>n.ZP.createElement(o.$m,{selected:e===t,key:e,value:e},i(`flow-type.${e}`)))))})),y&&y.length>1&&n.ZP.createElement(o.cw,{label:i("flowType"),labelIcon:n.ZP.createElement(h.B,{helpText:"authentication-help:flowType",fieldLabelId:"authentication:flowType"}),fieldId:"flowType"},n.ZP.createElement(P.Qr,{name:"provider",defaultValue:"",control:r,render:({onChange:e,value:t})=>n.ZP.createElement(o.Ph,{menuAppendTo:"parent",toggleId:"provider",onToggle:f,onSelect:(t,a)=>{e(a.toString()),f(!1)},selections:t.displayName,variant:o.TM.single,"aria-label":i("flowType"),isOpen:E},y.map((e=>n.ZP.createElement(o.$m,{selected:e.displayName===t,key:e.id,value:e},e.displayName))))})),1===y?.length&&n.ZP.createElement("input",{name:"provider",type:"hidden",ref:c,value:y[0].id})))},y=["addExecution","addSubFlow"],w=({flow:e,onAddExecution:t,onAddFlow:a})=>{const{t:i}=(0,l.$G)("authentication"),[c,r]=(0,n.eJ)();return n.ZP.createElement(n.ZP.Fragment,null,"addExecution"===c&&n.ZP.createElement(E,{name:e.alias,type:"client-flow"===e.providerId?"client":"basic",onSelect:e=>{e&&t(e),r(void 0)}}),"addSubFlow"===c&&n.ZP.createElement(f,{name:e.alias,onCancel:()=>r(void 0),onConfirm:e=>{a(e),r(void 0)}}),n.ZP.createElement(s.M,{message:i("emptyExecution"),instructions:i("emptyExecutionInstructions")}),n.ZP.createElement("div",{className:"keycloak__empty-execution-state__block"},y.map((e=>n.ZP.createElement(o.kC,{key:e,className:"keycloak__empty-execution-state__help"},n.ZP.createElement(o.B5,{flex:{default:"flex_1"}},n.ZP.createElement(o.Dx,{headingLevel:"h3",size:o.gY.md},i(`${e}Title`)),n.ZP.createElement("p",null,i(`authentication-help:${e}`))),n.ZP.createElement(o.kC,{alignSelf:{default:"alignSelfCenter"}},n.ZP.createElement(o.B5,null,n.ZP.createElement(o.zx,{"data-testid":e,variant:"tertiary",onClick:()=>r(e)},i(e)))))))))};var x=a(8336);const b=()=>{const{t:e}=(0,l.$G)("authentication");return n.ZP.createElement(o.LC,{"aria-labelledby":"headerName",id:"header"},n.ZP.createElement(o.Vi,null,n.ZP.createElement(o.D7,{className:"keycloak__authentication__header-drag-button","aria-label":e("common:disabled")}),n.ZP.createElement(o.p9,{className:"keycloak__authentication__header",dataListCells:[n.ZP.createElement(o.KX,{key:"step",id:"headerName"},e("steps")),n.ZP.createElement(o.KX,{key:"requirement"},e("requirement")),n.ZP.createElement(o.KX,{key:"config"})]})))},C=({id:e,title:t})=>n.ZP.createElement(o.Zb,{"data-testid":t,className:"keycloak__authentication__title",isFlat:!0},n.ZP.createElement(o.eW,{"data-id":e,id:`title-id-${e}`},t)),v=({flow:e,onChange:t})=>{const{t:a}=(0,l.$G)("authentication"),[i,c]=(0,n.eJ)(!1),r=e.requirementChoices.map(((e,t)=>n.ZP.createElement(o.$m,{key:t,value:e},a(`requirements.${e}`))));return n.ZP.createElement(n.ZP.Fragment,null,e.requirementChoices&&e.requirementChoices.length>1&&n.ZP.createElement(o.Ph,{className:"keycloak__authentication__requirement-dropdown",variant:o.TM.single,onToggle:c,onSelect:(a,n)=>{e.requirement=n.toString(),t(e),c(!1)},selections:[e.requirement],isOpen:i},r),(!e.requirementChoices||e.requirementChoices.length<=1)&&n.ZP.createElement(n.ZP.Fragment,null,a(`requirements.${e.requirement}`)))};var k=a(4326),L=a(5954);const F=({execution:e})=>{const{t}=(0,l.$G)("authentication"),{adminClient:a}=(0,d.K3)(),{addAlert:i,addError:r}=(0,k.Z7)(),[s,m]=(0,n.eJ)(!1),[u,p]=(0,n.eJ)(),[E,Z]=(0,n.eJ)(),f=(0,P.cI)(),{register:y,setValue:w,handleSubmit:x,formState:{errors:b}}=f;return(0,d.ib)((async()=>{const t=await a.authenticationManagement.getConfigDescription({providerId:e.providerId});let n;return e.authenticationConfig&&(n=await a.authenticationManagement.getConfig({id:e.authenticationConfig})),{configDescription:t,config:n}}),(({configDescription:e,config:t})=>{Z(e),p(t)}),[]),(0,n.d4)((()=>{var e;E&&(e=u,E.properties.map((t=>{w(`config.${t.name}`,e?.config?.[t.name]||t.defaultValue||"")})),e&&(w("alias",e.alias),w("id",e.id)))}),[s]),n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement(o.u,{content:t("common:settings")},n.ZP.createElement(o.zx,{variant:"plain","aria-label":t("common:settings"),onClick:()=>m(!0)},n.ZP.createElement(c.IE,null))),E&&n.ZP.createElement(o.u_,{variant:o.vE.small,isOpen:s,title:t("executionConfig",{name:E.name}),onClose:()=>m(!1)},n.ZP.createElement(o.l0,{id:"execution-config-form",onSubmit:x((async n=>{try{if(u){const e={...u,config:n.config};await a.authenticationManagement.updateConfig(e),p({...e.config})}else{const t={id:e.id,alias:n.alias,config:n.config},{id:i}=await a.authenticationManagement.createConfig(t);p({...t.config,id:i,alias:t.alias})}i(t("configSaveSuccess"),o.Ux.success),m(!1)}catch(e){r("authentication:configSaveError",e)}}))},n.ZP.createElement(o.cw,{label:t("alias"),fieldId:"alias",helperTextInvalid:t("common:required"),validated:b.alias?o.LD.error:o.LD.default,isRequired:!0,labelIcon:n.ZP.createElement(h.B,{helpText:"authentication-help:alias",fieldLabelId:"authentication:alias"})},n.ZP.createElement(g.F,{isReadOnly:!!u,type:"text",id:"alias",name:"alias","data-testid":"alias",ref:y({required:!0}),validated:b.alias?o.LD.error:o.LD.default})),n.ZP.createElement(P.RV,{...f},n.ZP.createElement(L.K,{properties:E.properties||[]})),n.ZP.createElement(o.WK,null,n.ZP.createElement(o.zx,{"data-testid":"save",variant:"primary",type:"submit"},t("common:save")),n.ZP.createElement(o.zx,{"data-testid":"cancel",variant:o.Wu.link,onClick:()=>{m(!1)}},t("common:cancel")),u&&n.ZP.createElement(o.zx,{className:"pf-u-ml-4xl","data-testid":"clear",variant:o.Wu.link,onClick:async()=>{await a.authenticationManagement.delConfig({id:u.id}),p(void 0),m(!1)}},t("common:clear")," ",n.ZP.createElement(c.XH,null))))))},_=({execution:e,onAddExecution:t,onAddFlow:a})=>{const{t:i}=(0,l.$G)("authentication"),{adminClient:r}=(0,d.K3)(),[s,m]=(0,n.eJ)(!1),[u,p]=(0,n.eJ)(),[P,h]=(0,n.eJ)();return(0,d.ib)((()=>r.authenticationManagement.getFlow({flowId:e.flowId})),(({providerId:e})=>h(e)),[]),n.ZP.createElement(o.u,{content:i("common:add")},n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement(o.Lt,{isPlain:!0,position:"right","data-testid":`${e.displayName}-edit-dropdown`,isOpen:s,toggle:n.ZP.createElement(o.Z_,{onToggle:m,"aria-label":i("common:add")},n.ZP.createElement(c.pO,null)),dropdownItems:[n.ZP.createElement(o.hP,{key:"addStep",onClick:()=>p("form-flow"===P?"form":"basic")},i("addStep")),n.ZP.createElement(o.hP,{key:"addCondition",onClick:()=>p("condition")},i("addCondition")),n.ZP.createElement(o.hP,{key:"addSubFlow",onClick:()=>p("subFlow")},i("addSubFlow"))],onSelect:()=>m(!1)}),u&&"subFlow"!==u&&n.ZP.createElement(E,{name:e.displayName,type:u,onSelect:a=>{a&&t(e,a),p(void 0)}}),"subFlow"===u&&n.ZP.createElement(f,{name:e.displayName,onCancel:()=>p(void 0),onConfirm:t=>{a(e,t),p(void 0)}})))};var I=a(4836),N=a(4036);const S=({execution:e,onRowChange:t})=>{const{t:a}=(0,l.$G)("authentication"),{register:i,errors:r,reset:d,handleSubmit:s}=(0,P.cI)(),[m,u]=(0,I.Z)();return(0,n.d4)((()=>{d(e)}),[e,d]),n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement(o.u,{content:a("common:edit")},n.ZP.createElement(o.zx,{variant:"plain","data-testid":`${e.id}-edit`,"aria-label":a("common:edit"),onClick:u},n.ZP.createElement(c.sC,null))),m&&n.ZP.createElement(o.u_,{title:a("editFlow"),isOpen:!0,onClose:u,variant:o.vE.small,actions:[n.ZP.createElement(o.zx,{id:"modal-confirm",key:"confirm",onClick:s((a=>{t({...e,...a}),u()})),"data-testid":"confirm"},a("edit")),n.ZP.createElement(o.zx,{"data-testid":"cancel",id:"modal-cancel",key:"cancel",variant:o.Wu.link,onClick:u},a("common:cancel"))]},n.ZP.createElement(o.l0,{isHorizontal:!0},n.ZP.createElement(o.cw,{label:a("common:name"),fieldId:"name",helperTextInvalid:a("common:required"),validated:r.displayName?o.LD.error:o.LD.default,isRequired:!0,labelIcon:n.ZP.createElement(h.B,{helpText:"authentication-help:name",fieldLabelId:"name"})},n.ZP.createElement(g.F,{type:"text",id:"name",name:"displayName","data-testid":"displayName",ref:i({required:!0}),validated:r.displayName?o.LD.error:o.LD.default})),n.ZP.createElement(o.cw,{label:a("common:description"),fieldId:"kc-description",labelIcon:n.ZP.createElement(h.B,{helpText:"authentication-help:description",fieldLabelId:"description"}),validated:r.description?o.LD.error:o.LD.default,helperTextInvalid:r.description?.message},n.ZP.createElement(N.Q,{ref:i({maxLength:{value:255,message:a("common:maxLength",{length:255})}}),type:"text",id:"kc-description",name:"description","data-testid":"description",validated:r.description?o.LD.error:o.LD.default})))))},T=({builtIn:e,execution:t,onRowClick:a,onRowChange:i,onAddExecution:r,onAddFlow:d,onDelete:s})=>{const{t:m}=(0,l.$G)("authentication"),u=!!t.executionList?.length;return n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement(o.LC,{className:"keycloak__authentication__flow-item",id:t.id,isExpanded:!t.isCollapsed,"aria-labelledby":`title-id-${t.id}`},n.ZP.createElement(o.Vi,{className:"keycloak__authentication__flow-row","aria-level":t.level+1,role:"heading","aria-labelledby":t.id},n.ZP.createElement(o.v7,null,n.ZP.createElement(o.D7,{"aria-label":m("common-help:dragHelp")})),u&&n.ZP.createElement(o.pO,{onClick:()=>a(t),isExpanded:!t.isCollapsed,id:`toggle1-${t.id}`,"aria-controls":t.executionList[0].id}),n.ZP.createElement(o.p9,{dataListCells:[n.ZP.createElement(o.KX,{key:`${t.id}-name`},!t.authenticationFlow&&n.ZP.createElement(C,{id:t.id,key:t.id,title:t.displayName}),t.authenticationFlow&&n.ZP.createElement(n.ZP.Fragment,null,t.displayName," ",n.ZP.createElement("br",null)," ",n.ZP.createElement(o.xv,{component:o.qO.small},t.description))),n.ZP.createElement(o.KX,{key:`${t.id}-requirement`},n.ZP.createElement(v,{flow:t,onChange:i})),n.ZP.createElement(o.KX,{key:`${t.id}-config`},t.configurable&&n.ZP.createElement(F,{execution:t}),t.authenticationFlow&&!e&&n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement(_,{execution:t,onAddExecution:r,onAddFlow:d}),n.ZP.createElement(S,{execution:t,onRowChange:i})),!e&&n.ZP.createElement(o.u,{content:m("common:delete")},n.ZP.createElement(o.zx,{variant:"plain","data-testid":`${t.displayName}-delete`,"aria-label":m("common:delete"),onClick:()=>s(t)},n.ZP.createElement(c.XH,null))))]}))),!t.isCollapsed&&u&&t.executionList?.map((t=>n.ZP.createElement(T,{builtIn:e,key:t.id,execution:t,onRowClick:a,onRowChange:i,onAddExecution:r,onAddFlow:d,onDelete:s}))))};class D{constructor(e,t){this.oldIndex=e,this.newIndex=t}}class $ extends D{constructor(e,t,a){super(e,t),this.parent=a}}class M{constructor(e){this.list=e;const t={executionList:[],isCollapsed:!1};this.transformToExpandableList(0,t),this.expandableList=t.executionList}transformToExpandableList(e,t){for(let a=e;a<this.list.length;a++){const e=this.list[a],n=e.level||0,i=this.list[a+1]?.level||0,l=n<i;if(n>i)return t.executionList?.push(e),a;if(e.level!==n||l){const n={...e,executionList:[],isCollapsed:!1};a=this.transformToExpandableList(a+1,n),t.executionList?.push(n)}else t.executionList?.push(e)}return this.list.length}order(e){let t=[];for(const a of e||this.expandableList)t.push(a),a.executionList&&!a.isCollapsed&&(t=t.concat(this.order(a.executionList)));return t}findExecution(e,t){let a=(t||this.expandableList).find((t=>t.id===e));if(!a)for(const n of t||this.expandableList)if(n.executionList&&(a=this.findExecution(e,n.executionList),a))return a;return a}getParentNodes(e){for(let t=0;t<this.list.length;t++){const a=this.list[t];if(t+1<this.list.length&&this.list[t+1].level>a.level&&a.level+1===e)return a}}getChange(e,t){const a=this.order(),n=t.findIndex((t=>t===e.id)),i=a[a.findIndex((t=>t.id===e.id))],l=a[n];if(l.level!==i.level){if(l.level>0){const e=this.getParentNodes(l.level);return new $(e?.executionList?.length||0,l.index,e)}return new $(this.expandableList.length,l.index)}return new D(i.index,l.index)}clone(){const e=new M([]);return e.list=this.list,e.expandableList=this.expandableList,e}}var A=a(9146);const q=(0,n.X$)((({data:{label:e},prefix:t,selected:a})=>n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement(A.HH,{position:A.Ly.Right,type:"source"}),n.ZP.createElement("div",{className:"react-flow__node-default keycloak__authentication__subflow_node "+(a?"selected":"")},n.ZP.createElement("div",null,t," ",e)),n.ZP.createElement(A.HH,{position:A.Ly.Left,type:"target"})))),J=({...e})=>n.ZP.createElement(q,{...e,prefix:"Start"}),R=({...e})=>n.ZP.createElement(q,{...e,prefix:"End"}),z=(0,n.X$)((({data:e,selected:t})=>n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement(A.HH,{position:A.Ly.Right,type:"source"}),n.ZP.createElement("div",{className:"react-flow__node-default keycloak__authentication__conditional_node "+(t?"selected":"")},n.ZP.createElement("div",null,e.label)),n.ZP.createElement(A.HH,{position:A.Ly.Left,type:"target"})))),O=({id:e,sourceX:t,sourceY:a,targetX:i,targetY:l,sourcePosition:o,targetPosition:r,style:d={},arrowHeadType:s,markerEndId:m,selected:u,data:{onEdgeClick:p}})=>{const E=(0,A.OQ)({sourceX:t,sourceY:a,sourcePosition:o,targetX:i,targetY:l,targetPosition:r}),P=(0,A.cf)(s,m),[h,g]=(0,A.Pp)({sourceX:t,sourceY:a,targetX:i,targetY:l});return n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement("path",{id:e,style:d,className:"react-flow__edge-path",d:E,markerEnd:P}),u&&n.ZP.createElement("foreignObject",{width:33,height:33,x:h-16.5,y:g-16.5,className:"edgebutton-foreignobject",requiredExtensions:"http://www.w3.org/1999/xhtml"},n.ZP.createElement("button",{className:"edgebutton",onClick:t=>p(t,e)},n.ZP.createElement(c.pO,null))))};var V=a(8930);const X=new V.Z.graphlib.Graph;X.setDefaultEdgeLabel((()=>({})));const K=(e,t)=>({id:`edge-${e}-to-${t}`,type:"buttonEdge",source:e,target:t,data:{onEdgeClick:(e,t)=>{e.stopPropagation(),alert(`hello ${t}`)}}}),G=e=>{let t;return e.executionList&&(t="startSubFlow"),le(e)&&(t="conditional"),{id:e.id,type:t,sourcePosition:A.Ly.Right,targetPosition:A.Ly.Left,data:{label:e.displayName},position:{x:0,y:0}}},H=(e,t,a)=>{const n=[];return n.push(G(t)),n.push(K(e.id,t.id)),n.push(K(t.id,a.id)),n},B=(e,t,a,n,i,l)=>{const o=[];return o.push(G(t)),i?o.push(K(e.id,t.id)):o.push(K(n.id,t.id)),l&&o.push(K(t.id,a.id)),o},U=(e,t,a,n)=>{const i=[];i.push({id:e.id,type:"startSubFlow",sourcePosition:A.Ly.Right,targetPosition:A.Ly.Left,data:{label:e.displayName},position:{x:0,y:0}});const l=`flow-end-${e.id}`;return i.push({id:l,type:"endSubFlow",sourcePosition:A.Ly.Right,targetPosition:A.Ly.Left,data:{label:e.displayName},position:{x:0,y:0}}),i.push(K(n&&"ALTERNATIVE"!==n.requirement?n.id:t.id,e.id)),i.push(K(l,a.id)),i.concat(W(e,e.executionList||[],{...e,id:l}))},W=(e,t,a)=>{let n=[];for(let i=0;i<t.length;i++){const l=t[i];n=l.executionList?n.concat(U(l,e,a,t[i-1])):"ALTERNATIVE"===l.requirement||"DISABLED"===l.requirement?n.concat(H(e,l,a)):n.concat(B(e,l,a,t[i-1],0===i,i===t.length-1))}return n},Y=({executionList:{expandableList:e}})=>{let t=[{id:"start",sourcePosition:A.Ly.Right,type:"input",data:{label:"Start"},position:{x:0,y:0},className:"keycloak__authentication__input_node"},{id:"end",targetPosition:A.Ly.Left,type:"output",data:{label:"End"},position:{x:0,y:0},className:"keycloak__authentication__output_node"}];t=t.concat(W({id:"start"},e,{id:"end"}));const[a,i]=(0,n.eJ)(((e,t="LR")=>{const a="LR"===t;return X.setGraph({rankdir:t}),e.forEach((e=>{(0,A.UG)(e)?X.setNode(e.id,{width:130,height:28}):X.setEdge(e.source,e.target)})),V.Z.layout(X),e.map((e=>{if((0,A.UG)(e)){const t=X.node(e.id);e.targetPosition=a?A.Ly.Left:A.Ly.Top,e.sourcePosition=a?A.Ly.Right:A.Ly.Bottom,e.position={x:t.x-65+Math.random()/1e3,y:t.y-14}}return e}))})(t)),[l,c]=(0,n.eJ)(!1);return n.ZP.createElement(o.dy,{isExpanded:l,onExpand:()=>c(!0)},n.ZP.createElement(o.sc,{panelContent:n.ZP.createElement(o.SH,null,n.ZP.createElement(o.hA,null,n.ZP.createElement("span",{tabIndex:l?0:-1},"drawer-panel"),n.ZP.createElement(o.x9,null,n.ZP.createElement(o.cC,{onClick:()=>c(!1)}))))},n.ZP.createElement(o.sL,null,n.ZP.createElement(A.ZP,{nodeTypes:{conditional:z,startSubFlow:J,endSubFlow:R},edgeTypes:{buttonEdge:O},onElementClick:(e,t)=>{(0,A.UG)(t)&&c(!l)},onElementsRemove:e=>i((t=>(0,A.d0)(e,t))),onLoad:e=>e.fitView(),elements:a,nodesConnectable:!1},n.ZP.createElement(A.a9,null),n.ZP.createElement(A.ZX,null),n.ZP.createElement(A.Aq,null)))))};var Q=a(9766),j=a(52),ee=a(764),te=a(5071),ae=a(6827);const ne=({flow:e,toggleDialog:t})=>{const{t:a}=(0,l.$G)("authentication"),i=(0,P.cI)({shouldUnregister:!1}),{reset:c,handleSubmit:r}=i,{adminClient:s}=(0,d.K3)(),{addAlert:m,addError:u}=(0,k.Z7)();return(0,n.d4)((()=>{c(e)}),[e,c]),n.ZP.createElement(o.u_,{title:a("editFlow"),isOpen:!0,onClose:t,variant:o.vE.small,actions:[n.ZP.createElement(o.zx,{id:"modal-confirm",key:"confirm",onClick:r((async n=>{try{await s.authenticationManagement.updateFlow({flowId:e.id},{...e,...n}),m(a("updateFlowSuccess"),o.Ux.success)}catch(e){u("authentication:updateFlowError",e)}t()})),"data-testid":"confirm"},a("edit")),n.ZP.createElement(o.zx,{"data-testid":"cancel",id:"modal-cancel",key:"cancel",variant:o.Wu.link,onClick:()=>{t()}},a("common:cancel"))]},n.ZP.createElement(P.RV,{...i},n.ZP.createElement(o.l0,{isHorizontal:!0},n.ZP.createElement(ae.a,null))))};var ie=a(2699);const le=e=>e.displayName?.startsWith("Condition ");function oe(){const{t:e}=(0,l.$G)("authentication"),{adminClient:t}=(0,d.K3)(),{realm:a}=(0,ee.PL)(),{addAlert:s,addError:m}=(0,k.Z7)(),{id:u,usedBy:p,builtIn:P}=(0,i.UO)(),h=(0,i.k6)(),[g,Z]=(0,n.eJ)(0),y=()=>Z((new Date).getTime()),[C,v]=(0,n.eJ)(!0),[L,F]=(0,n.eJ)(),[_,N]=(0,n.eJ)(),[S,D]=(0,n.eJ)(),[$,A]=(0,n.eJ)(""),[q,J]=(0,n.eJ)(),[R,z]=(0,n.eJ)(),[O,V]=(0,n.eJ)(),[X,K,G]=(0,I.Z)(),[H,B]=(0,n.eJ)(!1),[U,W]=(0,I.Z)();(0,d.ib)((async()=>{const a=(await t.authenticationManagement.getFlows()).find((e=>e.id===u));if(!a)throw new Error(e("common:notFound"));return{flow:a,executions:await t.authenticationManagement.getExecutions({flow:a.alias})}}),(({flow:e,executions:t})=>{F(e),N(new M(t))}),[g]);const ae=async a=>{const{executionList:n,isCollapsed:i,...l}=a;try{await t.authenticationManagement.updateExecution({flow:L?.alias},l),y(),s(e("updateFlowSuccess"),o.Ux.success)}catch(e){m("authentication:updateFlowError",e)}},le=async(a,n)=>{try{await t.authenticationManagement.addExecutionToFlow({flow:a,provider:n.id}),y(),s(e("updateFlowSuccess"),o.Ux.success)}catch(e){m("authentication:updateFlowError",e)}},oe=async(a,{name:n,description:i="",type:l,provider:c})=>{try{await t.authenticationManagement.addFlowToFlow({flow:a,alias:n,description:i,provider:c,type:l}),y(),s(e("updateFlowSuccess"),o.Ux.success)}catch(e){m("authentication:updateFlowError",e)}},[ce,re]=(0,Q.W)({titleKey:"authentication:deleteConfirmExecution",children:n.ZP.createElement(l.cC,{i18nKey:"authentication:deleteConfirmExecutionMessage"}," ",n.ZP.createElement("strong",null,{name:O?.displayName}),"."),continueButtonLabel:"common:delete",continueButtonVariant:o.Wu.danger,onConfirm:async()=>{try{await t.authenticationManagement.delExecution({id:O?.id}),s(e("deleteExecutionSuccess"),o.Ux.success),y()}catch(e){m("authentication:deleteExecutionError",e)}}}),[de,se]=(0,Q.W)({titleKey:"authentication:deleteConfirmFlow",children:n.ZP.createElement(l.cC,{i18nKey:"authentication:deleteConfirmFlowMessage"}," ",n.ZP.createElement("strong",null,{flow:L?.alias||""}),"."),continueButtonLabel:"common:delete",continueButtonVariant:o.Wu.danger,onConfirm:async()=>{try{await t.authenticationManagement.deleteFlow({flowId:L.id}),h.push((0,te.m)({realm:a})),s(e("deleteFlowSuccess"),o.Ux.success)}catch(e){m("authentication:deleteFlowError",e)}}}),me=0!==_?.expandableList.length,ue=[..."default"!==p&&"client-flow"!==L?.providerId?[n.ZP.createElement(o.hP,{"data-testid":"set-as-default",key:"default",onClick:W},e("bindFlow"))]:[],n.ZP.createElement(o.hP,{key:"duplicate",onClick:()=>G(!0)},e("duplicate")),...P?[]:[n.ZP.createElement(o.hP,{"data-testid":"edit-flow",key:"edit",onClick:()=>B(!0)},e("editInfo")),n.ZP.createElement(o.hP,{"data-testid":"delete-flow",key:"delete",onClick:()=>de()},e("common:delete"))]];return n.ZP.createElement(n.ZP.Fragment,null,U&&n.ZP.createElement(ie.O,{flowAlias:L?.alias,onClose:()=>{W(),y()}}),X&&n.ZP.createElement(j.$,{name:L?.alias,description:L?.description,toggleDialog:K,onComplete:()=>{y(),G(!1)}}),H&&n.ZP.createElement(ne,{flow:L,toggleDialog:()=>{B(!H),y()}}),n.ZP.createElement(se,null),n.ZP.createElement(r.t,{titleKey:(0,x.LO)(L?.alias||""),badges:[{text:n.ZP.createElement(o.__,null,e(p))},P?{text:n.ZP.createElement(o.__,{className:"keycloak_authentication-section__usedby_label",icon:n.ZP.createElement(c.rE,null)},e("buildIn")),id:"builtIn"}:{}],dropdownItems:ue}),n.ZP.createElement(o.NP,{variant:"light"},_&&me&&n.ZP.createElement(n.ZP.Fragment,null,n.ZP.createElement(o.o8,{id:"toolbar"},n.ZP.createElement(o.c_,null,n.ZP.createElement(o.Eg,null,n.ZP.createElement(o.tX,null,n.ZP.createElement(o.GX,{icon:n.ZP.createElement(c.$e,null),"aria-label":e("tableView"),buttonId:"tableView",isSelected:C,onChange:()=>v(!0)}),n.ZP.createElement(o.GX,{icon:n.ZP.createElement("i",{className:"fas fa-project-diagram"}),"aria-label":e("diagramView"),buttonId:"diagramView",isSelected:!C,onChange:()=>v(!1)}))),n.ZP.createElement(o.Eg,null,n.ZP.createElement(o.zx,{"data-testid":"addStep",variant:"secondary",onClick:()=>J(!0)},e("addStep"))),n.ZP.createElement(o.Eg,null,n.ZP.createElement(o.zx,{"data-testid":"addSubFlow",variant:"secondary",onClick:()=>z(!0)},e("addSubFlow"))))),n.ZP.createElement(re,null),C&&n.ZP.createElement(o.FR,{"aria-label":e("flows"),onDragFinish:a=>{const n=a.slice(1);A(e("common:onDragFinish",{list:S?.displayName}));const i=_.getChange(S,n);(async(a,n)=>{try{let i=a.id;"parent"in n&&(await t.authenticationManagement.delExecution({id:i}),i=(await t.authenticationManagement.addExecutionToFlow({flow:n.parent?.displayName||L?.alias,provider:a.providerId})).id);const l=n.newIndex-n.oldIndex;for(let e=0;e<Math.abs(l);e++)l>0?await t.authenticationManagement.lowerPriorityExecution({id:i}):await t.authenticationManagement.raisePriorityExecution({id:i});y(),s(e("updateFlowSuccess"),o.Ux.success)}catch(e){m("authentication:updateFlowError",e)}})(S,i)},onDragStart:t=>{const a=_.findExecution(t);A(e("common:onDragStart",{item:a.displayName})),D(a),a.isCollapsed||(a.isCollapsed=!0,N(_.clone()))},onDragMove:()=>A(e("common:onDragMove",{item:S?.displayName})),onDragCancel:()=>A(e("common:onDragCancel")),itemOrder:["header",..._.order().map((e=>e.id))]},n.ZP.createElement(b,null),n.ZP.createElement(n.ZP.Fragment,null,_.expandableList.map((e=>n.ZP.createElement(T,{builtIn:!!P,key:e.id,execution:e,onRowClick:e=>{e.isCollapsed=!e.isCollapsed,N(_.clone())},onRowChange:ae,onAddExecution:(e,t)=>le(e.displayName,t),onAddFlow:(e,t)=>oe(e.displayName,t),onDelete:e=>{V(e),ce()}}))))),L&&n.ZP.createElement(n.ZP.Fragment,null,q&&n.ZP.createElement(E,{name:L.alias,type:"client-flow"===L.providerId?"client":"basic",onSelect:e=>{e&&le(L.alias,e),J(!1)}}),R&&n.ZP.createElement(f,{name:L.alias,onCancel:()=>z(!1),onConfirm:e=>{oe(L.alias,e),z(!1)}})),n.ZP.createElement("div",{className:"pf-screen-reader","aria-live":"assertive"},$)),!C&&_?.expandableList&&n.ZP.createElement(Y,{executionList:_}),!_?.expandableList||L&&!me&&n.ZP.createElement(w,{flow:L,onAddExecution:e=>le(L.alias,e),onAddFlow:e=>oe(L.alias,e)})))}}}]);