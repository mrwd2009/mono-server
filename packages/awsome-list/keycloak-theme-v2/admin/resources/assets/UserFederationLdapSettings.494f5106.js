import{u as A,ay as F,l as E,az as $,r as D,h as p,F as x,j as e,aA as P,s as R,av as C,aY as K,bm as ee,a_ as j,aw as B,bM as te,bA as _,ae as re,b4 as ae,n as ie,P as N,cX as z,cI as J}from"./index.0cb2e516.js";import{H as l,c as ne}from"./HelpItem.e440d5db.js";import{b as Q,C as v,u as le,F as se,a as oe}from"./index.esm.6af887f8.js";import{F as q}from"./FormAccess.bee4f1e0.js";import{W as U,S as de}from"./Header.d933d0e7.js";import{P as ce}from"./PasswordInput.34ff6dd3.js";import{K as m}from"./KeycloakTextInput.b4d5b2db.js";import{i as ue}from"./isEqual.b67f23a3.js";import{a as n,F as pe,A as fe}from"./FormGroup.3d5f3f16.js";import{S as H,a as S,b as M}from"./Select.5a6b39aa.js";import{S as be}from"./ScrollForm.e8140edc.js";import{K as ge,L as he}from"./KeycloakDataTable.4e517788.js";import{u as me}from"./ConfirmDialog.f8013bbb.js";import{u as ye,m as ve}from"./useLocaleSort.84ea7ec0.js";import{E as Ie}from"./ExtendedHeader.c8ef22bd.js";import{R as Se,r as G}from"./RoutableTabs.f3cff418.js";import{T as W,a as Y}from"./Tabs.3d61d369.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./Text.c38ffb52.js";import"./useToggle.8c992bea.js";import"./NumberInput.331c7b85.js";import"./plus-icon.407671b4.js";import"./ViewHeader.2586557f.js";import"./check.51c67984.js";import"./star-icon.97692015.js";import"./FormPanel.4ba67868.js";import"./CardHeader.f162738f.js";import"./Card.32e78d5f.js";import"./CardTitle.42e61ef4.js";import"./CardBody.a2e5e179.js";import"./TableToolbar.c27bcd3c.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Modal.6593dfcc.js";import"./MenuList.288a98b4.js";const ke=["connectionUrl","bindDn","bindCredential","useTruststoreSpi","connectionTimeout","startTls","authType"],Z=t=>{const i={};return ke.forEach(d=>{const r=ee(t.getValues(),`config.${d}`);i[d]=Array.isArray(r)?r[0]:""}),i},Te=({form:t,id:i,showSectionHeading:d=!1,showSectionDescription:r=!1})=>{const{t:a}=A("user-federation"),{t:g}=A("user-federation-help"),{adminClient:s}=F(),{realm:c}=E(),{addAlert:u,addError:f}=$(),k=!!i,b=async o=>{try{const T=Z(t);await s.realms.testLDAPConnection({realm:c},{...T,action:o,componentId:i}),u(a("testSuccess"),K.success)}catch(T){f("user-federation:testError",T)}},[h,I]=D.exports.useState(!1),[L,O]=D.exports.useState(!1),w=Q({control:t.control,name:"config.authType",defaultValue:["simple"]});return p(x,{children:[d&&e(U,{title:a("connectionAndAuthenticationSettings"),description:g("ldapConnectionAndAuthorizationSettingsDescription"),showDescription:r}),p(q,{role:"manage-realm",isHorizontal:!0,children:[e(n,{label:a("connectionURL"),labelIcon:e(l,{helpText:"user-federation-help:consoleDisplayConnectionUrlHelp",fieldLabelId:"user-federation:connectionURL"}),fieldId:"kc-console-connection-url",isRequired:!0,validated:t.errors.config?.connectionUrl?.[0]?"error":"default",helperTextInvalid:t.errors.config?.connectionUrl?.[0].message,children:e(m,{isRequired:!0,type:"text",id:"kc-console-connection-url","data-testid":"ldap-connection-url",name:"config.connectionUrl[0]",ref:t.register({required:{value:!0,message:`${a("validateConnectionUrl")}`}}),validated:t.errors.config?.connectionUrl?.[0]?"error":"default"})}),e(n,{label:a("enableStartTls"),labelIcon:e(l,{helpText:"user-federation-help:enableStartTlsHelp",fieldLabelId:"user-federation:enableStartTls"}),fieldId:"kc-enable-start-tls",hasNoPaddingTop:!0,children:e(v,{name:"config.startTls",defaultValue:["false"],control:t.control,render:({onChange:o,value:T})=>e(P,{id:"kc-enable-start-tls","data-testid":"enable-start-tls",isDisabled:!1,onChange:y=>o([`${y}`]),isChecked:T[0]==="true",label:a("common:on"),labelOff:a("common:off"),"aria-label":a("enableStartTls")})})}),e(n,{label:a("useTruststoreSpi"),labelIcon:e(l,{helpText:"user-federation-help:useTruststoreSpiHelp",fieldLabelId:"user-federation:useTruststoreSpi"}),fieldId:"kc-use-truststore-spi",children:e(v,{name:"config.useTruststoreSpi[0]",control:t.control,defaultValue:"ldapsOnly",render:({onChange:o,value:T})=>p(H,{toggleId:"kc-use-truststore-spi",onToggle:()=>I(!h),isOpen:h,onSelect:(y,V)=>{o(V.toString()),I(!1)},selections:T,children:[e(S,{value:"always",children:a("always")}),e(S,{value:"ldapsOnly",children:a("onlyLdaps")}),e(S,{value:"never",children:a("never")})]})})}),e(n,{label:a("connectionPooling"),labelIcon:e(l,{helpText:"user-federation-help:connectionPoolingHelp",fieldLabelId:"user-federation:connectionPooling"}),fieldId:"kc-connection-pooling",hasNoPaddingTop:!0,children:e(v,{name:"config.connectionPooling",defaultValue:["false"],control:t.control,render:({onChange:o,value:T})=>e(P,{id:"kc-connection-pooling","data-testid":"connection-pooling",isDisabled:!1,onChange:y=>o([`${y}`]),isChecked:T[0]==="true",label:a("common:on"),labelOff:a("common:off"),"aria-label":a("connectionPooling")})})}),e(n,{label:a("connectionTimeout"),labelIcon:e(l,{helpText:"user-federation-help:connectionTimeoutHelp",fieldLabelId:"user-federation:consoleTimeout"}),fieldId:"kc-console-connection-timeout",children:e(m,{type:"number",min:0,id:"kc-console-connection-timeout","data-testid":"connection-timeout",name:"config.connectionTimeout[0]",ref:t.register})}),e(n,{fieldId:"kc-test-connection-button",children:e(R,{variant:"secondary",id:"kc-test-connection-button","data-testid":"test-connection-button",onClick:()=>b("testConnection"),children:a("common:testConnection")})}),e(n,{label:a("bindType"),labelIcon:e(l,{helpText:"user-federation-help:bindTypeHelp",fieldLabelId:"user-federation:bindType"}),fieldId:"kc-bind-type",isRequired:!0,children:e(v,{name:"config.authType[0]",defaultValue:"simple",control:t.control,render:({onChange:o,value:T})=>p(H,{toggleId:"kc-bind-type",required:!0,onToggle:()=>O(!L),isOpen:L,onSelect:(y,V)=>{o(V),O(!1)},selections:T,variant:M.single,"data-testid":"ldap-bind-type",children:[e(S,{value:"simple"}),e(S,{value:"none"})]})})}),ue(w,["simple"])&&p(x,{children:[e(n,{label:a("bindDn"),labelIcon:e(l,{helpText:"user-federation-help:bindDnHelp",fieldLabelId:"user-federation:bindDn"}),fieldId:"kc-console-bind-dn",helperTextInvalid:a("validateBindDn"),validated:t.errors.config?.bindDn?C.error:C.default,isRequired:!0,children:e(m,{type:"text",id:"kc-console-bind-dn","data-testid":"ldap-bind-dn",name:"config.bindDn[0]",ref:t.register({required:!0}),validated:t.errors.config?.bindDn?C.error:C.default})}),e(n,{label:a("bindCredentials"),labelIcon:e(l,{helpText:"user-federation-help:bindCredentialsHelp",fieldLabelId:"user-federation:bindCredentials"}),fieldId:"kc-console-bind-credentials",helperTextInvalid:a("validateBindCredentials"),validated:t.errors.config?.bindCredential?C.error:C.default,isRequired:!0,children:e(ce,{hasReveal:!k,isRequired:!0,id:"kc-console-bind-credentials","data-testid":"ldap-bind-credentials",name:"config.bindCredential[0]",ref:t.register({required:!0}),validated:t.errors.config?.bindCredential?C.error:C.default})})]}),e(n,{fieldId:"kc-test-auth-button",children:e(R,{variant:"secondary",id:"kc-test-auth-button","data-testid":"test-auth-button",onClick:()=>b("testAuthentication"),children:a("testAuthentication")})})]})]})},Ae="1.3.6.1.4.1.4203.1.11.1",Pe=({id:t,form:i,showSectionHeading:d=!1,showSectionDescription:r=!1})=>{const{t:a}=A("user-federation"),{t:g}=A("user-federation-help"),{adminClient:s}=F(),{realm:c}=E(),{addAlert:u,addError:f}=$(),k=async()=>{if(!!await i.trigger())try{const b=Z(i),h=await s.realms.ldapServerCapabilities({realm:c},{...b,componentId:t});u(a("testSuccess"));const I=h.filter(L=>L.oid===Ae);i.setValue("config.usePasswordModifyExtendedOp",[(I.length>0).toString()])}catch(b){f("user-federation:testError",b)}};return p(x,{children:[d&&e(U,{title:a("advancedSettings"),description:g("ldapAdvancedSettingsDescription"),showDescription:r}),p(q,{role:"manage-realm",isHorizontal:!0,children:[e(n,{label:a("enableLdapv3Password"),labelIcon:e(l,{helpText:"user-federation-help:enableLdapv3PasswordHelp",fieldLabelId:"user-federation:enableLdapv3Password"}),fieldId:"kc-enable-ldapv3-password",hasNoPaddingTop:!0,children:e(v,{name:"config.usePasswordModifyExtendedOp",defaultValue:["false"],control:i.control,render:({onChange:b,value:h})=>e(P,{id:"kc-enable-ldapv3-password","data-testid":"ldapv3-password",isDisabled:!1,onChange:I=>b([`${I}`]),isChecked:h[0]==="true",label:a("common:on"),labelOff:a("common:off"),"aria-label":a("enableLdapv3Password")})})}),e(n,{label:a("validatePasswordPolicy"),labelIcon:e(l,{helpText:"user-federation-help:validatePasswordPolicyHelp",fieldLabelId:"user-federation:validatePasswordPolicy"}),fieldId:"kc-validate-password-policy",hasNoPaddingTop:!0,children:e(v,{name:"config.validatePasswordPolicy",defaultValue:["false"],control:i.control,render:({onChange:b,value:h})=>e(P,{id:"kc-validate-password-policy","data-testid":"password-policy",isDisabled:!1,onChange:I=>b([`${I}`]),isChecked:h[0]==="true",label:a("common:on"),labelOff:a("common:off"),"aria-label":a("validatePasswordPolicy")})})}),e(n,{label:a("trustEmail"),labelIcon:e(l,{helpText:"user-federation-help:trustEmailHelp",fieldLabelId:"user-federation:trustEmail"}),fieldId:"kc-trust-email",hasNoPaddingTop:!0,children:e(v,{name:"config.trustEmail",defaultValue:["false"],control:i.control,render:({onChange:b,value:h})=>e(P,{id:"kc-trust-email","data-testid":"trust-email",isDisabled:!1,onChange:I=>b([`${I}`]),isChecked:h[0]==="true",label:a("common:on"),labelOff:a("common:off"),"aria-label":a("trustEmail")})})}),e(n,{fieldId:"query-extensions",children:e(R,{variant:"secondary",id:"query-extensions","data-testid":"query-extensions",onClick:k,children:a("queryExtensions")})})]})]})},Le=({form:t,showSectionHeading:i=!1,showSectionDescription:d=!1})=>{const{t:r}=A("user-federation"),{t:a}=A("user-federation-help"),g=Q({control:t.control,name:"config.allowKerberosAuthentication",defaultValue:["false"]});return p(x,{children:[i&&e(U,{title:r("kerberosIntegration"),description:a("ldapKerberosSettingsDescription"),showDescription:d}),p(q,{role:"manage-realm",isHorizontal:!0,children:[e(n,{label:r("allowKerberosAuthentication"),labelIcon:e(l,{helpText:"user-federation-help:allowKerberosAuthenticationHelp",fieldLabelId:"user-federation:allowKerberosAuthentication"}),fieldId:"kc-allow-kerberos-authentication",hasNoPaddingTop:!0,children:e(v,{name:"config.allowKerberosAuthentication",defaultValue:["false"],control:t.control,render:({onChange:s,value:c})=>e(P,{id:"kc-allow-kerberos-authentication","data-testid":"allow-kerberos-auth",isDisabled:!1,onChange:u=>s([`${u}`]),isChecked:c[0]==="true",label:r("common:on"),labelOff:r("common:off"),"aria-label":r("allowKerberosAuthentication")})})}),g[0]==="true"&&p(x,{children:[e(n,{label:r("kerberosRealm"),labelIcon:e(l,{helpText:"user-federation-help:kerberosRealmHelp",fieldLabelId:"user-federation:kerberosRealm"}),fieldId:"kc-kerberos-realm",isRequired:!0,validated:t.errors.config?.kerberosRealm?.[0]?"error":"default",helperTextInvalid:t.errors.config?.kerberosRealm?.[0].message,children:e(m,{isRequired:!0,type:"text",id:"kc-kerberos-realm",name:"config.kerberosRealm[0]",ref:t.register({required:{value:!0,message:`${r("validateRealm")}`}}),"data-testid":"kerberos-realm",validated:t.errors.config?.kerberosRealm?.[0]?"error":"default"})}),e(n,{label:r("serverPrincipal"),labelIcon:e(l,{helpText:"user-federation-help:serverPrincipalHelp",fieldLabelId:"user-federation:serverPrincipal"}),fieldId:"kc-server-principal",isRequired:!0,validated:t.errors.config?.serverPrincipal?.[0]?"error":"default",helperTextInvalid:t.errors.config?.serverPrincipal?.[0].message,children:e(m,{isRequired:!0,type:"text",id:"kc-server-principal",name:"config.serverPrincipal[0]",ref:t.register({required:{value:!0,message:`${r("validateServerPrincipal")}`}}),"data-testid":"kerberos-principal",validated:t.errors.config?.serverPrincipal?.[0]?"error":"default"})}),e(n,{label:r("keyTab"),labelIcon:e(l,{helpText:"user-federation-help:keyTabHelp",fieldLabelId:"user-federation:keyTab"}),fieldId:"kc-key-tab",isRequired:!0,validated:t.errors.config?.keyTab?.[0]?"error":"default",helperTextInvalid:t.errors.config?.keyTab?.[0].message,children:e(m,{isRequired:!0,type:"text",id:"kc-key-tab",name:"config.keyTab[0]",ref:t.register({required:{value:!0,message:`${r("validateKeyTab")}`}}),"data-testid":"kerberos-keytab",validated:t.errors.config?.keyTab?.[0]?"error":"default"})}),p(n,{label:r("debug"),labelIcon:e(l,{helpText:"user-federation-help:debugHelp",fieldLabelId:"user-federation:debug"}),fieldId:"kc-debug",hasNoPaddingTop:!0,children:[" ",e(v,{name:"config.debug",defaultValue:["false"],control:t.control,render:({onChange:s,value:c})=>e(P,{id:"kc-debug","data-testid":"debug",isDisabled:!1,onChange:u=>s([`${u}`]),isChecked:c[0]==="true",label:r("common:on"),labelOff:r("common:off"),"aria-label":r("debug")})})]})]}),e(n,{label:r("useKerberosForPasswordAuthentication"),labelIcon:e(l,{helpText:"user-federation-help:useKerberosForPasswordAuthenticationHelp",fieldLabelId:"user-federation:useKerberosForPasswordAuthentication"}),fieldId:"kc-use-kerberos-password-authentication",hasNoPaddingTop:!0,children:e(v,{name:"config.useKerberosForPasswordAuthentication",defaultValue:["false"],control:t.control,render:({onChange:s,value:c})=>e(P,{id:"kc-use-kerberos-password-authentication","data-testid":"use-kerberos-pw-auth",isDisabled:!1,onChange:u=>s([`${u}`]),isChecked:c[0]==="true",label:r("common:on"),labelOff:r("common:off"),"aria-label":r("useKerberosForPasswordAuthentication")})})})]})]})},De=({form:t,showSectionHeading:i=!1,showSectionDescription:d=!1})=>{const{t:r}=A("user-federation"),{t:a}=A("user-federation-help"),g=t.watch("config.periodicFullSync",!1),s=t.watch("config.periodicChangedUsersSync",!1);return p(x,{children:[i&&e(U,{title:r("synchronizationSettings"),description:a("ldapSynchronizationSettingsDescription"),showDescription:d}),p(q,{role:"manage-realm",isHorizontal:!0,children:[e(n,{hasNoPaddingTop:!0,label:r("importUsers"),labelIcon:e(l,{helpText:"user-federation-help:importUsersHelp",fieldLabelId:"user-federation:importUsers"}),fieldId:"kc-import-users",children:e(v,{name:"config.importEnabled",defaultValue:["true"],control:t.control,render:({onChange:c,value:u})=>e(P,{id:"kc-import-users","data-testid":"import-users",name:"importEnabled",label:r("common:on"),labelOff:r("common:off"),onChange:f=>c([`${f}`]),isChecked:u[0]==="true",isDisabled:!1,"aria-label":r("importUsers")})})}),e(n,{hasNoPaddingTop:!0,label:r("syncRegistrations"),labelIcon:e(l,{helpText:"user-federation-help:syncRegistrations",fieldLabelId:"user-federation:syncRegistrations"}),fieldId:"syncRegistrations",children:e(v,{name:"config.syncRegistrations",defaultValue:["true"],control:t.control,render:({onChange:c,value:u})=>e(P,{id:"syncRegistrations","data-testid":"syncRegistrations",label:r("common:on"),labelOff:r("common:off"),onChange:f=>c([`${f}`]),isChecked:u[0]==="true","aria-label":r("syncRegistrations")})})}),e(n,{label:r("batchSize"),labelIcon:e(l,{helpText:"user-federation-help:batchSizeHelp",fieldLabelId:"user-federation:batchSize"}),fieldId:"kc-batch-size",children:e(m,{type:"number",min:0,id:"kc-batch-size","data-testid":"batch-size",name:"config.batchSizeForSync[0]",ref:t.register})}),e(n,{label:r("periodicFullSync"),labelIcon:e(l,{helpText:"user-federation-help:periodicFullSyncHelp",fieldLabelId:"user-federation:periodicFullSync"}),fieldId:"kc-periodic-full-sync",hasNoPaddingTop:!0,children:e(v,{name:"config.periodicFullSync",defaultValue:!1,control:t.control,render:({onChange:c,value:u})=>e(P,{id:"kc-periodic-full-sync","data-testid":"periodic-full-sync",isDisabled:!1,onChange:f=>c(f),isChecked:u===!0,label:r("common:on"),labelOff:r("common:off"),ref:t.register,"aria-label":r("periodicFullSync")})})}),g&&e(n,{hasNoPaddingTop:!0,label:r("fullSyncPeriod"),labelIcon:e(l,{helpText:"user-federation-help:fullSyncPeriodHelp",fieldLabelId:"user-federation:fullSyncPeriod"}),fieldId:"kc-full-sync-period",children:e(m,{type:"number",min:-1,defaultValue:604800,id:"kc-full-sync-period","data-testid":"full-sync-period",name:"config.fullSyncPeriod[0]",ref:t.register})}),e(n,{label:r("periodicChangedUsersSync"),labelIcon:e(l,{helpText:"user-federation-help:periodicChangedUsersSyncHelp",fieldLabelId:"user-federation:periodicChangedUsersSync"}),fieldId:"kc-periodic-changed-users-sync",hasNoPaddingTop:!0,children:e(v,{name:"config.periodicChangedUsersSync",defaultValue:!1,control:t.control,render:({onChange:c,value:u})=>e(P,{id:"kc-periodic-changed-users-sync","data-testid":"periodic-changed-users-sync",isDisabled:!1,onChange:f=>c(f),isChecked:u===!0,label:r("common:on"),labelOff:r("common:off"),ref:t.register,"aria-label":r("periodicChangedUsersSync")})})}),s&&e(n,{label:r("changedUsersSyncPeriod"),labelIcon:e(l,{helpText:"user-federation-help:changedUsersSyncHelp",fieldLabelId:"user-federation:changedUsersSyncPeriod"}),fieldId:"kc-changed-users-sync-period",hasNoPaddingTop:!0,children:e(m,{type:"number",min:-1,defaultValue:86400,id:"kc-changed-users-sync-period","data-testid":"changed-users-sync-period",name:"config.changedSyncPeriod[0]",ref:t.register})})]})]})},xe=({form:t,showSectionHeading:i=!1,showSectionDescription:d=!1,vendorEdit:r=!1})=>{const{t:a}=A("user-federation"),{t:g}=A("user-federation-help"),{adminClient:s}=F(),{realm:c}=E();j(()=>s.realms.findOne({realm:c}),b=>t.setValue("parentId",b.id),[]);const[u,f]=D.exports.useState(!1),k=()=>{switch(t.getValues("config.vendor[0]")){case"ad":t.setValue("config.usernameLDAPAttribute[0]","cn"),t.setValue("config.rdnLDAPAttribute[0]","cn"),t.setValue("config.uuidLDAPAttribute[0]","objectGUID"),t.setValue("config.userObjectClasses[0]","person, organizationalPerson, user");break;case"rhds":t.setValue("config.usernameLDAPAttribute[0]","uid"),t.setValue("config.rdnLDAPAttribute[0]","uid"),t.setValue("config.uuidLDAPAttribute[0]","nsuniqueid"),t.setValue("config.userObjectClasses[0]","inetOrgPerson, organizationalPerson");break;case"tivoli":t.setValue("config.usernameLDAPAttribute[0]","uid"),t.setValue("config.rdnLDAPAttribute[0]","uid"),t.setValue("config.uuidLDAPAttribute[0]","uniqueidentifier"),t.setValue("config.userObjectClasses[0]","inetOrgPerson, organizationalPerson");break;case"edirectory":t.setValue("config.usernameLDAPAttribute[0]","uid"),t.setValue("config.rdnLDAPAttribute[0]","uid"),t.setValue("config.uuidLDAPAttribute[0]","guid"),t.setValue("config.userObjectClasses[0]","inetOrgPerson, organizationalPerson");break;case"other":t.setValue("config.usernameLDAPAttribute[0]","uid"),t.setValue("config.rdnLDAPAttribute[0]","uid"),t.setValue("config.uuidLDAPAttribute[0]","entryUUID"),t.setValue("config.userObjectClasses[0]","inetOrgPerson, organizationalPerson");break;default:return""}};return p(x,{children:[i&&e(U,{title:a("generalOptions"),description:g("ldapGeneralOptionsSettingsDescription"),showDescription:d}),p(q,{role:"manage-realm",isHorizontal:!0,children:[p(n,{label:a("consoleDisplayName"),labelIcon:e(l,{helpText:"user-federation-help:consoleDisplayNameHelp",fieldLabelId:"user-federation:consoleDisplayName"}),fieldId:"kc-console-display-name",isRequired:!0,validated:t.errors.name?"error":"default",helperTextInvalid:t.errors.name?.message,children:[e(m,{hidden:!0,type:"text",id:"kc-console-provider-id",name:"providerId",defaultValue:"ldap",ref:t.register}),e(m,{hidden:!0,type:"text",id:"kc-console-provider-type",name:"providerType",defaultValue:"org.keycloak.storage.UserStorageProvider",ref:t.register}),e(m,{hidden:!0,type:"text",id:"kc-console-parentId",name:"parentId",defaultValue:c,ref:t.register}),e(m,{isRequired:!0,type:"text",id:"kc-console-display-name",name:"name",defaultValue:"ldap",ref:t.register({required:{value:!0,message:`${a("validateName")}`}}),"data-testid":"ldap-name",validated:t.errors.name?"error":"default"})]}),e(n,{label:a("vendor"),labelIcon:e(l,{helpText:"user-federation-help:vendorHelp",fieldLabelId:"user-federation:vendor"}),fieldId:"kc-vendor",isRequired:!0,children:e(v,{name:"config.vendor[0]",defaultValue:"ad",control:t.control,render:({onChange:b,value:h})=>p(H,{isDisabled:!!r,toggleId:"kc-vendor",required:!0,onToggle:()=>f(!u),isOpen:u,onSelect:(I,L)=>{b(L),f(!1),k()},selections:h,variant:M.single,children:[e(S,{value:"ad",isPlaceholder:!0,children:"Active Directory"},0),e(S,{value:"rhds",children:"Red Hat Directory Server"},1),e(S,{value:"tivoli",children:"Tivoli"},2),e(S,{value:"edirectory",children:"Novell eDirectory"},3),e(S,{value:"other",children:"Other"},4)]})})})]})]})},Ce=({form:t,showSectionHeading:i=!1,showSectionDescription:d=!1})=>{const{t:r}=A("user-federation"),{t:a}=A("user-federation-help"),[g,s]=D.exports.useState(!1),[c,u]=D.exports.useState(!1);return p(x,{children:[i&&e(U,{title:r("ldapSearchingAndUpdatingSettings"),description:a("ldapSearchingAndUpdatingSettingsDescription"),showDescription:d}),p(q,{role:"manage-realm",isHorizontal:!0,children:[e(n,{label:r("editMode"),labelIcon:e(l,{helpText:"user-federation-help:editModeLdapHelp",fieldLabelId:"user-federation:editMode"}),fieldId:"kc-edit-mode",isRequired:!0,validated:t.errors.config?.editMode?.[0]?"error":"default",helperTextInvalid:t.errors.config?.editMode?.[0].message,children:e(v,{name:"config.editMode[0]",defaultValue:"",control:t.control,rules:{required:{value:!0,message:r("validateEditMode")}},render:({onChange:f,value:k})=>p(H,{toggleId:"kc-edit-mode",required:!0,onToggle:()=>u(!c),isOpen:c,onSelect:(b,h)=>{f(h.toString()),u(!1)},selections:k,variant:M.single,validated:t.errors.config?.editMode?.[0]?"error":"default",children:[e(S,{value:"",isPlaceholder:!0}),e(S,{value:"READ_ONLY"}),e(S,{value:"WRITABLE"}),e(S,{value:"UNSYNCED"})]})})}),e(n,{label:r("usersDN"),labelIcon:e(l,{helpText:"user-federation-help:usersDNHelp",fieldLabelId:"user-federation:usersDn"}),fieldId:"kc-console-users-dn",isRequired:!0,validated:t.errors.config?.usersDn?.[0]?"error":"default",helperTextInvalid:t.errors.config?.usersDn?.[0].message,children:e(m,{isRequired:!0,type:"text",defaultValue:"",id:"kc-console-users-dn","data-testid":"ldap-users-dn",name:"config.usersDn[0]",ref:t.register({required:{value:!0,message:`${r("validateUsersDn")}`}}),validated:t.errors.config?.usersDn?.[0]?"error":"default"})}),e(n,{label:r("usernameLdapAttribute"),labelIcon:e(l,{helpText:"user-federation-help:usernameLdapAttributeHelp",fieldLabelId:"user-federation:usernameLdapAttribute"}),fieldId:"kc-username-ldap-attribute",isRequired:!0,validated:t.errors.config?.usernameLDAPAttribute?.[0]?"error":"default",helperTextInvalid:t.errors.config?.usernameLDAPAttribute?.[0].message,children:e(m,{isRequired:!0,type:"text",defaultValue:"cn",id:"kc-username-ldap-attribute","data-testid":"ldap-username-attribute",name:"config.usernameLDAPAttribute[0]",ref:t.register({required:{value:!0,message:`${r("validateUsernameLDAPAttribute")}`}}),validated:t.errors.config?.usernameLDAPAttribute?.[0]?"error":"default"})}),e(n,{label:r("rdnLdapAttribute"),labelIcon:e(l,{helpText:"user-federation-help:rdnLdapAttributeHelp",fieldLabelId:"user-federation:rdnLdapAttribute"}),fieldId:"kc-rdn-ldap-attribute",isRequired:!0,validated:t.errors.config?.rdnLDAPAttribute?.[0]?"error":"default",helperTextInvalid:t.errors.config?.rdnLDAPAttribute?.[0].message,children:e(m,{isRequired:!0,type:"text",defaultValue:"cn",id:"kc-rdn-ldap-attribute","data-testid":"ldap-rdn-attribute",name:"config.rdnLDAPAttribute[0]",ref:t.register({required:{value:!0,message:`${r("validateRdnLdapAttribute")}`}}),validated:t.errors.config?.rdnLDAPAttribute?.[0]?"error":"default"})}),e(n,{label:r("uuidLdapAttribute"),labelIcon:e(l,{helpText:"user-federation-help:uuidLdapAttributeHelp",fieldLabelId:"user-federation:uuidLdapAttribute"}),fieldId:"kc-uuid-ldap-attribute",isRequired:!0,validated:t.errors.config?.uuidLDAPAttribute?.[0]?"error":"default",helperTextInvalid:t.errors.config?.uuidLDAPAttribute?.[0].message,children:e(m,{isRequired:!0,type:"text",defaultValue:"objectGUID",id:"kc-uuid-ldap-attribute","data-testid":"ldap-uuid-attribute",name:"config.uuidLDAPAttribute[0]",ref:t.register({required:{value:!0,message:`${r("validateUuidLDAPAttribute")}`}}),validated:t.errors.config?.uuidLDAPAttribute?.[0]?"error":"default"})}),e(n,{label:r("userObjectClasses"),labelIcon:e(l,{helpText:"user-federation-help:userObjectClassesHelp",fieldLabelId:"user-federation:userObjectClasses"}),fieldId:"kc-user-object-classes",isRequired:!0,validated:t.errors.config?.userObjectClasses?.[0]?"error":"default",helperTextInvalid:t.errors.config?.userObjectClasses?.[0].message,children:e(m,{isRequired:!0,type:"text",defaultValue:"person, organizationalPerson, user",id:"kc-user-object-classes","data-testid":"ldap-user-object-classes",name:"config.userObjectClasses[0]",ref:t.register({required:{value:!0,message:`${r("validateUserObjectClasses")}`}}),validated:t.errors.config?.userObjectClasses?.[0]?"error":"default"})}),e(n,{label:r("userLdapFilter"),labelIcon:e(l,{helpText:"user-federation-help:userLdapFilterHelp",fieldLabelId:"user-federation:userLdapFilter"}),fieldId:"kc-user-ldap-filter",validated:t.errors.config?.customUserSearchFilter?.[0]?"error":"default",helperTextInvalid:t.errors.config?.customUserSearchFilter?.[0].message,children:e(m,{type:"text",id:"kc-user-ldap-filter","data-testid":"user-ldap-filter",name:"config.customUserSearchFilter[0]",ref:t.register({pattern:{value:/(\(.*\))$/,message:`${r("validateCustomUserSearchFilter")}`}}),validated:t.errors.config?.customUserSearchFilter?.[0]?"error":"default"})}),e(n,{label:r("searchScope"),labelIcon:e(l,{helpText:"user-federation-help:searchScopeHelp",fieldLabelId:"user-federation:searchScope"}),fieldId:"kc-search-scope",children:e(v,{name:"config.searchScope[0]",defaultValue:"",control:t.control,render:({onChange:f,value:k})=>p(H,{toggleId:"kc-search-scope",required:!0,onToggle:()=>s(!g),isOpen:g,onSelect:(b,h)=>{f(h),s(!1)},selections:k,variant:M.single,children:[e(S,{value:"1",isPlaceholder:!0,children:r("oneLevel")},0),e(S,{value:"2",children:r("subtree")},1)]})})}),e(n,{label:r("readTimeout"),labelIcon:e(l,{helpText:"user-federation-help:readTimeoutHelp",fieldLabelId:"user-federation:readTimeout"}),fieldId:"kc-read-timeout",children:e(m,{type:"number",min:0,id:"kc-read-timeout","data-testid":"ldap-read-timeout",name:"config.readTimeout[0]",ref:t.register})}),e(n,{label:r("pagination"),labelIcon:e(l,{helpText:"user-federation-help:paginationHelp",fieldLabelId:"user-federation:pagination"}),fieldId:"kc-console-pagination",hasNoPaddingTop:!0,children:e(v,{name:"config.pagination",defaultValue:["false"],control:t.control,render:({onChange:f,value:k})=>e(P,{id:"kc-console-pagination","data-testid":"console-pagination",isDisabled:!1,onChange:b=>f([`${b}`]),isChecked:k[0]==="true",label:r("common:on"),labelOff:r("common:off"),"aria-label":r("pagination")})})})]})]})},we=()=>{const t=B(),{t:i}=A("user-federation"),{adminClient:d}=F(),{addAlert:r,addError:a}=$(),{url:g}=te(),[s,c]=D.exports.useState(0),u=()=>c(s+1),[f,k]=D.exports.useState([]),b=ye(),{id:h}=_(),[I,L]=D.exports.useState();j(()=>d.components.find({parent:h,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"}),y=>{k(b(y.map(V=>({...V,name:V.name,type:V.providerId})),ve("name")))},[s]);const[O,w]=me({titleKey:i("common:deleteMappingTitle",{mapperId:I?.id}),messageKey:"common:deleteMappingConfirm",continueButtonLabel:"common:delete",continueButtonVariant:re.danger,onConfirm:async()=>{try{await d.components.del({id:I.id}),u(),r(i("common:mappingDeletedSuccess"),K.success),L(void 0)}catch(y){a("common:mappingDeletedError",y)}}}),o=y=>y.includes("/mappers")?`${y}`:`${y}/mappers`,T=y=>e(ae,{to:`${o(g)}/${y.id}`,children:y.name});return p(x,{children:[e(w,{}),e(ge,{loader:f,ariaLabelKey:"ldapMappersList",searchPlaceholderKey:"common:searchForMapper",toolbarItem:e(ne,{children:e(R,{"data-testid":"add-mapper-btn",variant:"primary",onClick:()=>t(`${g}/new`),children:i("common:addMapper")})}),actions:[{title:i("common:delete"),onRowClick:y=>{L(y),O()}}],columns:[{name:"name",cellRenderer:T},{name:"type"}],emptyState:e(he,{message:i("common:emptyMappers"),instructions:i("common:emptyMappersInstructions"),primaryActionText:i("common:emptyPrimaryAction"),onPrimaryAction:()=>t(`${g}/new`)})},s)]})},X=({save:t})=>{const{t:i}=A("user-federation"),d=oe(),{id:r}=_(),a=B(),{realm:g}=E();return p(x,{children:[e(be,{sections:[{title:i("generalOptions"),panel:e(xe,{form:d,vendorEdit:!!r})},{title:i("connectionAndAuthenticationSettings"),panel:e(Te,{form:d,id:r})},{title:i("ldapSearchingAndUpdatingSettings"),panel:e(Ce,{form:d})},{title:i("synchronizationSettings"),panel:e(De,{form:d})},{title:i("kerberosIntegration"),panel:e(Le,{form:d})},{title:i("cacheSettings"),panel:e(de,{form:d})},{title:i("advancedSettings"),panel:e(Pe,{form:d,id:r})}]}),e(pe,{onSubmit:d.handleSubmit(t),children:p(fe,{className:"keycloak__form_actions",children:[e(R,{isDisabled:!d.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-save",children:i("common:save")}),e(R,{variant:"link",onClick:()=>a(J({realm:g})),"data-testid":"ldap-cancel",children:i("common:cancel")})]})})]})};function ht(){const{t}=A("user-federation"),i=le({mode:"onChange"}),d=B(),r=ie(),{adminClient:a}=F(),{realm:g}=E(),{id:s}=_(),{addAlert:c,addError:u}=$(),[f,k]=D.exports.useState(),[b,h]=D.exports.useState(0),I=f?.config?.editMode,L=()=>h(o=>o+1);j(async()=>{if(s)return await a.components.findOne({id:s})},o=>{if(o)O(o),k(o);else if(s)throw new Error(t("common:notFound"))},[b]);const O=o=>{i.reset({...o}),i.setValue("config.periodicChangedUsersSync",o.config?.changedSyncPeriod[0]!=="-1"),i.setValue("config.periodicFullSync",o.config?.fullSyncPeriod[0]!=="-1")},w=async o=>{o.config?.periodicChangedUsersSync!==void 0&&(o.config.periodicChangedUsersSync===!1&&(o.config.changedSyncPeriod=["-1"]),delete o.config.periodicChangedUsersSync),o.config?.periodicFullSync!==void 0&&(o.config.periodicFullSync===!1&&(o.config.fullSyncPeriod=["-1"]),delete o.config.periodicFullSync);try{s?await a.components.update({id:s},o):(await a.components.create(o),d(J({realm:g}))),c(t(s?"saveSuccess":"createSuccess"),K.success),L()}catch(T){u(`user-federation:${s?"saveError":"createError"}`,T)}};return p(se,{...i,children:[e(Ie,{provider:"LDAP",noDivider:!0,editMode:I,save:()=>i.handleSubmit(w)()}),e(N,{variant:"light",className:"pf-u-p-0",children:s?p(Se,{defaultLocation:z({realm:g,id:s,tab:"settings"}),isBox:!0,children:[e(W,{id:"settings",title:e(Y,{children:t("common:settings")}),...G({to:z({realm:g,id:s,tab:"settings"}),history:r}),children:e(N,{variant:"light",children:e(X,{save:w})})}),e(W,{id:"mappers",title:e(Y,{children:t("common:mappers")}),"data-testid":"ldap-mappers-tab",...G({to:z({realm:g,id:s,tab:"mappers"}),history:r}),children:e(we,{})})]}):e(N,{variant:"light",children:e(X,{save:w})})})]})}export{ht as default};
