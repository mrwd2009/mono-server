import{e as ia,h as d,F as Y,j as e,ad as _t,q as la,V as It,ay as ie,r as m,a_ as ke,u as F,l as le,az as de,P as W,cA as ft,aA as X,s as R,bR as nt,cB as na,b4 as be,bW as ra,aY as ee,H as _e,g as Ve,ae as te,aB as Ce,bB as tt,b6 as Dt,av as he,K as we,cC as oa,bS as Ye,cy as ca,cD as da,L as lt,aw as $e,cE as Nt,cF as ma,cG as bt,T as mt,bQ as ua,cH as fe,bn as Ot,af as $t,S as pa,cI as Mt,an as jt,am as fa,ap as Qe,cJ as Vt,cK as ha,cL as ga,cM as Kt,n as xt,cN as at,bD as st,cO as yt,bM as ba,cz as qt,ag as ya,aF as va,ax as Wt,c7 as ht,a4 as Ft,t as Sa,m as Ta,b2 as ka,ao as Ia,aC as xa,bA as Ca}from"./index.0cb2e516.js";import{u as ue,b as xe,C as A,F as Ct,a as Jt}from"./index.esm.6af887f8.js";import{u as pe}from"./ConfirmDialog.f8013bbb.js";import{R as rt,r as He}from"./RoutableTabs.f3cff418.js";import{F as vt,V as Ea}from"./ViewHeader.2586557f.js";import{F as Q,b as La,S as Xt,a as Le}from"./FormAccess.bee4f1e0.js";import{H as w,c as Te,T as ot,P as Pa,a as Qt,b as wa,f as Aa}from"./HelpItem.e440d5db.js";import{K as re}from"./KeycloakTextInput.b4d5b2db.js";import{P as Ra}from"./PasswordInput.34ff6dd3.js";import{F as oe}from"./FormPanel.4ba67868.js";/* empty css                               */import{u as Ue}from"./useToggle.8c992bea.js";import{f as Ht,a as v,A as ye,F as Et}from"./FormGroup.3d5f3f16.js";import{C as St}from"./Checkbox.2dc73ed3.js";import{A as gt,K as Da}from"./KeyValueInput.cb1ae3e8.js";import{T as q,t as Na}from"./TimeSelector.1a65a2e3.js";import{K as Ke,L as Pe,P as Oa,T as Ma,n as Va,o as Ka}from"./KeycloakDataTable.4e517788.js";import{M as Ge,a as ze}from"./Modal.6593dfcc.js";import{S as ce,b as ge,a as se,e as Bt}from"./Select.5a6b39aa.js";import{b as Lt,T as z,a as _}from"./Tabs.3d61d369.js";import{T as ct}from"./Trans.ec4d13b3.js";import{N as Tt}from"./NumberInput.331c7b85.js";import{T as Me,a as Fa}from"./Text.c38ffb52.js";import{F as Yt,a as Be}from"./FlexItem.308d9f82.js";import{R as dt}from"./Radio.cfe305aa.js";import{C as Pt,L as wt}from"./CodeEditor.16ebafa0.js";import{J as Ha}from"./JsonFileUpload.41ab83b4.js";import{e as Ba,D as Ua,a as Ga,c as za,d as _a}from"./DataListItemRow.8f458244.js";import{z as Ut,M as $a,an as ja,ao as qa,ap as Wa,ah as Je}from"./TableToolbar.c27bcd3c.js";import{i as Ja}from"./isEqual.b67f23a3.js";import{R as Xa}from"./AddRoleMappingModal.4adc845a.js";import{G as Qa}from"./GroupPickerDialog.f5430678.js";import{Q as Ya}from"./question-circle-icon.c9ca7908.js";import{u as At,U as Za}from"./UserProfileContext.c39a7cda.js";import{D as Zt}from"./DraggableTable.2d0d5d5a.js";import{F as ea}from"./filter-icon.fec9f70e.js";import{KeyProviderForm as es}from"./KeyProviderForm.1c1fd01b.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./CardHeader.f162738f.js";import"./Card.32e78d5f.js";import"./CardTitle.42e61ef4.js";import"./CardBody.a2e5e179.js";import"./check.51c67984.js";import"./minus-circle-icon.de526f05.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./star-icon.97692015.js";import"./plus-icon.407671b4.js";import"./MenuList.288a98b4.js";import"./FileUploadForm.9e6f7b27.js";import"./FileUpload.18e1e495.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.1b75ab8f.js";import"./useLocaleSort.84ea7ec0.js";import"./resource.df4d2bbd.js";import"./joinPath.69b856b1.js";import"./DynamicComponents.3dd18b3b.js";import"./KeycloakTextArea.f5e2440a.js";import"./ClientSelect.a855e118.js";import"./MultiLineInput.e27bc560.js";function ts(a,s){return s=typeof s=="function"?s:void 0,a&&a.length?ia(a,void 0,s):[]}const kt=({value:a,rowIndex:s,cellIndex:t,props:i,handleTextInputChange:l,inputAriaLabel:o,isDisabled:c=!1})=>d(Y,{children:[e("div",{className:Ut.inlineEditValue,children:a}),d("div",{className:Ut.inlineEditInput,children:[e(_t,{isDisabled:c,value:i.editableValue!==void 0?i.editableValue:a,validated:i.isValid!==!1?"default":"error",type:"text",onChange:(p,u)=>{l(p,u,s,t)},"aria-label":o}),e("div",{className:la(Ht.formHelperText,Ht.modifiers.error),"aria-live":"polite",children:i.errorText})]})]});kt.displayName="EditableTextCell";function as(){const{whoAmI:a}=It(),{adminClient:s}=ie(),[t,i]=m.exports.useState(),l=a.getUserId();return ke(()=>s.users.findOne({id:l}),i,[l]),t}const ss=({realm:a})=>{const{t:s}=F("realm-settings"),{adminClient:t}=ie(),{realm:i}=le(),{addAlert:l,addError:o}=de(),c=as(),[p,u]=m.exports.useState(a),{register:n,control:g,handleSubmit:S,watch:T,reset:h,getValues:k,formState:{errors:y}}=ue({defaultValues:p}),P=()=>h(p),L=T("smtpServer.from",""),f=T("smtpServer.host",""),[r,b]=Ue(),x=xe({control:g,name:"smtpServer.auth",defaultValue:""}),B=async C=>{try{const K={...p,...C};K.smtpServer?.port===""&&(K.smtpServer.port=null),await t.realms.update({realm:i},K),u(K),l(s("saveSuccess"),ee.success)}catch(K){o("realm-settings:saveError",K)}},E=async()=>{const C=H=>Number(H),K=H=>H===(!0).toString(),U=new Map([["port",C],["ssl",K],["starttls",K],["auth",K]]),D={...k().smtpServer};for(const[H,O]of U.entries())D[H]=O(D[H]);D.port===0&&(D.port=null);try{b(),await t.realms.testSMTPConnection({realm:p.realm},D),l(s("testConnectionSuccess"),ee.success)}catch(H){o("realm-settings:testConnectionError",H)}b()};return d(W,{variant:"light",children:[e(oe,{title:s("template"),className:"kc-email-template",children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:S(B),children:[e(v,{label:s("from"),fieldId:"kc-display-name",isRequired:!0,validated:y.smtpServer?.from?"error":"default",helperTextInvalid:s("users:emailInvalid"),children:e(re,{type:"email",id:"kc-sender-email-address","data-testid":"sender-email-address",name:"smtpServer.from",ref:n({pattern:ft,required:!0}),placeholder:"Sender email address",validated:y.smtpServer?.from?"error":"default"})}),e(v,{label:s("fromDisplayName"),fieldId:"kc-from-display-name",labelIcon:e(w,{helpText:"realm-settings-help:fromDisplayName",fieldLabelId:"realm-settings:authentication"}),children:e(re,{type:"text",id:"kc-from-display-name","data-testid":"from-display-name",name:"smtpServer.fromDisplayName",ref:n,placeholder:"Display name for Sender email address"})}),e(v,{label:s("replyTo"),fieldId:"kc-reply-to",validated:y.smtpServer?.replyTo?"error":"default",helperTextInvalid:s("users:emailInvalid"),children:e(re,{type:"email",id:"kc-reply-to",name:"smtpServer.replyTo",ref:n({pattern:ft}),placeholder:"Reply to email address",validated:y.smtpServer?.replyTo?"error":"default"})}),e(v,{label:s("replyToDisplayName"),fieldId:"kc-reply-to-display-name",labelIcon:e(w,{helpText:"realm-settings-help:replyToDisplayName",fieldLabelId:"realm-settings:replyToDisplayName"}),children:e(re,{type:"text",id:"kc-reply-to-display-name",name:"smtpServer.replyToDisplayName",ref:n,placeholder:'Display name for "reply to" email address'})}),e(v,{label:s("envelopeFrom"),fieldId:"kc-envelope-from",labelIcon:e(w,{helpText:"realm-settings-help:envelopeFrom",fieldLabelId:"realm-settings:envelopeFrom"}),children:e(re,{type:"text",id:"kc-envelope-from",name:"smtpServer.envelopeFrom",ref:n,placeholder:"Sender envelope email address"})})]})}),e(oe,{className:"kc-email-connection",title:s("connectionAndAuthentication"),children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:S(B),children:[e(v,{label:s("host"),fieldId:"kc-host",isRequired:!0,validated:y.smtpServer?.host?"error":"default",helperTextInvalid:s("common:required"),children:e(re,{type:"text",id:"kc-host",name:"smtpServer.host",ref:n({required:!0}),placeholder:"SMTP host",validated:y.smtpServer?.host?"error":"default"})}),e(v,{label:s("port"),fieldId:"kc-port",children:e(re,{type:"text",id:"kc-port",name:"smtpServer.port",ref:n,placeholder:"SMTP port (defaults to 25)"})}),d(v,{label:s("encryption"),fieldId:"kc-html-display-name",children:[e(A,{name:"smtpServer.ssl",control:g,defaultValue:"false",render:({onChange:C,value:K})=>e(St,{id:"kc-enable-ssl","data-testid":"enable-ssl",label:s("enableSSL"),ref:n,isChecked:K==="true",onChange:U=>C(""+U)})}),e(A,{name:"smtpServer.starttls",control:g,defaultValue:"false",render:({onChange:C,value:K})=>e(St,{id:"kc-enable-start-tls","data-testid":"enable-start-tls",label:s("enableStartTLS"),ref:n,isChecked:K==="true",onChange:U=>C(""+U)})})]}),e(v,{hasNoPaddingTop:!0,label:s("authentication"),fieldId:"kc-authentication",children:e(A,{name:"smtpServer.auth",control:g,defaultValue:"",render:({onChange:C,value:K})=>e(X,{id:"kc-authentication-switch","data-testid":"email-authentication-switch",label:s("common:enabled"),labelOff:s("common:disabled"),isChecked:K==="true",onChange:U=>{C(""+U)},"aria-label":s("authentication")})})}),x==="true"&&d(Y,{children:[e(v,{label:s("username"),fieldId:"kc-username",isRequired:!0,validated:y.smtpServer?.user?"error":"default",helperTextInvalid:s("common:required"),children:e(re,{type:"text",id:"kc-username","data-testid":"username-input",name:"smtpServer.user",ref:n({required:!0}),placeholder:"Login username",validated:y.smtpServer?.user?"error":"default"})}),e(v,{label:s("password"),fieldId:"kc-username",isRequired:!0,validated:y.smtpServer?.password?"error":"default",helperTextInvalid:s("common:required"),labelIcon:e(w,{helpText:"realm-settings-help:password",fieldLabelId:"realm-settings:password"}),children:e(Ra,{id:"kc-password","data-testid":"password-input",name:"smtpServer.password","aria-label":s("password"),validated:y.smtpServer?.password?"error":"default",ref:n({required:!0})})})]}),d(ye,{children:[e(gt,{children:e(R,{variant:"primary",type:"submit","data-testid":"email-tab-save",children:s("common:save")})}),e(gt,{children:e(R,{variant:"secondary",onClick:()=>E(),"data-testid":"test-connection-button",isDisabled:!(ft.test(L)&&f)||!c?.email,"aria-describedby":"descriptionTestConnection",isLoading:r,spinnerAriaValueText:s("testingConnection"),children:s("common:testConnection")})}),e(gt,{children:e(R,{variant:"link",onClick:P,"data-testid":"email-tab-revert",children:s("common:revert")})})]}),c&&e(v,{id:"descriptionTestConnection",children:c.email?e(nt,{variant:"info",isInline:!0,title:s("testConnectionHint.withEmail",{email:c.email})}):e(nt,{variant:"warning",isInline:!0,title:s("testConnectionHint.withoutEmail",{userName:c.username}),actionLinks:e(na,{component:C=>e(be,{...C,to:ra({realm:i,id:c.id,tab:"settings"})}),children:s("testConnectionHint.withoutEmailAction")})})})]})})]})},Gt=({type:a,form:s,reset:t,clear:i})=>{const{t:l}=F("realm-settings"),{control:o,watch:c,setValue:p,formState:{isDirty:u}}=s,n=a==="admin"?"adminEventsEnabled":"eventsEnabled",g=c(n),[S,T]=pe({titleKey:"realm-settings:events-disable-title",messageKey:"realm-settings:events-disable-confirm",continueButtonLabel:"realm-settings:confirm",onConfirm:()=>p(n,!1)});return d(Y,{children:[e(T,{}),e(v,{hasNoPaddingTop:!0,label:l("saveEvents"),fieldId:n,labelIcon:e(w,{helpText:`realm-settings-help:save-${a}-events`,fieldLabelId:"realm-settings:saveEvents"}),children:e(A,{name:n,defaultValue:!1,control:o,render:({onChange:h,value:k})=>e(X,{"data-testid":n,id:`${n}-switch`,label:l("common:on"),labelOff:l("common:off"),isChecked:k,onChange:y=>{y?h(y):S()},"aria-label":l("saveEvents")})})}),g&&d(Y,{children:[a==="admin"&&e(v,{hasNoPaddingTop:!0,label:l("includeRepresentation"),fieldId:"includeRepresentation",labelIcon:e(w,{helpText:"realm-settings-help:includeRepresentation",fieldLabelId:"realm-settings:includeRepresentation"}),children:e(A,{name:"adminEventsDetailsEnabled",defaultValue:!1,control:o,render:({onChange:h,value:k})=>e(X,{"data-testid":"includeRepresentation",id:"includeRepresentation",label:l("common:on"),labelOff:l("common:off"),isChecked:k,onChange:h,"aria-label":l("includeRepresentation")})})}),e(v,{label:l("expiration"),fieldId:"expiration",labelIcon:e(w,{helpText:"realm-settings-help:expiration",fieldLabelId:"realm-settings:expiration"}),children:e(A,{name:a==="user"?"eventsExpiration":"adminEventsExpiration",defaultValue:"",control:o,render:({onChange:h,value:k})=>e(q,{value:k,onChange:h,units:["minute","hour","day"]})})})]}),d(ye,{children:[e(R,{variant:"primary",type:"submit",id:`save-${a}`,"data-testid":`save-${a}`,isDisabled:!u,children:l("common:save")}),e(R,{variant:"link",onClick:t,children:l("common:revert")})]}),e(_e,{}),e(v,{label:l(a==="user"?"clearUserEvents":"clearAdminEvents"),fieldId:`clear-${a}-events`,labelIcon:e(w,{helpText:`realm-settings-help:${a}-clearEvents`,fieldLabelId:`realm-settings:clear-${a}-events`}),children:e(R,{variant:"danger",id:`clear-${a}-events`,"data-testid":`clear-${a}-events`,onClick:()=>i(),children:l(a==="user"?"clearUserEvents":"clearAdminEvents")})})]})};function ta({loader:a,addTypes:s,onSelect:t,onDelete:i}){const{t:l}=F("realm-settings"),o=c=>e(m.exports.Fragment,{children:l(`eventTypes.${c.id}.description`)},c.id);return e(Ke,{ariaLabelKey:"userEventsRegistered",searchPlaceholderKey:"realm-settings:searchEventType",loader:a,onSelect:t||void 0,canSelectAll:!!t,toolbarItem:s&&e(Te,{children:e(R,{id:"addTypes",onClick:s,"data-testid":"addTypes",children:l("addSavedTypes")})}),actions:i?[{title:l("common:delete"),onRowClick:i}]:[],columns:[{name:"id",displayKey:"realm-settings:eventType",cellFormatters:[c=>l(`eventTypes.${c}.name`)]},{name:"description",displayKey:"description",cellRenderer:o}],emptyState:e(Pe,{message:l("emptyEvents"),instructions:l("emptyEventsInstructions")})})}const is=({onConfirm:a,onClose:s,configured:t})=>{const{t:i}=F("realm-settings"),{enums:l}=Ve(),[o,c]=m.exports.useState([]);return e(Ge,{variant:ze.medium,title:i("addTypes"),isOpen:!0,onClose:s,actions:[e(R,{"data-testid":"addEventTypeConfirm",variant:"primary",onClick:()=>a(o),children:i("common:add")},"confirm"),e(R,{"data-testid":"moveCancel",variant:"link",onClick:s,children:i("common:cancel")},"cancel")],children:e(ta,{onSelect:p=>c(p),loader:()=>Promise.resolve(l.eventType.filter(p=>!t.includes(p)).map(p=>({id:p})))})})},ls=({form:a,reset:s})=>{const{t}=F("realm-settings"),{control:i,formState:{isDirty:l}}=a,[o,c]=m.exports.useState(!1),u=Ve().providers?.eventsListener.providers;return d(Y,{children:[e(v,{hasNoPaddingTop:!0,label:t("eventListeners"),fieldId:"kc-eventListeners",labelIcon:e(w,{helpText:t("eventListenersHelpText"),fieldLabelId:"realm-settings:eventListeners"}),children:e(A,{name:"eventsListeners",defaultValue:"",control:i,render:({onChange:n,value:g})=>e(ce,{name:"eventsListeners",className:"kc_eventListeners_select","data-testid":"eventListeners-select",chipGroupProps:{numChips:3,expandedText:t("common:hide"),collapsedText:t("common:showRemaining")},variant:ge.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:S=>c(S),selections:g,onSelect:(S,T)=>{const h=T.toString(),k=g.includes(h)?g.filter(y=>y!==h):[...g,h];n(k)},onClear:S=>{S.stopPropagation(),n([])},isOpen:o,"aria-labelledby":"eventsListeners",children:Object.keys(u).map(S=>e(se,{value:S},S))})})}),d(ye,{children:[e(R,{variant:"primary",type:"submit","data-testid":"saveEventListenerBtn",isDisabled:!l,children:t("common:save")}),e(R,{variant:"link","data-testid":"revertEventListenerBtn",onClick:s,children:t("common:revert")})]})]})},ns=({realm:a})=>{const{t:s}=F("realm-settings"),t=ue(),{setValue:i,handleSubmit:l,watch:o}=t,[c,p]=m.exports.useState(0),u=()=>p(new Date().getTime()),[n,g]=m.exports.useState(0),S=()=>g(new Date().getTime()),[T,h]=m.exports.useState("event"),[k,y]=m.exports.useState(),[P,L]=m.exports.useState(),[f,r]=m.exports.useState(!1),{adminClient:b}=ie(),{addAlert:x,addError:B}=de(),{realm:E}=le(),C=N=>{y(N),Ce(N,i)},K=async N=>{L(N),U()},[U,D]=pe({titleKey:"realm-settings:deleteEvents",messageKey:"realm-settings:deleteEventsConfirm",continueButtonLabel:"common:clear",continueButtonVariant:te.danger,onConfirm:async()=>{try{switch(P){case"admin":await b.realms.clearAdminEvents({realm:E});break;case"user":await b.realms.clearEvents({realm:E});break}x(s(`${P}-events-cleared`),ee.success)}catch(N){B(`realm-settings:${P}-events-cleared-error`,N)}}});ke(()=>b.realms.getConfigEvents({realm:E}),N=>{C({...N,adminEventsExpiration:a.attributes?.adminEventsExpiration}),S()},[c]);const H=async N=>{const Z=k?.eventsListeners!==N.eventsListeners,{adminEventsExpiration:ne,...Ie}=N;a.attributes?.adminEventsExpiration!==ne&&await b.realms.update({realm:E},{...a,attributes:{...a.attributes||{},adminEventsExpiration:ne}});try{await b.realms.updateConfigEvents({realm:E},Ie),C({...k,...Ie,adminEventsExpiration:ne}),x(s(Z?"realm-settings:saveEventListenersSuccess":"realm-settings:eventConfigSuccessfully"),ee.success)}catch(je){B(s(Z?"realm-settings:saveEventListenersError":"realm-settings:eventConfigError"),je)}},O=async N=>{const Z=N.map(Ie=>Ie.id),ne=k.enabledEventTypes?.concat(Z);await J(ne)},J=async(N=[])=>{const Z={...t.getValues(),enabledEventTypes:N};await H(Z),r(!1),u()},me=o("eventsEnabled")||!1;return d(Y,{children:[e(D,{}),f&&e(is,{onConfirm:N=>O(N),configured:k?.enabledEventTypes||[],onClose:()=>r(!1)}),d(Lt,{activeKey:T,onSelect:(N,Z)=>h(Z),children:[e(z,{eventKey:"event",title:e(_,{children:s("eventListeners")}),"data-testid":"rs-event-listeners-tab",children:e(W,{children:e(Q,{role:"manage-events",isHorizontal:!0,onSubmit:l(H),children:e(ls,{form:t,reset:()=>C(k)})})})}),d(z,{eventKey:"user",title:e(_,{children:s("userEventsSettings")}),"data-testid":"rs-events-tab",children:[e(W,{children:e(ot,{headingLevel:"h1",size:"xl",children:s("userEventsConfig")})}),e(W,{children:e(Q,{role:"manage-events",isHorizontal:!0,onSubmit:l(H),children:e(Gt,{type:"user",form:t,reset:()=>C(k),clear:()=>K("user")})})}),me&&e(W,{children:e(ta,{addTypes:()=>r(!0),loader:()=>Promise.resolve(k?.enabledEventTypes?.map(N=>({id:N}))||[]),onDelete:N=>{const Z=k?.enabledEventTypes?.filter(ne=>ne!==N.id);J(Z),y({...k,enabledEventTypes:Z})}},n)})]}),d(z,{eventKey:"admin",title:e(_,{children:s("adminEventsSettings")}),"data-testid":"rs-admin-events-tab",children:[e(W,{children:e(ot,{headingLevel:"h4",size:"xl",children:s("adminEventsConfig")})}),e(W,{children:e(Q,{role:"manage-events",isHorizontal:!0,onSubmit:l(H),children:e(Gt,{type:"admin",form:t,reset:()=>C(k),clear:()=>K("admin")})})})]})]})]})};var Rt=(a=>(a.DeclarativeUserProfile="DECLARATIVE_USER_PROFILE",a))(Rt||{});function aa(){const{profileInfo:a}=Ve(),s=a?.experimentalFeatures??[],t=a?.previewFeatures??[],i=a?.disabledFeatures??[],o=[...s,...t].filter(c=>!i.includes(c));return function(p){return o.includes(p)}}const rs=({realm:a,save:s})=>{const{t}=F("realm-settings"),{adminClient:i}=ie(),{realm:l}=le(),o=ue({shouldUnregister:!1}),{register:c,control:p,handleSubmit:u,setValue:n,formState:{isDirty:g}}=o,S=aa(),[T,h]=m.exports.useState(!1),k=["all","external","none"],y=()=>{if(Ce(a,n),a.attributes?.["acr.loa.map"]){const P=Object.entries(JSON.parse(a.attributes["acr.loa.map"])).flatMap(([L,f])=>({key:L,value:f}));P.concat({key:"",value:""}),n(tt("attributes.acr.loa.map"),P)}};return m.exports.useEffect(y,[]),e(W,{variant:"light",children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:u(s),children:[e(v,{label:t("realmId"),fieldId:"kc-realm-id",isRequired:!0,children:e(A,{name:"realm",control:p,defaultValue:"",render:({onChange:P,value:L})=>e(La,{"data-testid":"realmName",onChange:P,children:L})})}),e(v,{label:t("displayName"),fieldId:"kc-display-name",children:e(re,{type:"text",id:"kc-display-name",name:"displayName",ref:c})}),e(v,{label:t("htmlDisplayName"),fieldId:"kc-html-display-name",children:e(re,{type:"text",id:"kc-html-display-name",name:"displayNameHtml",ref:c})}),e(v,{label:t("frontendUrl"),fieldId:"kc-frontend-url",labelIcon:e(w,{helpText:"realm-settings-help:frontendUrl",fieldLabelId:"realm-settings:frontendUrl"}),children:e(re,{type:"text",id:"kc-frontend-url",name:tt("attributes.frontendUrl"),ref:c})}),e(v,{label:t("requireSsl"),fieldId:"kc-require-ssl",labelIcon:e(w,{helpText:"realm-settings-help:requireSsl",fieldLabelId:"realm-settings:requireSsl"}),children:e(A,{name:"sslRequired",defaultValue:"none",control:p,render:({onChange:P,value:L})=>e(ce,{toggleId:"kc-require-ssl",onToggle:()=>h(!T),onSelect:(f,r)=>{P(r),h(!1)},selections:L,variant:ge.single,"aria-label":t("requireSsl"),isOpen:T,children:k.map(f=>e(se,{selected:f===L,value:f,children:t(`sslType.${f}`)},f))})})}),e(v,{label:t("clients:acrToLoAMapping"),fieldId:"acrToLoAMapping",labelIcon:e(w,{helpText:"clients-help:acrToLoAMapping",fieldLabelId:"clients:acrToLoAMapping"}),children:e(Ct,{...o,children:e(Da,{name:tt("attributes.acr.loa.map")})})}),e(v,{hasNoPaddingTop:!0,label:t("userManagedAccess"),labelIcon:e(w,{helpText:"realm-settings-help:userManagedAccess",fieldLabelId:"realm-settings:userManagedAccess"}),fieldId:"kc-user-managed-access",children:e(A,{name:"userManagedAccessAllowed",control:p,defaultValue:!1,render:({onChange:P,value:L})=>e(X,{id:"kc-user-managed-access","data-testid":"user-managed-access-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:L,onChange:P,"aria-label":t("userManagedAccess")})})}),S(Rt.DeclarativeUserProfile)&&e(v,{hasNoPaddingTop:!0,label:t("userProfileEnabled"),labelIcon:e(w,{helpText:"realm-settings-help:userProfileEnabled",fieldLabelId:"realm-settings:userProfileEnabled"}),fieldId:"kc-user-profile-enabled",children:e(A,{name:tt("attributes.userProfileEnabled"),control:p,defaultValue:!1,render:({onChange:P,value:L})=>e(X,{id:"kc-user-profile-enabled","data-testid":"user-profile-enabled-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:L==="true",onChange:f=>P(f.toString()),"aria-label":t("userProfileEnabled")})})}),e(v,{label:t("endpoints"),labelIcon:e(w,{helpText:"realm-settings-help:endpoints",fieldLabelId:"realm-settings:endpoints"}),fieldId:"kc-endpoints",children:d(Xt,{children:[e(Le,{children:e(vt,{href:`${Dt(i.baseUrl)}realms/${l}/.well-known/openid-configuration`,title:t("openIDEndpointConfiguration")})}),e(Le,{children:e(vt,{href:`${Dt(i.baseUrl)}realms/${l}/protocol/saml/descriptor`,title:t("samlIdentityProviderMetadata")})})]})}),d(ye,{children:[e(R,{variant:"primary",type:"submit","data-testid":"general-tab-save",isDisabled:!g,children:t("common:save")}),e(R,{"data-testid":"general-tab-revert",variant:"link",onClick:y,children:t("common:revert")})]})]})})},os=({realm:a,refresh:s})=>{const{t}=F("realm-settings"),{addAlert:i,addError:l}=de(),{adminClient:o}=ie(),{realm:c}=le(),p=async u=>{const n=Array.isArray(u)?Object.keys(u[0])[0]:Object.keys(u)[0];try{await o.realms.update({realm:c},Array.isArray(u)?u.reduce((g,S)=>Object.assign(g,S),a):Object.assign(a,u)),i(t("enableSwitchSuccess",{switch:t(n)})),s()}catch(g){l(t("enableSwitchError"),g)}};return d(W,{variant:"light",children:[e(oe,{className:"kc-login-screen",title:t("loginScreenCustomization"),children:d(Q,{isHorizontal:!0,role:"manage-realm",children:[e(v,{label:t("registrationAllowed"),fieldId:"kc-user-reg",labelIcon:e(w,{helpText:t("userRegistrationHelpText"),fieldLabelId:"realm-settings:registrationAllowed"}),hasNoPaddingTop:!0,children:e(X,{id:"kc-user-reg-switch","data-testid":"user-reg-switch",value:a.registrationAllowed?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:a.registrationAllowed,onChange:u=>{p({registrationAllowed:u})},"aria-label":t("registrationAllowed")})}),e(v,{label:t("resetPasswordAllowed"),fieldId:"kc-forgot-pw",labelIcon:e(w,{helpText:"realm-settings:forgotPasswordHelpText",fieldLabelId:"realm-settings:resetPasswordAllowed"}),hasNoPaddingTop:!0,children:e(X,{id:"kc-forgot-pw-switch","data-testid":"forgot-pw-switch",name:"resetPasswordAllowed",value:a.resetPasswordAllowed?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:a.resetPasswordAllowed,onChange:u=>{p({resetPasswordAllowed:u})},"aria-label":t("resetPasswordAllowed")})}),e(v,{label:t("rememberMe"),fieldId:"kc-remember-me",labelIcon:e(w,{helpText:"realm-settings:rememberMeHelpText",fieldLabelId:"realm-settings:rememberMe"}),hasNoPaddingTop:!0,children:e(X,{id:"kc-remember-me-switch","data-testid":"remember-me-switch",value:a.rememberMe?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:a.rememberMe,onChange:u=>{p({rememberMe:u})},"aria-label":t("rememberMe")})})]})}),e(oe,{className:"kc-email-settings",title:t("emailSettings"),children:d(Q,{isHorizontal:!0,role:"manage-realm",children:[e(v,{label:t("registrationEmailAsUsername"),fieldId:"kc-email-as-username",labelIcon:e(w,{helpText:"realm-settings:emailAsUsernameHelpText",fieldLabelId:"realm-settings:registrationEmailAsUsername"}),hasNoPaddingTop:!0,children:e(X,{id:"kc-email-as-username-switch","data-testid":"email-as-username-switch",value:a.registrationEmailAsUsername?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:a.registrationEmailAsUsername,onChange:u=>{p([{registrationEmailAsUsername:u},{duplicateEmailsAllowed:!1}])},"aria-label":t("registrationEmailAsUsername")})}),e(v,{label:t("loginWithEmailAllowed"),fieldId:"kc-login-with-email",labelIcon:e(w,{helpText:"realm-settings:loginWithEmailHelpText",fieldLabelId:"realm-settings:loginWithEmailAllowed"}),hasNoPaddingTop:!0,children:e(X,{id:"kc-login-with-email-switch","data-testid":"login-with-email-switch",value:a.loginWithEmailAllowed?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:a.loginWithEmailAllowed,onChange:u=>{p([{loginWithEmailAllowed:u},{duplicateEmailsAllowed:!1}])},"aria-label":t("loginWithEmailAllowed")})}),e(v,{label:t("duplicateEmailsAllowed"),fieldId:"kc-duplicate-emails",labelIcon:e(w,{helpText:"realm-settings:duplicateEmailsHelpText",fieldLabelId:"realm-settings:duplicateEmailsAllowed"}),hasNoPaddingTop:!0,children:e(X,{id:"kc-duplicate-emails-switch","data-testid":"duplicate-emails-switch",label:t("common:on"),labelOff:t("common:off"),isChecked:a.duplicateEmailsAllowed||a.loginWithEmailAllowed||a.registrationEmailAsUsername,onChange:u=>{p({duplicateEmailsAllowed:u})},isDisabled:a.loginWithEmailAllowed||a.registrationEmailAsUsername,"aria-label":t("duplicateEmailsAllowed")})}),e(v,{label:t("verifyEmail"),fieldId:"kc-verify-email",labelIcon:e(w,{helpText:"realm-settings:verifyEmailHelpText",fieldLabelId:"realm-settings:verifyEmail"}),hasNoPaddingTop:!0,children:e(X,{id:"kc-verify-email-switch","data-testid":"verify-email-switch",name:"verifyEmail",value:a.verifyEmail?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:a.verifyEmail,onChange:u=>{p({verifyEmail:u})},"aria-label":t("verifyEmail")})})]})}),e(oe,{className:"kc-user-info-settings",title:t("userInfoSettings"),children:e(Q,{isHorizontal:!0,role:"manage-realm",children:e(v,{label:t("editUsernameAllowed"),fieldId:"kc-edit-username",labelIcon:e(w,{helpText:"realm-settings-help:editUsername",fieldLabelId:"realm-settings:editUsernameAllowed"}),hasNoPaddingTop:!0,children:e(X,{id:"kc-edit-username-switch","data-testid":"edit-username-switch",value:a.editUsernameAllowed?"on":"off",label:t("common:on"),labelOff:t("common:off"),isChecked:a.editUsernameAllowed,onChange:u=>{p({editUsernameAllowed:u})},"aria-label":t("editUsernameAllowed")})})})})]})},Oe=({fieldName:a,url:s})=>{const{t}=F("realm-settings"),{register:i}=Jt(),l=a.substr(a.indexOf(".")+1);return e(v,{label:t(l),fieldId:l,labelIcon:e(w,{helpText:d(ct,{i18nKey:`realm-settings-help:${l}`,children:["Default value prevents pages from being included",e(vt,{href:s,title:t("common:learnMore")})]}),fieldLabelId:l}),children:e(re,{type:"text",id:l,name:a,ref:i})})};const cs=({realm:a,save:s})=>{const{t}=F(),i=ue(),{setValue:l,formState:{isDirty:o},handleSubmit:c}=i,p=()=>Ce(a,l);return m.exports.useEffect(p,[]),e(Ct,{...i,children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"keycloak__security-defences__form",onSubmit:c(s),children:[e(Oe,{fieldName:"browserSecurityHeaders.xFrameOptions",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options"}),e(Oe,{fieldName:"browserSecurityHeaders.contentSecurityPolicy",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy"}),e(Oe,{fieldName:"browserSecurityHeaders.contentSecurityPolicyReportOnly",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy-Report-Only"}),e(Oe,{fieldName:"browserSecurityHeaders.xContentTypeOptions",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options"}),e(Oe,{fieldName:"browserSecurityHeaders.xRobotsTag",url:"https://developers.google.com/search/docs/advanced/robots/robots_meta_tag"}),e(Oe,{fieldName:"browserSecurityHeaders.xXSSProtection",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection"}),e(Oe,{fieldName:"browserSecurityHeaders.strictTransportSecurity",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security"}),d(ye,{children:[e(R,{variant:"primary",type:"submit","data-testid":"headers-form-tab-save",isDisabled:!o,children:t("common:save")}),e(R,{variant:"link",onClick:p,children:t("common:revert")})]})]})})},it=({name:a,style:s})=>{const{t}=F("realm-settings"),{control:i,formState:{errors:l}}=Jt();return e(v,{style:s,label:t(a),fieldId:a,labelIcon:e(w,{helpText:`realm-settings-help:${a}`,fieldLabelId:`realm-settings:${a}`}),validated:l[a]?he.error:he.default,helperTextInvalid:t("common:required"),children:e(A,{name:a,defaultValue:"",control:i,rules:{required:!0},render:({onChange:o,value:c})=>e(q,{"data-testid":a,value:c,onChange:o,validated:l[a]?he.error:he.default})})})},ds=({realm:a,save:s})=>{const{t}=F("realm-settings"),i=ue({shouldUnregister:!1}),{setValue:l,handleSubmit:o,control:c,formState:{isDirty:p}}=i,u=xe({control:c,name:"bruteForceProtected"}),n=xe({control:c,name:"permanentLockout"}),g=()=>Ce(a,l);return m.exports.useEffect(g,[]),e(Ct,{...i,children:d(Q,{role:"manage-realm",isHorizontal:!0,onSubmit:o(s),children:[e(v,{label:t("common:enabled"),fieldId:"bruteForceProtected",hasNoPaddingTop:!0,children:e(A,{name:"bruteForceProtected",defaultValue:!1,control:c,render:({onChange:S,value:T})=>e(X,{id:"bruteForceProtected",label:t("common:on"),labelOff:t("common:off"),isChecked:T,onChange:S,"aria-label":t("common:enabled")})})}),u&&d(Y,{children:[e(v,{label:t("failureFactor"),labelIcon:e(w,{helpText:"realm-settings-help:failureFactor",fieldLabelId:"realm-settings:failureFactor"}),fieldId:"failureFactor",children:e(A,{name:"failureFactor",defaultValue:0,control:c,rules:{required:!0},render:({onChange:S,value:T})=>e(Tt,{type:"text",id:"failureFactor",value:T,onPlus:()=>S(T+1),onMinus:()=>S(T-1),onChange:h=>S(Number(h.target.value))})})}),e(v,{label:t("permanentLockout"),fieldId:"permanentLockout",hasNoPaddingTop:!0,children:e(A,{name:"permanentLockout",defaultValue:!1,control:c,render:({onChange:S,value:T})=>e(X,{id:"permanentLockout",label:t("common:on"),labelOff:t("common:off"),isChecked:T,onChange:S,"aria-label":t("permanentLockout")})})}),!n&&d(Y,{children:[e(it,{name:"waitIncrementSeconds"}),e(it,{name:"maxFailureWaitSeconds"}),e(it,{name:"maxDeltaTimeSeconds"})]}),e(v,{label:t("quickLoginCheckMilliSeconds"),labelIcon:e(w,{helpText:"realm-settings-help:quickLoginCheckMilliSeconds",fieldLabelId:"realm-settings:quickLoginCheckMilliSeconds"}),fieldId:"quickLoginCheckMilliSeconds",children:e(A,{name:"quickLoginCheckMilliSeconds",defaultValue:0,control:c,render:({onChange:S,value:T})=>e(Tt,{type:"text",id:"quickLoginCheckMilliSeconds",value:T,onPlus:()=>S(T+1),onMinus:()=>S(T-1),onChange:h=>S(Number(h.target.value))})})}),e(it,{name:"minimumQuickLoginWaitSeconds"})]}),d(ye,{children:[e(R,{variant:"primary",type:"submit","data-testid":"brute-force-tab-save",isDisabled:!p,children:t("common:save")}),e(R,{variant:"link",onClick:g,children:t("common:revert")})]})]})})},ms=({realm:a,save:s})=>{const{t}=F("realm-settings"),[i,l]=m.exports.useState(10);return d(Lt,{activeKey:i,onSelect:(o,c)=>l(c),children:[e(z,{id:"headers",eventKey:10,title:e(_,{children:t("headers")}),children:e(W,{variant:"light",children:e(cs,{realm:a,save:s})})}),e(z,{id:"bruteForce",eventKey:20,title:e(_,{children:t("bruteForceDetection")}),children:e(W,{variant:"light",children:e(ds,{realm:a,save:s})})})]})},us=({realm:a,save:s})=>{const{t}=F("realm-settings"),{setValue:i,control:l,handleSubmit:o,formState:c}=ue({shouldUnregister:!1}),p=xe({control:l,name:"offlineSessionMaxLifespanEnabled"}),u=()=>{Ce(a,i)};return m.exports.useEffect(u,[]),d(W,{variant:"light",children:[e(oe,{title:t("SSOSessionSettings"),className:"kc-sso-session-template",children:d(Q,{isHorizontal:!0,role:"manage-realm",onSubmit:o(s),children:[e(v,{label:t("SSOSessionIdle"),fieldId:"SSOSessionIdle",labelIcon:e(w,{helpText:"realm-settings-help:ssoSessionIdle",fieldLabelId:"realm-settings:SSOSessionIdle"}),children:e(A,{name:"ssoSessionIdleTimeout",defaultValue:a.ssoSessionIdleTimeout,control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-sso-session-idle","data-testid":"sso-session-idle-input","aria-label":"sso-session-idle-input",value:g,onChange:n,units:["minute","hour","day"]})})}),e(v,{label:t("SSOSessionMax"),fieldId:"SSOSessionMax",labelIcon:e(w,{helpText:"realm-settings-help:ssoSessionMax",fieldLabelId:"realm-settings:SSOSessionMax"}),children:e(A,{name:"ssoSessionMaxLifespan",defaultValue:"",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-sso-session-max","data-testid":"sso-session-max-input","aria-label":"sso-session-max-input",value:g,onChange:n,units:["minute","hour","day"]})})}),e(v,{label:t("SSOSessionIdleRememberMe"),fieldId:"SSOSessionIdleRememberMe",labelIcon:e(w,{helpText:"realm-settings-help:ssoSessionIdleRememberMe",fieldLabelId:"realm-settings:SSOSessionIdleRememberMe"}),children:e(A,{name:"ssoSessionIdleTimeoutRememberMe",defaultValue:"",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-sso-session-idle-remember-me","data-testid":"sso-session-idle-remember-me-input","aria-label":"sso-session-idle-remember-me-input",value:g,onChange:n,units:["minute","hour","day"]})})}),e(v,{label:t("SSOSessionMaxRememberMe"),fieldId:"SSOSessionMaxRememberMe",labelIcon:e(w,{helpText:"realm-settings-help:ssoSessionMaxRememberMe",fieldLabelId:"realm-settings:SSOSessionMaxRememberMe"}),children:e(A,{name:"ssoSessionMaxLifespanRememberMe",defaultValue:"",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-sso-session-max-remember-me","aria-label":"sso-session-max-remember-me-input","data-testid":"sso-session-max-remember-me-input",value:g,onChange:n,units:["minute","hour","day"]})})})]})}),e(oe,{title:t("clientSessionSettings"),className:"kc-client-session-template",children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:o(s),children:[e(v,{label:t("clientSessionIdle"),fieldId:"clientSessionIdle",labelIcon:e(w,{helpText:"realm-settings-help:clientSessionIdle",fieldLabelId:"realm-settings:clientSessionIdle"}),children:e(A,{name:"clientSessionIdleTimeout",defaultValue:"",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-client-session-idle","data-testid":"client-session-idle-input","aria-label":"client-session-idle-input",value:g,onChange:n,units:["minute","hour","day"]})})}),e(v,{label:t("clientSessionMax"),fieldId:"clientSessionMax",labelIcon:e(w,{helpText:"realm-settings-help:clientSessionMax",fieldLabelId:"realm-settings:clientSessionMax"}),children:e(A,{name:"clientSessionMaxLifespan",defaultValue:"",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-client-session-max","data-testid":"client-session-max-input","aria-label":"client-session-max-input",value:g,onChange:n,units:["minute","hour","day"]})})})]})}),e(oe,{title:t("offlineSessionSettings"),className:"kc-offline-session-template",children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:o(s),children:[e(v,{label:t("offlineSessionIdle"),fieldId:"offlineSessionIdle",labelIcon:e(w,{helpText:"realm-settings-help:offlineSessionIdle",fieldLabelId:"realm-settings:offlineSessionIdle"}),children:e(A,{name:"offlineSessionIdleTimeout",defaultValue:"",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-offline-session-idle","data-testid":"offline-session-idle-input","aria-label":"offline-session-idle-input",value:g,onChange:n,units:["minute","hour","day"]})})}),e(v,{hasNoPaddingTop:!0,label:t("offlineSessionMaxLimited"),fieldId:"kc-offlineSessionMaxLimited",labelIcon:e(w,{helpText:"realm-settings-help:offlineSessionMaxLimited",fieldLabelId:"realm-settings:offlineSessionMaxLimited"}),children:e(A,{name:"offlineSessionMaxLifespanEnabled",control:l,defaultValue:!1,render:({onChange:n,value:g})=>e(X,{id:"kc-offline-session-max","data-testid":"offline-session-max-switch","aria-label":t("offlineSessionMaxLimited"),label:t("common:enabled"),labelOff:t("common:disabled"),isChecked:g,onChange:n})})}),p&&e(v,{label:t("offlineSessionMax"),fieldId:"offlineSessionMax",id:"offline-session-max-label",labelIcon:e(w,{helpText:"realm-settings-help:offlineSessionMax",fieldLabelId:"realm-settings:offlineSessionMax"}),children:e(A,{name:"offlineSessionMaxLifespan",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-offline-session-max","data-testid":"offline-session-max-input","aria-label":"offline-session-max-input",value:g,onChange:n,units:["minute","hour","day"]})})})]})}),e(oe,{className:"kc-login-settings-template",title:t("loginSettings"),children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:o(s),children:[e(v,{label:t("loginTimeout"),id:"kc-login-timeout-label",fieldId:"offlineSessionIdle",labelIcon:e(w,{helpText:"realm-settings-help:loginTimeout",fieldLabelId:"realm-settings:loginTimeout"}),children:e(A,{name:"accessCodeLifespanLogin",defaultValue:"",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-login-timeout","data-testid":"login-timeout-input","aria-label":"login-timeout-input",value:g,onChange:n,units:["minute","hour","day"]})})}),e(v,{label:t("loginActionTimeout"),fieldId:"loginActionTimeout",id:"login-action-timeout-label",labelIcon:e(w,{helpText:"realm-settings-help:loginActionTimeout",fieldLabelId:"realm-settings:loginActionTimeout"}),children:e(A,{name:"accessCodeLifespanUserAction",defaultValue:"",control:l,render:({onChange:n,value:g})=>e(q,{className:"kc-login-action-timeout","data-testid":"login-action-timeout-input","aria-label":"login-action-timeout-input",value:g,onChange:n,units:["minute","hour","day"]})})}),d(ye,{children:[e(R,{variant:"primary",type:"submit","data-testid":"sessions-tab-save",isDisabled:!c.isDirty,children:t("common:save")}),e(R,{variant:"link",onClick:u,children:t("common:revert")})]})]})})]})},ps=({realm:a,save:s})=>{const{t}=F("realm-settings"),[i,l]=m.exports.useState(!1),[o,c]=m.exports.useState(!1),[p,u]=m.exports.useState(!1),[n,g]=m.exports.useState(!1),{control:S,handleSubmit:T,setValue:h}=ue(),k=Ve().themes,y=()=>{Ce(a,h)};return m.exports.useEffect(y,[]),e(W,{variant:"light",children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:T(s),children:[e(v,{label:t("loginTheme"),fieldId:"kc-login-theme",labelIcon:e(w,{helpText:"realm-settings-help:loginTheme",fieldLabelId:"realm-settings:loginTheme"}),children:e(A,{name:"loginTheme",control:S,defaultValue:"",render:({onChange:P,value:L})=>e(ce,{toggleId:"kc-login-theme",onToggle:()=>l(!i),onSelect:(f,r)=>{P(r),l(!1)},selections:L,variant:ge.single,"aria-label":t("loginTheme"),isOpen:i,placeholderText:"Select a theme","data-testid":"select-login-theme",children:k.login.map((f,r)=>e(se,{selected:f.name===L,value:f.name,children:t(`${f.name}`)},`login-theme-${r}`))})})}),e(v,{label:t("accountTheme"),fieldId:"kc-account-theme",labelIcon:e(w,{helpText:"realm-settings-help:accountTheme",fieldLabelId:"realm-settings:accountTheme"}),children:e(A,{name:"accountTheme",control:S,defaultValue:"",render:({onChange:P,value:L})=>e(ce,{toggleId:"kc-account-theme",onToggle:()=>c(!o),onSelect:(f,r)=>{P(r),c(!1)},selections:L,variant:ge.single,"aria-label":t("accountTheme"),isOpen:o,placeholderText:"Select a theme","data-testid":"select-account-theme",children:k.account.map((f,r)=>e(se,{selected:f.name===L,value:f.name,children:t(`${f.name}`)},`account-theme-${r}`))})})}),e(v,{label:t("adminTheme"),fieldId:"kc-admin-console-theme",labelIcon:e(w,{helpText:"realm-settings-help:adminConsoleTheme",fieldLabelId:"realm-settings:adminTheme"}),children:e(A,{name:"adminTheme",control:S,defaultValue:"",render:({onChange:P,value:L})=>e(ce,{toggleId:"kc-admin-console-theme",onToggle:()=>u(!p),onSelect:(f,r)=>{P(r),u(!1)},selections:L,variant:ge.single,"aria-label":t("adminConsoleTheme"),isOpen:p,placeholderText:"Select a theme","data-testid":"select-admin-theme",children:k.admin.map((f,r)=>e(se,{selected:f.name===L,value:f.name,children:t(`${f.name}`)},`admin-theme-${r}`))})})}),e(v,{label:t("emailTheme"),fieldId:"kc-email-theme",labelIcon:e(w,{helpText:"realm-settings-help:emailTheme",fieldLabelId:"realm-settings:emailTheme"}),children:e(A,{name:"emailTheme",control:S,defaultValue:"",render:({onChange:P,value:L})=>e(ce,{toggleId:"kc-email-theme",onToggle:()=>g(!n),onSelect:(f,r)=>{P(r),g(!1)},selections:L,variant:ge.single,"aria-label":t("emailTheme"),isOpen:n,placeholderText:"Select a theme","data-testid":"select-email-theme",children:k.email.map((f,r)=>e(se,{selected:f.name===L,value:f.name,children:t(`${f.name}`)},`email-theme-${r}`))})})}),d(ye,{children:[e(R,{variant:"primary",type:"submit","data-testid":"themes-tab-save",children:t("common:save")}),e(R,{variant:"link",onClick:y,children:t("common:revert")})]})]})})},fs=({realm:a,reset:s,save:t})=>{const{t:i}=F("realm-settings"),l=Ve(),{whoAmI:o}=It(),[c,p]=m.exports.useState(!1),u=l.componentTypes?.["org.keycloak.keys.KeyProvider"]??[],n=["ES256","ES384","ES512"],g=u[2].properties[4].options,S=u[3].properties[3].options,T=n.concat(g,S),h=ue({shouldUnregister:!1}),{setValue:k,control:y}=h,P=xe({control:y,name:"offlineSessionMaxLifespanEnabled",defaultValue:a.offlineSessionMaxLifespanEnabled}),L=xe({control:y,name:"ssoSessionIdleTimeout",defaultValue:36e3}),f=xe({control:y,name:"revokeRefreshToken",defaultValue:!1});return m.exports.useEffect(()=>{Ce(a,k)},[]),d(W,{variant:"light",children:[e(oe,{title:i("realm-settings:general"),className:"kc-sso-session-template",children:e(Q,{isHorizontal:!0,role:"manage-realm",onSubmit:h.handleSubmit(t),children:e(v,{label:i("defaultSigAlg"),fieldId:"kc-default-signature-algorithm",labelIcon:e(w,{helpText:"realm-settings-help:defaultSigAlg",fieldLabelId:"realm-settings:algorithm"}),children:e(A,{name:"defaultSignatureAlgorithm",defaultValue:"RS256",control:h.control,render:({onChange:r,value:b})=>e(ce,{toggleId:"kc-default-sig-alg",onToggle:()=>p(!c),onSelect:(x,B)=>{r(B.toString()),p(!1)},selections:[b.toString()],variant:ge.single,"aria-label":i("defaultSigAlg"),isOpen:c,"data-testid":"select-default-sig-alg",children:T.map((x,B)=>e(se,{selected:x===b,value:x},`default-sig-alg-${B}`))})})})})}),e(oe,{title:i("realm-settings:refreshTokens"),className:"kc-client-session-template",children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:h.handleSubmit(t),children:[e(v,{hasNoPaddingTop:!0,label:i("revokeRefreshToken"),fieldId:"kc-revoke-refresh-token",labelIcon:e(w,{helpText:"realm-settings-help:revokeRefreshToken",fieldLabelId:"realm-settings:revokeRefreshToken"}),children:e(A,{name:"revokeRefreshToken",control:h.control,defaultValue:!1,render:({onChange:r,value:b})=>e(X,{id:"kc-revoke-refresh-token","data-testid":"revoke-refresh-token-switch","aria-label":i("revokeRefreshToken"),label:i("common:enabled"),labelOff:i("common:disabled"),isChecked:b,onChange:r})})}),f&&e(v,{label:i("refreshTokenMaxReuse"),labelIcon:e(w,{helpText:"realm-settings-help:refreshTokenMaxReuse",fieldLabelId:"realm-settings:refreshTokenMaxReuse"}),fieldId:"refreshTokenMaxReuse",children:e(A,{name:"refreshTokenMaxReuse",defaultValue:0,control:h.control,render:({onChange:r,value:b})=>e(Tt,{type:"text",id:"refreshTokenMaxReuseMs",value:b,onPlus:()=>r(b+1),onMinus:()=>r(b-1),onChange:x=>r(Number(x.target.value))})})})]})}),e(oe,{title:i("realm-settings:accessTokens"),className:"kc-offline-session-template",children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:h.handleSubmit(t),children:[e(v,{label:i("accessTokenLifespan"),fieldId:"accessTokenLifespan",helperText:i("recommendedSsoTimeout",{time:Na(L,o.getLocale())}),labelIcon:e(w,{helpText:"realm-settings-help:accessTokenLifespan",fieldLabelId:"realm-settings:accessTokenLifespan"}),children:e(A,{name:"accessTokenLifespan",defaultValue:"",helperTextInvalid:i("common:required"),control:h.control,render:({onChange:r,value:b})=>e(q,{validated:b>L?"warning":"default",className:"kc-access-token-lifespan","data-testid":"access-token-lifespan-input","aria-label":"access-token-lifespan",value:b,onChange:r,units:["minute","hour","day"]})})}),e(v,{label:i("accessTokenLifespanImplicitFlow"),fieldId:"accessTokenLifespanImplicitFlow",labelIcon:e(w,{helpText:"realm-settings-help:accessTokenLifespanImplicitFlow",fieldLabelId:"realm-settings:accessTokenLifespanImplicitFlow"}),children:e(A,{name:"accessTokenLifespanForImplicitFlow",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-access-token-lifespan-implicit","data-testid":"access-token-lifespan-implicit-input","aria-label":"access-token-lifespan-implicit",value:b,onChange:r,units:["minute","hour","day"]})})}),e(v,{label:i("clientLoginTimeout"),fieldId:"clientLoginTimeout",labelIcon:e(w,{helpText:"realm-settings-help:clientLoginTimeout",fieldLabelId:"realm-settings:clientLoginTimeout"}),children:e(A,{name:"accessCodeLifespan",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-client-login-timeout","data-testid":"client-login-timeout-input","aria-label":"client-login-timeout",value:b,onChange:r,units:["minute","hour","day"]})})}),P&&e(v,{label:i("offlineSessionMax"),fieldId:"offlineSessionMax",id:"offline-session-max-label",labelIcon:e(w,{helpText:"realm-settings-help:offlineSessionMax",fieldLabelId:"realm-settings:offlineSessionMax"}),children:e(A,{name:"offlineSessionMaxLifespan",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-offline-session-max","data-testid":"offline-session-max-input","aria-label":"offline-session-max-input",value:b,onChange:r,units:["minute","hour","day"]})})})]})}),e(oe,{className:"kc-login-settings-template",title:i("actionTokens"),children:d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:h.handleSubmit(t),children:[e(v,{label:i("userInitiatedActionLifespan"),id:"kc-user-initiated-action-lifespan",fieldId:"userInitiatedActionLifespan",labelIcon:e(w,{helpText:"realm-settings-help:userInitiatedActionLifespan",fieldLabelId:"realm-settings:userInitiatedActionLifespan"}),children:e(A,{name:"actionTokenGeneratedByUserLifespan",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-user-initiated-action-lifespan","data-testid":"user-initiated-action-lifespan","aria-label":"user-initiated-action-lifespan",value:b,onChange:r,units:["minute","hour","day"]})})}),e(v,{label:i("defaultAdminInitiated"),fieldId:"defaultAdminInitiated",id:"default-admin-initiated-label",labelIcon:e(w,{helpText:"realm-settings-help:defaultAdminInitiatedActionLifespan",fieldLabelId:"realm-settings:defaultAdminInitiated"}),children:e(A,{name:"actionTokenGeneratedByAdminLifespan",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-default-admin-initiated","data-testid":"default-admin-initated-input","aria-label":"default-admin-initated-input",value:b,onChange:r,units:["minute","hour","day"]})})}),e(Me,{className:"kc-override-action-tokens-subtitle",component:Fa.h1,children:i("overrideActionTokens")}),e(v,{label:i("emailVerification"),fieldId:"emailVerification",id:"email-verification",children:e(A,{name:"attributes.actionTokenGeneratedByUserLifespan-verify-email",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-email-verification","data-testid":"email-verification-input","aria-label":"email-verification-input",value:b,onChange:x=>r(x.toString()),units:["minute","hour","day"]})})}),e(v,{label:i("idpAccountEmailVerification"),fieldId:"idpAccountEmailVerification",id:"idp-acct-label",children:e(A,{name:"attributes.actionTokenGeneratedByUserLifespan-idp-verify-account-via-email",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-idp-email-verification","data-testid":"idp-email-verification-input","aria-label":"idp-email-verification",value:b,onChange:r,units:["minute","hour","day"]})})}),e(v,{label:i("forgotPassword"),fieldId:"forgotPassword",id:"forgot-password-label",children:e(A,{name:"attributes.actionTokenGeneratedByUserLifespan-reset-credentials",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-forgot-pw","data-testid":"forgot-pw-input","aria-label":"forgot-pw-input",value:b,onChange:r,units:["minute","hour","day"]})})}),e(v,{label:i("executeActions"),fieldId:"executeActions",id:"execute-actions",children:e(A,{name:"attributes.actionTokenGeneratedByUserLifespan-execute-actions",defaultValue:"",control:h.control,render:({onChange:r,value:b})=>e(q,{className:"kc-execute-actions","data-testid":"execute-actions-input","aria-label":"execute-actions-input",value:b,onChange:r,units:["minute","hour","day"]})})}),d(ye,{children:[e(R,{variant:"primary",type:"submit","data-testid":"tokens-tab-save",isDisabled:!h.formState.isDirty,children:i("common:save")}),e(R,{variant:"link",onClick:s,children:i("common:revert")})]})]})})]})};function hs(){const{t:a}=F("realm-settings"),{adminClient:s}=ie(),{realm:t}=le(),{addAlert:i,addError:l}=de(),[o,c]=m.exports.useState(),[p,u]=m.exports.useState(),[n,g]=m.exports.useState(),[S,T]=m.exports.useState(!1),[h,k]=m.exports.useState(),[y,P]=m.exports.useState(0);ke(()=>s.clientPolicies.listProfiles({includeGlobalProfiles:!0}),E=>{u(E.globalProfiles);const C=E.globalProfiles?.map(D=>({...D,global:!0})),K=E.profiles?.map(D=>({...D,global:!1})),U=C?.concat(K??[]);c(U||[]),k(JSON.stringify(U,null,2))},[y]);const L=async()=>o??[],f=E=>ca(E,"global"),[r,b]=pe({titleKey:a("deleteClientProfileConfirmTitle"),messageKey:a("deleteClientProfileConfirm",{profileName:n?.name}),continueButtonLabel:a("delete"),continueButtonVariant:te.danger,onConfirm:async()=>{const E=o?.filter(C=>C.name!==n?.name&&!C.global).map(C=>f(C));try{await s.clientPolicies.createProfiles({profiles:E,globalProfiles:p}),i(a("deleteClientSuccess"),ee.success),P(y+1)}catch(C){l(a("deleteClientError"),C)}}}),x=E=>d(be,{to:da({realm:t,profileName:E.name}),children:[E.name," ",E.global&&e(lt,{color:"blue",children:a("global")})]},E.name);if(!o)return e(we,{});const B=async()=>{if(!!h)try{const E=JSON.parse(h),C=E.filter(U=>!U.global).map(U=>f(U)),K=E.filter(U=>U.global).map(U=>f(U));try{await s.clientPolicies.createProfiles({profiles:C,globalProfiles:K}),i(a("realm-settings:updateClientProfilesSuccess"),ee.success),P(y+1)}catch(U){l("realm-settings:updateClientProfilesError",U)}}catch{console.warn("Invalid json, ignoring value using {}")}};return d(Y,{children:[e(b,{}),e(W,{children:d(Yt,{className:"kc-profiles-config-section",children:[e(Be,{children:e(ot,{headingLevel:"h1",size:"md",children:a("profilesConfigType")})}),e(Be,{children:e(dt,{isChecked:!S,name:"profilesView",onChange:()=>T(!1),label:a("profilesConfigTypes.formView"),id:"formView-profilesView",className:"kc-form-radio-btn pf-u-mr-sm pf-u-ml-sm","data-testid":"formView-profilesView"})}),e(Be,{children:e(dt,{isChecked:S,name:"profilesView",onChange:()=>T(!0),label:a("profilesConfigTypes.jsonEditor"),id:"jsonEditor-profilesView",className:"kc-editor-radio-btn","data-testid":"jsonEditor-profilesView"})})]})}),e(_e,{}),S?d(v,{fieldId:"jsonEditor",children:[e("div",{className:"pf-u-mt-md pf-u-ml-lg",children:e(Pt,{isLineNumbersVisible:!0,isLanguageLabelVisible:!0,isReadOnly:!1,code:h,language:wt.json,height:"30rem",onChange:E=>{k(E??"")}})}),e(ye,{children:d("div",{className:"pf-u-mt-md",children:[e(R,{variant:te.primary,className:"pf-u-mr-md pf-u-ml-lg",onClick:B,"data-testid":"jsonEditor-saveBtn",children:a("save")}),e(R,{variant:te.link,onClick:()=>{k(Ye(o))},"data-testid":"jsonEditor-reloadBtn",children:a("reload")})]})})]}):e(Ke,{ariaLabelKey:"realm-settings:profiles",searchPlaceholderKey:"realm-settings:clientProfileSearch",loader:L,toolbarItem:e(Te,{children:e(R,{id:"createProfile",component:E=>e(be,{...E,to:oa({realm:t,tab:"profiles"})}),"data-testid":"createProfile",children:a("createClientProfile")})}),isRowDisabled:E=>E.global,actions:[{title:a("common:delete"),onRowClick:E=>{g(E),r()}}],columns:[{name:"name",displayKey:a("common:name"),cellRenderer:x},{name:"description",displayKey:a("clientProfileDescription")}],emptyState:e(Pe,{message:a("emptyClientProfiles"),instructions:a("emptyClientProfilesInstructions")})},o.length)]})}const gs=()=>{const{t:a}=F("realm-settings"),{adminClient:s}=ie(),{addAlert:t,addError:i}=de(),{realm:l}=le(),o=$e(),[c,p]=m.exports.useState(!1),[u,n]=m.exports.useState(),[g,S]=m.exports.useState(),[T,h]=m.exports.useState(0),[k,y]=m.exports.useState(),[P,L]=m.exports.useState(),f=()=>h(T+1),r=ue({mode:"onChange"});ke(()=>s.clientPolicies.listPolicies(),D=>{n(D.policies),L(D.policies||[]),y(Ye(D.policies))},[T]);const b=async()=>u??[],x=async()=>{const D=r.getValues(),H=u?.map(O=>{const J=D[O.name];return{...O,enabled:J}});try{await s.clientPolicies.updatePolicy({policies:H}),o(bt({realm:l,tab:"policies"})),t(a("realm-settings:updateClientPolicySuccess"),ee.success)}catch(O){i("realm-settings:updateClientPolicyError",O)}},B=({name:D})=>e(be,{to:ma({realm:l,policyName:D}),children:D}),E=({clientPolicy:D})=>{const[H,O]=pe({titleKey:"realm-settings:disablePolicyConfirmTitle",messageKey:"realm-settings:disablePolicyConfirm",continueButtonLabel:"common:disable",onConfirm:()=>{r.setValue(D.name,!1),x()}});return d(Y,{children:[e(O,{}),e(A,{name:D.name,"data-testid":`${D.name}-switch`,defaultValue:D.enabled,control:r.control,render:({onChange:J,value:me})=>e(X,{label:a("common:enabled"),labelOff:a("common:disabled"),isChecked:me,onChange:N=>{N?(J(N),x()):H()},"aria-label":D.name})})]})},C=async()=>{if(!!k)try{const D=JSON.parse(k);try{await s.clientPolicies.updatePolicy({policies:D}),t(a("realm-settings:updateClientPoliciesSuccess"),ee.success),f()}catch(H){i("realm-settings:updateClientPoliciesError",H)}}catch(D){console.warn("Invalid json, ignoring value using {}"),i("realm-settings:updateClientPoliciesError",D)}},[K,U]=pe({titleKey:a("deleteClientPolicyConfirmTitle"),messageKey:a("deleteClientPolicyConfirm",{policyName:g?.name}),continueButtonLabel:a("delete"),continueButtonVariant:te.danger,onConfirm:async()=>{const D=u?.filter(H=>H.name!==g?.name);try{await s.clientPolicies.updatePolicy({policies:D}),t(a("deleteClientPolicySuccess"),ee.success),f()}catch(H){i(a("deleteClientPolicyError"),H)}}});return u?d(Y,{children:[e(U,{}),e(W,{children:d(Yt,{className:"kc-policies-config-section",children:[e(Be,{children:e(ot,{headingLevel:"h1",size:"md",children:a("policiesConfigType")})}),e(Be,{children:e(dt,{isChecked:!c,name:"policiesView",onChange:()=>p(!1),label:a("policiesConfigTypes.formView"),id:"formView-policiesView","data-testid":"formView-policiesView",className:"kc-form-radio-btn pf-u-mr-sm pf-u-ml-sm"})}),e(Be,{children:e(dt,{isChecked:c,name:"policiesView",onChange:()=>p(!0),label:a("policiesConfigTypes.jsonEditor"),id:"jsonEditor-policiesView","data-testid":"jsonEditor-policiesView",className:"kc-editor-radio-btn"})})]})}),e(_e,{}),c?d(Y,{children:[e("div",{className:"pf-u-mt-md pf-u-ml-lg",children:e(Pt,{isLineNumbersVisible:!0,isLanguageLabelVisible:!0,isReadOnly:!1,code:k,language:wt.json,height:"30rem",onChange:y})}),d("div",{className:"pf-u-mt-md",children:[e(R,{variant:te.primary,className:"pf-u-mr-md pf-u-ml-lg","data-testid":"jsonEditor-policies-saveBtn",onClick:C,children:a("save")}),e(R,{variant:te.link,"data-testid":"jsonEditor-reloadBtn",onClick:()=>{y(Ye(P))},children:a("reload")})]})]}):e(Ke,{emptyState:e(Pe,{message:a("realm-settings:noClientPolicies"),instructions:a("realm-settings:noClientPoliciesInstructions"),primaryActionText:a("realm-settings:createClientPolicy"),onPrimaryAction:()=>o(Nt({realm:l}))}),ariaLabelKey:"realm-settings:clientPolicies",searchPlaceholderKey:"realm-settings:clientPolicySearch",loader:b,toolbarItem:e(Te,{children:e(R,{id:"createPolicy",component:D=>e(be,{...D,to:Nt({realm:l})}),"data-testid":"createPolicy",children:a("createClientPolicy")})}),actions:[{title:a("common:delete"),onRowClick:D=>{K(),S(D)}}],columns:[{name:"name",cellRenderer:B},{name:"enabled",displayKey:"realm-settings:status",cellRenderer:D=>e(E,{clientPolicy:D})},{name:"description"}]},u.length)]}):e(we,{})},zt={users:!1,clients:!1,groups:!1,identityProviders:!1,realmRoles:!1,clientRoles:!1},bs=a=>{const{t:s}=F("realm-settings"),{adminClient:t}=ie(),{realm:i}=le(),[l,o]=m.exports.useState(),c=!!l,[p,u]=m.exports.useState(!1),[n,g]=m.exports.useState(!1),[S,T]=m.exports.useState(!1),[h,k]=m.exports.useState("FAIL"),[y,P]=m.exports.useState({}),[L,f]=m.exports.useState(),{addError:r}=de(),[b,x]=m.exports.useState(zt),B=Object.values(b).some(I=>I),E=()=>{x(zt)},C=()=>{o(void 0),P({}),k("FAIL"),E()};m.exports.useEffect(()=>{T(!1),f(void 0),C()},[a.open]);const K=I=>{C(),o(I),Array.isArray(I)?I.length>0&&P(I[0]):P(I)},U=I=>{P(I),u(!1),E()},D=(I,j)=>{const De=j.currentTarget.name;x({...b,[De]:I})},H=I=>I.map(j=>e(se,{value:j,"data-testid":j.id+"-select-option",children:j.realm||j.id},j.id)),O=(I,j)=>{k(j),g(!1)},J=()=>[e(se,{value:"FAIL",children:s("FAIL")},"fail"),e(se,{value:"SKIP",children:s("SKIP")},"skip"),e(se,{value:"OVERWRITE",children:s("OVERWRITE")},"overwrite")],me=()=>N("users")||N("groups")||N("clients")||N("identityProviders")||Z()||ne(),N=I=>{const j=y[I];return j!==void 0&&j.length>0},Z=()=>{const I=y.roles?.realm;return I!==void 0&&I.length>0},ne=()=>{const I=y.roles?.client;return I!==void 0&&Object.keys(I).length>0},Ie=I=>c?I==="realmRoles"?y.roles?.realm?.length??0:I==="clientRoles"?ne()?je(y.roles.client):0:y[I]?.length??0:0,je=I=>Object.values(I).reduce((j,De)=>j+De.length,0),ve=(I,j)=>e(Ua,{"aria-labelledby":`${I}-list-item`,children:e(Ga,{children:e(za,{dataListCells:[e(_a,{children:e(St,{id:`${I}-checkbox`,label:`${Ie(I)} ${j}`,"aria-labelledby":`${I}-checkbox`,name:I,isChecked:b[I],onChange:D,"data-testid":I+"-checkbox"})},I)]})})}),Ze=()=>{const I={ifResourceExists:h,id:y.id,realm:y.realm};return b.users&&(I.users=y.users),b.groups&&(I.groups=y.groups),b.identityProviders&&(I.identityProviders=y.identityProviders),b.clients&&(I.clients=y.clients),(b.realmRoles||b.clientRoles)&&(I.roles=y.roles,b.realmRoles||delete I.roles?.realm,b.clientRoles||delete I.roles?.client),I};async function Ae(){if(!S){T(!0);try{const I=await t.realms.partialImport({realm:i,rep:Ze()});f(I)}catch(I){r("realm-settings:importFail",I)}T(!1)}}const Fe=()=>e(Ge,{variant:ze.medium,title:s("partialImport"),isOpen:a.open,onClose:a.toggleDialog,actions:[e(R,{id:"modal-import","data-testid":"import-button",isDisabled:!B,onClick:()=>{Ae()},children:s("import")},"import"),e(R,{id:"modal-cancel","data-testid":"cancel-button",variant:te.link,onClick:()=>{a.toggleDialog()},children:s("common:cancel")},"cancel")],children:d(Xt,{hasGutter:!0,children:[e(Le,{children:e(mt,{children:e(Me,{children:s("partialImportHeaderText")})})}),e(Le,{children:e(Ha,{id:"partial-import-file",allowEditingUploadedText:!0,onChange:K})}),c&&me()&&d(Y,{children:[e(Le,{children:e(_e,{})}),Array.isArray(l)&&l.length>1&&d(Le,{children:[d(Me,{children:[s("selectRealm"),":"]}),e(ce,{toggleId:"realm-selector",isOpen:p,onToggle:()=>u(!p),onSelect:(I,j)=>U(j),placeholderText:y.realm||y.id,children:H(l)})]}),d(Le,{children:[d(Me,{children:[s("chooseResources"),":"]}),d(Ba,{"aria-label":s("resourcesToImport"),isCompact:!0,children:[N("users")&&ve("users",s("common:users")),N("groups")&&ve("groups",s("common:groups")),N("clients")&&ve("clients",s("common:clients")),N("identityProviders")&&ve("identityProviders",s("common:identityProviders")),Z()&&ve("realmRoles",s("common:realmRoles")),ne()&&ve("clientRoles",s("common:clientRoles"))]})]}),d(Le,{children:[d(Me,{children:[s("selectIfResourceExists"),":"]}),e(ce,{isOpen:n,direction:"up",onToggle:()=>{g(!n)},onSelect:O,placeholderText:s(h),children:J()})]})]})]})}),Re=()=>`${s("importAdded",{count:L?.added})}  ${s("importSkipped",{count:L?.skipped})} ${s("importOverwritten",{count:L?.overwritten})}`,ut=async(I=0,j=15)=>{if(!L)return[];const De=Math.min(I+j,L.results.length);return L.results.slice(I,De)},qe=I=>{switch(I.action){case"ADDED":return e(lt,{color:"green",children:s("added")},I.id);case"SKIPPED":return e(lt,{color:"orange",children:s("skipped")},I.id);case"OVERWRITTEN":return e(lt,{color:"purple",children:s("overwritten")},I.id)}},et=I=>{const j=new Map([["CLIENT",s("common:clients")],["REALM_ROLE",s("common:realmRoles")],["USER",s("common:users")],["CLIENT_ROLE",s("common:clientRoles")],["IDP",s("common:identityProviders")]]);return e("span",{children:j.get(I.resourceType)})},pt=()=>d(Ge,{variant:ze.medium,title:s("partialImport"),isOpen:a.open,onClose:a.toggleDialog,actions:[e(R,{id:"modal-close","data-testid":"close-button",variant:te.primary,onClick:()=>{a.toggleDialog()},children:s("common:close")},"close")],children:[e(nt,{variant:"success",isInline:!0,title:Re()}),e(Ke,{loader:ut,isPaginated:!0,ariaLabelKey:"realm-settings:partialImport",columns:[{name:"action",displayKey:"common:action",cellRenderer:qe},{name:"resourceType",displayKey:"common:type",cellRenderer:et},{name:"resourceName",displayKey:"common:name"},{name:"id",displayKey:"common:id"}]})]});return L?pt():Fe()};const ys=({isOpen:a,onClose:s})=>{const{t}=F("realm-settings"),{realm:i}=le(),{adminClient:l}=ie(),{addAlert:o,addError:c}=de(),[p,u]=m.exports.useState(!1),[n,g]=m.exports.useState(!1),[S,T]=m.exports.useState(!1),h=p||n;async function k(){T(!0);try{const y=await l.realms.export({realm:i,exportClients:n,exportGroupsAndRoles:p});ua.saveAs(new Blob([Ye(y)],{type:"application/json"}),"realm-export.json"),o(t("exportSuccess"),ee.success),s()}catch(y){c("exportFail",y)}T(!1)}return d(Ge,{variant:ze.small,title:t("partialExport"),isOpen:a,onClose:s,actions:[e(R,{"data-testid":"export-button",isDisabled:S,onClick:k,children:t("common:export")},"export"),e(R,{"data-testid":"cancel-button",variant:te.link,onClick:s,children:t("common:cancel")},"cancel")],children:[e(mt,{children:e(Me,{children:t("partialExportHeaderText")})}),d(Et,{isHorizontal:!0,className:"keycloak__realm-settings__partial-import_form",children:[e(v,{label:t("includeGroupsAndRoles"),fieldId:"include-groups-and-roles-check",hasNoPaddingTop:!0,children:e(X,{id:"include-groups-and-roles-check","data-testid":"include-groups-and-roles-check",isChecked:p,onChange:u,label:t("common:on"),labelOff:t("common:off"),"aria-label":t("includeGroupsAndRoles")})}),e(v,{label:t("includeClients"),fieldId:"include-clients-check",hasNoPaddingTop:!0,children:e(X,{id:"include-clients-check","data-testid":"include-clients-check",onChange:g,isChecked:n,label:t("common:on"),labelOff:t("common:off"),"aria-label":t("includeClients")})})]}),h&&e(nt,{"data-testid":"warning-message",variant:"warning",title:t("exportWarningTitle"),isInline:!0,children:t("exportWarningDescription")})]})},vs=({handleModalToggle:a,save:s})=>{const{t}=F("realm-settings"),{register:i,handleSubmit:l,formState:{errors:o}}=ue();return e(Ge,{variant:ze.small,title:t("addMessageBundle"),isOpen:!0,onClose:a,actions:[e(R,{"data-testid":"add-bundle-confirm-button",variant:"primary",type:"submit",form:"bundle-form",children:t("common:create")},"confirm"),e(R,{id:"modal-cancel","data-testid":"cancel",variant:te.link,onClick:()=>{a()},children:t("common:cancel")},"cancel")],children:d(Et,{id:"bundle-form",isHorizontal:!0,onSubmit:l(s),children:[e(v,{label:t("common:key"),name:"key",fieldId:"key-id",helperTextInvalid:t("common:required"),validated:o.key?he.error:he.default,isRequired:!0,children:e(re,{"data-testid":"key-input",ref:i({required:!0}),autoFocus:!0,type:"text",id:"key-id",name:"key",validated:o.key?he.error:he.default})}),e(v,{label:t("common:value"),name:"add-value",fieldId:"value-id",helperTextInvalid:t("common:required"),validated:o.value?he.error:he.default,isRequired:!0,children:e(re,{"data-testid":"value-input",ref:i({required:!0}),type:"text",id:"value-id",name:"value",validated:o.value?he.error:he.default})})]})})},Ee=a=>new Intl.DisplayNames([a],{type:"language"}).of(a),Ss=({save:a,realm:s})=>{const{t}=F("realm-settings"),{adminClient:i}=ie(),[l,o]=m.exports.useState(!1),[c,p]=m.exports.useState(!1),[u,n]=m.exports.useState(!1),[g,S]=m.exports.useState(!1),[T,h]=m.exports.useState(fe),{setValue:k,getValues:y,control:P,handleSubmit:L,formState:f}=ue({shouldUnregister:!1}),[r,b]=m.exports.useState(!1),[x,B]=m.exports.useState([]),[E,C]=m.exports.useState([]),K=Ve().themes,U=m.exports.useMemo(()=>{const M=Object.values(K).flatMap(V=>V.flatMap(({locales:G})=>G||[]));return Array.from(new Set(M))},[K]),D=ue({mode:"onChange"}),{addAlert:H,addError:O}=de(),{realm:J}=le(),{whoAmI:me}=It(),N=()=>{Ce(s,k),s.supportedLocales?.length===0&&k("supportedLocales",[fe])};m.exports.useEffect(N,[]);const Z=xe({control:P,name:"supportedLocales",defaultValue:[fe]}),ne=xe({control:P,name:"internationalizationEnabled",defaultValue:!1}),[Ie,je]=m.exports.useState(0),[ve,Ze]=m.exports.useState(10),[Ae,Fe]=m.exports.useState(0),[Re,ut]=m.exports.useState(""),qe=()=>{je(Ie+1)};ke(async()=>{let M=await i.realms.getRealmLocalizationTexts({first:Ae,max:ve,realm:s.realm,selectedLocale:T||y("defaultLocale")||me.getLocale()}).catch(()=>[]);const V=G=>Object.entries(M).filter($=>$[G].includes(Re));if(Re){const G=ts(V(0).concat(V(1)),Ja);M=Object.fromEntries(G)}return{result:M}},({result:M})=>{const V=Object.entries(M).slice(Ae,Ae+ve+1);B(V);const G=V.map($=>({rowEditBtnAriaLabel:()=>t("rowEditBtnAriaLabel",{messageBundle:$[1]}),rowSaveBtnAriaLabel:()=>t("rowSaveBtnAriaLabel",{messageBundle:$[1]}),rowCancelBtnAriaLabel:()=>t("rowCancelBtnAriaLabel",{messageBundle:$[1]}),cells:[{title:(ae,Se,Ne,We)=>e(kt,{value:ae,rowIndex:Se,cellIndex:Ne,props:We,isDisabled:!0,handleTextInputChange:et,inputAriaLabel:$[0]}),props:{value:$[0]}},{title:(ae,Se,Ne,We)=>e(kt,{value:ae,rowIndex:Se,cellIndex:Ne,props:We,handleTextInputChange:et,inputAriaLabel:$[1]}),props:{value:$[1]}}]}));return C(G),V},[Ie,Re,Ae,ve]);const et=(M,V,G,$)=>{C(ae=>{const Se=Ot(ae),Ne=Se[G]?.cells?.[$];return Ne.props.editableValue=M,Se})},pt=async(M,V,G)=>{if(V===void 0)return;const $=Ot(E);let ae;const Se=!!G&&Object.keys(G).length>0;if(Se?ae=ja($[V],M,G):M==="cancel"?ae=qa($[V]):ae=Wa($[V],M),$[V]=ae,!Se&&M==="save"){const Ne=(ae.cells?.[0]).props.value,We=(ae.cells?.[1]).props.value;try{await i.realms.addLocalization({realm:s.realm,selectedLocale:T||y("defaultLocale")||fe,key:Ne},We),H(t("updateMessageBundleSuccess"),ee.success)}catch{H(t("updateMessageBundleError"),ee.danger)}}C($)},I=()=>{o(!l)},j=[e(Bt,{label:t("defaultLocale"),children:e(se,{value:fe,children:Ee(fe)},fe)},"group1"),e(_e,{},"divider"),e(Bt,{label:t("supportedLocales"),children:Z.map(M=>e(se,{value:M,children:Ee(M)},M))},"group2")],De=async M=>{try{await i.realms.addLocalization({realm:J,selectedLocale:T||y("defaultLocale")||fe,key:M.key},M.value),i.setConfig({realmName:J}),qe(),H(t("addMessageBundleSuccess"),ee.success)}catch(V){O(t("addMessageBundleError"),V)}},sa=async M=>{try{await i.realms.deleteRealmLocalizationTexts({realm:J,selectedLocale:T,key:M}),qe(),H(t("deleteMessageBundleSuccess"))}catch(V){O("realm-settings:deleteMessageBundleError",V)}};return d(Y,{children:[l&&e(vs,{handleModalToggle:I,save:M=>{De(M),I()},form:D}),d(W,{variant:"light",children:[d(Q,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:L(a),children:[e(v,{label:t("internationalization"),fieldId:"kc-internationalization",labelIcon:e(w,{helpText:"realm-settings-help:internationalization",fieldLabelId:"realm-settings:internationalization"}),children:e(A,{name:"internationalizationEnabled",control:P,defaultValue:!1,render:({onChange:M,value:V})=>e(X,{id:"kc-l-internationalization",label:t("common:enabled"),labelOff:t("common:disabled"),isChecked:ne,"data-testid":V?"internationalization-enabled":"internationalization-disabled",onChange:M,"aria-label":t("internationalization")})})}),ne&&d(Y,{children:[e(v,{label:t("supportedLocales"),fieldId:"kc-l-supported-locales",children:e(A,{name:"supportedLocales",control:P,defaultValue:[fe],render:({onChange:M,value:V})=>e(ce,{toggleId:"kc-l-supported-locales",onToggle:G=>{p(G)},onSelect:(G,$)=>{const ae=$;V.includes(ae)?M(V.filter(Se=>Se!==ae)):M([...V,ae])},onClear:()=>{M([])},selections:V,variant:ge.typeaheadMulti,"aria-label":t("supportedLocales"),isOpen:c,placeholderText:t("selectLocales"),children:U.map(G=>e(se,{selected:V.includes(G),value:G,children:Ee(G)},G))})})}),e(v,{label:t("defaultLocale"),fieldId:"kc-l-default-locale",children:e(A,{name:"defaultLocale",control:P,defaultValue:fe,render:({onChange:M,value:V})=>e(ce,{toggleId:"kc-default-locale",onToggle:()=>n(!u),onSelect:(G,$)=>{M($),n(!1)},selections:V?Ee(V):s.defaultLocale!==""?Ee(s.defaultLocale||fe):t("placeholderText"),variant:ge.single,"aria-label":t("defaultLocale"),isOpen:u,placeholderText:t("placeholderText"),"data-testid":"select-default-locale",children:Z.map((G,$)=>e(se,{value:G,children:Ee(G)},`default-locale-${$}`))})})})]}),d(ye,{children:[e(R,{variant:"primary",isDisabled:!f.isDirty,type:"submit","data-testid":"localization-tab-save",children:t("common:save")}),e(R,{variant:"link",onClick:N,children:t("common:revert")})]})]}),d(oe,{className:"kc-message-bundles",title:"Edit message bundles",children:[e(mt,{className:"messageBundleDescription",children:t("messageBundleDescription")}),e("div",{className:"tableBorder",children:d(Oa,{count:x.length,first:Ae,max:ve,onNextClick:Fe,onPreviousClick:Fe,onPerPageSelect:(M,V)=>{Fe(M),Ze(V)},inputGroupName:"common:search",inputGroupOnEnter:M=>{ut(M),Fe(0),Ze(10)},inputGroupPlaceholder:t("searchForMessageBundle"),toolbarItem:e(R,{"data-testid":"add-bundle-button",onClick:()=>o(!0),children:t("addMessageBundle")}),searchTypeComponent:e(Te,{children:e(ce,{width:180,"data-testid":"filter-by-locale-select",isOpen:g,className:"kc-filter-by-locale-select",variant:ge.single,isDisabled:!ne,onToggle:M=>S(M),onSelect:(M,V)=>{h(V.toString()),b(!0),qe(),S(!1)},selections:r?Ee(T):s.defaultLocale!==""?Ee(fe):t("placeholderText"),children:j})}),children:[x.length===0&&!Re&&e(Pe,{hasIcon:!0,message:t("noMessageBundles"),instructions:t("noMessageBundlesInstructions"),onPrimaryAction:I}),x.length===0&&Re&&e(Pe,{hasIcon:!0,icon:$t,isSearchVariant:!0,message:t("common:noSearchResults"),instructions:t("common:noSearchResultsInstructions")}),x.length!==0&&d(Ma,{"aria-label":t("editableRowsTable"),"data-testid":"editable-rows-table",variant:$a.compact,cells:[t("common:key"),t("common:value")],rows:E,onRowEdit:(M,V,G,$,ae)=>pt(V,$,ae),actions:[{title:t("common:delete"),onClick:(M,V)=>sa((E[V].cells?.[0]).props.value)}],children:[e(Va,{}),e(Ka,{})]})]})})]})]})]})},Ts=()=>{const{t:a}=F("realm-settings"),[s,t]=Ue(),[i,l]=Ue(),[o,c]=m.exports.useState(),[p,u]=m.exports.useState([]),[n,g]=m.exports.useState(0),[S,T]=m.exports.useState(0),h=()=>T(S+1),{adminClient:k}=ie(),{realm:y}=le(),{addAlert:P,addError:L}=de(),{enabled:f}=pa();ke(()=>k.realms.getDefaultGroups({realm:y}),C=>{c(C),g(n+1)},[S]);const r=()=>Promise.resolve(o),b=async()=>{try{await Promise.all(p.map(C=>k.realms.removeDefaultGroup({realm:y,id:C.id}))),P(a("groupRemove",{count:p.length}),ee.success),u([])}catch(C){L("realm-settings:groupRemoveError",C)}h()},x=async C=>{try{await Promise.all(C.map(K=>k.realms.addDefaultGroup({realm:y,id:K.id}))),P(a("defaultGroupAdded",{count:C.length}),ee.success)}catch(K){L("realm-settings:defaultGroupAddedError",K)}h()},[B,E]=pe({titleKey:a("removeConfirmTitle",{count:p.length}),messageKey:a("removeConfirm",{count:p.length}),continueButtonLabel:"common:delete",continueButtonVariant:te.danger,onConfirm:b});return o?d(Y,{children:[e(E,{}),i&&e(Qa,{type:"selectMany",text:{title:"realm-settings:addDefaultGroups",ok:"common:add"},onConfirm:C=>{x(C||[]),l()},onClose:l}),f&&e(Pa,{bodyContent:d(ct,{i18nKey:"realm-settings-help:defaultGroups",children:[" ",e(be,{to:Mt({realm:y})}),"."]}),children:e(mt,{className:"keycloak__section_intro__help",style:{paddingLeft:"var(--pf-c-page__main-section--PaddingLeft)"},children:d(Me,{children:[e(Ya,{})," ",a("whatIsDefaultGroups")]})})}),e(Ke,{canSelectAll:!0,onSelect:C=>u([...C]),loader:r,ariaLabelKey:"realm-settings:defaultGroups",searchPlaceholderKey:"realm-settings:searchForGroups",toolbarItem:d(Y,{children:[e(Te,{children:e(R,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:l,children:a("addGroups")})}),e(Te,{children:e(jt,{toggle:e(fa,{onToggle:t,isDisabled:p.length===0}),isOpen:s,isPlain:!0,dropdownItems:[e(Qe,{component:"button",onClick:()=>{B(),t()},children:a("common:remove")},"action")]})})]}),actions:[{title:a("common:remove"),onRowClick:C=>(u([C]),B(),Promise.resolve(!1))}],columns:[{name:"name",displayKey:"groups:groupName"},{name:"path",displayKey:"groups:path"}],emptyState:e(Pe,{hasIcon:!0,message:a("noDefaultGroups"),instructions:d(ct,{i18nKey:"realm-settings:noDefaultGroupsInstructions",children:[" ",e(be,{to:Mt({realm:y})}),"Add groups..."]}),primaryActionText:a("addGroups"),onPrimaryAction:l})},n)]}):e(we,{})},ks=()=>{const{t:a}=F("realm-settings"),[s,t]=m.exports.useState(),[i,l]=m.exports.useState(10),[o,c]=m.exports.useState(0),{adminClient:p}=ie(),{addAlert:u,addError:n}=de(),{realm:g}=le();if(ke(()=>p.realms.findOne({realm:g}),t,[]),!s)return e(we,{});const S=async T=>{const h=T;try{await p.roles.createComposite({roleId:s.defaultRole.id,realm:g},h),c(o+1),u(a("roles:addAssociatedRolesSuccess"),ee.success)}catch(k){n("roles:addAssociatedRolesError",k)}};return d(Lt,{activeKey:i,onSelect:(T,h)=>l(h),children:[e(z,{id:"roles",eventKey:10,title:e(_,{children:a("defaultRoles")}),children:e(Xa,{name:s.defaultRole.name,id:s.defaultRole.id,type:"roles",isManager:!0,save:T=>S(T.map(h=>h.role))})},o),e(z,{id:"groups",eventKey:20,title:e(_,{children:a("defaultGroups")}),children:e(Ts,{})})]})},Is=()=>{const{config:a,save:s}=At(),{t}=F("attributes-group"),i=$e(),{realm:l}=le(),[o,c]=m.exports.useState(0),[p,u]=m.exports.useState();m.exports.useEffect(()=>c(h=>h+1),[a]);async function n(){return a?.groups??[]}const[g,S]=pe({titleKey:"attributes-group:deleteDialogTitle",children:d(ct,{i18nKey:"attributes-group:deleteDialogDescription",children:[" ",e("strong",{children:{group:p?.name}}),"."]}),continueButtonLabel:"common:delete",continueButtonVariant:te.danger,onConfirm(){const h=(a?.groups??[]).filter(k=>k!==p);s({...a,groups:h},{successMessageKey:"attributes-group:deleteSuccess",errorMessageKey:"attributes-group:deleteError"})}});function T(h){u(h),g()}return d(W,{variant:"light",className:"pf-u-p-0",children:[e(S,{}),e(Ke,{loader:n,ariaLabelKey:"attributes-group:tableTitle",toolbarItem:e(Te,{children:e(R,{component:h=>e(be,{...h,to:Vt({realm:l})}),children:t("createGroupText")})}),columns:[{name:"name",displayKey:"attributes-group:columnName",cellRenderer:h=>e(be,{to:ha({realm:l,name:h.name}),children:h.name})},{name:"displayHeader",displayKey:"attributes-group:columnDisplayName"},{name:"displayDescription",displayKey:"attributes-group:columnDisplayDescription"}],actions:[{title:t("common:delete"),onRowClick:T}],emptyState:e(Pe,{message:t("emptyStateMessage"),instructions:t("emptyStateInstructions"),primaryActionText:t("createGroupText"),onPrimaryAction:()=>i(Vt({realm:l}))})},o)]})},xs=["username","email"],Cs=()=>{const{config:a,save:s}=At(),{realm:t}=le(),{t:i}=F("realm-settings"),l=$e(),[o,c]=m.exports.useState("allGroups"),[p,u]=Ue(),[n,g]=m.exports.useState(a?.attributes),[S,T]=m.exports.useState(""),h=async(f,r)=>{const b=a?.attributes.findIndex(B=>B.name===f.name);let x={};x=a?.attributes[b],a?.attributes.splice(b,1),a?.attributes.splice(r,0,x),s({attributes:a?.attributes},{successMessageKey:"realm-settings:updatedUserProfileSuccess",errorMessageKey:"realm-settings:updatedUserProfileError"})},k=a?.attributes.filter(f=>f.name!==S),[y,P]=pe({titleKey:i("deleteAttributeConfirmTitle"),messageKey:i("deleteAttributeConfirm",{attributeName:S}),continueButtonLabel:i("common:delete"),continueButtonVariant:te.danger,onConfirm:async()=>{s({attributes:k},{successMessageKey:"realm-settings:deleteAttributeSuccess",errorMessageKey:"realm-settings:deleteAttributeError"}),T("")}}),L=f=>e(be,{to:Kt({realm:t,attributeName:f.name}),children:f.name},f.name);return a?.attributes?d(Y,{children:[e(Qt,{children:d(wa,{children:[e(Te,{children:e(ce,{width:200,"data-testid":"filter-select",isOpen:p,variant:ge.single,onToggle:u,toggleIcon:e(ea,{}),onSelect:(f,r)=>{const b=r.toString();c(b),g(b==="allGroups"?a.attributes:a.attributes?.filter(x=>x.group===b)),u()},selections:o==="allGroups"?i(o):o,children:[e(se,{"data-testid":"all-groups",value:"allGroups",children:i("allGroups")},"allGroups"),...a.attributes.filter(f=>!!f.group).map(f=>e(se,{"data-testid":`${f.group}-option`,value:f.group},f.group))]})}),e(Te,{className:"kc-toolbar-attributesTab",children:e(R,{"data-testid":"createAttributeBtn",variant:"primary",component:f=>e(be,{...f,to:ga({realm:t})}),children:i("createAttribute")})})]})}),e(_e,{}),e(P,{}),e(Zt,{keyField:"name",onDragFinish:async(f,r)=>{const b=a.attributes.map(C=>C.name),x=r.indexOf(f),B=b.indexOf(f),E=a.attributes[B];!E.name||h(E,x)},actions:[{title:i("common:edit"),onClick:(f,r,b)=>{l(Kt({realm:t,attributeName:b.name}))}},{title:i("common:delete"),isActionable:({name:f})=>!xs.includes(f),onClick:(f,r,b)=>{T(b.name),y()}}],columns:[{name:"name",displayKey:i("attributeName"),cellRenderer:L},{name:"displayName",displayKey:i("attributeDisplayName")},{name:"group",displayKey:i("attributeGroup")}],data:n||a.attributes})]}):e(we,{})},Es=()=>{const{config:a,save:s,isSaving:t}=At(),{t:i}=F(),{addError:l}=de(),[o,c]=m.exports.useState();m.exports.useEffect(()=>p(),[a,o]);function p(){o?.setValue(a?Ye(a):"")}function u(){const n=o?.getValue();if(!!n)try{s(JSON.parse(n))}catch(g){l("realm-settings:invalidJsonError",g);return}}return d(W,{variant:"light",children:[e(Pt,{language:wt.json,height:"30rem",onEditorDidMount:n=>c(n),isLanguageLabelVisible:!0}),e(Et,{children:d(ye,{children:[e(R,{variant:"primary",onClick:u,isDisabled:t,children:i("common:save")}),e(R,{variant:"link",onClick:p,isDisabled:t,children:i("common:revert")})]})})]})},Ls=()=>{const{realm:a}=le(),{t:s}=F("realm-settings"),t=xt();return e(Za,{children:d(rt,{defaultLocation:at({realm:a,tab:"attributes"}),mountOnEnter:!0,children:[e(z,{title:e(_,{children:s("attributes")}),"data-testid":"attributesTab",...He({to:at({realm:a,tab:"attributes"}),history:t}),children:e(Cs,{})}),e(z,{title:e(_,{children:s("attributesGroup")}),"data-testid":"attributesGroupTab",...He({to:at({realm:a,tab:"attributes-group"}),history:t}),children:e(Is,{})}),e(z,{title:e(_,{children:s("jsonEditor")}),"data-testid":"jsonEditorTab",...He({to:at({realm:a,tab:"json-editor"}),history:t}),children:e(Es,{})})]})})},Xe=["ACTIVE","PASSIVE","DISABLED"],Ps=({onFilter:a})=>{const{t:s}=F("realm-settings"),[t,i]=m.exports.useState(Xe[0]),[l,o]=Ue();return e(ce,{width:300,"data-testid":"filter-type-select",isOpen:l,className:"kc-filter-type-select",variant:ge.single,onToggle:o,toggleIcon:e(ea,{}),onSelect:(c,p)=>{const u=Xe.find(n=>n===p.toString())||Xe[0];i(u),a(u),o()},selections:t,children:Xe.map(c=>e(se,{"data-testid":`${c}-option`,value:c,children:s(`keysFilter.${c}`)},c))})},ws=({realmComponents:a})=>{const{t:s}=F("realm-settings"),t=$e(),[i,l]=m.exports.useState(""),[o,c]=m.exports.useState(""),{adminClient:p}=ie(),{realm:u}=le(),[n,g]=m.exports.useState(),[S,T]=m.exports.useState();ke(async()=>(await p.realms.getKeys({realm:u})).keys?.map(b=>{const x=a.find(B=>B.id===b.providerId);return{...b,provider:x?.name}}),g,[]);const[h,k]=pe({titleKey:s("publicKeys").slice(0,-1),messageKey:i,continueButtonLabel:"common:close",continueButtonVariant:te.primary,onConfirm:()=>Promise.resolve()}),[y,P]=pe({titleKey:s("certificate"),messageKey:o,continueButtonLabel:"common:close",continueButtonVariant:te.primary,onConfirm:()=>Promise.resolve()}),L=({provider:r})=>r,f=({type:r,publicKey:b,certificate:x})=>{if(r==="EC")return e(R,{onClick:()=>{h(),l(b)},variant:"secondary",id:"kc-public-key",children:s("publicKeys").slice(0,-1)});if(r==="RSA")return d("div",{className:"button-wrapper",children:[e(R,{onClick:()=>{h(),l(b)},variant:"secondary",id:b,children:s("publicKeys").slice(0,-1)}),e(R,{onClick:()=>{y(),c(x)},variant:"secondary",id:x,className:"kc-certificate",children:s("certificate")})]})};return n?d(W,{variant:"light",padding:{default:"noPadding"},children:[e(k,{}),e(P,{}),e(Ke,{isNotCompact:!0,className:"kc-keys-list",loader:S||n,ariaLabelKey:"realm-settings:keysList",searchPlaceholderKey:"realm-settings:searchKey",searchTypeComponent:e(Ps,{onFilter:r=>T(r!==Xe[0]?n.filter(({status:b})=>b===r):void 0)}),canSelectAll:!0,columns:[{name:"algorithm",displayKey:"realm-settings:algorithm",cellFormatters:[st()],transforms:[Je(15)]},{name:"type",displayKey:"type",cellFormatters:[st()],transforms:[Je(10)]},{name:"kid",displayKey:"realm-settings:kid",cellFormatters:[st()],transforms:[Je(10)]},{name:"provider",displayKey:"realm-settings:provider",cellRenderer:L,cellFormatters:[st()],transforms:[Je(10)]},{name:"publicKeys",displayKey:"realm-settings:publicKeys",cellRenderer:f,cellFormatters:[],transforms:[Je(20)]}],isSearching:!!S,emptyState:e(Pe,{hasIcon:!0,message:s("noKeys"),instructions:s("noKeysDescription"),primaryActionText:s("addProvider"),onPrimaryAction:()=>t(yt({realm:u,tab:"providers"}))})})]}):e(we,{})},As=({providerType:a,onClose:s})=>{const{t}=F("realm-settings");return e(Ge,{className:"add-provider-modal",variant:ze.medium,title:t("addProvider"),isOpen:!0,onClose:s,children:e(es,{providerType:a,onClose:s})})},Rs=({realmComponents:a,refresh:s})=>{const{t}=F("realm-settings"),{addAlert:i,addError:l}=de(),{adminClient:o}=ie(),{realm:c}=le(),{url:p}=ba(),[u,n]=m.exports.useState(""),[g,S]=m.exports.useState([]),[T,h]=Ue(),y=Ve().componentTypes?.[qt]??[],P=y.map(O=>O.id),[L,f]=m.exports.useState(!1),[r,b]=m.exports.useState(),[x,B]=m.exports.useState(),E=m.exports.useMemo(()=>a.map(O=>{const J=y.find(me=>O.providerId===me.id);return{...O,providerDescription:J?.helpText}}),[a]),[C,K]=pe({titleKey:"realm-settings:deleteProviderTitle",messageKey:t("deleteProviderConfirm",{provider:x?.name}),continueButtonLabel:"common:delete",continueButtonVariant:te.danger,onConfirm:async()=>{try{await o.components.del({id:x.id,realm:c}),s(),i(t("deleteProviderSuccess"),ee.success)}catch(O){l("realm-settings:deleteProviderError",O)}}}),U=()=>{if(u!==""){n(u);const O=E.filter(J=>J.name?.includes(u)||J.providerId?.includes(u));S(O)}else n(""),S(E)},D=O=>{O.key==="Enter"&&U()},H=O=>{n(O)};return d(Y,{children:[T&&r&&e(As,{providerType:r,onClose:()=>{h(),s()}}),e(K,{}),d(W,{variant:"light",padding:{default:"noPadding"},children:[e(Qt,{children:d(Aa,{className:"providers-toolbar",children:[e(Te,{children:d(ya,{children:[e(_t,{name:"inputGroupName",id:"inputGroupName","data-testid":"provider-search-input",type:"search","aria-label":t("common:search"),placeholder:t("common:search"),onChange:H,onKeyDown:D}),e(R,{variant:te.control,"aria-label":t("common:search"),onClick:U,children:e($t,{})})]})}),e(Te,{children:e(jt,{"data-testid":"addProviderDropdown",className:"add-provider-dropdown",isOpen:L,toggle:e(va,{onToggle:O=>f(O),isPrimary:!0,children:t("addProvider")}),dropdownItems:[P.map(O=>e(Qe,{onClick:()=>{h(),f(!1),b(O)},"data-testid":`option-${O}`,children:O},O))]})})]})}),e(Zt,{variant:"compact",className:"kc-draggable-table",keyField:"id",data:g.length===0?E:g,onDragFinish:async(O,J)=>{const me=E.map(N=>{const Z={...N};return delete Z.providerDescription,o.components.update({id:N.id},{...Z,config:{priority:[(J.length-J.indexOf(N.id)+100).toString()]}})});try{await Promise.all(me),s(),i(t("saveProviderListSuccess"),ee.success)}catch(N){l("realm-settings:saveProviderError",N)}},columns:[{name:"name",displayKey:"realm-settings:name",cellRenderer:O=>e(be,{"data-testid":"provider-name-link",to:`${p}/${O.id}/${O.providerId}/settings`,children:O.name},O.name)},{name:"providerId",displayKey:"realm-settings:provider"},{name:"providerDescription",displayKey:"realm-settings:providerDescription"}],actions:[{title:t("common:delete"),onClick:(O,J,me)=>{B(me),C()}}]})]})]})},Ds=a=>[...a].sort((t,i)=>{const l=Number(t.config?.priority),o=Number(i.config?.priority);return(isNaN(o)?0:o)-(isNaN(l)?0:l)}),Ns=()=>{const{t:a}=F("realm-settings"),s=xt(),{adminClient:t}=ie(),{realm:i}=le(),[l,o]=m.exports.useState(),[c,p]=m.exports.useState(0),u=()=>{p(c+1)};if(ke(()=>t.components.find({type:qt,realm:i}),g=>o(Ds(g)),[c]),!l)return e(we,{});const n=g=>He({to:yt({realm:i,tab:g}),history:s});return d(rt,{mountOnEnter:!0,unmountOnExit:!0,defaultLocation:yt({realm:i,tab:"list"}),children:[e(z,{id:"keysList","data-testid":"rs-keys-list-tab","aria-label":"keys-list-subtab",title:e(_,{children:a("keysList")}),...n("list"),children:e(ws,{realmComponents:l})}),e(z,{id:"providers","data-testid":"rs-providers-tab","aria-label":"rs-providers-tab",title:e(_,{children:a("providers")}),...n("providers"),children:e(Rs,{realmComponents:l,refresh:u})})]})},Os=({save:a,onChange:s,value:t,realmName:i,refresh:l})=>{const{t:o}=F("realm-settings"),{adminClient:c}=ie(),{refresh:p}=Wt(),{addAlert:u,addError:n}=de(),g=$e(),[S,T]=m.exports.useState(!1),[h,k]=m.exports.useState(!1),[y,P]=pe({titleKey:"realm-settings:disableConfirmTitle",messageKey:"realm-settings:disableConfirm",continueButtonLabel:"common:disable",onConfirm:()=>{s(!t),a()}}),[L,f]=pe({titleKey:"realm-settings:deleteConfirmTitle",messageKey:"realm-settings:deleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:te.danger,onConfirm:async()=>{try{await c.realms.del({realm:i}),u(o("deletedSuccess"),ee.success),await p(),g(Sa({realm:Ta.masterRealm})),l()}catch(r){n("realm-settings:deleteError",r)}}});return d(Y,{children:[e(P,{}),e(f,{}),e(bs,{open:S,toggleDialog:()=>T(!S)}),e(ys,{isOpen:h,onClose:()=>k(!1)}),e(Ea,{titleKey:i,subKey:"realm-settings:realmSettingsExplain",helpUrl:ka.realmSettingsUrl,divider:!1,dropdownItems:[e(Qe,{"data-testid":"openPartialImportModal",onClick:()=>{T(!0)},children:o("partialImport")},"import"),e(Qe,{"data-testid":"openPartialExportModal",onClick:()=>k(!0),children:o("partialExport")},"export"),e(Ia,{},"separator"),e(Qe,{onClick:L,children:o("common:delete")},"delete")],isEnabled:t,onToggle:r=>{r?(s(r),a()):y()}})]})},Ms=({realm:a,refresh:s})=>{const{t}=F("realm-settings"),{adminClient:i}=ie(),{addAlert:l,addError:o}=de(),{realm:c}=le(),{refresh:p}=Wt(),u=xt(),n=$e(),g=aa(),{control:S,setValue:T,getValues:h}=ue({mode:"onChange",shouldUnregister:!1}),[k,y]=m.exports.useState(0),P=()=>{y(k+1)},L=(x=a)=>{Ce(x,T)};m.exports.useEffect(L,[]);const f=async x=>{x=xa(x),x.attributes?.["acr.loa.map"]&&typeof x.attributes["acr.loa.map"]!="string"&&(x.attributes["acr.loa.map"]=JSON.stringify(Object.fromEntries(x.attributes["acr.loa.map"].filter(({key:E})=>E!=="").map(({key:E,value:C})=>[E,C]))));try{await i.realms.update({realm:c},{...a,...x,id:x.realm}),l(t("saveSuccess"),ee.success)}catch(E){o("realm-settings:saveError",E)}c!==(x.realm||a.realm)&&(await p(),n(ht({realm:x.realm,tab:"general"}))),s()},r=(x="general")=>He({to:ht({realm:c,tab:x}),history:u}),b=x=>He({to:bt({realm:c,tab:x}),history:u});return d(Y,{children:[e(A,{name:"enabled",defaultValue:!0,control:S,render:({onChange:x,value:B})=>e(Os,{value:B,onChange:x,realmName:c,refresh:P,save:()=>f(h())})}),e(W,{variant:"light",className:"pf-u-p-0",children:d(rt,{isBox:!0,mountOnEnter:!0,defaultLocation:ht({realm:c,tab:"general"}),children:[e(z,{title:e(_,{children:t("general")}),"data-testid":"rs-general-tab",...r(),children:e(rs,{realm:a,save:f})}),e(z,{title:e(_,{children:t("login")}),"data-testid":"rs-login-tab",...r("login"),children:e(os,{refresh:s,realm:a})}),e(z,{title:e(_,{children:t("email")}),"data-testid":"rs-email-tab",...r("email"),children:e(ss,{realm:a})}),e(z,{title:e(_,{children:t("themes")}),"data-testid":"rs-themes-tab",...r("themes"),children:e(ps,{realm:a,save:f})}),e(z,{title:e(_,{children:t("realm-settings:keys")}),"data-testid":"rs-keys-tab",...r("keys"),children:e(Ns,{})}),e(z,{title:e(_,{children:t("events")}),"data-testid":"rs-realm-events-tab",...r("events"),children:e(ns,{realm:a})}),e(z,{title:e(_,{children:t("localization")}),"data-testid":"rs-localization-tab",...r("localization"),children:e(Ss,{refresh:s,save:f,realm:a},k)}),e(z,{title:e(_,{children:t("securityDefences")}),"data-testid":"rs-security-defenses-tab",...r("security-defenses"),children:e(ms,{realm:a,save:f})}),e(z,{title:e(_,{children:t("realm-settings:sessions")}),"data-testid":"rs-sessions-tab",...r("sessions"),children:e(us,{realm:a,save:f},k)}),e(z,{title:e(_,{children:t("realm-settings:tokens")}),"data-testid":"rs-tokens-tab",...r("tokens"),children:e(fs,{save:f,realm:a})}),e(z,{title:e(_,{children:t("realm-settings:clientPolicies")}),"data-testid":"rs-clientPolicies-tab",...r("client-policies"),children:d(rt,{mountOnEnter:!0,defaultLocation:bt({realm:c,tab:"profiles"}),children:[e(z,{id:"profiles","data-testid":"rs-policies-clientProfiles-tab","aria-label":t("clientProfilesSubTab"),title:e(_,{children:t("profiles")}),tooltip:e(Ft,{content:t("realm-settings:clientPoliciesProfilesHelpText")}),...b("profiles"),children:e(hs,{})}),e(z,{id:"policies","data-testid":"rs-policies-clientPolicies-tab","aria-label":t("clientPoliciesSubTab"),...b("policies"),title:e(_,{children:t("policies")}),tooltip:e(Ft,{content:t("realm-settings:clientPoliciesPoliciesHelpText")}),children:e(gs,{})})]})}),g(Rt.DeclarativeUserProfile)&&a.attributes?.userProfileEnabled==="true"&&e(z,{title:e(_,{children:t("realm-settings:userProfile")}),"data-testid":"rs-user-profile-tab",...r("user-profile"),children:e(Ls,{})}),e(z,{title:e(_,{children:t("userRegistration")}),"data-testid":"rs-userRegistration-tab",...r("user-registration"),children:e(ks,{})})]})})]})};function $i(){const{adminClient:a}=ie(),{realm:s}=Ca(),[t,i]=m.exports.useState(),[l,o]=m.exports.useState(0),c=()=>{o(l+1),i(void 0)};return ke(()=>a.realms.findOne({realm:s}),i,[l]),t?e(Ms,{realm:t,refresh:c}):e(we,{})}export{$i as default};
