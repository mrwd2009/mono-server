import{u as Y,aw as q,bA as F,az as J,r as l,g as Q,ay as U,a_ as W,h as u,F as X,j as t,P as Z,s as h,b4 as V,cD as P,aY as $}from"./index.0cb2e516.js";import{F as ee}from"./FormAccess.bee4f1e0.js";import{V as te}from"./ViewHeader.2586557f.js";import{u as oe,C as re,F as se}from"./index.esm.6af887f8.js";import{H as k}from"./HelpItem.e440d5db.js";import{D as ie}from"./DynamicComponents.3dd18b3b.js";import{a as ae,A as ce}from"./FormGroup.3d5f3f16.js";import{S as ne,b as le,a as me}from"./Select.5a6b39aa.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./Text.c38ffb52.js";import"./KeycloakTextInput.b4d5b2db.js";import"./KeycloakTextArea.f5e2440a.js";import"./useToggle.8c992bea.js";import"./AddRoleMappingModal.4adc845a.js";import"./KeycloakDataTable.4e517788.js";import"./TableToolbar.c27bcd3c.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Modal.6593dfcc.js";import"./useLocaleSort.84ea7ec0.js";import"./resource.df4d2bbd.js";import"./joinPath.69b856b1.js";import"./filter-icon.fec9f70e.js";import"./ConfirmDialog.f8013bbb.js";import"./KeyValueInput.cb1ae3e8.js";import"./FlexItem.308d9f82.js";import"./minus-circle-icon.de526f05.js";import"./CodeEditor.16ebafa0.js";import"./ClientSelect.a855e118.js";import"./MultiLineInput.e27bc560.js";import"./GroupPickerDialog.f5430678.js";import"./DataListItemRow.8f458244.js";import"./data-list.f7ff2ea7.js";import"./FileUpload.18e1e495.js";import"./PasswordInput.34ff6dd3.js";const A={config:{},executor:""};function Ze(){const{t:i}=Y("realm-settings"),C=q(),{realm:p,profileName:c}=F(),{executorName:n}=F(),{addAlert:I,addError:H}=J(),[D,T]=l.exports.useState(!1),N=Q(),{adminClient:y}=U(),d=N.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[x,O]=l.exports.useState([]),[G,j]=l.exports.useState([]),[E,w]=l.exports.useState([]),[B,L]=l.exports.useState([]),f=oe({defaultValues:A}),{control:z,reset:b,handleSubmit:_}=f,r=!!n,S=e=>{const o=e.find(a=>a.name===c)?.executors?.find(a=>a.executor===n);o&&b({config:o.configuration})};W(()=>y.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{w(e.globalProfiles),L(e.profiles),S(e.profiles),S(e.globalProfiles)},[]);const K=async()=>{const e=f.getValues(),s=B.map(o=>{if(o.name!==c)return o;const a=(o.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(r){const m=o.executors.find(R=>R.executor===n);m.configuration={...m.configuration,...e.config}}return r?o:{...o,executors:a}});try{await y.clientPolicies.createProfiles({profiles:s,globalProfiles:E}),I(i(r?"realm-settings:updateExecutorSuccess":"realm-settings:addExecutorSuccess"),$.success),C(P({realm:p,profileName:c}))}catch(o){H(r?"realm-settings:updateExecutorError":"realm-settings:addExecutorError",o)}},g=E.find(e=>e.name===c),v=d?.find(e=>e.id===n),M=v?.properties.map(e=>{const s=r?e.defaultValue:"";return{...e,defaultValue:s}});return u(X,{children:[t(te,{titleKey:r?n:i("addExecutor"),divider:!0}),u(Z,{variant:"light",children:[u(ee,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",isReadOnly:!!g,children:[t(ae,{label:i("executorType"),fieldId:"kc-executorType",labelIcon:x.length>0&&x[0].helpText!==""?t(k,{helpText:x[0].helpText,fieldLabelId:"realm-settings:executorTypeHelpText"}):r?t(k,{helpText:v?.helpText,fieldLabelId:"realm-settings:executorTypeHelpText"}):void 0,children:t(re,{name:"executor",defaultValue:"",control:z,render:({value:e})=>t(ne,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:s=>T(s),onSelect:(s,o)=>{b({...A,executor:o.toString()});const a=d?.filter(m=>m.id===o);O(a??[]),j(a?.[0].properties??[]),T(!1)},selections:r?n:e,variant:le.single,"data-testid":"executorType-select","aria-label":i("executorType"),isOpen:D,maxHeight:580,isDisabled:r,children:d?.map(s=>t(me,{selected:s.id===e,value:s.id,description:s.helpText},s.id))})})}),t(se,{...f,children:t(ie,{properties:r?M:G})}),!g&&u(ce,{children:[t(h,{variant:"primary",onClick:()=>_(K)(),"data-testid":"addExecutor-saveBtn",children:i(r?"common:save":"common:add")}),t(h,{variant:"link",component:e=>t(V,{...e,to:P({realm:p,profileName:c})}),"data-testid":"addExecutor-cancelBtn",children:i("common:cancel")})]})]}),r&&g&&t("div",{className:"kc-backToProfile",children:t(h,{component:e=>t(V,{...e,to:P({realm:p,profileName:c})}),variant:"primary",children:i("realm-settings:back")})})]})]})}export{Ze as default};
