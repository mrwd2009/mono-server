import{u as x,r as h,h as m,F as b,j as e,ay as X,a_ as Z,bA as ee,az as me,aw as fe,l as ue,ae as z,aY as K,cr as ge,cs as ye,K as he,H as be,s as E,P as ve,ct as j,b4 as $,o as Ce,ap as Se,cu as xe}from"./index.0cb2e516.js";import{a as F,C as S,u as Ie,F as ke}from"./index.esm.6af887f8.js";import{F as N}from"./FormAccess.bee4f1e0.js";import{S as we}from"./ScrollForm.e8140edc.js";import{V as Te}from"./ViewHeader.2586557f.js";import{G as Me,E as Re}from"./ExtendedFieldsForm.27b13c2a.js";import{T as H,S as f,F as De}from"./discovery-settings.18f66d94.js";import{H as v,c as Fe}from"./HelpItem.e440d5db.js";import{a as C,F as te,A as Le}from"./FormGroup.3d5f3f16.js";import{S as L,b as O,a as M}from"./Select.5a6b39aa.js";import{u as _}from"./ConfirmDialog.f8013bbb.js";import{K as Oe}from"./KeycloakTabs.3730c896.js";import{E as Pe}from"./ExpandableSection.ed768772.js";import{N as Ae}from"./NumberInput.331c7b85.js";import{O as Ke,D as Ee,a as Ne}from"./OIDCAuthentication.fcec663d.js";import{S as Be,D as Ve}from"./SamlGeneralSettings.423673f3.js";import{M as J}from"./MultiLineInput.e27bc560.js";import{K as He,L as _e}from"./KeycloakDataTable.4e517788.js";import{P as Ge}from"./PermissionTab.13062542.js";import{T as B,a as V}from"./Tabs.3d61d369.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./FormPanel.4ba67868.js";import"./CardHeader.f162738f.js";import"./Card.32e78d5f.js";import"./CardTitle.42e61ef4.js";import"./CardBody.a2e5e179.js";import"./Text.c38ffb52.js";import"./DisplayOrder.76153bb4.js";import"./ClientIdSecret.0917a328.js";import"./PasswordInput.34ff6dd3.js";import"./KeycloakTextInput.b4d5b2db.js";import"./check.51c67984.js";import"./star-icon.97692015.js";import"./Modal.6593dfcc.js";import"./plus-icon.407671b4.js";import"./minus-circle-icon.de526f05.js";import"./plus-circle-icon.32cdf4dc.js";import"./TableToolbar.c27bcd3c.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./useLocaleSort.84ea7ec0.js";import"./Trans.ec4d13b3.js";import"./MenuList.288a98b4.js";const Y=({field:t,label:i,defaultValue:s})=>{const{t:a}=x("identity-providers"),{control:d}=F(),{adminClient:c}=X(),[r,o]=h.exports.useState(),[l,u]=h.exports.useState(!1);return Z(()=>c.authenticationManagement.getFlows(),I=>o(I.filter(g=>g.providerId==="basic-flow")),[]),e(C,{label:a(i),labelIcon:e(v,{helpText:`identity-providers-help:${i}`,fieldLabelId:`identity-providers:${i}`}),fieldId:i,children:e(S,{name:t,defaultValue:s,control:d,render:({onChange:I,value:g})=>m(L,{toggleId:i,required:!0,onToggle:()=>u(!l),onSelect:(y,k)=>{I(k),u(!1)},selections:g||a("common:none"),variant:O.single,"aria-label":a(i),isOpen:l,children:[e(b,{children:s===""&&e(M,{value:s,children:a("common:none")},"empty")}),e(b,{children:r?.map(y=>e(M,{selected:y.alias===g,value:y.alias,children:y.alias},y.id))})]})})})},Q=["import","legacy","force"],Ue=({isOIDC:t,isSAML:i})=>{const{t:s}=x("identity-providers"),{control:a}=F(),[d,c]=h.exports.useState(!1);return m(b,{children:[!t&&!i&&e(H,{field:"config.defaultScope",label:"scopes"}),e(f,{field:"storeToken",label:"storeTokens",fieldType:"boolean"}),(i||t)&&e(f,{field:"addReadTokenRoleOnCreate",label:"storedTokensReadable",fieldType:"boolean"}),!t&&!i&&m(b,{children:[e(f,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(f,{field:"config.disableUserInfo",label:"disableUserInfo"})]}),e(f,{field:"trustEmail",label:"trustEmail",fieldType:"boolean"}),e(f,{field:"linkOnly",label:"accountLinkingOnly",fieldType:"boolean"}),e(f,{field:"config.hideOnLoginPage",label:"hideOnLoginPage"}),e(Y,{field:"firstBrokerLoginFlowAlias",label:"firstBrokerLoginFlowAlias",defaultValue:"fist broker login"}),e(Y,{field:"postBrokerLoginFlowAlias",label:"postBrokerLoginFlowAlias",defaultValue:""}),e(C,{className:"pf-u-pb-3xl",label:s("syncMode"),labelIcon:e(v,{helpText:"identity-providers-help:syncMode",fieldLabelId:"identity-providers:syncMode"}),fieldId:"syncMode",children:e(S,{name:"config.syncMode",defaultValue:Q[0].toUpperCase(),control:a,render:({onChange:r,value:o})=>e(L,{toggleId:"syncMode",required:!0,direction:"up",onToggle:()=>c(!d),onSelect:(l,u)=>{r(u),c(!1)},selections:s(`syncModes.${o.toLowerCase()}`),variant:O.single,"aria-label":s("syncMode"),isOpen:d,children:Q.map(l=>e(M,{selected:l===o,value:l.toUpperCase(),children:s(`syncModes.${l}`)},l))})})})]})},qe={unspecified:"",none:"none",consent:"consent",login:"login",select_account:"select_account"},ze=()=>{const{t}=x("identity-providers"),{control:i}=F(),[s,a]=h.exports.useState(!1),[d,c]=h.exports.useState(!1);return e(Pe,{toggleText:t("advanced"),onToggle:()=>a(!s),isExpanded:s,children:m(te,{isHorizontal:!0,children:[e(f,{label:"passLoginHint",field:"config.loginHint"}),e(f,{label:"passMaxAge",field:"config.passMaxAge"}),e(f,{label:"passCurrentLocale",field:"config.uiLocales"}),e(f,{field:"config.backchannelSupported",label:"backchannelLogout"}),e(f,{field:"config.disableUserInfo",label:"disableUserInfo"}),e(H,{field:"config.defaultScope",label:"scopes"}),e(De,{label:"prompt",children:e(S,{name:"config.prompt",defaultValue:"",control:i,render:({onChange:r,value:o})=>e(L,{toggleId:"prompt",required:!0,onToggle:()=>c(!d),onSelect:(l,u)=>{r(u),c(!1)},selections:o||t("prompts.unspecified"),variant:O.single,"aria-label":t("prompt"),isOpen:d,children:Object.entries(qe).map(([l,u])=>e(M,{selected:u===o,value:u,children:t(`prompts.${l}`)},l))})})}),e(f,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(C,{label:t("allowedClockSkew"),labelIcon:e(v,{helpText:"identity-providers-help:allowedClockSkew",fieldLabelId:"identity-providers:allowedClockSkew"}),fieldId:"allowedClockSkew",children:e(S,{name:"config.allowedClockSkew",control:i,defaultValue:0,render:({onChange:r,value:o})=>e(Ae,{value:o,"data-testid":"allowedClockSkew",onMinus:()=>r(o-1),onChange:r,onPlus:()=>r(o+1),inputName:"input",inputAriaLabel:t("allowedClockSkew"),minusBtnAriaLabel:t("common:minus"),plusBtnAriaLabel:t("common:plus"),min:0,unit:t("common:times.seconds")})})}),e(H,{field:"config.forwardParameters",label:"forwardParameters"})]})})},W=["exact","minimum","maximum","better"],je=()=>{const{t}=x("identity-providers"),{control:i}=F(),[s,a]=h.exports.useState(!1);return m(b,{children:[e(C,{label:t("comparison"),labelIcon:e(v,{helpText:"identity-providers-help:comparison",fieldLabelId:"identity-providers:comparison"}),fieldId:"comparison",children:e(S,{name:"config.authnContextComparisonType",defaultValue:W[0],control:i,render:({onChange:d,value:c})=>e(L,{toggleId:"comparison",required:!0,direction:"up",onToggle:r=>a(r),onSelect:(r,o)=>{d(o.toString()),a(!1)},selections:c,variant:O.single,"aria-label":t("comparison"),isOpen:s,children:W.map(r=>e(M,{selected:r===c,value:r,children:t(r)},r))})})}),e(C,{label:t("authnContextClassRefs"),fieldId:"kc-authnContextClassRefs",labelIcon:e(v,{helpText:"identity-providers-help:authnContextClassRefs",fieldLabelId:"authnContextClassRefs"}),children:e(J,{name:"config.authnContextClassRefs","aria-label":t("identify-providers:authnContextClassRefs"),addButtonLabel:"identity-providers:addAuthnContextClassRef","data-testid":"classref-field"})}),e(C,{label:t("authnContextDeclRefs"),fieldId:"kc-authnContextDeclRefs",labelIcon:e(v,{helpText:"identity-providers-help:authnContextDeclRefs",fieldLabelId:"authnContextDeclRefs"}),children:e(J,{name:"config.authnContextDeclRefs","aria-label":t("identify-providers:authnContextDeclRefs"),addButtonLabel:"identity-providers:addAuthnContextDeclRef","data-testid":"declref-field"})})]})},$e=({onChange:t,value:i,save:s,toggleDeleteDialog:a})=>{const{t:d}=x("identity-providers"),{alias:c}=ee(),[r,o]=_({titleKey:"identity-providers:disableProvider",messageKey:d("disableConfirm",{provider:c}),continueButtonLabel:"common:disable",onConfirm:()=>{t(!i),s()}});return m(b,{children:[e(o,{}),e(Te,{titleKey:Ce(c),divider:!1,dropdownItems:[e(Se,{onClick:()=>a(),children:d("common:delete")},"delete")],isEnabled:i,onToggle:l=>{l?(t(l),s()):r()}})]})};function _t(){const{t}=x("identity-providers"),{alias:i,providerId:s}=ee(),a=Ie(),{handleSubmit:d,getValues:c,reset:r}=a,[o,l]=h.exports.useState(),[u,I]=h.exports.useState(),{adminClient:g}=X(),{addAlert:y,addError:k}=me(),P=fe(),{realm:w}=ue(),[G,ie]=h.exports.useState(0),oe=()=>ie(G+1),ne=({name:n,mapperId:p})=>e($,{to:xe({realm:w,alias:i,providerId:o?.providerId,id:p}),children:n});Z(()=>g.identityProviders.findOne({alias:i}),n=>{if(!n)throw new Error(t("common:notFound"));r(n),l(n),n.config.authnContextClassRefs&&a.setValue("config.authnContextClassRefs",JSON.parse(n.config?.authnContextClassRefs)),n.config.authnContextDeclRefs&&a.setValue("config.authnContextDeclRefs",JSON.parse(n.config?.authnContextDeclRefs))},[]);const R=async n=>{const p=n||c();p.config?.authnContextClassRefs&&(p.config.authnContextClassRefs=JSON.stringify(p.config.authnContextClassRefs)),p.config?.authnContextDeclRefs&&(p.config.authnContextDeclRefs=JSON.stringify(p.config.authnContextDeclRefs));try{await g.identityProviders.update({alias:i},{...p,config:{...o?.config,...p.config},alias:i,providerId:s}),y(t("updateSuccess"),K.success)}catch(U){k("identity-providers:updateError",U)}},[re,se]=_({titleKey:"identity-providers:deleteProvider",messageKey:t("identity-providers:deleteConfirm",{provider:i}),continueButtonLabel:"common:delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{await g.identityProviders.del({alias:i}),y(t("deletedSuccess"),K.success),P(ge({realm:w}))}catch(n){k("identity-providers:deleteErrorError",n)}}}),[ae,le]=_({titleKey:"identity-providers:deleteProviderMapper",messageKey:t("identity-providers:deleteMapperConfirm",{mapper:u?.name}),continueButtonLabel:"common:delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{await g.identityProviders.delMapper({alias:i,id:u?.mapperId}),y(t("deleteMapperSuccess"),K.success),oe(),P(ye({providerId:s,alias:i,tab:"mappers",realm:w}))}catch(n){k("identity-providers:deleteErrorError",n)}}});if(!o)return e(he,{});const D=o.providerId.includes("oidc"),T=o.providerId.includes("saml"),de=async()=>{const[n,p]=await Promise.all([g.identityProviders.findMappers({alias:i}),g.identityProviders.findMapperTypes({alias:i})]);return n.map(A=>{const q=Object.values(p).find(pe=>A.identityProviderMapper===pe.id);return{...q,name:A.name,type:q?.name,mapperId:A.id}})},ce=[{title:t("generalSettings"),panel:m(N,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:d(R),children:[!D&&!T&&m(b,{children:[e(Me,{create:!1,id:i}),e(Re,{providerId:i})]}),D&&e(Ke,{id:i}),T&&e(Be,{id:i,isAliasReadonly:!0})]})},{title:t("oidcSettings"),isHidden:!D,panel:m(b,{children:[e(Ee,{readOnly:!1}),m(te,{isHorizontal:!0,className:"pf-u-py-lg",children:[e(be,{}),e(Ne,{create:!1})]}),e(ze,{})]})},{title:t("samlSettings"),isHidden:!T,panel:e(Ve,{readOnly:!1})},{title:t("reqAuthnConstraints"),isHidden:!T,panel:e(N,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:d(R),children:e(je,{})})},{title:t("advancedSettings"),panel:m(N,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:d(R),children:[e(Ue,{isOIDC:D,isSAML:T}),m(Le,{className:"keycloak__form_actions",children:[e(E,{"data-testid":"save",type:"submit",children:t("common:save")}),e(E,{"data-testid":"revert",variant:"link",onClick:()=>{r()},children:t("common:revert")})]})]})}];return m(ke,{...a,children:[e(se,{}),e(le,{}),e(S,{name:"enabled",control:a.control,defaultValue:!0,render:({onChange:n,value:p})=>e($e,{value:p,onChange:n,save:R,toggleDeleteDialog:re})}),e(ve,{variant:"light",className:"pf-u-p-0",children:m(Oe,{isBox:!0,children:[e(B,{id:"settings",eventKey:"settings",title:e(V,{children:t("common:settings")}),children:e(we,{className:"pf-u-px-lg",sections:ce})}),e(B,{id:"mappers","data-testid":"mappers-tab",eventKey:"mappers",title:e(V,{children:t("common:mappers")}),children:e(He,{emptyState:e(_e,{message:t("identity-providers:noMappers"),instructions:t("identity-providers:noMappersInstructions"),primaryActionText:t("identity-providers:addMapper"),onPrimaryAction:()=>P(j({realm:w,alias:i,providerId:o.providerId,tab:"mappers"}))}),loader:de,ariaLabelKey:"identity-providers:mappersList",searchPlaceholderKey:"identity-providers:searchForMapper",toolbarItem:e(Fe,{children:e(E,{id:"add-mapper-button",component:n=>e($,{...n,to:j({realm:w,alias:i,providerId:o.providerId,tab:"mappers"})}),"data-testid":"addMapper",children:t("addMapper")})}),columns:[{name:"name",displayKey:"common:name",cellRenderer:ne},{name:"category",displayKey:"common:category"},{name:"type",displayKey:"common:type"}],actions:[{title:t("common:delete"),onRowClick:n=>{I(n),ae()}}]},G)}),e(B,{id:"permissions","data-testid":"permissionsTab",eventKey:"permissions",title:e(V,{children:t("common:permissions")}),children:e(Ge,{id:i,type:"identityProviders"})})]})})]})}export{_t as default};
