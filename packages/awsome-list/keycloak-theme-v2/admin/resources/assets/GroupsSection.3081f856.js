import{_ as ne,h as S,F as R,j as e,H as Me,q as T,a5 as De,r as y,ai as me,R as Ke,a6 as Re,A as pe,N as he,u as O,ay as B,az as q,s as W,ae as ve,av as te,aY as Y,cm as z,aD as se,an as re,am as oe,ap as j,l as P,aw as ye,W as ee,ck as we,b4 as Z,bD as X,cn as Oe,bW as Le,P as Ce,co as Ne,cp as Be,cq as Fe,a_ as Se,K as Ue,aq as $e,bE as je,bF as ge,bw as qe,bx as ze,by as He,b2 as We,bz as Ye}from"./index.0cb2e516.js";import{V as Je}from"./ViewHeader.2586557f.js";import{b as Ge}from"./resource.df4d2bbd.js";import{K as ie,L as ce,p as Qe,P as Xe}from"./KeycloakDataTable.4e517788.js";import{u as ke}from"./index.esm.6af887f8.js";import{K as Ze}from"./KeycloakTextInput.b4d5b2db.js";import{M as Ie,a as xe}from"./Modal.6593dfcc.js";import{F as Pe,a as et}from"./FormGroup.3d5f3f16.js";import{u as $}from"./useToggle.8c992bea.js";import{C as tt}from"./ConfirmDialog.f8013bbb.js";import{c as H}from"./HelpItem.e440d5db.js";import{G as st,a as at}from"./GroupPickerDialog.f5430678.js";import{al as fe,am as nt}from"./TableToolbar.c27bcd3c.js";import{C as rt}from"./Checkbox.2dc73ed3.js";import{A as ot}from"./AttributeForm.ba0220ea.js";import{R as it}from"./AddRoleMappingModal.4adc845a.js";import{P as ct}from"./PermissionTab.13062542.js";import{j as lt}from"./joinPath.69b856b1.js";import{D as dt}from"./DrawerHead.ad4b75f2.js";import{b as ut,T as J,a as Q}from"./Tabs.3d61d369.js";import"./Text.c38ffb52.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./DataListItemRow.8f458244.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.1b75ab8f.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./KeyValueInput.cb1ae3e8.js";import"./FlexItem.308d9f82.js";import"./minus-circle-icon.de526f05.js";import"./FormAccess.bee4f1e0.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./useLocaleSort.84ea7ec0.js";import"./filter-icon.fec9f70e.js";import"./Trans.ec4d13b3.js";import"./Card.32e78d5f.js";import"./CardTitle.42e61ef4.js";import"./CardBody.a2e5e179.js";import"./plus-icon.407671b4.js";import"./MenuList.288a98b4.js";const Te=s=>{var{isNested:t=!1,toolbar:c,children:o}=s,n=ne(s,["isNested","toolbar","children"]);return S(R,{children:[c&&S(R,{children:[c,e(Me,{})]}),e("ul",{...Object.assign({className:T("pf-c-tree-view__list"),role:t?"group":"tree"},n),children:o})]})};Te.displayName="TreeViewList";const N={badge:"pf-c-badge",modifiers:{compact:"pf-m-compact",guides:"pf-m-guides",expanded:"pf-m-expanded",noBackground:"pf-m-no-background",current:"pf-m-current",read:"pf-m-read",selectable:"pf-m-selectable",truncate:"pf-m-truncate"},themeDark:"pf-theme-dark",treeView:"pf-c-tree-view",treeViewAction:"pf-c-tree-view__action",treeViewContent:"pf-c-tree-view__content",treeViewListItem:"pf-c-tree-view__list-item",treeViewNode:"pf-c-tree-view__node",treeViewNodeCheck:"pf-c-tree-view__node-check",treeViewNodeContainer:"pf-c-tree-view__node-container",treeViewNodeContent:"pf-c-tree-view__node-content",treeViewNodeCount:"pf-c-tree-view__node-count",treeViewNodeIcon:"pf-c-tree-view__node-icon",treeViewNodeText:"pf-c-tree-view__node-text",treeViewNodeTitle:"pf-c-tree-view__node-title",treeViewNodeToggle:"pf-c-tree-view__node-toggle",treeViewNodeToggleIcon:"pf-c-tree-view__node-toggle-icon",treeViewSearch:"pf-c-tree-view__search"},mt=({name:s,title:t,id:c,isExpanded:o,defaultExpanded:n=!1,children:d=null,onSelect:l,onCheck:a,hasCheck:i=!1,checkProps:r={checked:!1},hasBadge:g=!1,customBadgeContent:b,badgeProps:h={isRead:!0},isSelectable:p=!1,isCompact:m,activeItems:G=[],itemData:D,parentItem:w,icon:f,expandedIcon:_,action:K,compareItems:E,useMemo:u})=>{const[C,A]=y.exports.useState(n);y.exports.useEffect(()=>{o!=null?A(o):n!=null&&A(C||n)},[o,n]);let L="button";i?L="label":p&&(L="div");const v=i||p?"button":"span",M=V=>e(v,{...Object.assign({className:T(N.treeViewNodeToggle),onClick:I=>{(p||i)&&A(!C),p&&I.stopPropagation()}},(i||p)&&{"aria-labelledby":`label-${V}`},{tabIndex:-1}),children:e("span",{className:T(N.treeViewNodeToggleIcon),children:e(Re,{"aria-hidden":"true"})})}),x=V=>e("span",{className:T(N.treeViewNodeCheck),children:e("input",{...Object.assign({type:"checkbox",onChange:I=>a&&a(I,D,w),onClick:I=>I.stopPropagation(),ref:I=>I&&(I.indeterminate=r.checked===null)},r,{checked:r.checked===null?!1:r.checked,id:V,tabIndex:-1})})}),k=S("span",{className:T(N.treeViewNodeIcon),children:[!C&&f,C&&(_||f)]}),F=()=>{const V=S(R,{children:[m&&t&&e("span",{className:T(N.treeViewNodeTitle),children:t}),p?e("button",{tabIndex:-1,className:T(N.treeViewNodeText),children:s}):e("span",{className:T(N.treeViewNodeText),children:s})]});return m?e("span",{className:T(N.treeViewNodeContent),children:V}):V},U=S(R,{children:[g&&d&&e("span",{className:T(N.treeViewNodeCount),children:e(me,{...Object.assign({},h),children:b||d.props.data.length})}),g&&!d&&b!==void 0&&e("span",{className:T(N.treeViewNodeCount),children:e(me,{...Object.assign({},h),children:b})})]});return S("li",{...Object.assign({id:c,className:T(N.treeViewListItem,C&&N.modifiers.expanded)},C&&{"aria-expanded":"true"},{role:"treeitem",tabIndex:-1}),children:[S("div",{className:T(N.treeViewContent),children:[e(Ke,{prefix:p?"selectable-id":"checkbox-id",children:V=>e(L,{...Object.assign({className:T(N.treeViewNode,d&&(p||i)&&N.modifiers.selectable,(!d||p)&&G&&G.length>0&&G.some(I=>E&&I&&E(I,D))?N.modifiers.current:""),onClick:I=>{i||(l&&l(I,D,w),!p&&d&&I.isDefaultPrevented()!==!0&&A(!C))}},i&&{htmlFor:V},(i||p&&d)&&{id:`label-${V}`}),children:S("span",{className:T(N.treeViewNodeContainer),children:[d&&M(V),i&&x(V),f&&k,F(),U]})})}),K&&e("div",{className:T(N.treeViewAction),children:K})]}),C&&d]})},_e=De.memo(mt,(s,t)=>{if(!t.useMemo)return!1;const c=s.activeItems&&s.activeItems.length>0&&s.activeItems.some(n=>s.compareItems&&n&&s.compareItems(n,s.itemData)),o=t.activeItems&&t.activeItems.length>0&&t.activeItems.some(n=>t.compareItems&&n&&t.compareItems(n,t.itemData));return!(c||o||s.name!==t.name||s.title!==t.title||s.id!==t.id||s.isExpanded!==t.isExpanded||s.defaultExpanded!==t.defaultExpanded||s.onSelect!==t.onSelect||s.onCheck!==t.onCheck||s.hasCheck!==t.hasCheck||s.checkProps!==t.checkProps||s.hasBadge!==t.hasBadge||s.customBadgeContent!==t.customBadgeContent||s.badgeProps!==t.badgeProps||s.isCompact!==t.isCompact||s.icon!==t.icon||s.expandedIcon!==t.expandedIcon||s.action!==t.action||s.parentItem!==t.parentItem||s.itemData!==t.itemData)});_e.displayName="TreeViewListItem";class pt extends y.exports.Component{constructor(){super(...arguments),this.displayName="TreeViewRoot",this.treeRef=y.exports.createRef(),this.handleKeys=t=>{var c,o,n,d,l,a,i;if(!this.treeRef.current.contains(t.target))return;const r=document.activeElement,g=t.key,b=Array.from((c=this.treeRef.current)===null||c===void 0?void 0:c.getElementsByClassName("pf-c-tree-view__node")).filter(h=>!h.classList.contains("pf-m-disabled"));if(g===pe.Space&&(r.click(),t.preventDefault()),fe(t,b,h=>r===h,void 0,[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(g)){const h=(n=(o=r?.firstElementChild)===null||o===void 0?void 0:o.firstElementChild)===null||n===void 0?void 0:n.classList.contains("pf-c-tree-view__node-toggle"),p=(d=r?.closest("li"))===null||d===void 0?void 0:d.classList.contains("pf-m-expanded");if(g==="ArrowLeft")if(h&&p)r.click();else{const m=(l=r?.closest("ul"))===null||l===void 0?void 0:l.parentElement;if(m?.tagName!=="DIV"){const G=m?.querySelector("button");r.tabIndex=-1,G&&(G.tabIndex=0,G.focus())}}else if(h&&!p){r.tabIndex=-1,r.click();const m=(i=(a=r?.closest("li"))===null||a===void 0?void 0:a.querySelector("ul > li"))===null||i===void 0?void 0:i.querySelector("button");m&&(m.tabIndex=0,m.focus())}t.preventDefault()}},this.handleKeysCheckbox=t=>{var c,o,n,d,l;if(!this.treeRef.current.contains(t.target))return;const a=document.activeElement,i=t.key;i===pe.Space&&(a.click(),t.preventDefault());const r=Array.from((c=this.treeRef.current)===null||c===void 0?void 0:c.getElementsByClassName("pf-c-tree-view__node"));fe(t,r,g=>g.contains(a),g=>g.querySelector("button,input"),[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(i)&&(i==="ArrowLeft"?a?.tagName==="INPUT"?!((o=a?.parentElement)===null||o===void 0)&&o.previousSibling&&a.parentElement.previousSibling.focus():a?.previousSibling&&(((n=a.previousElementSibling)===null||n===void 0?void 0:n.tagName)==="SPAN"?a.previousSibling.firstChild.focus():a.previousSibling.focus()):a?.tagName==="INPUT"?!((d=a.parentElement)===null||d===void 0)&&d.nextSibling&&a.parentElement.nextSibling.focus():a?.nextSibling&&(((l=a.nextElementSibling)===null||l===void 0?void 0:l.tagName)==="SPAN"?a.nextSibling.firstChild.focus():a.nextSibling.focus()),t.preventDefault())},this.variantStyleModifiers={default:"",compact:N.modifiers.compact,compactNoBackground:[N.modifiers.compact,N.modifiers.noBackground]}}componentDidMount(){var t;if(he&&window.addEventListener("keydown",this.props.hasChecks||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys),this.props.hasChecks||this.props.hasSelectableNodes){const c=this.treeRef.current.getElementsByClassName("pf-c-tree-view__node-toggle")[0];if(c&&(c.tabIndex=0),this.props.hasChecks){const o=this.treeRef.current.getElementsByTagName("INPUT")[0];o&&(o.tabIndex=0)}if(this.props.hasSelectableNodes){const o=this.treeRef.current.getElementsByClassName("pf-c-tree-view__node-text")[0];o&&(o.tabIndex=0)}}else((t=this.treeRef.current)===null||t===void 0?void 0:t.getElementsByClassName("pf-c-tree-view__node")[0]).tabIndex=0}componentWillUnmount(){he&&window.removeEventListener("keydown",this.props.hasChecks||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys)}render(){const t=this.props,{children:c,hasChecks:o,hasGuides:n,variant:d,className:l,hasSelectableNodes:a}=t,i=ne(t,["children","hasChecks","hasGuides","variant","className","hasSelectableNodes"]);return e("div",{...Object.assign({className:T(N.treeView,n&&N.modifiers.guides,this.variantStyleModifiers[d],l),ref:this.treeRef},i),children:c})}}const le=s=>{var{data:t,isNested:c=!1,hasChecks:o=!1,hasBadges:n=!1,hasGuides:d=!1,hasSelectableNodes:l=!1,variant:a="default",defaultAllExpanded:i=!1,allExpanded:r,icon:g,expandedIcon:b,parentItem:h,onSelect:p,onCheck:m,toolbar:G,activeItems:D,compareItems:w=(u,C)=>u.id===C.id,className:f,useMemo:_}=s,K=ne(s,["data","isNested","hasChecks","hasBadges","hasGuides","hasSelectableNodes","variant","defaultAllExpanded","allExpanded","icon","expandedIcon","parentItem","onSelect","onCheck","toolbar","activeItems","compareItems","className","useMemo"]);const E=e(Te,{isNested:c,toolbar:G,children:t.map(u=>{var C,A;return e(_e,{...Object.assign({key:((C=u.id)===null||C===void 0?void 0:C.toString())||((A=u.name)===null||A===void 0?void 0:A.toString()),name:u.name,title:u.title,id:u.id,isExpanded:r,isSelectable:l,defaultExpanded:u.defaultExpanded!==void 0?u.defaultExpanded:i,onSelect:p,onCheck:m,hasCheck:u.hasCheck!==void 0?u.hasCheck:o,checkProps:u.checkProps,hasBadge:u.hasBadge!==void 0?u.hasBadge:n,customBadgeContent:u.customBadgeContent,badgeProps:u.badgeProps,activeItems:D,parentItem:h,itemData:u,icon:u.icon!==void 0?u.icon:g,expandedIcon:u.expandedIcon!==void 0?u.expandedIcon:b,action:u.action,compareItems:w,isCompact:a==="compact"||a==="compactNoBackground",useMemo:_},u.children&&{children:e(le,{data:u.children,isNested:!0,parentItem:u,hasChecks:o,hasBadges:n,hasGuides:d,hasSelectableNodes:l,variant:a,allExpanded:r,defaultAllExpanded:i,onSelect:p,onCheck:m,activeItems:D,icon:g,expandedIcon:b})})})})});return e(R,{children:h?E:e(pt,{...Object.assign({hasSelectableNodes:l,hasChecks:o,hasGuides:d,variant:a,className:f},K),children:E})})};le.displayName="TreeView";const de=({id:s,rename:t,handleModalToggle:c,refresh:o})=>{const{t:n}=O("groups"),{adminClient:d}=B(),{addAlert:l,addError:a}=q(),{register:i,handleSubmit:r,formState:{errors:g}}=ke({defaultValues:{name:t}}),b=async h=>{h.name=h.name?.trim();try{s?t?await d.groups.update({id:s},h):await d.groups.setOrCreateChild({id:s},h):await d.groups.create(h),o(t?h:void 0),c(),l(n(t?"groupUpdated":"groupCreated"),Y.success)}catch(p){a("groups:couldNotCreateGroup",p)}};return e(Ie,{variant:xe.small,title:n(t?"renameAGroup":"createAGroup"),isOpen:!0,onClose:c,actions:[e(W,{"data-testid":`${t?"rename":"create"}Group`,variant:"primary",type:"submit",form:"group-form",children:n(t?"rename":"create")},"confirm"),e(W,{id:"modal-cancel","data-testid":"cancel",variant:ve.link,onClick:()=>{c()},children:n("common:cancel")},"cancel")],children:e(Pe,{id:"group-form",isHorizontal:!0,onSubmit:r(b),children:e(et,{name:"create-modal-group",label:n("common:name"),fieldId:"group-id",helperTextInvalid:n("common:required"),validated:g.name?te.error:te.default,isRequired:!0,children:e(Ze,{"data-testid":"groupNameInput","aria-label":"group name input",ref:i({required:!0}),autoFocus:!0,type:"text",id:"create-group-name",name:"name",validated:g.name?te.error:te.default})})})})},Ee=s=>{const t=s.substr(1).split("/");return t.length>1?t.splice(2):void 0},ae=s=>{const t=Ee(s);return t?t[t.length-1]:void 0},ue=({selectedRows:s,show:t,toggleDialog:c,refresh:o})=>{const{t:n}=O("groups"),{adminClient:d}=B(),{addAlert:l,addError:a}=q(),i=async()=>{try{for(const r of s)await d.groups.del({id:r.id});o(),l(n("groupDeleted",{count:s.length}))}catch(r){a("groups:groupDeleteError",r)}};return e(tt,{titleKey:n("deleteConfirmTitle",{count:s.length}),messageKey:n("deleteConfirm",{count:s.length,groupName:s[0]?.name}),continueButtonLabel:"common:delete",continueButtonVariant:ve.danger,onConfirm:i,open:t,toggleDialog:c})},ht=({toggleCreate:s,toggleDelete:t,kebabDisabled:c})=>{const{t:o}=O("groups"),{currentGroup:n}=z(),{hasAccess:d}=se(),l=d("manage-users")||n()?.access?.manage,[a,i]=$();return l?S(R,{children:[e(H,{children:e(W,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:s,children:o("createGroup")})}),e(H,{children:e(re,{toggle:e(oe,{onToggle:i,isDisabled:c}),isOpen:a,isPlain:!0,dropdownItems:[e(j,{component:"button",onClick:()=>{t(),i()},children:o("common:delete")},"action")]})})]}):e("div",{})},gt=async(s,t)=>{await s.groups.del({id:t.id});const{id:c}=await s.groups.create({...t,id:void 0});t.subGroups&&await Promise.all(t.subGroups.map(o=>s.groups.setOrCreateChild({id:c},{...o,id:void 0})))},ft=async(s,t,c)=>{try{await s.groups.setOrCreateChild({id:c.id},t)}catch(o){if(o.response)throw o}},Ve=({source:s,onClose:t,refresh:c})=>{const{t:o}=O("groups"),{adminClient:n}=B(),{addAlert:d,addError:l}=q(),a=async i=>{try{await(i?ft(n,s,i[0]):gt(n,s)),c(),d(o("moveGroupSuccess"))}catch(r){l("groups:moveGroupError",r)}};return e(st,{type:"selectOne",filterGroups:[s.name],text:{title:"groups:moveToGroup",ok:"groups:moveHere"},onClose:t,onConfirm:a})},be=({refresh:s})=>{const{t}=O("groups"),{adminClient:c}=B(),{realm:o}=P(),[n,d]=y.exports.useState(!1),[l,a]=y.exports.useState([]),[i,r]=$(),[g,b]=y.exports.useState(),{subGroups:h,currentGroup:p,setSubGroups:m}=z(),[G,D]=y.exports.useState(0),w=()=>D(G+1),[f,_]=y.exports.useState(),K=ye(),E=ee(),u=ae(E.pathname),{hasAccess:C}=se(),A=C("manage-users")||p()?.access?.manage,L=C("query-groups","view-users")||C("manage-users","query-groups"),v=async(k,F)=>{const U={search:f||"",first:k?.toString()||"",max:F?.toString()||""};let V;if(u){const I=await c.groups.findOne({id:u});if(!I)throw new Error(t("common:notFound"));V=f?I.subGroups?.filter(Ae=>Ae.name?.includes(f)):I.subGroups}else V=await Ge(c,"admin-ui-groups",{...U,global:"false"});return V||K(we({realm:o})),V||[]},M=k=>L?e(Z,{to:`${E.pathname}/${k.id}`,onClick:()=>m([...h,k]),children:k.name},k.id):e("span",{children:k.name}),x=()=>{d(!n)};return S(R,{children:[e(ue,{show:i,toggleDialog:r,selectedRows:l,refresh:()=>{w(),s(),a([])}}),e(ie,{onSelect:k=>a([...k]),canSelectAll:!0,loader:v,ariaLabelKey:"groups:groups",isPaginated:!0,isSearching:!!f,toolbarItem:S(R,{children:[e(H,{children:e(nt,{"data-testid":"group-search",placeholder:t("filterGroups"),value:f,onChange:_,onSearch:w,onClear:()=>{_(""),w()}})}),e(ht,{toggleCreate:x,toggleDelete:r,kebabDisabled:l.length===0})]}),actions:A?[{title:t("moveTo"),onRowClick:async k=>(b(k),!1)},{title:t("common:delete"),onRowClick:async k=>(a([k]),r(),!0)}]:[],columns:[{name:"name",displayKey:"groups:groupName",cellRenderer:M}],emptyState:e(ce,{hasIcon:!0,message:t(`noGroupsInThis${u?"SubGroup":"Realm"}`),instructions:t(`noGroupsInThis${u?"SubGroup":"Realm"}Instructions`),primaryActionText:t("createGroup"),onPrimaryAction:x})},`${u}${G}`),n&&e(de,{id:u,handleModalToggle:x,refresh:()=>{w(),s()}}),g&&e(Ve,{source:g,refresh:()=>{b(void 0),w(),s()},onClose:()=>b(void 0)})]})},bt=({groupId:s,onClose:t})=>{const{t:c}=O("groups"),{adminClient:o}=B(),{addAlert:n,addError:d}=q(),[l,a]=y.exports.useState([]),i=async(r,g,b)=>{const h=await o.groups.listMembers({id:s}),p={first:r,max:g+h.length,search:b||""};try{const m=await o.users.find({...p});return Qe(m,h,"id").slice(0,g)}catch(m){return d("groups:noUsersFoundError",m),[]}};return e(Ie,{variant:xe.large,title:c("addMember"),isOpen:!0,onClose:t,actions:[e(W,{"data-testid":"add",variant:"primary",onClick:async()=>{try{await Promise.all(l.map(r=>o.users.addToGroup({id:r.id,groupId:s}))),t(),n(c("usersAdded",{count:l.length}),Y.success)}catch(r){d("groups:usersAddedError",r)}},children:c("common:add")},"confirm"),e(W,{"data-testid":"cancel",variant:"link",onClick:t,children:c("common:cancel")},"cancel")],children:e(ie,{loader:i,isPaginated:!0,ariaLabelKey:"users:title",searchPlaceholderKey:"users:searchForUser",canSelectAll:!0,onSelect:r=>a([...r]),emptyState:e(ce,{message:c("users:noUsersFound"),instructions:c("users:emptyInstructions")}),columns:[{name:"username",displayKey:"users:username"},{name:"email",displayKey:"users:email"},{name:"lastName",displayKey:"users:lastName",cellFormatters:[X()]},{name:"firstName",displayKey:"users:firstName",cellFormatters:[X()]}]})})},vt=()=>{const{t:s}=O("groups"),{adminClient:t}=B(),{realm:c}=P(),{addAlert:o,addError:n}=q(),d=ee(),l=ae(d.pathname),[a,i]=y.exports.useState(!1),{currentGroup:r}=z(),[g,b]=y.exports.useState(!1),[h,p]=y.exports.useState(!1),[m,G]=y.exports.useState([]),{hasAccess:D}=se(),w=D("manage-users")||r().access.manageMembership,[f,_]=y.exports.useState(0),K=()=>_(new Date().getTime()),E=async v=>await t.users.listGroups({id:v}),u=v=>{let M=[];for(const x of v){M.push(x);const k=u(x.subGroups);M=M.concat(k)}return M},C=async(v,M)=>{let x=await t.groups.listMembers({id:l,first:v,max:M});if(a){const F=u(r()?.subGroups);for(const U of F)x=x.concat(await t.groups.listMembers({id:U.id}));x=Oe(x,U=>U.username)}const k=await Promise.all(x.map(F=>E(F.id)));return x.map((F,U)=>({...F,membership:k[U]}))},A=v=>e(R,{children:v.membership.map((M,x)=>S(R,{children:[e(at,{group:M},M.id),v.membership[x+1]?", ":""]}))}),L=v=>e(Z,{to:Le({realm:c,id:v.id,tab:"settings"}),children:v.username},v.id);return S(R,{children:[g&&e(bt,{groupId:l,onClose:()=>{b(!1),K()}}),e(ie,{"data-testid":"members-table",loader:C,ariaLabelKey:"groups:members",isPaginated:!0,canSelectAll:!0,onSelect:v=>G([...v]),toolbarItem:w&&S(R,{children:[e(H,{children:e(W,{"data-testid":"addMember",variant:"primary",onClick:()=>b(!0),children:s("addMember")})}),e(H,{children:e(rt,{"data-testid":"includeSubGroupsCheck",label:s("includeSubGroups"),id:"kc-include-sub-groups",isChecked:a,onChange:()=>i(!a)})}),e(H,{children:e(re,{toggle:e(oe,{onToggle:()=>p(!h),isDisabled:m.length===0}),isOpen:h,isPlain:!0,dropdownItems:[e(j,{component:"button",onClick:async()=>{try{await Promise.all(m.map(v=>t.users.delFromGroup({id:v.id,groupId:l}))),p(!1),o(s("usersLeft",{count:m.length}),Y.success)}catch(v){n("groups:usersLeftError",v)}K()},children:s("leave")},"action")]})})]}),actions:w?[{title:s("leave"),onRowClick:async v=>{try{await t.users.delFromGroup({id:v.id,groupId:l}),o(s("usersLeft",{count:1}),Y.success)}catch(M){n("groups:usersLeftError",M)}return!0}}]:[],columns:[{name:"username",displayKey:"common:name",cellRenderer:L},{name:"email",displayKey:"groups:email",cellFormatters:[X()]},{name:"firstName",displayKey:"groups:firstName",cellFormatters:[X()]},{name:"lastName",displayKey:"groups:lastName",cellFormatters:[X()]},{name:"membership",displayKey:"groups:membership",cellRenderer:A}],emptyState:e(ce,{message:s("users:noUsersFound"),instructions:w?s("users:emptyInstructions"):void 0,primaryActionText:w?s("addMember"):void 0,onPrimaryAction:()=>b(!0),secondaryActions:[{text:s("includeSubGroups"),onClick:()=>i(!0)}]})},`${l}${f}${a}`)]})},yt=()=>{const{t:s}=O("groups"),{adminClient:t}=B(),{addAlert:c,addError:o}=q(),n=ke({mode:"onChange",shouldUnregister:!1}),d=ee(),l=ae(d.pathname),{currentGroup:a,subGroups:i,setSubGroups:r}=z(),g=h=>Be(h||a()?.attributes);y.exports.useEffect(()=>{n.setValue("attributes",g())},[i]);const b=async h=>{try{const p=a(),m=Fe(h.attributes);await t.groups.update({id:l},{...p,attributes:m}),r([...i.slice(0,i.length-1),{...p,attributes:m}]),c(s("groupUpdated"),Y.success)}catch(p){o("groups:groupUpdateError",p)}};return e(Ce,{variant:Ne.light,children:e(ot,{form:n,save:b,fineGrainedAccess:a()?.access?.manage,reset:()=>n.reset({attributes:g()})})})},wt=({id:s,name:t})=>{const{t:c}=O("clients"),{adminClient:o}=B(),{addAlert:n,addError:d}=q();return e(it,{name:t,id:s,type:"groups",save:async a=>{try{const i=a.filter(r=>r.client===void 0).map(r=>r.role).flat();await o.groups.addRealmRoleMappings({id:s,roles:i}),await Promise.all(a.filter(r=>r.client!==void 0).map(r=>o.groups.addClientRoleMappings({id:s,clientUniqueId:r.client.id,roles:[r.role]}))),n(c("roleMappingUpdatedSuccess"),Y.success)}catch(i){d("clients:roleMappingUpdatedError",i)}}})},Ct=({group:s,refresh:t})=>{const{t:c}=O("groups"),[o,n]=$(),[d,l]=$(),[a,i]=$(),[r,g]=$();return S(R,{children:[d&&e(de,{id:s.id,handleModalToggle:l,refresh:t}),a&&e(Ve,{source:s,refresh:t,onClose:i}),e(ue,{show:r,toggleDialog:g,selectedRows:[s],refresh:t}),e(re,{toggle:e(oe,{onToggle:n}),isOpen:o,isPlain:!0,position:$e.right,dropdownItems:[e(j,{onClick:l,children:c("createGroup")},"create"),e(j,{onClick:i,children:c("moveTo")},"move"),e(j,{onClick:g,children:c("common:delete")},"delete")]})]})},Nt=({refresh:s})=>{const{t}=O("groups"),{adminClient:c}=B(),{realm:o}=P(),[n,d]=y.exports.useState(),{subGroups:l,setSubGroups:a}=z(),[i,r]=y.exports.useState(""),[g,b]=y.exports.useState(20),[h,p]=y.exports.useState(0),[m,G]=y.exports.useState(0),D=()=>{G(m+1),s()},w=(f,_,K)=>{const E=[..._,f];return{id:f.id,name:e(Z,{to:`/${o}/groups/${lt(...E.map(u=>u.id))}`,onClick:()=>a(E),children:f.name},f.id),children:f.subGroups&&f.subGroups.length>0?f.subGroups.map(u=>w(u,E,K)):void 0,action:e(Ct,{group:f,refresh:K}),defaultExpanded:l.map(u=>u.id).includes(f.id)}};return Se(()=>Ge(c,"admin-ui-groups",Object.assign({first:`${h}`,max:`${g+1}`},i===""?null:{search:i})),f=>d(f.map(_=>w(_,[],D))),[m,h,g,i]),n?e(Xe,{count:n.length||0,first:h,max:g,onNextClick:p,onPreviousClick:p,onPerPageSelect:(f,_)=>{p(f),b(_)},inputGroupName:"searchForGroups",inputGroupPlaceholder:t("groups:searchForGroups"),inputGroupOnEnter:r,children:n.length>0&&e(le,{data:n,allExpanded:i.length>0})}):e(Ue,{})},St=()=>{const{t:s}=O(),{clear:t,remove:c,subGroups:o}=z(),{realm:n}=P(),d=ee();return y.exports.useEffect(()=>{const{pathname:l}=d;(!l.includes("/groups")||l.endsWith("/groups"))&&t()},[d]),o.length!==0?S(je,{children:[e(ge,{children:e(Z,{to:`/${n}/groups`,children:s("groups")})},"home"),o.map((l,a)=>{const i=a===o.length-1;return S(ge,{isActive:i,children:[!i&&e(Z,{to:d.pathname.substring(0,d.pathname.indexOf(l.id)+l.id.length),onClick:()=>c(l),children:l.name}),i&&(l.id==="search"?l.name:s("groups:groupDetails"))]},l.id)})]}):null};function ps(){const{t:s}=O("groups"),[t,c]=y.exports.useState(0),{adminClient:o}=B(),{subGroups:n,setSubGroups:d,currentGroup:l}=z(),{realm:a}=P(),[i,r]=y.exports.useState(),[g,b]=$(),h=ye(),p=ee(),m=ae(p.pathname),[G,D]=y.exports.useState(0),w=()=>D(G+1),{hasAccess:f}=se(),_=f("manage-authorization","manage-users","manage-clients"),K=f("manage-users")||l()?.access?.manage,E=f("manage-users");return Se(async()=>{const u=Ee(p.pathname);if(u&&u.length>n.length){const A=[];for(const L of u){const v=L!=="search"?await o.groups.findOne({id:L}):{name:s("searchGroups"),id:"search"};if(v)A.push(v);else throw new Error(s("common:notFound"))}return A}return[]},u=>{u.length&&d(u)},[m]),S(R,{children:[e(ue,{show:g,toggleDialog:b,selectedRows:[l()],refresh:()=>{h(we({realm:a})),w()}}),i&&e(de,{id:m,rename:i,refresh:u=>{w(),d([...n.slice(0,n.length-1),u])},handleModalToggle:()=>r(void 0)}),e(Ce,{variant:Ne.light,className:"pf-u-p-0",children:e(qe,{isInline:!0,isExpanded:!0,children:e(ze,{panelContent:e(He,{isResizable:!0,defaultSize:"80%",minSize:"500px",children:S(dt,{children:[e(St,{}),e(Je,{titleKey:m?l()?.name:"groups:groups",subKey:m?"":"groups:groupsDescription",helpUrl:m?"":We.groupsUrl,divider:!m,dropdownItems:m&&K?[e(j,{"data-testid":"renameGroupAction",onClick:()=>r(l()?.name),children:s("renameGroup")},"renameGroup"),e(j,{"data-testid":"deleteGroup",onClick:b,children:s("deleteGroup")},"deleteGroup")]:void 0}),n.length>0&&S(ut,{inset:{default:"insetNone",md:"insetSm",xl:"insetLg","2xl":"inset2xl"},activeKey:t,onSelect:(u,C)=>c(C),isBox:!0,children:[e(J,{"data-testid":"groups",eventKey:0,title:e(Q,{children:s("childGroups")}),children:e(be,{refresh:w})}),e(J,{"data-testid":"members",eventKey:1,title:e(Q,{children:s("members")}),children:e(vt,{})}),e(J,{"data-testid":"attributes",eventKey:2,title:e(Q,{children:s("common:attributes")}),children:e(yt,{})}),E&&e(J,{eventKey:3,"data-testid":"role-mapping-tab",title:e(Q,{children:s("roleMapping")}),children:e(wt,{id:m,name:l()?.name})}),_&&e(J,{eventKey:4,"data-testid":"permissionsTab",title:e(Q,{children:s("common:permissions")}),children:e(ct,{id:m,type:"groups"})})]}),n.length===0&&e(be,{refresh:w})]})}),children:e(Ye,{children:e(Nt,{refresh:w})})})},G)})]})}export{ps as default};
