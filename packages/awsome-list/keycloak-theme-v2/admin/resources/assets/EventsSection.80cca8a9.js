import{bd as Re,ci as Oe,c as xe,cj as Pe,j as t,l as oe,b4 as te,a4 as ye,bP as De,ck as Le,bK as we,bW as fe,aZ as Ue,ca as Ke,u as ie,ay as _e,g as Ve,r as f,bS as Ge,h as p,F as se,an as Te,aF as ke,s as N,a_ as Me,n as He,c7 as Be,b2 as je,P as We,cl as le,aS as ze}from"./index.0cb2e516.js";import{u as be,C as I}from"./index.esm.6af887f8.js";import{T as Ze,n as $e,o as Je,K as ge,L as ve}from"./KeycloakDataTable.4e517788.js";import{V as Xe}from"./ViewHeader.2586557f.js";import{K as F}from"./KeycloakTextInput.b4d5b2db.js";import{u as Se,F as Fe}from"./useFormatDate.53169b6c.js";import{M as qe,ah as Ie,ak as Qe}from"./TableToolbar.c27bcd3c.js";import{C as Ye,L as et}from"./CodeEditor.16ebafa0.js";import{M as tt,a as st}from"./Modal.6593dfcc.js";import{F as Ce,a as M}from"./FlexItem.308d9f82.js";import{F as Ee,a as u,A as Ae}from"./FormGroup.3d5f3f16.js";import{S as re,b as ae,C as w,c as C,a as ne}from"./Select.5a6b39aa.js";import{D as H}from"./DatePicker.3081625b.js";import{R as rt,r as at}from"./RoutableTabs.f3cff418.js";import{T as nt}from"./Trans.ec4d13b3.js";import{W as ot}from"./warning-triangle-icon.00f0aca5.js";import{T as ce,a as de}from"./Tabs.3d61d369.js";import{D as it,a as lt,b as ct,c as dt}from"./DescriptionListTerm.60563b13.js";import"./HelpItem.e440d5db.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Text.c38ffb52.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./copy-icon.cf10e1f5.js";import"./plus-icon.407671b4.js";import"./MenuList.288a98b4.js";function Ne(e,i){if(e==null)return{};var l=Re(Oe(e),function(d){return[d]});return i=xe(i),Pe(e,l,function(d,k){return i(d,k[0])})}const pe=38,pt=({text:e,children:i})=>{const l=e||"",d=l.length>pe,k=l.substring(0,pe);return d?t(ye,{content:e,children:i(k+"\u2026")}):i(l)},mt=e=>e.operationType==="DELETE"?!1:e.resourceType==="USER"||e.resourceType==="GROUP_MEMBERSHIP"||e.resourceType==="GROUP"||e.resourceType==="CLIENT"||e.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||e.resourceType==="CLIENT_SCOPE"||e.resourceType==="AUTH_FLOW"||e.resourcePath?.startsWith("roles-by-id"),ut=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),ht=(e,i)=>{const l=ut.exec(i.resourcePath);if(!l)return console.warn("event didn't contain a valid link",i),"";const d=l[1];return i.resourceType==="CLIENT"||i.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?De({realm:e,clientId:d,tab:i.resourceType==="CLIENT"?"settings":"authorization"}):i.resourceType==="GROUP"?Le({realm:e,id:d}):i.resourceType==="CLIENT_SCOPE"?we({realm:e,id:d,tab:"settings"}):i.resourceType==="USER"||i.resourceType==="GROUP_MEMBERSHIP"?fe({realm:e,id:d,tab:"settings"}):i.resourceType==="AUTH_FLOW"?Ue({realm:e,id:d,usedBy:"-"}):i.resourcePath?.startsWith("roles-by-id")?Ke({realm:e,id:d}):""},yt=({event:e})=>{const{realm:i}=oe();return t(pt,{text:e.resourcePath,children:l=>mt(e)?t(te,{to:ht(i,e),children:l}):t("span",{children:l})})},ft=e=>t(yt,{event:e});const me={resourceTypes:[],operationTypes:[],resourcePath:"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},ue=({titleKey:e,onClose:i,children:l})=>{const{t:d}=ie("events");return t(tt,{variant:st.medium,title:d(e),isOpen:!0,onClose:i,children:l})},_t=()=>{const{t:e}=ie("events"),{adminClient:i}=_e(),{realm:l}=oe(),d=Ve(),k=Se(),B=d.enums?.resourceType,j=d.enums?.operationType,[R,W]=f.exports.useState(0),[z,U]=f.exports.useState(!1),[Z,E]=f.exports.useState(!1),[$,J]=f.exports.useState(!1),[b,K]=f.exports.useState({}),[_,O]=f.exports.useState(),[g,V]=f.exports.useState(),X={resourceTypes:e("resourceTypes"),operationTypes:e("operationTypes"),resourcePath:e("resourcePath"),dateFrom:e("dateFrom"),dateTo:e("dateTo"),authClient:e("client"),authUser:e("userId"),authRealm:e("realm"),authIpAddress:e("ipAddress")},{getValues:x,register:S,reset:P,formState:{isDirty:v},control:A}=be({shouldUnregister:!1,mode:"onChange",defaultValues:me});function q(r,n){return i.realms.findAdminEvents({...b,realm:l,first:r,max:n})}function Q(){U(!1),o()}function Y(){P(),o()}function G(r){const n={...x()};delete n[r],P({...me,...n}),o()}function s(r,n){const a=x(),m=a[r],y=Array.isArray(m)?m.filter(L=>L!==n):m;P({...a,[r]:y}),o()}function o(){const r=Ne(x(),n=>n!==""||Array.isArray(n)&&n.length>0);K(r),W(R+1)}function c(){o()}const h=()=>p(Ce,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[p(M,{children:[t(Te,{id:"admin-events-search-select","data-testid":"AdminEventsSearchSelector",className:"pf-u-ml-md",toggle:t(ke,{"data-testid":"adminEventsSearchSelectorToggle",onToggle:r=>U(r),className:"keycloak__events_search_selector_dropdown__toggle",children:e("searchForAdminEvent")}),isOpen:z,children:p(Ee,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[t(u,{label:e("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:t(I,{name:"resourceTypes",control:A,render:({onChange:r,value:n})=>t(re,{className:"keycloak__events_search__type_select",name:"resourceTypes","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:e("common:hide"),collapsedText:e("common:showRemaining")},variant:ae.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:a=>E(a),selections:n,onSelect:(a,m)=>{const y=m.toString(),L=n.includes(y)?n.filter(ee=>ee!==y):[...n,y];r(L)},onClear:a=>{a.stopPropagation(),r([])},isOpen:Z,"aria-labelledby":"resourceTypes",chipGroupComponent:t(w,{children:n.map(a=>t(C,{onClick:m=>{m.stopPropagation(),r(n.filter(y=>y!==a))},children:a},a))}),children:B?.map(a=>t(ne,{value:a},a))})})}),t(u,{label:e("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:t(I,{name:"operationTypes",control:A,render:({onChange:r,value:n})=>t(re,{className:"keycloak__events_search__type_select",name:"operationTypes","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:e("common:hide"),collapsedText:e("common:showRemaining")},variant:ae.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:a=>J(a),selections:n,onSelect:(a,m)=>{const y=m.toString(),L=n.includes(y)?n.filter(ee=>ee!==y):[...n,y];r(L)},onClear:a=>{a.stopPropagation(),r([])},isOpen:$,"aria-labelledby":"operationTypes",chipGroupComponent:t(w,{children:n.map(a=>t(C,{onClick:m=>{m.stopPropagation(),r(n.filter(y=>y!==a))},children:a},a))}),children:j?.map(a=>t(ne,{value:a},a))})})}),t(u,{label:e("resourcePath"),fieldId:"kc-resourcePath",className:"keycloak__events_search__form_label",children:t(F,{ref:S(),type:"text",id:"kc-resourcePath",name:"resourcePath","data-testid":"resourcePath-searchField"})}),t(u,{label:e("realm"),fieldId:"kc-realm",className:"keycloak__events_search__form_label",children:t(F,{ref:S(),type:"text",id:"kc-realm",name:"authRealm","data-testid":"realm-searchField"})}),t(u,{label:e("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:t(F,{ref:S(),type:"text",id:"kc-client",name:"authClient","data-testid":"client-searchField"})}),t(u,{label:e("user"),fieldId:"kc-user",className:"keycloak__events_search__form_label",children:t(F,{ref:S(),type:"text",id:"kc-user",name:"authUser","data-testid":"user-searchField"})}),t(u,{label:e("ipAddress"),fieldId:"kc-ipAddress",className:"keycloak__events_search__form_label",children:t(F,{ref:S(),type:"text",id:"kc-ipAddress",name:"authIpAddress","data-testid":"ipAddress-searchField"})}),t(u,{label:e("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:t(I,{name:"dateFrom",control:A,render:({onChange:r,value:n})=>t(H,{className:"pf-u-w-100",value:n,onChange:a=>r(a),inputProps:{id:"kc-dateFrom"}})})}),t(u,{label:e("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:t(I,{name:"dateTo",control:A,render:({onChange:r,value:n})=>t(H,{className:"pf-u-w-100",value:n,onChange:a=>r(a),inputProps:{id:"kc-dateTo"}})})}),p(Ae,{children:[t(N,{variant:"primary",onClick:Q,"data-testid":"search-events-btn",isDisabled:!v,children:e("searchAdminEventsBtn")}),t(N,{variant:"secondary",onClick:Y,isDisabled:!v,children:e("resetBtn")})]})]})}),t(N,{className:"pf-u-ml-md",onClick:c,"data-testid":"refresh-btn",children:e("refresh")})]}),t(M,{children:Object.entries(b).length>0&&t("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(b).map(r=>{const[n,a]=r;return t(w,{className:"pf-u-mt-md pf-u-mr-md",categoryName:X[n],isClosable:!0,onClick:()=>G(n),children:typeof a=="string"?t(C,{isReadOnly:!0,children:a}):a.map(m=>t(C,{onClick:()=>s(n,m),children:m},m))},n)})})})]}),T=[[e("realm"),_?.authDetails?.realmId],[e("client"),_?.authDetails?.clientId],[e("user"),_?.authDetails?.userId],[e("ipAddress"),_?.authDetails?.ipAddress]],D=f.exports.useMemo(()=>g?.representation?Ge(JSON.parse(g.representation)):"",[g?.representation]);return p(se,{children:[_&&t(ue,{titleKey:"auth",onClose:()=>O(void 0),children:p(Ze,{"aria-label":"authData","data-testid":"auth-dialog",variant:qe.compact,cells:[e("attribute"),e("value")],rows:T,children:[t($e,{}),t(Je,{})]})}),g&&t(ue,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>V(void 0),children:t(Ye,{isLineNumbersVisible:!0,isReadOnly:!0,code:D,language:et.json,height:"8rem"})}),t(ge,{loader:q,isPaginated:!0,ariaLabelKey:"events:adminEvents",toolbarItem:h(),actions:[{title:e("auth"),onRowClick:r=>O(r)},{title:e("representation"),onRowClick:r=>V(r)}],columns:[{name:"time",displayKey:"events:time",cellRenderer:r=>k(new Date(r.time),Fe)},{name:"resourcePath",displayKey:"events:resourcePath",cellRenderer:ft},{name:"resourceType",displayKey:"events:resourceType"},{name:"operationType",displayKey:"events:operationType",transforms:[Ie(10)]},{name:"",displayKey:"events:user",cellRenderer:r=>r.authDetails?.userId}],emptyState:t(ve,{message:e("emptyEvents"),instructions:e("emptyEventsInstructions")}),isSearching:Object.keys(b).length>0},R)]})},he={client:"",dateFrom:"",dateTo:"",user:"",type:[]},Tt=e=>e.error?t(ye,{content:e.error,children:p("span",{children:[t(ot,{color:"orange"})," ",e.type]})}):p("span",{children:[t(ze,{color:"green"})," ",e.type]}),kt=e=>t(it,{isHorizontal:!0,className:"keycloak_eventsection_details",children:Object.entries(e.details).map(([i,l])=>p(lt,{children:[t(ct,{children:i}),t(dt,{children:l})]},i))});function Xt(){const{t:e}=ie("events"),{adminClient:i}=_e(),{realm:l}=oe(),d=Se(),[k,B]=f.exports.useState(0),[j,R]=f.exports.useState(!1),[W,z]=f.exports.useState(!1),[U,Z]=f.exports.useState(),[E,$]=f.exports.useState({}),J={client:e("client"),dateFrom:e("dateFrom"),dateTo:e("dateTo"),user:e("userId"),type:e("eventType")},{getValues:b,register:K,reset:_,formState:{isDirty:O},control:g}=be({shouldUnregister:!1,mode:"onChange",defaultValues:he});Me(()=>i.realms.getConfigEvents({realm:l}),s=>Z(s),[]);function V(s,o){return i.realms.findEvents({...E,realm:l,first:s,max:o})}function X(){R(!1),v()}function x(){_(),v()}function S(s){const o={...b()};delete o[s],_({...he,...o}),v()}function P(s,o){const c=b(),h=c[s],T=Array.isArray(h)?h.filter(D=>D!==o):h;_({...c,[s]:T}),v()}function v(){const s=Ne(b(),o=>o!==""||Array.isArray(o)&&o.length>0);$(s),B(k+1)}function A(){v()}const q=s=>p(se,{children:[s.userId&&t(te,{to:fe({realm:l,id:s.userId,tab:"settings"}),children:s.userId},`link-${s.time}-${s.type}`),!s.userId&&e("noUserDetails")]}),Q=()=>p(Ce,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[p(M,{children:[t(Te,{id:"user-events-search-select","data-testid":"UserEventsSearchSelector",className:"pf-u-ml-md",toggle:t(ke,{"data-testid":"userEventsSearchSelectorToggle",onToggle:s=>R(s),className:"keycloak__events_search_selector_dropdown__toggle",children:e("searchForUserEvent")}),isOpen:j,children:p(Ee,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[t(u,{label:e("userId"),fieldId:"kc-userId",className:"keycloak__events_search__form_label",children:t(F,{ref:K(),type:"text",id:"kc-userId",name:"user","data-testid":"userId-searchField"})}),t(u,{label:e("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:t(I,{name:"type",control:g,render:({onChange:s,value:o})=>t(re,{className:"keycloak__events_search__type_select",name:"eventType","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:e("common:hide"),collapsedText:e("common:showRemaining")},variant:ae.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:c=>z(c),selections:o,onSelect:(c,h)=>{const T=h.toString(),D=o.includes(T)?o.filter(r=>r!==T):[...o,T];s(D)},onClear:c=>{c.stopPropagation(),s([])},isOpen:W,"aria-labelledby":"eventType",chipGroupComponent:t(w,{children:o.map(c=>t(C,{onClick:h=>{h.stopPropagation(),s(o.filter(T=>T!==c))},children:c},c))}),children:U?.enabledEventTypes?.map(c=>t(ne,{value:c},c))})})}),t(u,{label:e("client"),fieldId:"kc-client",className:"keycloak__events_search__form_label",children:t(F,{ref:K(),type:"text",id:"kc-client",name:"client","data-testid":"client-searchField"})}),t(u,{label:e("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:t(I,{name:"dateFrom",control:g,render:({onChange:s,value:o})=>t(H,{className:"pf-u-w-100",value:o,onChange:c=>s(c),inputProps:{id:"kc-dateFrom"}})})}),t(u,{label:e("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:t(I,{name:"dateTo",control:g,render:({onChange:s,value:o})=>t(H,{className:"pf-u-w-100",value:o,onChange:c=>s(c),inputProps:{id:"kc-dateTo"}})})}),p(Ae,{children:[t(N,{variant:"primary",onClick:X,"data-testid":"search-events-btn",isDisabled:!O,children:e("searchUserEventsBtn")}),t(N,{variant:"secondary",onClick:x,isDisabled:!O,children:e("resetBtn")})]})]})}),t(N,{className:"pf-u-ml-md",onClick:A,"data-testid":"refresh-btn",children:e("refresh")})]}),t(M,{children:Object.entries(E).length>0&&t("div",{className:"keycloak__searchChips pf-u-ml-md",children:Object.entries(E).map(s=>{const[o,c]=s;return t(w,{className:"pf-u-mt-md pf-u-mr-md",categoryName:J[o],isClosable:!0,onClick:()=>S(o),children:typeof c=="string"?t(C,{isReadOnly:!0,children:c}):c.map(h=>t(C,{onClick:()=>P(o,h),children:h},h))},o)})})})]}),Y=He(),G=s=>at({to:le({realm:l,tab:s}),history:Y});return p(se,{children:[t(Xe,{titleKey:"events:title",subKey:p(nt,{i18nKey:"events:eventExplain",children:["If you want to configure user events, Admin events or Event listeners, please enter",t(te,{to:Be({realm:l,tab:"events"}),children:e("eventConfig")}),"page realm settings to configure."]}),helpUrl:je.eventsUrl,divider:!1}),t(We,{variant:"light",className:"pf-u-p-0",children:p(rt,{isBox:!0,defaultLocation:le({realm:l,tab:"user-events"}),children:[t(ce,{title:t(de,{children:e("userEvents")}),...G("user-events"),children:t("div",{className:"keycloak__events_table",children:t(ge,{loader:V,detailColumns:[{name:"details",enabled:s=>s.details!==void 0,cellRenderer:kt}],isPaginated:!0,ariaLabelKey:"events:title",toolbarItem:Q(),columns:[{name:"time",displayKey:"events:time",cellFormatters:[Qe],cellRenderer:s=>d(new Date(s.time),Fe)},{name:"userId",displayKey:"events:user",cellRenderer:q},{name:"type",displayKey:"events:eventType",cellRenderer:Tt},{name:"ipAddress",displayKey:"events:ipAddress",transforms:[Ie(10)]},{name:"clientId",displayKey:"events:client"}],emptyState:t(ve,{message:e("emptyEvents"),instructions:e("emptyEventsInstructions")}),isSearching:Object.keys(E).length>0},k)})}),t(ce,{title:t(de,{children:e("adminEvents")}),"data-testid":"admin-events-tab",...G("admin-events"),children:t(_t,{})})]})})]})}export{Xt as default};
