import{_ as yt,h as r,q as Fe,j as e,ay as ne,l as pe,u as L,S as xn,g as Ye,r as u,a_ as oe,bQ as Qe,bR as qe,aY as ee,b6 as ei,b7 as ti,bS as He,b0 as Xe,b1 as Te,bB as N,F as j,aA as ce,s as D,b8 as kn,bT as Ae,az as de,b4 as fe,bP as Cn,ag as Vt,a4 as qt,ae as ye,P as me,o as St,aD as ze,m as ni,av as Ie,bU as ii,H as Be,T as Oe,R as si,bV as ai,an as zt,am as li,ap as $e,aV as Rn,bW as oi,K as we,bX as An,bY as mt,L as Ut,aF as On,aw as Ze,bZ as Zt,b_ as wn,b$ as dt,c0 as en,c1 as tn,c2 as jt,ao as ri,bA as Gt,aQ as ci,ad as di,af as ui,c3 as pi,n as mi,bO as hi,c4 as kt,c5 as nn,c6 as fi,aB as gi,aC as sn,bn as bi}from"./index.0cb2e516.js";import{C as M,a as ae,u as Ee,b as vt,F as Le,c as yi}from"./index.esm.6af887f8.js";import{C as Ht,u as xe}from"./ConfirmDialog.f8013bbb.js";import{H as I,c as ge,T as $t,a as Si,f as vi}from"./HelpItem.e440d5db.js";import{K as et}from"./KeycloakTextArea.f5e2440a.js";import{a as tt,M as _e}from"./Modal.6593dfcc.js";import{F as Se,a as b,A as be}from"./FormGroup.3d5f3f16.js";import{S as Ii,a as Ct,F as re,C as Ti,b as En}from"./FormAccess.bee4f1e0.js";import{S as X,b as Q,a as V}from"./Select.5a6b39aa.js";import{V as xi}from"./ViewHeader.2586557f.js";import{R as ki}from"./RolesList.9e2aaa9f.js";import{u as ve}from"./useToggle.8c992bea.js";import{S as Pn}from"./ScrollForm.e8140edc.js";import{T as Wt}from"./TimeSelector.1a65a2e3.js";import{K as Ci}from"./KeyValueInput.cb1ae3e8.js";import{M as rt}from"./MultiLineInput.e27bc560.js";import{K as Z}from"./KeycloakTextInput.b4d5b2db.js";import{u as Jt,F as Ln}from"./useFormatDate.53169b6c.js";import{T as _n}from"./Trans.ec4d13b3.js";import{T as ue,a as Nn}from"./Text.c38ffb52.js";import{K as It,L as Ce,P as Tt}from"./KeycloakDataTable.4e517788.js";import{E as Dn}from"./ExpandableSection.ed768772.js";import{C as Ri,a as Ai}from"./ClientDescription.e967f34f.js";import{S as Oi}from"./SessionsTable.1482375a.js";import{P as Kt}from"./PasswordInput.34ff6dd3.js";import{C as bt}from"./Card.32e78d5f.js";import{C as We}from"./CardBody.a2e5e179.js";import{F as Un}from"./FileUpload.18e1e495.js";import{C as wi}from"./CardHeader.f162738f.js";import{C as Ei}from"./CardTitle.42e61ef4.js";import{A as Pi,D as Li,i as _i,U as Ni}from"./PolicyDetails.defea597.js";import{A as an,f as ln,g as Di,C as on,d as Ui,e as Ki}from"./ClientScopeTypes.9d1fc6d4.js";import{S as Mi,a as Fi,C as Bi,n as Vi,t as qi}from"./SearchFilter.f13d0406.js";import{u as Kn,m as Mn}from"./useLocaleSort.84ea7ec0.js";import{E as Fn,a as Bn}from"./EmptyStateBody.a0363fe4.js";import{d as lt,b as zi,T as ie,a as se}from"./Tabs.3d61d369.js";import{Q as ji}from"./question-circle-icon.c9ca7908.js";import{G as Gi,a as rn}from"./GridItem.0db472b0.js";import{R as Hi}from"./AddRoleMappingModal.4adc845a.js";import{d as Vn,i as gt,g as $i}from"./utils.988d95db.js";import{F as Wi,a as cn}from"./FlexItem.308d9f82.js";import{R as ut}from"./Radio.cfe305aa.js";import{F as Mt}from"./FormPanel.4ba67868.js";import{J as Ji}from"./JsonFileUpload.41ab83b4.js";import{a as Yi,b as Qi,c as Xi,D as nt}from"./DescriptionListTerm.60563b13.js";import{a as Ne,b as De,c as le,d as W,e as Ue,f as K,ai as it}from"./TableToolbar.c27bcd3c.js";import{D as Zi}from"./DeleteScopeDialog.f883bfb4.js";import{E as es}from"./EmptyStateSecondaryActions.1a804d56.js";import{P as qn}from"./plus-circle-icon.32cdf4dc.js";import{c as ts}from"./camelCase.2add9c33.js";import{M as ns}from"./minus-circle-icon.de526f05.js";import{C as is}from"./ClientSelect.a855e118.js";import{R as Rt,r as ht}from"./RoutableTabs.f3cff418.js";import{P as ss}from"./PermissionTab.13062542.js";import"./copy-icon.cf10e1f5.js";import"./check.51c67984.js";import"./star-icon.97692015.js";import"./Checkbox.2dc73ed3.js";import"./ListItem.f69883ba.js";import"./ResourcesPolicySelect.0de4bf6f.js";import"./filter-icon.fec9f70e.js";import"./GroupPickerDialog.f5430678.js";import"./DataListItemRow.8f458244.js";import"./data-list.f7ff2ea7.js";import"./grip-vertical-icon.1b75ab8f.js";import"./DatePicker.3081625b.js";import"./MenuList.288a98b4.js";import"./NumberInput.331c7b85.js";import"./plus-icon.407671b4.js";import"./CodeEditor.16ebafa0.js";import"./resource.df4d2bbd.js";import"./joinPath.69b856b1.js";import"./FileUploadForm.9e6f7b27.js";import"./capitalize.388ec7cb.js";const ft={codeBlock:"pf-c-code-block",codeBlockActions:"pf-c-code-block__actions",codeBlockCode:"pf-c-code-block__code",codeBlockContent:"pf-c-code-block__content",codeBlockHeader:"pf-c-code-block__header",codeBlockPre:"pf-c-code-block__pre"},zn=t=>{var{children:i=null,className:a,actions:n=null}=t,s=yt(t,["children","className","actions"]);return r("div",{...Object.assign({className:Fe(ft.codeBlock,a)},s),children:[e("div",{className:Fe(ft.codeBlockHeader),children:e("div",{className:Fe(ft.codeBlockActions),children:n&&n})}),e("div",{className:Fe(ft.codeBlockContent),children:i})]})};zn.displayName="CodeBlock";const jn=t=>{var{children:i=null,className:a}=t,n=yt(t,["children","className"]);return e("div",{...Object.assign({className:Fe("pf-c-code-block__actions-item",a)},n),children:i})};jn.displayName="CodeBlockAction";var Ft;(function(t){t.ul="ul",t.ol="ol",t.dl="dl"})(Ft||(Ft={}));const Gn=t=>{var{children:i=null,className:a="",component:n=Ft.ul}=t,s=yt(t,["children","className","component"]);return e(n,{...Object.assign({},s,{"data-pf-content":!0,className:Fe(a)}),children:i})};Gn.displayName="TextList";var Bt;(function(t){t.li="li",t.dt="dt",t.dd="dd"})(Bt||(Bt={}));const Hn=t=>{var{children:i=null,className:a="",component:n=Bt.li}=t,s=yt(t,["children","className","component"]);return e(n,{...Object.assign({},s,{"data-pf-content":!0,className:Fe(a)}),children:i})};Hn.displayName="TextListItem";const as=({id:t,open:i,toggleDialog:a,protocol:n="openid-connect"})=>{const{adminClient:s}=ne(),{realm:l}=pe(),{t:o}=L("common"),{enabled:c}=xn(),h=Ye().clientInstallations[n],[d,y]=u.exports.useState(h[h.length-1].id),[f,m]=u.exports.useState(),[S,x]=u.exports.useState(!1),T=u.exports.useMemo(()=>h.find(k=>k.id===d)??null,[d]),g=k=>k.replace(/<PrivateKeyPem>.*<\/PrivateKeyPem>/gs,`<PrivateKeyPem>${o("clients:privateKeyMask")}</PrivateKeyPem>`);return oe(async()=>{if(T?.mediaType==="application/zip")return(await fetch(`${ei(s.baseUrl)}admin/realms/${l}/clients/${t}/installation/providers/${d}`,{method:"GET",headers:ti(await s.getAccessToken())})).arrayBuffer();{const k=await s.clients.getInstallationProviders({id:t,providerId:d});return typeof k=="string"?g(k):He(k)}},k=>m(k),[t,d]),u.exports.useEffect(()=>m(""),[t,d]),e(Ht,{titleKey:o("clients:downloadAdaptorTitle"),continueButtonLabel:o("download"),onConfirm:()=>{Qe.saveAs(new Blob([f],{type:T?.mediaType}),T?.filename)},open:i,toggleDialog:a,variant:tt.medium,children:e(Se,{children:r(Ii,{hasGutter:!0,children:[c&&e(Ct,{children:e(qe,{id:t,title:o("clients:description"),variant:ee.info,isInline:!0,children:h.find(k=>k.id===d)?.helpText})}),e(Ct,{children:e(b,{fieldId:"type",label:o("clients:formatOption"),labelIcon:e(I,{helpText:o("clients-help:downloadType"),fieldLabelId:"clients:formatOption"}),children:e(X,{toggleId:"type",isOpen:S,onToggle:k=>x(k),variant:Q.single,value:d,selections:d,onSelect:(k,Y)=>{y(Y.toString()),x(!1)},"aria-label":"Select Input",menuAppendTo:()=>document.body,children:h.map(k=>e(V,{value:k.id,isSelected:d===k.id,children:k.displayType},k.id))})})}),!T?.downloadOnly&&e(Ct,{isFilled:!0,children:e(b,{fieldId:"details",label:o("details"),labelIcon:e(I,{helpText:o("clients-help:details"),fieldLabelId:"clients:details"}),children:e(et,{id:"details",readOnly:!0,rows:12,resizeOrientation:"vertical",value:f&&typeof f=="string"?f:"","aria-label":"text area example"})})})]})})})};function At(t){return(t||"").split("##")}function Ot(t){return t.join("##")}const dn="tokenLifespan.never",un="tokenLifespan.expires",ot=({id:t,name:i,defaultValue:a,control:n,units:s})=>{const{t:l}=L("clients"),[o,c]=u.exports.useState(!1),[p,h]=u.exports.useState(!1),d=()=>h(!0),y=()=>h(!1),f=m=>typeof m=="number"&&m!==-1||typeof m=="string"&&m!==""&&m!=="-1"||p;return e(b,{label:l(t),fieldId:t,labelIcon:e(I,{helpText:`clients-help:${t}`,fieldLabelId:`clients:${t}`}),children:e(M,{name:i,defaultValue:a,control:n,render:({onChange:m,value:S})=>r(Xe,{hasGutter:!0,children:[e(Te,{children:r(X,{variant:Q.single,onToggle:c,isOpen:o,onSelect:(x,T)=>{m(T),c(!1)},selections:[f(S)?l(un):l(dn)],children:[e(V,{value:-1,children:l(dn)}),e(V,{value:60,children:l(un)})]})}),e(Te,{children:f(S)&&e(Wt,{units:s,value:S,onChange:m,onFocus:d,onBlur:y,min:1})})]})})})},ls=({control:t,save:i,reset:a,protocol:n,hasConfigureAccess:s})=>{const{t:l}=L("clients"),[o,c]=u.exports.useState(!1);return r(re,{role:"manage-realm",fineGrainedAccess:s,isHorizontal:!0,children:[n!=="openid-connect"&&e(b,{label:l("assertionLifespan"),fieldId:"assertionLifespan",labelIcon:e(I,{helpText:"clients-help:assertionLifespan",fieldLabelId:"clients:assertionLifespan"}),children:e(M,{name:N("attributes.saml.assertion.lifespan"),defaultValue:"",control:t,render:({onChange:p,value:h})=>e(Wt,{units:["minute","day","hour"],value:h,onChange:p})})}),n==="openid-connect"&&r(j,{children:[e(ot,{id:"accessTokenLifespan",name:N("attributes.access.token.lifespan"),defaultValue:"",units:["minute","day","hour"],control:t}),e(ot,{id:"clientSessionIdle",name:N("attributes.client.session.idle.timeout"),defaultValue:"",units:["minute","day","hour"],control:t}),e(ot,{id:"clientSessionMax",name:N("attributes.client.session.max.lifespan"),defaultValue:"",units:["minute","day","hour"],control:t}),e(ot,{id:"clientOfflineSessionIdle",name:N("attributes.client.offline.session.idle.timeout"),defaultValue:"",units:["minute","day","hour"],control:t}),e(ot,{id:"clientOfflineSessionMax",name:N("attributes.client.offline.session.max.lifespan"),defaultValue:"",units:["minute","day","hour"],control:t}),e(b,{label:l("oAuthMutual"),fieldId:"oAuthMutual",hasNoPaddingTop:!0,labelIcon:e(I,{helpText:"clients-help:oAuthMutual",fieldLabelId:"clients:oAuthMutual"}),children:e(M,{name:"attributes.tls-client-certificate-bound-access-tokens",defaultValue:!1,control:t,render:({onChange:p,value:h})=>e(ce,{id:"oAuthMutual-switch",label:l("common:on"),labelOff:l("common:off"),isChecked:h==="true",onChange:d=>p(""+d),"aria-label":l("oAuthMutual")})})}),e(b,{label:l("keyForCodeExchange"),fieldId:"keyForCodeExchange",hasNoPaddingTop:!0,labelIcon:e(I,{helpText:"clients-help:keyForCodeExchange",fieldLabelId:"clients:keyForCodeExchange"}),children:e(M,{name:N("attributes.pkce.code.challenge.method"),defaultValue:"",control:t,render:({onChange:p,value:h})=>e(X,{toggleId:"keyForCodeExchange",variant:Q.single,onToggle:c,isOpen:o,onSelect:(d,y)=>{p(y),c(!1)},selections:[h||l("common:choose")],children:["","S256","plain"].map(d=>e(V,{value:d,children:d||l("common:choose")},d))})})}),e(b,{label:l("pushedAuthorizationRequestRequired"),fieldId:"pushedAuthorizationRequestRequired",labelIcon:e(I,{helpText:"clients-help:pushedAuthorizationRequestRequired",fieldLabelId:"clients:pushedAuthorizationRequestRequired"}),children:e(M,{name:N("attributes.require.pushed.authorization.requests"),defaultValue:"false",control:t,render:({onChange:p,value:h})=>e(ce,{id:"pushedAuthorizationRequestRequired",label:l("common:on"),labelOff:l("common:off"),isChecked:h==="true",onChange:d=>p(d.toString()),"aria-label":l("pushedAuthorizationRequestRequired")})})}),e(b,{label:l("acrToLoAMapping"),fieldId:"acrToLoAMapping",labelIcon:e(I,{helpText:"clients-help:acrToLoAMapping",fieldLabelId:"clients:acrToLoAMapping"}),children:e(Ci,{name:N("attributes.acr.loa.map")})}),e(b,{label:l("defaultACRValues"),fieldId:"defaultACRValues",labelIcon:e(I,{helpText:"clients-help:defaultACRValues",fieldLabelId:"clients:defaultACRValues"}),children:e(rt,{name:N("attributes.default.acr.values")})})]}),r(be,{children:[e(D,{variant:"secondary",onClick:i,"data-testid":"OIDCAdvancedSave",children:l("common:save")}),e(D,{variant:"link",onClick:a,"data-testid":"OIDCAdvancedRevert",children:l("common:revert")})]})]})},os=({protocol:t,control:i,save:a,reset:n,hasConfigureAccess:s})=>{const{adminClient:l}=ne(),{t:o}=L("clients"),[c,p]=u.exports.useState([]),[h,d]=u.exports.useState(!1),[y,f]=u.exports.useState(!1);return oe(()=>l.authenticationManagement.getFlows(),m=>{let S=[...m.filter(x=>x.providerId!=="client-flow")];S=kn(S,[x=>x.alias]),p([e(V,{value:"",children:o("common:choose")},"empty"),...S.map(x=>e(V,{value:x.id,children:x.alias},x.id))])},[]),r(re,{role:"manage-clients",fineGrainedAccess:s,isHorizontal:!0,children:[e(b,{label:o("browserFlow"),fieldId:"browserFlow",labelIcon:e(I,{helpText:"clients-help:browserFlow",fieldLabelId:"clients:browserFlow"}),children:e(M,{name:"authenticationFlowBindingOverrides.browser",defaultValue:"",control:i,render:({onChange:m,value:S})=>e(X,{toggleId:"browserFlow",variant:Q.single,onToggle:d,isOpen:h,onSelect:(x,T)=>{m(T),d(!1)},selections:[S],children:c})})}),t==="openid-connect"&&e(b,{label:o("directGrant"),fieldId:"directGrant",labelIcon:e(I,{helpText:"clients-help:directGrant",fieldLabelId:"clients:directGrant"}),children:e(M,{name:"authenticationFlowBindingOverrides.direct_grant",defaultValue:"",control:i,render:({onChange:m,value:S})=>e(X,{toggleId:"directGrant",variant:Q.single,onToggle:f,isOpen:y,onSelect:(x,T)=>{m(T),f(!1)},selections:[S],children:c})})}),r(be,{children:[e(D,{variant:"secondary",onClick:a,"data-testid":"OIDCAuthFlowOverrideSave",children:o("common:save")}),e(D,{variant:"link",onClick:n,"data-testid":"OIDCAuthFlowOverrideRevert",children:o("common:revert")})]})]})},$n=()=>{const{t}=L("clients"),{register:i}=ae();return r(j,{children:[e(b,{label:t("logoUrl"),fieldId:"logoUrl",labelIcon:e(I,{helpText:"clients-help:logoUrl",fieldLabelId:"clients:logoUrl"}),children:e(Z,{type:"text",id:"logoUrl",name:N("attributes.logoUri"),"data-testid":"logoUrl",ref:i})}),e(b,{label:t("policyUrl"),fieldId:"policyUrl",labelIcon:e(I,{helpText:"clients-help:policyUrl",fieldLabelId:"clients:policyUrl"}),children:e(Z,{type:"text",id:"policyUrl",name:N("attributes.policyUri"),"data-testid":"policyUrl",ref:i})}),e(b,{label:t("termsOfServiceUrl"),fieldId:"termsOfServiceUrl",labelIcon:e(I,{helpText:"clients-help:termsOfServiceUrl",fieldLabelId:"clients:termsOfServiceUrl"}),children:e(Z,{type:"text",id:"termsOfServiceUrl",name:N("attributes.tosUri"),"data-testid":"termsOfServiceUrl",ref:i})})]})},rs=({save:t,reset:i,hasConfigureAccess:a})=>{const{t:n}=L("clients"),s=Ye().providers,l=s?.clientSignature.providers,o=s?.contentencryption.providers,c=s?.cekmanagement.providers,p=s?.signature.providers,[h,d]=u.exports.useState(!1),[y,f]=u.exports.useState(!1),[m,S]=u.exports.useState(!1),[x,T]=u.exports.useState(!1),[g,k]=u.exports.useState(!1),[Y,J]=u.exports.useState(!1),[_,G]=u.exports.useState(!1),[q,A]=u.exports.useState(!1),[B,U]=u.exports.useState(!1),[z,C]=u.exports.useState(!1),[v,P]=u.exports.useState(!1),[E,O]=u.exports.useState(!1),{control:w}=ae(),H=[e(V,{value:"",children:n("common:choose")},"empty"),...Ae(l).map(R=>e(V,{value:R},R))],he=[e(V,{value:"",children:n("common:choose")},"empty"),...Ae(c).map(R=>e(V,{value:R},R))],Re=[e(V,{value:"",children:n("unsigned")},"unsigned"),...Ae(p).map(R=>e(V,{value:R},R))],ke=[e(V,{value:"",children:n("common:choose")},"empty"),...Ae(o).map(R=>e(V,{value:R},R))],Ke=[e(V,{value:"any",children:n("common:any")},"any"),e(V,{value:"none",children:n("common:none")},"none"),...Ae(l).map(R=>e(V,{value:R},R))],je=[e(V,{value:"any",children:n("common:any")},"any"),...Ae(c).map(R=>e(V,{value:R},R))],Ge=[e(V,{value:"any",children:n("common:any")},"any"),...Ae(o).map(R=>e(V,{value:R},R))],Me=[e(V,{value:"",children:n("common:choose")},"empty"),...Ae(p).map(R=>e(V,{value:R},R))],st=["not required","request or request_uri","request only","request_uri only"].map(R=>e(V,{value:R,children:n(`requestObject.${R}`)},R));return r(re,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e($n,{}),e(b,{label:n("accessTokenSignatureAlgorithm"),fieldId:"accessTokenSignatureAlgorithm",labelIcon:e(I,{helpText:"clients-help:accessTokenSignatureAlgorithm",fieldLabelId:"clients:accessTokenSignatureAlgorithm"}),children:e(M,{name:N("attributes.access.token.signed.response.alg"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"accessTokenSignatureAlgorithm",variant:Q.single,onToggle:d,isOpen:h,onSelect:(te,$)=>{R($),d(!1)},selections:F,children:H})})}),e(b,{label:n("idTokenSignatureAlgorithm"),fieldId:"kc-id-token-signature",labelIcon:e(I,{helpText:"clients-help:idTokenSignatureAlgorithm",fieldLabelId:"clients:idTokenSignatureAlgorithm"}),children:e(M,{name:N("attributes.id.token.signed.response.alg"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"idTokenSignatureAlgorithm",variant:Q.single,onToggle:f,isOpen:y,onSelect:(te,$)=>{R($),f(!1)},selections:F,children:H})})}),e(b,{label:n("idTokenEncryptionKeyManagementAlgorithm"),fieldId:"idTokenEncryptionKeyManagementAlgorithm",labelIcon:e(I,{helpText:"clients-help:idTokenEncryptionKeyManagementAlgorithm",fieldLabelId:"clients:idTokenEncryptionKeyManagementAlgorithm"}),children:e(M,{name:N("attributes.id.token.encrypted.response.alg"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"idTokenEncryptionKeyManagementAlgorithm",variant:Q.single,onToggle:S,isOpen:m,onSelect:(te,$)=>{R($),S(!1)},selections:F,children:he})})}),e(b,{label:n("idTokenEncryptionContentEncryptionAlgorithm"),fieldId:"idTokenEncryptionContentEncryptionAlgorithm",labelIcon:e(I,{helpText:"clients-help:idTokenEncryptionContentEncryptionAlgorithm",fieldLabelId:"clients:idTokenEncryptionContentEncryptionAlgorithm"}),children:e(M,{name:N("attributes.id.token.encrypted.response.enc"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"idTokenEncryptionContentEncryptionAlgorithm",variant:Q.single,onToggle:T,isOpen:x,onSelect:(te,$)=>{R($),T(!1)},selections:F,children:ke})})}),e(b,{label:n("userInfoSignedResponseAlgorithm"),fieldId:"userInfoSignedResponseAlgorithm",labelIcon:e(I,{helpText:"clients-help:userInfoSignedResponseAlgorithm",fieldLabelId:"clients:userInfoSignedResponseAlgorithm"}),children:e(M,{name:N("attributes.user.info.response.signature.alg"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"userInfoSignedResponseAlgorithm",variant:Q.single,onToggle:k,isOpen:g,onSelect:(te,$)=>{R($),k(!1)},selections:F,children:Re})})}),e(b,{label:n("requestObjectSignatureAlgorithm"),fieldId:"requestObjectSignatureAlgorithm",labelIcon:e(I,{helpText:"clients-help:requestObjectSignatureAlgorithm",fieldLabelId:"clients:requestObjectSignatureAlgorithm"}),children:e(M,{name:N("attributes.request.object.signature.alg"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"requestObjectSignatureAlgorithm",variant:Q.single,onToggle:J,isOpen:Y,onSelect:(te,$)=>{R($),J(!1)},selections:F,children:Ke})})}),e(b,{label:n("requestObjectEncryption"),fieldId:"requestObjectEncryption",labelIcon:e(I,{helpText:"clients-help:requestObjectEncryption",fieldLabelId:"clients:requestObjectEncryption"}),children:e(M,{name:N("attributes.request.object.encryption.alg"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"requestObjectEncryption",variant:Q.single,onToggle:A,isOpen:q,onSelect:(te,$)=>{R($),A(!1)},selections:F,children:je})})}),e(b,{label:n("requestObjectEncoding"),fieldId:"requestObjectEncoding",labelIcon:e(I,{helpText:"clients-help:requestObjectEncoding",fieldLabelId:"clients:requestObjectEncoding"}),children:e(M,{name:N("attributes.request.object.encryption.enc"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"requestObjectEncoding",variant:Q.single,onToggle:U,isOpen:B,onSelect:(te,$)=>{R($),U(!1)},selections:F,children:Ge})})}),e(b,{label:n("requestObjectRequired"),fieldId:"requestObjectRequired",labelIcon:e(I,{helpText:"clients-help:requestObjectRequired",fieldLabelId:"clients:requestObjectRequired"}),children:e(M,{name:N("attributes.request.object.required"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"requestObjectRequired",variant:Q.single,onToggle:G,isOpen:_,onSelect:(te,$)=>{R($),G(!1)},selections:F,children:st})})}),e(b,{label:n("validRequestURIs"),fieldId:"validRequestURIs",labelIcon:e(I,{helpText:"clients-help:validRequestURIs",fieldLabelId:"clients:validRequestURIs"}),children:e(rt,{name:N("attributes.request.uris"),"aria-label":n("validRequestURIs"),addButtonLabel:"clients:addRequestUri"})}),e(b,{label:n("authorizationSignedResponseAlg"),fieldId:"authorizationSignedResponseAlg",labelIcon:e(I,{helpText:"clients-help:authorizationSignedResponseAlg",fieldLabelId:"clients:authorizationSignedResponseAlg"}),children:e(M,{name:N("attributes.authorization.signed.response.alg"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"authorizationSignedResponseAlg",variant:Q.single,onToggle:C,isOpen:z,onSelect:(te,$)=>{R($),C(!1)},selections:F,children:Me})})}),e(b,{label:n("authorizationEncryptedResponseAlg"),fieldId:"authorizationEncryptedResponseAlg",labelIcon:e(I,{helpText:"clients-help:authorizationEncryptedResponseAlg",fieldLabelId:"clients:authorizationEncryptedResponseAlg"}),children:e(M,{name:N("attributes.authorization.encrypted.response.alg"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"authorizationEncryptedResponseAlg",variant:Q.single,onToggle:P,isOpen:v,onSelect:(te,$)=>{R($),P(!1)},selections:F,children:he})})}),e(b,{label:n("authorizationEncryptedResponseEnc"),fieldId:"authorizationEncryptedResponseEnc",labelIcon:e(I,{helpText:"clients-help:authorizationEncryptedResponseEnc",fieldLabelId:"clients:authorizationEncryptedResponseEnc"}),children:e(M,{name:N("attributes.authorization.encrypted.response.enc"),defaultValue:"",control:w,render:({onChange:R,value:F})=>e(X,{toggleId:"authorizationEncryptedResponseEnc",variant:Q.single,onToggle:O,isOpen:E,onSelect:(te,$)=>{R($),O(!1)},selections:F,children:ke})})}),r(be,{children:[e(D,{variant:"secondary",id:"fineGrainSave",onClick:t,children:n("common:save")}),e(D,{id:"fineGrainRevert",variant:"link",onClick:i,children:n("common:revert")})]})]})},cs=({control:{register:t},save:i,reset:a})=>{const{t:n}=L("clients");return r(re,{role:"manage-realm",isHorizontal:!0,children:[e($n,{}),e(b,{label:n("assertionConsumerServicePostBindingURL"),fieldId:"assertionConsumerServicePostBindingURL",labelIcon:e(I,{helpText:"clients-help:assertionConsumerServicePostBindingURL",fieldLabelId:"clients:assertionConsumerServicePostBindingURL"}),children:e(Z,{ref:t(),type:"text",id:"assertionConsumerServicePostBindingURL",name:"attributes.saml_assertion_consumer_url_post"})}),e(b,{label:n("assertionConsumerServiceRedirectBindingURL"),fieldId:"assertionConsumerServiceRedirectBindingURL",labelIcon:e(I,{helpText:"clients-help:assertionConsumerServiceRedirectBindingURL",fieldLabelId:"clients:assertionConsumerServiceRedirectBindingURL"}),children:e(Z,{ref:t(),type:"text",id:"assertionConsumerServiceRedirectBindingURL",name:"attributes.saml_assertion_consumer_url_redirect"})}),e(b,{label:n("logoutServicePostBindingURL"),fieldId:"logoutServicePostBindingURL",labelIcon:e(I,{helpText:"clients-help:logoutServicePostBindingURL",fieldLabelId:"clients:logoutServicePostBindingURL"}),children:e(Z,{ref:t(),type:"text",id:"logoutServicePostBindingURL",name:"attributes.saml_single_logout_service_url_post"})}),e(b,{label:n("logoutServiceRedirectBindingURL"),fieldId:"logoutServiceRedirectBindingURL",labelIcon:e(I,{helpText:"clients-help:logoutServiceRedirectBindingURL",fieldLabelId:"clients:logoutServiceRedirectBindingURL"}),children:e(Z,{ref:t(),type:"text",id:"logoutServiceRedirectBindingURL",name:"attributes.saml_single_logout_service_url_redirect"})}),e(b,{label:n("logoutServiceArtifactBindingUrl"),fieldId:"logoutServiceArtifactBindingUrl",labelIcon:e(I,{helpText:"clients-help:logoutServiceArtifactBindingUrl",fieldLabelId:"clients:logoutServiceArtifactBindingUrl"}),children:e(Z,{ref:t(),type:"text",id:"logoutServiceArtifactBindingUrl",name:"attributes.saml_single_logout_service_url_artifact"})}),e(b,{label:n("artifactBindingUrl"),fieldId:"artifactBindingUrl",labelIcon:e(I,{helpText:"clients-help:artifactBindingUrl",fieldLabelId:"clients:artifactBindingUrl"}),children:e(Z,{ref:t(),type:"text",id:"artifactBindingUrl",name:"attributes.saml_artifact_binding_url"})}),e(b,{label:n("artifactResolutionService"),fieldId:"artifactResolutionService",labelIcon:e(I,{helpText:"clients-help:artifactResolutionService",fieldLabelId:"clients:artifactResolutionService"}),children:e(Z,{ref:t(),type:"text",id:"artifactResolutionService",name:"attributes.saml_artifact_resolution_service_url"})}),r(be,{children:[e(D,{variant:"tertiary",onClick:i,children:n("common:save")}),e(D,{variant:"link",onClick:a,children:n("common:revert")})]})]})},ds=({control:t,save:i,reset:a,hasConfigureAccess:n})=>{const{t:s}=L("clients");return r(re,{role:"manage-realm",fineGrainedAccess:n,isHorizontal:!0,children:[e(b,{label:s("excludeSessionStateFromAuthenticationResponse"),fieldId:"excludeSessionStateFromAuthenticationResponse",hasNoPaddingTop:!0,labelIcon:e(I,{helpText:"clients-help:excludeSessionStateFromAuthenticationResponse",fieldLabelId:"clients:excludeSessionStateFromAuthenticationResponse"}),children:e(M,{name:N("attributes.exclude.session.state.from.auth.response"),defaultValue:"",control:t,render:({onChange:l,value:o})=>e(ce,{id:"excludeSessionStateFromAuthenticationResponse-switch",label:s("common:on"),labelOff:s("common:off"),isChecked:o==="true",onChange:c=>l(c.toString()),"aria-label":s("excludeSessionStateFromAuthenticationResponse")})})}),e(b,{label:s("useRefreshTokens"),fieldId:"useRefreshTokens",hasNoPaddingTop:!0,labelIcon:e(I,{helpText:"clients-help:useRefreshTokens",fieldLabelId:"clients:useRefreshTokens"}),children:e(M,{name:N("attributes.use.refresh.tokens"),defaultValue:"true",control:t,render:({onChange:l,value:o})=>e(ce,{id:"useRefreshTokens",label:s("common:on"),labelOff:s("common:off"),isChecked:o==="true",onChange:c=>l(c.toString()),"aria-label":s("useRefreshTokens")})})}),e(b,{label:s("useRefreshTokenForClientCredentialsGrant"),fieldId:"useRefreshTokenForClientCredentialsGrant",hasNoPaddingTop:!0,labelIcon:e(I,{helpText:"clients-help:useRefreshTokenForClientCredentialsGrant",fieldLabelId:"clients:useRefreshTokenForClientCredentialsGrant"}),children:e(M,{name:N("attributes.client_credentials.use_refresh_token"),defaultValue:"false",control:t,render:({onChange:l,value:o})=>e(ce,{id:"useRefreshTokenForClientCredentialsGrant",label:s("common:on"),labelOff:s("common:off"),isChecked:o==="true",onChange:c=>l(c.toString()),"aria-label":s("useRefreshTokenForClientCredentialsGrant")})})}),e(b,{label:s("useLowerCaseBearerType"),fieldId:"useLowerCaseBearerType",hasNoPaddingTop:!0,labelIcon:e(I,{helpText:"clients-help:useLowerCaseBearerType",fieldLabelId:"clients:useLowerCaseBearerType"}),children:e(M,{name:N("attributes.token.response.type.bearer.lower-case"),defaultValue:"false",control:t,render:({onChange:l,value:o})=>e(ce,{id:"useLowerCaseBearerType",label:s("common:on"),labelOff:s("common:off"),isChecked:o==="true",onChange:c=>l(c.toString()),"aria-label":s("useLowerCaseBearerType")})})}),r(be,{children:[e(D,{variant:"secondary",onClick:i,"data-testid":"OIDCCompatabilitySave",children:s("common:save")}),e(D,{variant:"link",onClick:a,"data-testid":"OIDCCompatabilityRevert",children:s("common:revert")})]})]})},us=({save:t,client:{id:i,adminUrl:a,access:n}})=>{const s="notBefore",l=u.exports.useRef(),{t:o}=L("clients"),{adminClient:c}=ne(),{realm:p}=pe(),{addAlert:h}=de(),d=Jt(),{getValues:y,setValue:f,register:m}=ae(),S=(g,k)=>{f(s,g),t({messageKey:k})};u.exports.useEffect(()=>{m(s)},[m]);const x=()=>{const g=y(s);return g>0?d(new Date(g*1e3),Ln):o("common:none")},T=async()=>{const g=await c.clients.pushRevocation({id:i});Wn(g,"notBeforePush",h,o)};return r(j,{children:[e(ue,{className:"pf-u-pb-lg",children:r(_n,{i18nKey:"clients-help:notBeforeIntro",children:["In order to successfully push setup url on",e(fe,{to:Cn({realm:p,clientId:i,tab:"settings"}),children:o("settings")}),"tab"]})}),r(re,{role:"manage-clients",fineGrainedAccess:n?.configure,isHorizontal:!0,children:[e(b,{label:o("notBefore"),fieldId:"kc-not-before",labelIcon:e(I,{helpText:"clients-help:notBefore",fieldLabelId:"clients:notBefore"}),children:r(Vt,{children:[e(Z,{type:"text",id:"kc-not-before",name:"notBefore",isReadOnly:!0,value:x()}),e(D,{id:"setToNow",variant:"control",onClick:()=>{S(Date.now()/1e3,"notBeforeSetToNow")},children:o("setToNow")}),e(D,{id:"clear",variant:"control",onClick:()=>{S(0,"notBeforeNowClear")},children:o("clear")})]})}),r(be,{children:[!a&&e(qt,{reference:l,content:o("clients-help:notBeforeTooltip")}),e(D,{id:"push",variant:"secondary",onClick:T,isAriaDisabled:!a,ref:l,children:o("push")})]})]})]})},ps=({clientId:t,isOpen:i,onAdded:a,onClose:n})=>{const{t:s}=L("clients"),{register:l,getValues:o}=Ee(),{adminClient:c}=ne(),{addAlert:p,addError:h}=de();return e(_e,{title:s("addNode"),isOpen:i,onClose:n,variant:"small",actions:[e(D,{id:"add-node-confirm",onClick:async()=>{try{const d=o("node");await c.clients.addClusterNode({id:t,node:d}),a(d),p(s("addedNodeSuccess"),ee.success)}catch(d){h("clients:addedNodeFail",d)}n()},children:s("common:save")},"confirm"),e(D,{id:"add-node-cancel",variant:ye.link,onClick:()=>n(),children:s("common:cancel")},"cancel")],children:e(Se,{isHorizontal:!0,children:e(b,{label:s("nodeHost"),fieldId:"nodeHost",children:e(Z,{id:"nodeHost",ref:l,name:"node"})})})})},ms=({save:t,client:{id:i,registeredNodes:a,access:n}})=>{const{t:s}=L("clients"),{control:l}=ae(),{adminClient:o}=ne(),{addAlert:c,addError:p}=de(),h=Jt(),[d,y]=u.exports.useState(a||{}),[f,m]=u.exports.useState(!1),[S,x]=u.exports.useState(""),[T,g]=u.exports.useState(!1),[k,Y]=u.exports.useState(0),J=()=>Y(new Date().getTime()),_=async()=>{const A=await o.clients.testNodesAvailable({id:i});Wn(A,"testCluster",c,s)},[G,q]=xe({titleKey:"clients:deleteNode",messageKey:s("deleteNodeBody",{node:S}),continueButtonLabel:"common:delete",continueButtonVariant:ye.danger,onConfirm:async()=>{try{await o.clients.deleteClusterNode({id:i,node:S}),y({...Object.keys(d).reduce((A,B)=>(B!==S&&(A[B]=d[B]),A),{})}),J(),c(s("deleteNodeSuccess"),ee.success)}catch(A){p("clients:deleteNodeFail",A)}}});return r(j,{children:[e(re,{role:"manage-clients",fineGrainedAccess:n?.configure,isHorizontal:!0,children:e(b,{label:s("nodeReRegistrationTimeout"),fieldId:"kc-node-reregistration-timeout",labelIcon:e(I,{helpText:"clients-help:nodeReRegistrationTimeout",fieldLabelId:"clients:nodeReRegistrationTimeout"}),children:r(Xe,{hasGutter:!0,children:[e(Te,{children:e(M,{name:"nodeReRegistrationTimeout",defaultValue:"",control:l,render:({onChange:A,value:B})=>e(Wt,{value:B,onChange:A})})}),e(Te,{children:e(D,{variant:ye.secondary,onClick:()=>t(),children:s("common:save")})})]})})}),r(j,{children:[e(q,{}),e(ps,{clientId:i,isOpen:T,onAdded:A=>{d[A]=Date.now()/1e3,J()},onClose:()=>g(!1)}),e(Dn,{toggleText:s("registeredClusterNodes"),onToggle:m,isExpanded:f,children:e(It,{ariaLabelKey:"registeredClusterNodes",loader:()=>Promise.resolve(Object.entries(d||{}).map(A=>({host:A[0],registration:A[1]}))),toolbarItem:r(j,{children:[e(ge,{children:e(D,{id:"testClusterAvailability",onClick:_,variant:ye.secondary,isDisabled:Object.keys(d).length===0,children:s("testClusterAvailability")})}),e(ge,{children:e(D,{id:"registerNodeManually",onClick:()=>g(!0),variant:ye.tertiary,children:s("registerNodeManually")})})]}),actions:[{title:s("common:delete"),onRowClick:A=>{x(A.host),G()}}],columns:[{name:"host",displayKey:"clients:nodeHost"},{name:"registration",displayKey:"clients:lastRegistration",cellFormatters:[A=>A?h(new Date(parseInt(A.toString())*1e3),Ln):""]}],emptyState:e(Ce,{message:s("noNodes"),instructions:s("noNodesInstructions"),primaryActionText:s("registerNodeManually"),onPrimaryAction:()=>g(!0)})},k)})]})]})},Wn=(t,i,a,n)=>{const s=t.successRequests?.length||0,l=t.failedRequests?.length||0;s===0&&l===0?a(n("noAdminUrlSet"),ee.warning):l>0?(a(n(i+"Success",{successNodes:t.successRequests}),ee.success),a(n(i+"Fail",{failedNodes:t.failedRequests}),ee.danger)):a(n(i+"Success",{successNodes:t.successRequests}),ee.success)},hs=({save:t,client:i})=>{const{t:a}=L("clients"),n="openid-connect",{setValue:s,control:l}=ae(),{publicClient:o,attributes:c,protocol:p,authenticationFlowBindingOverrides:h}=i,d=y=>{for(const f of y)s(N(`attributes.${f}`),c?.[f]||"")};return e(me,{variant:"light",className:"pf-u-py-0",children:e(Pn,{sections:[{title:a("revocation"),isHidden:p!==n,panel:e(us,{client:i,save:t})},{title:a("clustering"),isHidden:!o,panel:e(ms,{client:i,save:t})},{title:a("fineGrainOpenIdConnectConfiguration"),isHidden:p!==n,panel:r(j,{children:[e(ue,{className:"pf-u-pb-lg",children:a("clients-help:fineGrainOpenIdConnectConfiguration")}),e(rs,{save:t,reset:()=>{d(["logoUri","policyUri","tosUri","access.token.signed.response.alg","id.token.signed.response.alg","id.token.encrypted.response.alg","id.token.encrypted.response.enc","user.info.response.signature.alg","request.object.signature.alg","request.object.encryption.alg","request.object.encryption.enc","request.object.required","request.uris","authorization.encrypted.response.alg","authorization.encrypted.response.enc"])}})]})},{title:a("openIdConnectCompatibilityModes"),isHidden:p!==n,panel:r(j,{children:[e(ue,{className:"pf-u-pb-lg",children:a("clients-help:openIdConnectCompatibilityModes")}),e(ds,{control:l,save:()=>t(),reset:()=>d(["exclude.session.state.from.auth.response"])})]})},{title:a("fineGrainSamlEndpointConfig"),isHidden:p===n,panel:r(j,{children:[e(ue,{className:"pf-u-pb-lg",children:a("clients-help:fineGrainSamlEndpointConfig")}),e(cs,{control:l,save:()=>t(),reset:()=>d(["logoUri","policyUri","tosUri","saml_assertion_consumer_url_post","saml_assertion_consumer_url_redirect","saml_single_logout_service_url_post","saml_single_logout_service_url_redirect","saml_single_logout_service_url_artifact","saml_artifact_binding_url","saml_artifact_resolution_service_url"])})]})},{title:a("advancedSettings"),panel:r(j,{children:[e(ue,{className:"pf-u-pb-lg",children:a("clients-help:advancedSettings"+St(p||""))}),e(ls,{protocol:p,control:l,save:()=>t(),reset:()=>{d(["saml.assertion.lifespan","access.token.lifespan","tls.client.certificate.bound.access.tokens","pkce.code.challenge.method"])}})]})},{title:a("authenticationOverrides"),panel:r(j,{children:[e(ue,{className:"pf-u-pb-lg",children:a("clients-help:authenticationOverrides")}),e(os,{protocol:p,control:l,save:()=>t(),reset:()=>{s("authenticationFlowBindingOverrides.browser",h?.browser),s("authenticationFlowBindingOverrides.direct_grant",h?.direct_grant)}})]})}],borders:!0})})},Pe=({name:t,label:i})=>{const{t:a}=L("clients"),{control:n}=ae();return e(b,{hasNoPaddingTop:!0,label:a(i),fieldId:i,labelIcon:e(I,{helpText:a(`clients-help:${i}`),fieldLabelId:`clients:${i}`}),children:e(M,{name:t,defaultValue:"false",control:n,render:({onChange:s,value:l})=>e(ce,{id:t,"data-testid":i,label:a("common:on"),labelOff:a("common:off"),isChecked:l==="true",onChange:o=>s(o.toString()),"aria-label":a(i)})})})},fs=()=>{const{t}=L("clients"),{control:i}=ae(),[a,n]=u.exports.useState(!1);return r(re,{isHorizontal:!0,role:"manage-clients",className:"keycloak__capability-config__form",children:[e(b,{label:t("nameIdFormat"),fieldId:"nameIdFormat",labelIcon:e(I,{helpText:"clients-help:nameIdFormat",fieldLabelId:"clients:nameIdFormat"}),children:e(M,{name:"attributes.saml_name_id_format",defaultValue:"username",control:i,render:({onChange:s,value:l})=>e(X,{toggleId:"samlNameIdFormat",onToggle:n,onSelect:(o,c)=>{s(c.toString()),n(!1)},selections:l,variant:Q.single,"aria-label":t("nameIdFormat"),isOpen:a,children:["username","email","transient","persistent"].map(o=>e(V,{selected:o===l,value:o},o))})})}),e(Pe,{name:N("attributes.saml.force.name.id.format"),label:"forceNameIdFormat"}),e(Pe,{name:N("attributes.saml.force.post.binding"),label:"forcePostBinding"}),e(Pe,{name:N("attributes.saml.artifact.binding"),label:"forceArtifactBinding"}),e(Pe,{name:N("attributes.saml.authnstatement"),label:"includeAuthnStatement"}),e(Pe,{name:N("attributes.saml.onetimeuse.condition"),label:"includeOneTimeUseCondition"}),e(Pe,{name:N("attributes.saml.server.signature.keyinfo.ext"),label:"optimizeLookup"})]})},pn=["RSA_SHA1","RSA_SHA256","RSA_SHA256_MGF1","RSA_SHA512","RSA_SHA512_MGF1","DSA_SHA1"],mn=["NONE","KEY_ID","CERT_SUBJECT"],wt=[{name:"EXCLUSIVE",value:"http://www.w3.org/2001/10/xml-exc-c14n#"},{name:"EXCLUSIVE_WITH_COMMENTS",value:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments"},{name:"INCLUSIVE",value:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315"},{name:"INCLUSIVE_WITH_COMMENTS",value:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments"}],gs=()=>{const{t}=L("clients"),[i,a]=u.exports.useState(!1),[n,s]=u.exports.useState(!1),[l,o]=u.exports.useState(!1),{control:c,watch:p}=ae(),h=p(N("attributes.saml.server.signature")),d=p(N("attributes.saml.assertion.signature"));return r(re,{isHorizontal:!0,role:"manage-clients",className:"keycloak__capability-config__form",children:[e(Pe,{name:N("attributes.saml.server.signature"),label:"signDocuments"}),e(Pe,{name:N("attributes.saml.assertion.signature"),label:"signAssertions"}),(h==="true"||d==="true")&&r(j,{children:[e(b,{label:t("signatureAlgorithm"),fieldId:"signatureAlgorithm",labelIcon:e(I,{helpText:"clients-help:signatureAlgorithm",fieldLabelId:"clients:signatureAlgorithm"}),children:e(M,{name:N("attributes.saml.signature.algorithm"),defaultValue:pn[0],Key:!0,control:c,render:({onChange:y,value:f})=>e(X,{toggleId:"signatureAlgorithm",onToggle:a,onSelect:(m,S)=>{y(S.toString()),a(!1)},selections:f,variant:Q.single,"aria-label":t("signatureAlgorithm"),isOpen:i,children:pn.map(m=>e(V,{selected:m===f,value:m},m))})})}),e(b,{label:t("signatureKeyName"),fieldId:"signatureKeyName",labelIcon:e(I,{helpText:"clients-help:signatureKeyName",fieldLabelId:"clients:signatureKeyName"}),children:e(M,{name:N("attributes.saml.server.signature.keyinfo$xmlSigKeyInfoKeyNameTransformer"),defaultValue:mn[0],control:c,render:({onChange:y,value:f})=>e(X,{toggleId:"signatureKeyName",onToggle:s,onSelect:(m,S)=>{y(S.toString()),s(!1)},selections:f,variant:Q.single,"aria-label":t("signatureKeyName"),isOpen:n,children:mn.map(m=>e(V,{selected:m===f,value:m},m))})})}),e(b,{label:t("canonicalization"),fieldId:"canonicalization",labelIcon:e(I,{helpText:"clients-help:canonicalization",fieldLabelId:"clients:canonicalization"}),children:e(M,{name:"attributes.saml_signature_canonicalization_method",defaultValue:wt[0].value,control:c,render:({onChange:y,value:f})=>e(X,{toggleId:"canonicalization",onToggle:o,onSelect:(m,S)=>{y(S.toString()),o(!1)},selections:wt.find(m=>m.value===f)?.name,variant:Q.single,"aria-label":t("canonicalization"),isOpen:l,children:wt.map(m=>e(V,{selected:m.value===f,value:m.value,children:m.name},m.name))})})})]})]})},Yt=({name:t,save:i,reset:a,isActive:n=!0,...s})=>{const{t:l}=L("common");return r(be,{...s,children:[e(D,{isDisabled:!n,"data-testid":t+"Save",onClick:i,children:l("save")}),e(D,{isDisabled:!n,"data-testid":t+"Revert",variant:"link",onClick:a,children:l("revert")})]})},bs=({client:t,save:i,reset:a})=>{const{t:n}=L("clients"),{register:s,watch:l}=ae(),{realm:o}=pe(),{hasAccess:c}=ze(),p=c("manage-clients")||t.access?.configure,h=l("protocol"),d=l("attributes.saml_idp_initiated_sso_url_name");return r(re,{isHorizontal:!0,fineGrainedAccess:t.access?.configure,role:"manage-clients",children:[!t.bearerOnly&&r(j,{children:[e(b,{label:n("rootUrl"),fieldId:"kc-root-url",labelIcon:e(I,{helpText:"clients-help:rootURL",fieldLabelId:"clients:rootUrl"}),children:e(Z,{type:"text",id:"kc-root-url",name:"rootUrl",ref:s})}),e(b,{label:n("homeURL"),fieldId:"kc-home-url",labelIcon:e(I,{helpText:"clients-help:homeURL",fieldLabelId:"clients:homeURL"}),children:e(Z,{type:"text",id:"kc-home-url",name:"baseUrl",ref:s})}),e(b,{label:n("validRedirectUri"),fieldId:"kc-redirect",labelIcon:e(I,{helpText:"clients-help:validRedirectURIs",fieldLabelId:"clients:validRedirectUri"}),children:e(rt,{name:"redirectUris","aria-label":n("validRedirectUri"),addButtonLabel:"clients:addRedirectUri"})}),e(b,{label:n("validPostLogoutRedirectUri"),fieldId:"kc-postLogoutRedirect",labelIcon:e(I,{helpText:"clients-help:validPostLogoutRedirectURIs",fieldLabelId:"clients:validPostLogoutRedirectUri"}),children:e(rt,{name:N("attributes.post.logout.redirect.uris"),"aria-label":n("validPostLogoutRedirectUri"),addButtonLabel:"clients:addPostLogoutRedirectUri"})}),h==="saml"&&r(j,{children:[e(b,{label:n("idpInitiatedSsoUrlName"),fieldId:"idpInitiatedSsoUrlName",labelIcon:e(I,{helpText:"clients-help:idpInitiatedSsoUrlName",fieldLabelId:"clients:idpInitiatedSsoUrlName"}),helperText:d!==""&&n("idpInitiatedSsoUrlNameHelp",{url:`${ni.authServerUrl}/realms/${o}/protocol/saml/clients/${d}`}),children:e(Z,{type:"text",id:"idpInitiatedSsoUrlName",name:"attributes.saml_idp_initiated_sso_url_name",ref:s})}),e(b,{label:n("idpInitiatedSsoRelayState"),fieldId:"idpInitiatedSsoRelayState",labelIcon:e(I,{helpText:"clients-help:idpInitiatedSsoRelayState",fieldLabelId:"clients:idpInitiatedSsoRelayState"}),children:e(Z,{type:"text",id:"idpInitiatedSsoRelayState",name:"attributes.saml_idp_initiated_sso_relay_state",ref:s})}),e(b,{label:n("masterSamlProcessingUrl"),fieldId:"masterSamlProcessingUrl",labelIcon:e(I,{helpText:"clients-help:masterSamlProcessingUrl",fieldLabelId:"clients:masterSamlProcessingUrl"}),children:e(Z,{type:"text",id:"masterSamlProcessingUrl",name:"adminUrl",ref:s})})]}),h!=="saml"&&e(b,{label:n("webOrigins"),fieldId:"kc-web-origins",labelIcon:e(I,{helpText:"clients-help:webOrigins",fieldLabelId:"clients:webOrigins"}),children:e(rt,{name:"webOrigins","aria-label":n("webOrigins"),addButtonLabel:"clients:addWebOrigins"})})]}),h!=="saml"&&e(b,{label:n("adminURL"),fieldId:"kc-admin-url",labelIcon:e(I,{helpText:"clients-help:adminURL",fieldLabelId:"clients:adminURL"}),children:e(Z,{type:"text",id:"kc-admin-url",name:"adminUrl",ref:s})}),t.bearerOnly&&e(Yt,{className:"keycloak__form_actions",name:"settings",save:i,reset:a,isActive:!p})]})},ys=({access:t})=>{const{t:i}=L("clients"),{register:a,control:n,watch:s}=ae(),[l,o]=u.exports.useState(!1),c=Ye().themes.login,p=s("consentRequired"),h=s(N("attributes.display.on.consent.screen"));return r(re,{isHorizontal:!0,fineGrainedAccess:t,role:"manage-clients",children:[e(b,{label:i("loginTheme"),labelIcon:e(I,{helpText:"clients-help:loginTheme",fieldLabelId:"clients:loginTheme"}),fieldId:"loginTheme",children:e(M,{name:"attributes.login_theme",defaultValue:"",control:n,render:({onChange:d,value:y})=>e(X,{toggleId:"loginTheme",onToggle:o,onSelect:(f,m)=>{d(m.toString()),o(!1)},selections:y||i("common:choose"),variant:Q.single,"aria-label":i("loginTheme"),isOpen:l,children:[e(V,{value:"",children:i("common:choose")},"empty"),...c.map(f=>e(V,{selected:f.name===y,value:f.name},f.name))]})})}),e(b,{label:i("consentRequired"),labelIcon:e(I,{helpText:"clients-help:consentRequired",fieldLabelId:"clients:consentRequired"}),fieldId:"kc-consent",hasNoPaddingTop:!0,children:e(M,{name:"consentRequired",defaultValue:!1,control:n,render:({onChange:d,value:y})=>e(ce,{id:"kc-consent-switch",label:i("common:on"),labelOff:i("common:off"),isChecked:y,onChange:d,"aria-label":i("consentRequired")})})}),e(b,{label:i("displayOnClient"),labelIcon:e(I,{helpText:"clients-help:displayOnClient",fieldLabelId:"clients:displayOnClient"}),fieldId:"kc-display-on-client",hasNoPaddingTop:!0,children:e(M,{name:N("attributes.display.on.consent.screen"),defaultValue:!1,control:n,render:({onChange:d,value:y})=>e(ce,{id:"kc-display-on-client-switch",label:i("common:on"),labelOff:i("common:off"),isChecked:y==="true",onChange:f=>d(""+f),isDisabled:!p,"aria-label":i("displayOnClient")})})}),e(b,{label:i("consentScreenText"),labelIcon:e(I,{helpText:"clients-help:consentScreenText",fieldLabelId:"clients:consentScreenText"}),fieldId:"kc-consent-screen-text",children:e(et,{id:"kc-consent-screen-text",name:N("attributes.consent.screen.text"),ref:a,isDisabled:!(p&&h==="true")})})]})},Ss=({save:t,reset:i,client:{access:a}})=>{const{t:n}=L("clients"),{register:s,control:l,watch:o,formState:{errors:c}}=ae(),{hasAccess:p}=ze(),h=p("manage-clients")||a?.configure,d=o("protocol"),y=o("frontchannelLogout");return r(re,{isHorizontal:!0,fineGrainedAccess:a?.configure,role:"manage-clients",children:[e(b,{label:n("frontchannelLogout"),labelIcon:e(I,{helpText:"clients-help:frontchannelLogout",fieldLabelId:"clients:frontchannelLogout"}),fieldId:"kc-frontchannelLogout",hasNoPaddingTop:!0,children:e(M,{name:"frontchannelLogout",defaultValue:!0,control:l,render:({onChange:f,value:m})=>e(ce,{id:"kc-frontchannelLogout-switch",label:n("common:on"),labelOff:n("common:off"),isChecked:m,onChange:f,"aria-label":n("frontchannelLogout")})})}),d==="openid-connect"&&y&&e(b,{label:n("frontchannelLogoutUrl"),fieldId:"frontchannelLogoutUrl",labelIcon:e(I,{helpText:"clients-help:frontchannelLogoutUrl",fieldLabelId:"clients:frontchannelLogoutUrl"}),helperTextInvalid:c.attributes?.frontchannel?.logout?.url?.message,validated:c.attributes?.frontchannel?.logout?.url?.message?Ie.error:Ie.default,children:e(Z,{type:"text",id:"frontchannelLogoutUrl",name:N("attributes.frontchannel.logout.url"),ref:s({validate:f=>(f.startsWith("https://")||f.startsWith("http://"))&&!f.includes("*")||f===""||n("frontchannelUrlInvalid").toString()}),validated:c.attributes?.frontchannel?.logout?.url?.message?Ie.error:Ie.default})}),d==="openid-connect"&&r(j,{children:[e(b,{label:n("backchannelLogoutUrl"),fieldId:"backchannelLogoutUrl",labelIcon:e(I,{helpText:"clients-help:backchannelLogoutUrl",fieldLabelId:"clients:backchannelLogoutUrl"}),helperTextInvalid:c.attributes?.backchannel?.logout?.url?.message,validated:c.attributes?.backchannel?.logout?.url?.message?Ie.error:Ie.default,children:e(Z,{type:"text",id:"backchannelLogoutUrl",name:N("attributes.backchannel.logout.url"),ref:s({validate:f=>(f.startsWith("https://")||f.startsWith("http://"))&&!f.includes("*")||f===""||n("backchannelUrlInvalid").toString()}),validated:c.attributes?.backchannel?.logout?.url?.message?Ie.error:Ie.default})}),e(b,{label:n("backchannelLogoutSessionRequired"),labelIcon:e(I,{helpText:"clients-help:backchannelLogoutSessionRequired",fieldLabelId:"clients:backchannelLogoutSessionRequired"}),fieldId:"backchannelLogoutSessionRequired",hasNoPaddingTop:!0,children:e(M,{name:N("attributes.backchannel.logout.session.required"),defaultValue:"true",control:l,render:({onChange:f,value:m})=>e(ce,{id:"backchannelLogoutSessionRequired",label:n("common:on"),labelOff:n("common:off"),isChecked:m==="true",onChange:S=>f(S.toString()),"aria-label":n("backchannelLogoutSessionRequired")})})}),e(b,{label:n("backchannelLogoutRevokeOfflineSessions"),labelIcon:e(I,{helpText:"clients-help:backchannelLogoutRevokeOfflineSessions",fieldLabelId:"clients:backchannelLogoutRevokeOfflineSessions"}),fieldId:"backchannelLogoutRevokeOfflineSessions",hasNoPaddingTop:!0,children:e(M,{name:N("attributes.backchannel.logout.revoke.offline.tokens"),defaultValue:"false",control:l,render:({onChange:f,value:m})=>e(ce,{id:"backchannelLogoutRevokeOfflineSessions",label:n("common:on"),labelOff:n("common:off"),isChecked:m==="true",onChange:S=>f(S.toString()),"aria-label":n("backchannelLogoutRevokeOfflineSessions")})})})]}),e(Yt,{className:"keycloak__form_actions",name:"settings",save:t,reset:i,isActive:h})]})},vs=t=>{const{t:i}=L("clients"),{watch:a}=ae(),n=a("protocol"),{client:s}=t;return e(Pn,{className:"pf-u-px-lg pf-u-pb-lg",sections:[{title:i("generalSettings"),panel:e(Se,{isHorizontal:!0,children:e(Ri,{protocol:s.protocol,hasConfigureAccess:s.access?.configure})})},{title:i("accessSettings"),panel:e(bs,{...t})},{title:i("samlCapabilityConfig"),isHidden:n!=="saml"||s.bearerOnly,panel:e(fs,{})},{title:i("signatureAndEncryption"),isHidden:n!=="saml"||s.bearerOnly,panel:e(gs,{})},{title:i("capabilityConfig"),isHidden:n!=="openid-connect"||s.bearerOnly,panel:e(Ai,{})},{title:i("loginSettings"),isHidden:s.bearerOnly,panel:e(ys,{access:s.access?.configure})},{title:i("logoutSettings"),isHidden:s.bearerOnly,panel:e(Ss,{...t})}]})},Is=({client:t})=>{const{adminClient:i}=ne(),{t:a}=L("sessions");return e(me,{variant:"light",className:"pf-u-p-0",children:e(Oi,{loader:(s,l)=>i.clients.listSessions({id:t.id,first:s,max:l}),hiddenColumns:["clients"],emptyInstructions:a("noSessionsForClient")})})},Jn=({id:t,label:i,text:a,variant:n="plain"})=>{const{t:s}=L("clients"),l=ii(),[o,c]=u.exports.useState(0),p=u.exports.useMemo(()=>{switch(o){case 0:return s("copyToClipboard");case 1:return s("copySuccess");case 2:return s("clipboardCopyError")}},[o]);u.exports.useEffect(()=>{if(o!==0)return l(()=>c(0),1e3)},[o]);const h=async d=>{try{await navigator.clipboard.writeText(d),c(1)}catch{c(2)}};return e(Ti,{id:`copy-button-${t}`,textId:i,"aria-label":s("copyToClipboard"),onClick:()=>h(a),exitDelay:600,variant:n,children:p})},hn=({id:t,buttonLabel:i,secret:a,toggle:n})=>{const{t:s}=L("clients"),l=ae();return r(Xe,{hasGutter:!0,children:[e(Te,{isFilled:!0,children:r(Vt,{children:[e(Kt,{id:t,value:a,isReadOnly:!0}),e(Jn,{id:t,text:a,label:"clientSecret",variant:"control"})]})}),e(Te,{children:e(D,{variant:"secondary",isDisabled:l.formState.isDirty,onClick:n,children:s(i)})})]})},fn=({time:t})=>{const{t:i}=L("clients"),a=Jt();return e("div",{className:"pf-u-my-md",children:(s=>s?i("secretExpiresOn",{time:a(new Date(s*1e3),{dateStyle:"full",timeStyle:"long"})}):void 0)(t)})},Ts=({client:t,secret:i,toggle:a})=>{const{t:n}=L("clients"),{adminClient:s}=ne(),{addAlert:l,addError:o}=de(),[c,p]=u.exports.useState(t.attributes?.["client.secret.rotated"]),h=t.attributes?.["client.secret.expiration.time"],d=t.attributes?.["client.secret.rotated.expiration.time"],y=S=>new Date().getTime()>=S*1e3,[f,m]=xe({titleKey:"clients:invalidateRotatedSecret",messageKey:"clients:invalidateRotatedSecretExplain",continueButtonLabel:"common:confirm",onConfirm:async()=>{try{await s.clients.invalidateSecret({id:t.id}),p(void 0),l(n("invalidateRotatedSuccess"))}catch(S){o("clients:invalidateRotatedError",S)}}});return r(j,{children:[e(m,{}),r(b,{label:n("clientSecret"),fieldId:"kc-client-secret",className:"pf-u-my-md",children:[e(hn,{id:"kc-client-secret",secret:i,toggle:a,buttonLabel:"regenerate"}),e(fn,{time:h}),y(h)&&e(qe,{variant:"warning",isInline:!0,title:n("secretHasExpired")})]}),c&&r(b,{label:n("secretRotated"),fieldId:"secretRotated",children:[e(hn,{id:"secretRotated",secret:c,toggle:f,buttonLabel:"invalidateSecret"}),e(fn,{time:d})]})]})},xs=()=>{const{control:t}=ae(),i=Ae(Ye().providers.clientSignature.providers),{t:a}=L("clients"),[n,s]=u.exports.useState(!1);return e(b,{label:a("signatureAlgorithm"),fieldId:"kc-signature-algorithm",labelIcon:e(I,{helpText:"clients-help:signature-algorithm",fieldLabelId:"clients:signatureAlgorithm"}),children:e(M,{name:N("attributes.token.endpoint.auth.signing.alg"),defaultValue:"",control:t,render:({onChange:l,value:o})=>r(X,{maxHeight:200,toggleId:"kc-signature-algorithm",onToggle:s,onSelect:(c,p)=>{l(p.toString()),s(!1)},selections:o||a("anyAlgorithm"),variant:Q.single,"aria-label":a("signatureAlgorithm"),isOpen:n,children:[e(V,{selected:o==="",value:"",children:a("anyAlgorithm")},"any"),e(j,{children:i.map(c=>e(V,{selected:c===o,value:c},c))})]})})})},ks=()=>{const{t}=L("clients"),{register:i,control:a,formState:{errors:n}}=ae();return r(j,{children:[e(b,{label:t("allowRegexComparison"),labelIcon:e(I,{helpText:"clients-help:allowRegexComparison",fieldLabelId:"clients:allowRegexComparison"}),fieldId:"allowRegexComparison",hasNoPaddingTop:!0,children:e(M,{name:N("attributes.x509.allow.regex.pattern.comparison"),defaultValue:"false",control:a,render:({onChange:s,value:l})=>e(ce,{id:"allowRegexComparison",label:t("common:on"),labelOff:t("common:off"),isChecked:l==="true",onChange:o=>s(o.toString()),"aria-label":t("allowRegexComparison")})})}),e(b,{label:t("subject"),fieldId:"kc-subject",labelIcon:e(I,{helpText:"clients-help:subject",fieldLabelId:"clients:subject"}),helperTextInvalid:t("common:required"),validated:n.attributes?.["x509.subjectdn"]?Ie.error:Ie.default,isRequired:!0,children:e(Z,{ref:i({required:!0}),type:"text",id:"kc-subject",name:N("attributes.x509.subjectdn"),validated:n.attributes?.["x509.subjectdn"]?Ie.error:Ie.default})})]})};const Cs=({client:t,save:i,refresh:a})=>{const{t:n}=L("clients"),{adminClient:s}=ne(),{addAlert:l,addError:o}=de(),c=t.id,[p,h]=u.exports.useState([]),{control:d,formState:{isDirty:y},handleSubmit:f}=ae(),m=vt({control:d,name:"clientAuthenticatorType",defaultValue:""}),[S,x]=u.exports.useState(""),[T,g]=u.exports.useState(""),[k,Y]=u.exports.useState(!1);oe(()=>Promise.all([s.authenticationManagement.getClientAuthenticatorProviders(),s.clients.getClientSecret({id:c})]),([z,C])=>{h(z),x(C.value)},[]);async function J(z,C){try{const v=await z(c);return l(n(`${C}Success`),ee.success),v}catch(v){o(`clients:${C}Error`,v)}}const _=async()=>{const z=await J(C=>s.clients.generateNewClientSecret({id:C}),"clientSecret");x(z?.value||""),a()},[G,q]=xe({titleKey:"clients:confirmClientSecretTitle",messageKey:"clients:confirmClientSecretBody",continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",onConfirm:_}),A=async()=>{const z=await J(C=>s.clients.generateRegistrationAccessToken({id:C}),"accessToken");g(z?.registrationAccessToken||"")},[B,U]=xe({titleKey:"clients:confirmAccessTokenTitle",messageKey:"clients:confirmAccessTokenBody",continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",onConfirm:A});return e(me,{children:r(re,{onSubmit:f(i),isHorizontal:!0,className:"pf-u-mt-md",role:"manage-clients",children:[e(q,{}),e(U,{}),r(bt,{isFlat:!0,children:[r(We,{children:[e(b,{label:n("clientAuthenticator"),fieldId:"kc-client-authenticator-type",labelIcon:e(I,{helpText:"clients-help:client-authenticator-type",fieldLabelId:"clients:clientAuthenticator"}),children:e(M,{name:"clientAuthenticatorType",control:d,defaultValue:"",render:({onChange:z,value:C})=>e(X,{toggleId:"kc-client-authenticator-type",required:!0,onToggle:Y,onSelect:(v,P)=>{z(P),Y(!1)},selections:C,variant:Q.single,"aria-label":n("clientAuthenticator"),isOpen:k,children:p.map(v=>e(V,{selected:v.id===C,value:v.id,children:v.displayName},v.id))})})}),(m==="client-jwt"||m==="client-secret-jwt")&&e(xs,{}),m==="client-jwt"&&e(qe,{variant:"info",isInline:!0,className:"kc-signedJWTAlert",title:n("signedJWTConfirm")}),m==="client-x509"&&e(ks,{}),e(be,{children:e(D,{variant:"primary",type:"submit",isDisabled:!y,children:n("common:save")})})]}),(m==="client-secret"||m==="client-secret-jwt")&&e(Be,{}),(m==="client-secret"||m==="client-secret-jwt")&&e(We,{children:e(Ts,{client:t,secret:S,toggle:G})})]}),e(bt,{isFlat:!0,children:e(We,{children:e(b,{label:n("registrationAccessToken"),fieldId:"kc-access-token",labelIcon:e(I,{helpText:"clients-help:registration-access-token",fieldLabelId:"clients:registrationAccessToken"}),children:r(Xe,{hasGutter:!0,children:[e(Te,{isFilled:!0,children:e(En,{id:"kc-access-token",isReadOnly:!0,children:T})}),e(Te,{children:e(D,{variant:"secondary",onClick:B,children:n("regenerate")})})]})})})})]})})},Yn=({hidePassword:t=!1,isSaml:i=!1})=>{const{t:a}=L("clients"),{register:n,errors:s}=ae();return r(j,{children:[e(b,{label:a("keyAlias"),fieldId:"keyAlias",isRequired:!0,labelIcon:e(I,{helpText:"clients-help:keyAlias",fieldLabelId:"clients:keyAlias"}),helperTextInvalid:a("common:required"),validated:s.keyAlias?"error":"default",children:e(Z,{"data-testid":"keyAlias",type:"text",id:"keyAlias",name:"keyAlias",ref:n({required:!0}),validated:s.keyAlias?"error":"default"})}),!t&&e(b,{label:a("keyPassword"),fieldId:"keyPassword",isRequired:!0,labelIcon:e(I,{helpText:"clients-help:keyPassword",fieldLabelId:"clients:keyPassword"}),helperTextInvalid:a("common:required"),validated:s.keyPassword?"error":"default",children:e(Kt,{"data-testid":"keyPassword",id:"keyPassword",name:"keyPassword",ref:n({required:!0}),validated:s.keyPassword?"error":"default"})}),i&&e(b,{label:a("realmCertificateAlias"),fieldId:"realmCertificateAlias",labelIcon:e(I,{helpText:"clients-help:realmCertificateAlias",fieldLabelId:"clients:realmCertificateAlias"}),children:e(Z,{"data-testid":"realmCertificateAlias",type:"text",id:"realmCertificateAlias",name:"realmAlias",ref:n()})}),e(b,{label:a("storePassword"),fieldId:"storePassword",isRequired:!0,labelIcon:e(I,{helpText:"clients-help:storePassword",fieldLabelId:"clients:storePassword"}),helperTextInvalid:a("common:required"),validated:s.storePassword?"error":"default",children:e(Kt,{"data-testid":"storePassword",id:"storePassword",name:"storePassword",ref:n({required:!0}),validated:s.storePassword?"error":"default"})})]})},gn="Certificate PEM",xt=({isSaml:t=!1,hasPem:i=!1,useFile:a=!1})=>{const{t:n}=L("clients"),[s,l]=u.exports.useState(),[o,c]=u.exports.useState(!1),{control:p,watch:h}=ae(),d=h("format");return r(Se,{className:"pf-u-pt-lg",children:[e(b,{label:n("archiveFormat"),labelIcon:e(I,{helpText:"clients-help:archiveFormat",fieldLabelId:"clients:archiveFormat"}),fieldId:"archiveFormat",children:e(M,{name:"format",defaultValue:"JKS",control:p,render:({onChange:y,value:f})=>e(X,{toggleId:"archiveFormat",onToggle:c,onSelect:(m,S)=>{y(S.toString()),c(!1)},selections:f,variant:Q.single,"aria-label":n("archiveFormat"),isOpen:o,children:["JKS","PKCS12"].concat(i?gn:[]).map(m=>e(V,{selected:m===f,value:m},m))})})}),a&&e(b,{label:n("importFile"),labelIcon:e(I,{helpText:"clients-help:importFile",fieldLabelId:"clients:importFile"}),fieldId:"importFile",children:e(M,{name:"file",defaultValue:"",control:p,render:({onChange:y,value:f})=>e(Un,{id:"importFile",value:f,filename:s,browseButtonText:n("browse"),onChange:(m,S)=>{l(S),y(m)}})})}),d!==gn&&e(Yn,{hidePassword:a,isSaml:t})]})},Rs=({clientId:t,save:i,toggleDialog:a})=>{const{t:n}=L("clients"),s=Ee({defaultValues:{keyAlias:t},mode:"onChange"}),{handleSubmit:l,formState:{isValid:o}}=s;return r(_e,{variant:tt.medium,title:n("generateKeys"),isOpen:!0,onClose:a,actions:[e(D,{id:"modal-confirm","data-testid":"confirm",isDisabled:!o,onClick:()=>{l(c=>{i(c),a()})()},children:n("generate")},"confirm"),e(D,{id:"modal-cancel","data-testid":"cancel",variant:ye.link,onClick:()=>{a()},children:n("common:cancel")},"cancel")],children:[e(Oe,{children:e(ue,{children:n("clients-help:generateKeysDescription")})}),e(Le,{...s,children:e(xt,{})})]})},Qn=["JKS","PKCS12"],As=Qn.concat(["Certificate PEM","Public Key PEM","JSON Web Key Set"]),Os=({save:t,toggleDialog:i})=>{const{t:a}=L("clients"),n=Ee(),{control:s,handleSubmit:l}=n,[o,c]=u.exports.useState(!1),p=vt({control:s,name:"keystoreFormat",defaultValue:"JKS"});return r(_e,{variant:tt.medium,title:a("generateKeys"),isOpen:!0,onClose:i,actions:[e(D,{id:"modal-confirm","data-testid":"confirm",onClick:()=>{l(h=>{t(h),i()})()},children:a("import")},"confirm"),e(D,{id:"modal-cancel","data-testid":"cancel",variant:ye.link,onClick:()=>{i()},children:a("common:cancel")},"cancel")],children:[e(Oe,{children:e(ue,{children:a("clients-help:generateKeysDescription")})}),r(Se,{className:"pf-u-pt-lg",children:[e(b,{label:a("archiveFormat"),labelIcon:e(I,{helpText:"clients-help:archiveFormat",fieldLabelId:"clients:archiveFormat"}),fieldId:"archiveFormat",children:e(M,{name:"keystoreFormat",control:s,defaultValue:"JKS",render:({onChange:h,value:d})=>e(X,{toggleId:"archiveFormat",onToggle:c,onSelect:(y,f)=>{h(f),c(!1)},selections:d,variant:Q.single,"aria-label":a("archiveFormat"),isOpen:o,children:As.map(y=>e(V,{selected:y===d,value:y},y))})})}),Qn.includes(p)&&e(Le,{...n,children:e(Yn,{hidePassword:!0})}),e(b,{label:a("importFile"),fieldId:"importFile",children:e(M,{name:"file",control:s,defaultValue:"",render:({onChange:h,value:d})=>e(Un,{id:"importFile",value:d.value,filename:d.filename,onChange:(y,f)=>h({value:y,filename:f})})})})]})]})},bn=({id:t,keyInfo:i})=>e(et,{readOnly:!0,rows:5,id:t,"data-testid":"certificate",value:i?.certificate}),Qt=({keyInfo:t,plain:i=!1})=>{const{t:a}=L("clients");return e(si,{prefix:"certificate",children:n=>i?e(bn,{id:n,keyInfo:t}):e(b,{label:a("certificate"),fieldId:n,labelIcon:e(I,{helpText:"clients-help:certificate",fieldLabelId:`clients:${n}`}),children:e(bn,{id:n,keyInfo:t})})})},Et="jwt.credential",ws=({clientId:t,save:i,hasConfigureAccess:a})=>{const{t:n}=L("clients"),{control:s,register:l,getValues:o,formState:{isDirty:c}}=ae(),{adminClient:p}=ne(),{addAlert:h,addError:d}=de(),[y,f]=u.exports.useState(),[m,S,x]=ve(),[T,g,k]=ve(),[Y,J]=u.exports.useState(0),_=()=>J(Y+1),G=vt({control:s,name:"attributes.use.jwks.url",defaultValue:"false"});oe(()=>p.clients.getKeyInfo({id:t,attr:Et}),B=>f(B),[Y]);const q=async B=>{try{const U=await p.clients.generateAndDownloadKey({id:t,attr:Et},B);Qe.saveAs(new Blob([U],{type:"application/octet-stream"}),`keystore.${B.format=="PKCS12"?"p12":"jks"}`),h(n("generateSuccess"),ee.success),_()}catch(U){d("clients:generateError",U)}},A=async B=>{try{const U=new FormData,{file:z,...C}=B;Object.entries(C).map(v=>U.append(v[0],v[1])),U.append("file",z.value),await p.clients.uploadCertificate({id:t,attr:Et},U),h(n("importSuccess"),ee.success),_()}catch(U){d("clients:importError",U)}};return r(me,{variant:"light",className:"keycloak__form",children:[m&&e(Rs,{clientId:o("clientId"),toggleDialog:S,save:q}),T&&e(Os,{toggleDialog:g,save:A}),r(bt,{isFlat:!0,children:[e(wi,{children:e(Ei,{children:n("jwksUrlConfig")})}),e(We,{children:e(Oe,{children:e(ue,{children:n("keysIntro")})})}),e(We,{children:r(re,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e(b,{hasNoPaddingTop:!0,label:n("useJwksUrl"),fieldId:"useJwksUrl",labelIcon:e(I,{helpText:"clients-help:useJwksUrl",fieldLabelId:"clients:useJwksUrl"}),children:e(M,{name:N("attributes.use.jwks.url"),defaultValue:"false",control:s,render:({onChange:B,value:U})=>e(ce,{"data-testid":"useJwksUrl",id:"useJwksUrl-switch",label:n("common:on"),labelOff:n("common:off"),isChecked:U==="true",onChange:z=>B(`${z}`),"aria-label":n("useJwksUrl")})})}),G!=="true"&&(y?e(Qt,{plain:!0,keyInfo:y}):"No client certificate configured"),G==="true"&&e(b,{label:n("jwksUrl"),fieldId:"jwksUrl",labelIcon:e(I,{helpText:"clients-help:jwksUrl",fieldLabelId:"clients:jwksUrl"}),children:e(Z,{type:"text",id:"jwksUrl",name:N("attributes.jwks.url"),ref:l})}),r(be,{children:[e(D,{"data-testid":"saveKeys",onClick:i,isDisabled:!c,children:n("common:save")}),e(D,{"data-testid":"generate",variant:"secondary",onClick:()=>x(!0),children:n("generateNewKeys")}),e(D,{"data-testid":"import",variant:"secondary",onClick:()=>k(!0),isDisabled:G==="true",children:n("import")})]})]})})]})]})},Pt="dedicated",Es=({clientId:t,protocol:i,clientName:a,fineGrainedAccess:n})=>{const{t:s}=L("clients"),{adminClient:l}=ne(),{addAlert:o,addError:c}=de(),{realm:p}=pe(),h=Kn(),[d,y]=u.exports.useState("name"),[f,m]=u.exports.useState(an.none),[S,x]=u.exports.useState(!1),[T,g]=u.exports.useState(),[k,Y]=u.exports.useState([]),J=O=>Y(O.filter(({id:w})=>w!==Pt)),[_,G]=u.exports.useState(0),q=()=>G(_+1),A=O=>O.id===Pt,{hasAccess:B}=ze(),U=B("manage-clients")||n,z=async(O,w,H)=>{const he=await l.clients.listDefaultClientScopes({id:t}),Re=await l.clients.listOptionalClientScopes({id:t}),ke=await l.clientScopes.find(),Ke=$=>ke.find(at=>$===at.id),je=Re.map($=>{const at=Ke($.id);return{...$,type:on.optional,description:at?.description}}),Ge=he.map($=>{const at=Ke($.id);return{...$,type:on.default,description:at?.description}}),Me=[...je,...Ge],st=Me.map($=>$.name);g(ke.filter($=>!st.includes($.name)).filter($=>$.protocol===i));const R=d==="name"?Vi(H):qi(f),F=Number(O),te=h(Me.filter(R),Mn("name")).slice(F,F+Number(w));return F===0&&U?[{id:Pt,name:s("dedicatedScopeName",{clientName:a}),type:an.none,description:s("dedicatedScopeDescription")},...te]:te},C=O=>e(Ui,{isDisabled:A(O)||!U,clientScope:O,type:O.type,onSelect:async w=>{try{await Ki(l,t,O,O.type,w),o(s("clientScopeSuccess"),ee.success),q()}catch(H){c("clients:clientScopeError",H)}}}),[v,P]=xe({titleKey:s("client-scopes:deleteClientScope",{count:k.length,name:k[0]?.name}),messageKey:"client-scopes:deleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:ye.danger,onConfirm:async()=>{try{await ln(l,t,k[0],k[0].type),o(s("clientScopeRemoveSuccess"),ee.success),q()}catch(O){c("clients:clientScopeRemoveError",O)}}});return r(j,{children:[T&&e(Pi,{clientScopes:T,clientName:a,open:S,toggleDialog:()=>x(!S),onAdd:async O=>{try{await Promise.all(O.map(async w=>await Di(l,t,w.scope,w.type))),o(s("clientScopeSuccess"),ee.success),q()}catch(w){c("clients:clientScopeError",w)}}}),e(It,{loader:z,ariaLabelKey:"clients:clientScopeList",searchPlaceholderKey:d==="name"?"clients:searchByName":void 0,canSelectAll:!0,isPaginated:!0,isSearching:d==="type",onSelect:O=>J([...O]),searchTypeComponent:e(Mi,{searchType:d,onSelect:O=>y(O)}),toolbarItem:r(j,{children:[e(Fi,{searchType:d,type:f,onSelect:O=>y(O),onType:O=>{m(O),q()}}),e(()=>{const[O,w]=u.exports.useState(!1);return U?r(j,{children:[e(P,{}),e(ge,{children:e(D,{onClick:()=>x(!0),children:s("addClientScope")})}),e(ge,{children:e(Bi,{clientId:t,selectedRows:k,refresh:q})}),e(ge,{children:e(zt,{toggle:e(li,{onToggle:()=>w(!O)}),isOpen:O,isPlain:!0,dropdownItems:[e($e,{isDisabled:k.length===0,onClick:async()=>{try{await Promise.all(k.map(H=>ln(l,t,{...H},H.type))),w(!1),J([]),o(s("clients:clientScopeRemoveSuccess")),q()}catch(H){c("clients:clientScopeRemoveError",H)}},children:s("common:remove")},"deleteAll")]})})]}):e("span",{})},{})]}),columns:[{name:"name",displayKey:"clients:assignedClientScope",cellRenderer:O=>A(O)?e(fe,{to:ai({realm:p,clientId:t}),children:O.name}):O.name},{name:"type",displayKey:"clients:assignedType",cellRenderer:C},{name:"description"}],actions:U?[{title:s("common:remove"),onRowClick:async O=>(J([O]),v(),!0)}]:[],emptyState:e(Ce,{message:s("clients:emptyClientScopes"),instructions:s("clients:emptyClientScopesInstructions"),primaryActionText:s("clients:emptyClientScopesPrimaryAction"),onPrimaryAction:()=>x(!0)})},_)]})},Lt=({text:t,user:i,label:a})=>{const{t:n}=L("clients");return i?e(zn,{id:a,actions:e(jn,{children:e(Jn,{id:"code",text:t,label:a})}),children:e(et,{id:`text-area-${a}`,rows:20,value:t})}):r(Fn,{variant:"large",children:[e($t,{headingLevel:"h4",size:"lg",children:n(`${a}No`)}),e(Bn,{children:n(`${a}IsDisabled`)})]})};const Ps=({protocolMappers:t})=>{const[i,a]=u.exports.useState(0);return u.exports.useEffect(()=>{a(i+1)},[t]),e(It,{loader:()=>Promise.resolve(t),ariaLabelKey:"clients:effectiveProtocolMappers",searchPlaceholderKey:"clients:searchForProtocol",columns:[{name:"mapperName",displayKey:"common:name"},{name:"containerName",displayKey:"clients:parentClientScope"},{name:"type.category",displayKey:"common:category"},{name:"type.priority",displayKey:"common:priority"}]},i)},Ls=({effectiveRoles:t})=>{const[i,a]=u.exports.useState(0);return u.exports.useEffect(()=>{a(i+1)},[t]),e(It,{loader:()=>Promise.resolve(t),ariaLabelKey:"client:effectiveRoleScopeMappings",searchPlaceholderKey:"clients:searchForRole",columns:[{name:"name",displayKey:"clients:role"},{name:"containerId",displayKey:"clients:origin"}]},i)},_s=({clientId:t,protocol:i})=>{const a="openid",{t:n}=L("clients"),{enabled:s}=xn(),{adminClient:l}=ne(),{realm:o}=pe(),c=Ye().protocolMapperTypes[i],[p,h]=u.exports.useState([]),[d,y]=u.exports.useState(!1),[f,m]=u.exports.useState(!1),[S,x]=u.exports.useState([a]),[T,g]=u.exports.useState(0),[k,Y]=u.exports.useState([]),[J,_]=u.exports.useState(""),[G,q]=u.exports.useState(),[A,B]=u.exports.useState(""),U=()=>B(`${new Date().getTime()}`),[z,C]=u.exports.useState([]),[v,P]=u.exports.useState([]),[E,O]=u.exports.useState(""),[w,H]=u.exports.useState(""),[he,Re]=u.exports.useState(""),ke=u.exports.useRef(null),Ke=u.exports.useRef(null),je=u.exports.useRef(null),Ge=u.exports.useRef(null),Me=u.exports.useRef(null);oe(()=>l.clients.listOptionalClientScopes({id:t}),R=>h(R),[]);const st=R=>n("common:fullName",{givenName:R.firstName,familyName:R.lastName}).trim()||R.username||"";return oe(()=>l.users.find({search:J}),R=>Y(R.map(F=>(F.toString=function(){return st(this)},F)).map(F=>e(V,{value:F},F.id))),[J]),oe(async()=>{const R=S.join(" "),F=await l.clients.evaluatePermission({id:t,roleContainer:o,scope:R,type:"granted"});return{mapperList:await l.clients.evaluateListProtocolMapper({id:t,scope:R}),effectiveRoles:F}},({mapperList:R,effectiveRoles:F})=>{C(F),R.map(te=>{te.type=c.filter($=>$.id===te.protocolMapper)[0]}),P(R),U()},[S]),oe(async()=>{const R=S.join(" ");return G?await Promise.all([l.clients.evaluateGenerateAccessToken({id:t,userId:G.id,scope:R}),l.clients.evaluateGenerateUserInfo({id:t,userId:G.id,scope:R}),l.clients.evaluateGenerateIdToken({id:t,userId:G.id,scope:R})]):[]},([R,F,te])=>{O(He(R)),H(He(F)),Re(He(te))},[G,S]),r(j,{children:[r(me,{variant:"light",children:[s&&e(Oe,{className:"keycloak__section_intro__help",children:r(ue,{children:[e(ji,{})," ",n("clients-help:evaluateExplain")]})}),r(Se,{isHorizontal:!0,children:[e(b,{label:n("scopeParameter"),fieldId:"scopeParameter",labelIcon:e(I,{helpText:"clients-help:scopeParameter",fieldLabelId:"clients:scopeParameter"}),children:r(Xe,{hasGutter:!0,children:[e(Te,{isFilled:!0,children:e(X,{toggleId:"scopeParameter",variant:Q.typeaheadMulti,typeAheadAriaLabel:n("scopeParameter"),onToggle:()=>y(!d),isOpen:d,selections:S,onSelect:(R,F)=>{const te=F;S.includes(te)?te!==a&&x(S.filter($=>$!==te)):x([...S,te])},"aria-labelledby":n("scopeParameter"),placeholderText:n("scopeParameterPlaceholder"),children:p.map((R,F)=>e(V,{value:R.name},F))})}),e(Te,{children:e(En,{className:"keycloak__scopes_evaluate__clipboard-copy",children:S.join(" ")})})]})}),e(b,{label:n("user"),fieldId:"user",labelIcon:e(I,{helpText:"clients-help:user",fieldLabelId:"clients:user"}),children:e(X,{toggleId:"user",variant:Q.typeahead,typeAheadAriaLabel:n("user"),onToggle:()=>m(!f),onFilter:R=>{const F=R?.target.value||"";return _(F),k},onClear:()=>{q(void 0),_("")},selections:[G],onSelect:(R,F)=>{q(F),_(""),m(!1)},isOpen:f})})]})]}),r(Gi,{hasGutter:!0,className:"keycloak__scopes_evaluate__tabs",children:[r(rn,{span:8,children:[e(lt,{"aria-labelledby":"pf-tab-0-effectiveProtocolMappers",eventKey:0,id:"effectiveProtocolMappers",ref:ke,children:e(Ps,{protocolMappers:v})}),e(lt,{"aria-labelledby":"pf-tab-0-effectiveRoleScopeMappings",eventKey:1,id:"effectiveRoleScopeMappings",ref:Ke,hidden:!0,children:e(Ls,{effectiveRoles:z})}),e(lt,{"aria-labelledby":n("generatedAccessToken"),eventKey:2,id:"tab-generated-access-token",ref:je,hidden:!0,children:e(Lt,{text:E,user:G,label:"generatedAccessToken"})}),e(lt,{"aria-labelledby":n("generatedIdToken"),eventKey:3,id:"tab-generated-id-token",ref:Ge,hidden:!0,children:e(Lt,{text:he,user:G,label:"generatedIdToken"})}),e(lt,{"aria-labelledby":n("generatedUserInfo"),eventKey:4,id:"tab-generated-user-info",ref:Me,hidden:!0,children:e(Lt,{text:w,user:G,label:"generatedUserInfo"})})]}),e(rn,{span:4,children:r(zi,{id:"tabs",isVertical:!0,activeKey:T,onSelect:(R,F)=>g(F),children:[e(ie,{id:"effectiveProtocolMappers","aria-controls":"effectiveProtocolMappers",eventKey:0,title:r(se,{children:[n("effectiveProtocolMappers")," ",e(I,{fieldLabelId:"clients:effectiveProtocolMappers",helpText:"clients-help:effectiveProtocolMappers",noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:ke}),e(ie,{id:"effectiveRoleScopeMappings","aria-controls":"effectiveRoleScopeMappings",eventKey:1,title:r(se,{children:[n("effectiveRoleScopeMappings")," ",e(I,{fieldLabelId:"clients:effectiveRoleScopeMappings",helpText:"clients-help:effectiveRoleScopeMappings",noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:Ke}),e(ie,{id:"generatedAccessToken","aria-controls":"generatedAccessToken",eventKey:2,title:r(se,{children:[n("generatedAccessToken")," ",e(I,{fieldLabelId:"clients:generatedAccessToken",helpText:"clients-help:generatedAccessToken",noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:je}),e(ie,{id:"generatedIdToken","aria-controls":"generatedIdToken",eventKey:3,title:r(se,{children:[n("generatedIdToken")," ",e(I,{fieldLabelId:"clients:generatedIdToken",helpText:"clients-help:generatedIdToken",noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:Ge}),e(ie,{id:"generatedUserInfo","aria-controls":"generatedUserInfo",eventKey:4,title:r(se,{children:[n("generatedUserInfo")," ",e(I,{fieldLabelId:"clients:generatedUserInfo",helpText:"clients-help:generatedUserInfo",noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:Me})]},A)})]})]})};const Ns=({client:t})=>{const{t:i}=L("clients"),{adminClient:a}=ne(),{addAlert:n,addError:s}=de(),{realm:l}=pe(),[o,c]=u.exports.useState(),{hasAccess:p}=ze(),h=p("manage-clients");oe(()=>a.clients.getServiceAccountUser({id:t.id}),y=>c(y),[]);const d=async y=>{try{const f=y.filter(m=>m.client===void 0).map(m=>m.role).flat();await a.users.addRealmRoleMappings({id:o?.id,roles:f}),await Promise.all(y.filter(m=>m.client!==void 0).map(m=>a.users.addClientRoleMappings({id:o?.id,clientUniqueId:m.client.id,roles:[m.role]}))),n(i("roleMappingUpdatedSuccess"),ee.success)}catch(f){s("clients:roleMappingUpdatedError",f)}};return o?r(j,{children:[r(me,{className:"pf-u-pb-0",children:[e(Rn,{className:"pf-c-alert__icon keycloak--service-account--info-text"}),e("span",{className:"pf-u-pl-sm",children:r(_n,{i18nKey:"clients-help:manageServiceAccountUser",children:["",e(fe,{to:oi({realm:l,id:o.id,tab:"settings"}),children:{link:o.username}})]})})]}),e(Hi,{name:t.clientId,id:o.id,type:"users",isManager:h||t.access?.configure,save:d})]}):e(we,{})},Xn=async(t,i,a,n,s)=>{try{const l=new FormData,{file:o,...c}=t;Object.entries(c).map(([p,h])=>l.append(p==="format"?"keystoreFormat":p,h.toString())),l.append("file",o),await n.clients.uploadKey({id:i,attr:a},l),s()}catch(l){s(l)}},Ds=({id:t,attr:i,onClose:a,onCancel:n})=>{const{t:s}=L("clients"),[l,o]=u.exports.useState(!1),[c,p]=u.exports.useState(),h=Ee(),{handleSubmit:d,formState:{isDirty:y}}=h,{adminClient:f}=ne(),{addAlert:m,addError:S}=de(),x=g=>{Xn(g,t,i,f,k=>{k?S("clients:importError",k):m(s("importSuccess"),ee.success)})},T=async()=>{try{const g=await f.clients.generateKey({id:t,attr:i});p(g),Qe.saveAs(new Blob([g.privateKey],{type:"application/octet-stream"}),"private.key"),m(s("generateSuccess"),ee.success)}catch(g){S("clients:generateError",g)}};return r(_e,{variant:tt.medium,"aria-labelledby":s("enableClientSignatureRequired"),header:r(Oe,{children:[e($t,{headingLevel:"h1",children:s("enableClientSignatureRequired")}),e(ue,{children:s("enableClientSignatureRequiredExplain")})]}),isOpen:!0,onClose:a,actions:[e(D,{id:"modal-confirm","data-testid":"confirm",variant:"primary",isDisabled:!y&&!c,onClick:()=>{l&&d(x)(),a()},children:s("confirm")},"confirm"),e(D,{id:"modal-cancel","data-testid":"cancel",variant:ye.link,onClick:n,children:s("common:cancel")},"cancel")],children:[e(Se,{isHorizontal:!0,children:e(b,{label:s("selectMethod"),fieldId:"selectMethod",hasNoPaddingTop:!0,children:r(Wi,{children:[e(cn,{children:e(ut,{isChecked:!l,name:"selectMethodType",onChange:()=>o(!1),label:s("selectMethodType.generate"),id:"selectMethodType-generate"})}),e(cn,{children:e(ut,{isChecked:l,name:"selectMethodType",onChange:()=>o(!0),label:s("selectMethodType.import"),id:"selectMethodType-import"})})]})})}),!l&&e(Se,{children:e(b,{label:s("certificate"),fieldId:"certificate",labelIcon:e(I,{helpText:"clients-help:certificate",fieldLabelId:"clients:certificate"}),children:r(Xe,{hasGutter:!0,children:[e(Te,{isFilled:!0,children:e(Qt,{plain:!0,keyInfo:c})}),e(Te,{children:e(D,{variant:"secondary","data-testid":"generate",onClick:T,children:s("generate")})})]})})}),l&&e(Le,{...h,children:e(xt,{useFile:!0})})]})},Us=({id:t,attr:i,onClose:a})=>{const{t:n}=L("clients"),s=ae(),{handleSubmit:l}=s,{adminClient:o}=ne(),{addAlert:c,addError:p}=de(),h=d=>{Xn(d,t,i,o,y=>{y?p("clients:importError",y):c(n("importSuccess"),ee.success)})};return e(Ht,{open:!0,toggleDialog:a,continueButtonLabel:"clients:import",titleKey:"clients:importKey",onConfirm:()=>{l(h)(),a()},children:e(Le,{...s,children:e(xt,{useFile:!0,hasPem:!0})})})},Ks=({clientId:t,close:i})=>{const{t:a}=L("clients"),{realm:n}=pe(),{adminClient:s}=ne(),{addAlert:l,addError:o}=de(),c=Ee({defaultValues:{realmAlias:n}}),p=async h=>{try{const d=await s.clients.downloadKey({id:t,attr:"saml.signing"},h);Qe.saveAs(new Blob([d],{type:"application/octet-stream"}),`keystore.${h.format=="PKCS12"?"p12":"jks"}`),l(a("samlKeysExportSuccess")),i()}catch(d){o("clients:samlKeysExportError",d)}};return e(_e,{variant:"medium",title:a("exportSamlKeyTitle"),isOpen:!0,onClose:i,actions:[e(D,{id:"modal-confirm","data-testid":"confirm",type:"submit",form:"export-saml-key-form",children:a("common:export")},"confirm"),e(D,{id:"modal-cancel","data-testid":"cancel",variant:"link",onClick:()=>{i()},children:a("common:cancel")},"cancel")],children:e(Se,{id:"export-saml-key-form",className:"pf-u-pt-lg",onSubmit:c.handleSubmit(p),children:e(Le,{...c,children:e(xt,{isSaml:!0})})})})},_t=["saml.signing","saml.encryption"],Je={"saml.signing":{name:N("attributes.saml.client.signature"),title:"signingKeysConfig",key:"clientSignature"},"saml.encryption":{name:N("attributes.saml.encrypt"),title:"encryptionKeysConfig",key:"encryptAssertions"}},Ms=({clientId:t,keyInfo:i,attr:a,onChanged:n,onGenerate:s,onImport:l})=>{const{t:o}=L("clients"),{control:c,watch:p}=ae(),h=Je[a].title,d=Je[a].key,y=Je[a].name,[f,m]=ve(),S=p(y);return r(j,{children:[f&&e(Ks,{clientId:t,close:m}),r(Mt,{title:o(h),className:"kc-form-panel__panel",children:[e(Oe,{className:"pf-u-pb-lg",children:e(ue,{children:o(`${h}Explain`)})}),e(re,{role:"manage-clients",isHorizontal:!0,children:e(b,{labelIcon:e(I,{helpText:`clients-help:${d}`,fieldLabelId:`clients:${d}`}),label:o(d),fieldId:d,hasNoPaddingTop:!0,children:e(M,{name:y,control:c,defaultValue:"false",render:({onChange:x,value:T})=>e(ce,{"data-testid":d,id:d,label:o("common:on"),labelOff:o("common:off"),isChecked:T==="true",onChange:g=>{const k=g.toString();k==="true"?(n(a),x(k)):s(a,!1)},"aria-label":o(d)})})})})]}),i?.certificate&&S==="true"&&e(bt,{isFlat:!0,children:e(We,{className:"kc-form-panel__body",children:r(Se,{isHorizontal:!0,children:[e(Qt,{keyInfo:i}),r(be,{children:[e(D,{variant:"secondary",onClick:()=>s(a,!0),children:o("regenerate")}),e(D,{variant:"secondary",onClick:()=>l(a),children:o("importKey")}),e(D,{variant:"tertiary",onClick:m,children:o("common:export")})]})]})})})]})},Fs=({clientId:t,save:i})=>{const{t:a}=L("clients"),[n,s]=u.exports.useState(),[l,o]=u.exports.useState(),[c,p]=u.exports.useState(),[h,d]=u.exports.useState(!1),[y,f]=u.exports.useState(0),{setValue:m}=ae(),{adminClient:S}=ne(),{addAlert:x,addError:T}=de();oe(()=>Promise.all(_t.map(q=>S.clients.getKeyInfo({id:t,attr:q}))),q=>o(q),[y]);const g=async q=>{const A=_t.indexOf(q);try{const B=[...l||[]];B[A]=await S.clients.generateKey({id:t,attr:q}),o(B),Qe.saveAs(new Blob([B[A].privateKey],{type:"application/octet-stream"}),"private.key"),x(a("generateSuccess"),ee.success)}catch(B){T("clients:generateError",B)}},k=c?Je[c].key:"",[Y,J]=xe({titleKey:a("disableSigning",{key:a(k)}),messageKey:a("disableSigningExplain",{key:a(k)}),continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",onConfirm:()=>{m(Je[c].name,"false"),i()}}),[_,G]=xe({titleKey:"clients:reGenerateSigning",messageKey:"clients:reGenerateSigningExplain",continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",onConfirm:()=>{g(c)}});return r(me,{variant:"light",className:"keycloak__form",children:[n&&e(Ds,{id:t,attr:n,onClose:()=>{s(void 0),i(),f(y+1)},onCancel:()=>{m(Je[c].name,"false"),s(void 0)}}),e(J,{}),e(G,{}),_t.map((q,A)=>r(u.exports.Fragment,{children:[h&&e(Us,{id:t,attr:q,onClose:()=>d(!1)}),e(Ms,{clientId:t,keyInfo:l?.[A],attr:q,onChanged:s,onGenerate:(B,U)=>{p(B),U?_():Y()},onImport:()=>d(!0)})]},q))]})},Bs=({onConfirm:t,closeDialog:i})=>{const{t:a}=L("clients"),[n,s]=u.exports.useState({});return r(_e,{title:a("import"),isOpen:!0,variant:"small",onClose:i,actions:[e(D,{id:"modal-confirm",onClick:()=>{t(n),i()},"data-testid":"confirm",children:a("confirm")},"confirm"),e(D,{"data-testid":"cancel",id:"modal-cancel",variant:ye.link,onClick:()=>{i()},children:a("common:cancel")},"cancel")],children:[e(Se,{children:e(Ji,{id:"import-resource",onChange:s})}),Object.keys(n).length!==0&&r(j,{children:[e(Be,{}),e("p",{className:"pf-u-my-lg",children:a("importResources")}),r(Se,{isHorizontal:!0,children:[e(b,{label:a("policyEnforcementMode"),labelIcon:e(I,{helpText:"clients-help:policyEnforcementMode",fieldLabelId:"clients:policyEnforcementMode"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0,children:e(ut,{id:"policyEnforcementMode",name:"policyEnforcementMode",label:a(`policyEnforcementModes.${n.policyEnforcementMode}`),isChecked:!0,isDisabled:!0,className:"pf-u-mb-md"})}),e(b,{label:a("decisionStrategy"),labelIcon:e(I,{helpText:"clients-help:decisionStrategy",fieldLabelId:"clients:decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(ut,{id:"decisionStrategy",name:"decisionStrategy",isChecked:!0,isDisabled:!0,label:a(`decisionStrategies.${n.decisionStrategy}`),className:"pf-u-mb-md"})}),e(b,{hasNoPaddingTop:!0,label:a("allowRemoteResourceManagement"),fieldId:"allowRemoteResourceManagement",labelIcon:e(I,{helpText:a("allowRemoteResourceManagement"),fieldLabelId:"clients:allowRemoteResourceManagement"}),children:e(ce,{id:"allowRemoteResourceManagement",label:a("common:on"),labelOff:a("common:off"),isChecked:n.allowRemoteResourceManagement,isDisabled:!0,"aria-label":a("allowRemoteResourceManagement")})})]}),e("div",{className:"pf-u-mt-md",children:Object.entries(n).filter(([,l])=>Array.isArray(l)).map(([l,o])=>r(u.exports.Fragment,{children:[e(Be,{}),e("p",{className:"pf-u-my-sm",children:r("strong",{children:[o.length," ",a(l)]})})]},l))}),e(Be,{}),e(qe,{variant:"warning",className:"pf-u-mt-lg",isInline:!0,title:a("importWarning")})]})]})},yn=["ENFORCING","PERMISSIVE","DISABLED"],Vs=({clientId:t})=>{const{t:i}=L("clients"),[a,n]=u.exports.useState(),[s,l]=ve(),o=Ee({}),{control:c,reset:p,handleSubmit:h}=o,{adminClient:d}=ne(),{addAlert:y,addError:f}=de();oe(()=>d.clients.getResourceServer({id:t}),x=>{n(x),p(x)},[]);const m=async x=>{try{await d.clients.importResource({id:t},x),y(i("importResourceSuccess"),ee.success),p({...x})}catch(T){f("clients:importResourceError",T)}},S=async x=>{try{await d.clients.updateResourceServer({id:t},x),y(i("updateResourceSuccess"),ee.success)}catch(T){f("clients:resourceSaveError",T)}};return a?r(me,{variant:"light",children:[s&&e(Bs,{onConfirm:m,closeDialog:l}),r(re,{role:"view-clients",isHorizontal:!0,children:[e(b,{label:i("import"),fieldId:"import",labelIcon:e(I,{helpText:"clients-help:import",fieldLabelId:"clients:import"}),children:e(D,{variant:"secondary",onClick:l,children:i("import")})}),e(Be,{}),e(b,{label:i("policyEnforcementMode"),labelIcon:e(I,{helpText:"clients-help:policyEnforcementMode",fieldLabelId:"clients:policyEnforcementMode"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0,children:e(M,{name:"policyEnforcementMode","data-testid":"policyEnforcementMode",defaultValue:yn[0],control:c,render:({onChange:x,value:T})=>e(j,{children:yn.map(g=>e(ut,{id:g,"data-testid":g,isChecked:T===g,name:"policyEnforcementMode",onChange:()=>x(g),label:i(`policyEnforcementModes.${g}`),className:"pf-u-mb-md"},g))})})}),e(Le,{...o,children:e(Li,{isLimited:!0})}),e(b,{hasNoPaddingTop:!0,label:i("allowRemoteResourceManagement"),fieldId:"allowRemoteResourceManagement",labelIcon:e(I,{helpText:"clients-help:allowRemoteResourceManagement",fieldLabelId:"clients:allowRemoteResourceManagement"}),children:e(M,{name:"allowRemoteResourceManagement","data-testid":"allowRemoteResourceManagement",defaultValue:!1,control:c,render:({onChange:x,value:T})=>e(ce,{id:"allowRemoteResourceManagement",label:i("common:on"),labelOff:i("common:off"),isChecked:T,onChange:x,"aria-label":i("allowRemoteResourceManagement")})})}),e(Yt,{name:"authenticationSettings",save:()=>h(S)(),reset:()=>p(a),isActive:!0})]})]}):e(we,{})};function qs(t){return e(Ve,{...t})}function Ve({name:t,array:i,convert:a,link:n}){const{t:s}=L("clients");return r(Yi,{children:[e(Qi,{children:s(t)}),r(Xi,{children:[i?.map(l=>{const o=typeof l=="string"?l:a(l);return n?e(fe,{to:n(l),className:"pf-u-pr-sm",children:o},o):e("span",{className:"pf-u-pr-sm",children:o},o)}),i?.length===0&&e("i",{children:s("common:none")})]})]})}const zs=({id:t,clientId:i,uris:a})=>{const{adminClient:n}=ne(),{realm:s}=pe(),[l,o]=u.exports.useState(),[c,p]=u.exports.useState();return oe(()=>Promise.all([n.clients.listScopesByResource({id:i,resourceName:t}),n.clients.listPermissionsByResource({id:i,resourceId:t})]),([h,d])=>{o(h),p(d)},[]),!c||!l?e(we,{}):r(nt,{isHorizontal:!0,className:"keycloak_resource_details",children:[e(qs,{name:"uris",array:a}),e(Ve,{name:"scopes",array:l,convert:h=>h.name,link:h=>An({id:i,realm:s,scopeId:h.id})}),e(Ve,{name:"associatedPermissions",array:c,convert:h=>h.name,link:h=>mt({id:i,realm:s,permissionId:h.id,permissionType:"resource"})})]})},pt=({array:t})=>{const{t:i}=L("clients");return!t||t.length<=1?null:e(Ut,{color:"blue",children:i("common:more",{count:t.length-1})})};const Xt=({types:t,search:i,onSearch:a,isResource:n=!1})=>{const{t:s}=L("clients"),{register:l,control:o,reset:c,formState:{isDirty:p},handleSubmit:h}=Ee({mode:"onChange"}),[d,y]=ve(),[f,m]=ve(),S=T=>{y(),a(T)};u.exports.useEffect(()=>c(i),[i]);const x=T=>[e(V,{value:"",children:s("allTypes")},"empty"),...(t||[]).map(g=>e(V,{selected:g.type===T,value:g.type,children:g.name},g.type))];return e(zt,{"data-testid":"searchdropdown_dorpdown",className:"pf-u-ml-md",toggle:e(On,{onToggle:y,className:"keycloak__client_authentication__searchdropdown",children:s("searchForPermission")}),isOpen:d,children:r(Se,{isHorizontal:!0,className:"keycloak__client_authentication__searchdropdown_form",onSubmit:h(S),children:[e(b,{label:s("common:name"),fieldId:"name",children:e(Z,{ref:l,type:"text",id:"name",name:"name","data-testid":"searchdropdown_name"})}),n&&r(j,{children:[e(b,{label:s("common:type"),fieldId:"type",children:e(Z,{ref:l,type:"text",id:"type",name:"type","data-testid":"searchdropdown_type"})}),e(b,{label:s("uris"),fieldId:"uri",children:e(Z,{ref:l,type:"text",id:"uri",name:"uri","data-testid":"searchdropdown_uri"})}),e(b,{label:s("owner"),fieldId:"owner",children:e(Z,{ref:l,type:"text",id:"owner",name:"owner","data-testid":"searchdropdown_owner"})})]}),!n&&e(b,{label:s("resource"),fieldId:"resource",children:e(Z,{ref:l,type:"text",id:"resource",name:"resource","data-testid":"searchdropdown_resource"})}),e(b,{label:s("scope"),fieldId:"scope",children:e(Z,{ref:l,type:"text",id:"scope",name:"scope","data-testid":"searchdropdown_scope"})}),!n&&e(b,{label:s("common:type"),fieldId:"type",children:e(M,{name:"type",defaultValue:"",control:o,render:({onChange:T,value:g})=>e(X,{toggleId:"type",onToggle:m,onSelect:(k,Y)=>{k.stopPropagation(),T(Y),m()},selections:g||s("allTypes"),variant:Q.single,"aria-label":s("common:type"),isOpen:f,children:x(g)})})}),r(be,{children:[e(D,{variant:"primary",type:"submit","data-testid":"search-btn",isDisabled:!p,children:s("common:search")}),e(D,{variant:"link","data-testid":"revert-btn",onClick:()=>a({}),children:s("common:clear")})]})]})})},js=({clientId:t})=>{const{t:i}=L("clients"),a=Ze(),{adminClient:n}=ne(),{addAlert:s,addError:l}=de(),{realm:o}=pe(),[c,p]=u.exports.useState(),[h,d]=u.exports.useState(),[y,f]=u.exports.useState(),[m,S]=u.exports.useState(0),x=()=>S(m+1),[T,g]=u.exports.useState(10),[k,Y]=u.exports.useState(0),[J,_]=u.exports.useState({});oe(()=>{const C={first:k,max:T+1,deep:!1,...J};return n.clients.listResources({...C,id:t})},C=>p(C.map(v=>({...v,isExpanded:!1}))),[m,J,k,T]);const G=({row:C})=>r(j,{children:[C.uris?.[0]," ",e(pt,{array:C.uris})]}),q=async C=>n.clients.listPermissionsByResource({id:t,resourceId:C}),[A,B]=xe({titleKey:"clients:deleteResource",children:r(j,{children:[i("deleteResourceConfirm"),y?.length&&e(qe,{variant:"warning",isInline:!0,isPlain:!0,title:i("deleteResourceWarning"),className:"pf-u-pt-lg",children:e("p",{className:"pf-u-pt-xs",children:y.map(C=>e("strong",{className:"pf-u-pr-md",children:C.name},C.id))})})]}),continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await n.clients.delResource({id:t,resourceId:h?._id}),s(i("resourceDeletedSuccess"),ee.success),x()}catch(C){l("clients:resourceDeletedError",C)}}});if(!c)return e(we,{});const U=c.length===0,z=Object.keys(J).length!==0;return r(me,{variant:"light",className:"pf-u-p-0",children:[e(B,{}),(!U||z)&&e(Tt,{count:c.length,first:k,max:T,onNextClick:Y,onPreviousClick:Y,onPerPageSelect:(C,v)=>{Y(C),g(v)},toolbarItem:r(j,{children:[e(ge,{children:e(Xt,{search:J,onSearch:_,isResource:!0})}),e(ge,{children:e(D,{"data-testid":"createResource",component:C=>e(fe,{...C,to:Zt({realm:o,id:t})}),children:i("createResource")})})]}),children:!U&&r(Ne,{"aria-label":i("resources"),variant:"compact",children:[e(De,{children:r(le,{children:[e(W,{}),e(W,{children:i("common:name")}),e(W,{children:i("common:type")}),e(W,{children:i("owner")}),e(W,{children:i("uris")}),e(W,{}),e(W,{})]})}),c.map((C,v)=>r(Ue,{isExpanded:C.isExpanded,children:[r(le,{children:[e(K,{expand:{rowIndex:v,isExpanded:C.isExpanded,onToggle:(P,E)=>{const O=c.map((w,H)=>H===E?{...w,isExpanded:!w.isExpanded}:w);p(O)}}}),e(K,{"data-testid":`name-column-${C.name}`,children:e(fe,{to:wn({realm:o,id:t,resourceId:C._id}),children:C.name})}),e(K,{children:C.type}),e(K,{children:C.owner?.name}),e(K,{children:e(G,{row:C})}),e(K,{width:10,children:e(D,{variant:"link",component:P=>e(fe,{...P,to:dt({realm:o,id:t,permissionType:"resource",selectedId:C._id})}),children:i("createPermission")})}),e(K,{actions:{items:[{title:i("common:delete"),onClick:async()=>{d(C),f(await q(C._id)),A()}}]}})]}),r(le,{isExpanded:C.isExpanded,children:[e(K,{}),e(K,{colSpan:4,children:e(it,{children:C.isExpanded&&e(zs,{clientId:t,id:C._id,uris:C.uris})})})]},`child-${C._id}`)]},C._id))]})}),U&&z&&e(Ce,{isSearchVariant:!0,message:i("common:noSearchResults"),instructions:i("common:noSearchResultsInstructions")}),U&&!z&&e(Ce,{message:i("emptyResources"),instructions:i("emptyResourcesInstructions"),primaryActionText:i("createResource"),onPrimaryAction:()=>a(Zt({realm:o,id:t}))})]})},Gs=({clientId:t})=>{const{t:i}=L("clients"),a=Ze(),{adminClient:n}=ne(),{realm:s}=pe(),[l,o]=ve(),[c,p]=u.exports.useState(),[h,d]=u.exports.useState(),[y,f]=u.exports.useState(0),m=()=>f(y+1),[S,x]=u.exports.useState(10),[T,g]=u.exports.useState(0),[k,Y]=u.exports.useState("");oe(async()=>{const A={first:T,max:S+1,deep:!1,name:k},B=await n.clients.listAllScopes({...A,id:t});return await Promise.all(B.map(async U=>{const z={id:t,scopeId:U.id},[C,v]=await Promise.all([n.clients.listAllResourcesByScope(z),n.clients.listAllPermissionsByScope(z)]);return{...U,resources:C,permissions:v,isExpanded:!1}}))},p,[y,k,T,S]);const J=({row:A})=>r(j,{children:[A.resources?.[0]?.name?A.resources[0]?.name:"\u2014"," ",e(pt,{array:A.resources})]}),_=({row:A})=>r(j,{children:[A.permissions?.[0]?.name?A.permissions[0]?.name:"\u2014"," ",e(pt,{array:A.permissions})]});if(!c)return e(we,{});const G=c.length===0,q=k!=="";return r(me,{variant:"light",className:"pf-u-p-0",children:[e(Zi,{clientId:t,open:l,toggleDialog:o,selectedScope:h,refresh:m}),(!G||q)&&e(Tt,{count:c.length,first:T,max:S,onNextClick:g,onPreviousClick:g,onPerPageSelect:(A,B)=>{g(A),x(B)},inputGroupName:"search",inputGroupPlaceholder:i("searchByName"),inputGroupOnEnter:Y,toolbarItem:e(ge,{children:e(D,{"data-testid":"createAuthorizationScope",component:A=>e(fe,{...A,to:en({realm:s,id:t})}),children:i("createAuthorizationScope")})}),children:!G&&r(Ne,{"aria-label":i("scopes"),variant:"compact",children:[e(De,{children:r(le,{children:[e(W,{}),e(W,{children:i("common:name")}),e(W,{children:i("resources")}),e(W,{children:i("common:permissions")}),e(W,{}),e(W,{})]})}),c.map((A,B)=>r(Ue,{isExpanded:A.isExpanded,children:[r(le,{children:[e(K,{expand:{rowIndex:B,isExpanded:A.isExpanded,onToggle:(U,z)=>{const C=c.map((v,P)=>P===z?{...v,isExpanded:!v.isExpanded}:v);p(C)}}}),e(K,{"data-testid":`name-column-${A.name}`,children:e(fe,{to:An({realm:s,id:t,scopeId:A.id}),children:A.name})}),e(K,{children:e(J,{row:A})}),e(K,{children:e(_,{row:A})}),e(K,{width:10,children:e(D,{variant:"link",component:U=>e(fe,{...U,to:dt({realm:s,id:t,permissionType:"scope",selectedId:A.id})}),children:i("createPermission")})}),e(K,{isActionCell:!0,actions:{items:[{title:i("common:delete"),onClick:()=>{d(A),o()}}]}})]}),r(le,{isExpanded:A.isExpanded,children:[e(K,{}),e(K,{colSpan:4,children:e(it,{children:A.isExpanded&&r(nt,{isHorizontal:!0,className:"keycloak_resource_details",children:[e(Ve,{name:"resources",array:A.resources,convert:U=>U.name,link:U=>wn({id:t,realm:s,resourceId:U._id})}),e(Ve,{name:"associatedPermissions",array:A.permissions,convert:U=>U.name,link:U=>mt({id:t,realm:s,permissionId:U.id,permissionType:U.type})})]})})})]},`child-${A.id}`)]},A.id))]})}),G&&!q&&e(Ce,{message:i("emptyAuthorizationScopes"),instructions:i("emptyAuthorizationInstructions"),onPrimaryAction:()=>a(en({id:t,realm:s})),primaryActionText:i("createAuthorizationScope")}),G&&q&&e(Ce,{isSearchVariant:!0,message:i("common:noSearchResults"),instructions:i("common:noSearchResultsInstructions")})]})},Sn=({policyProviders:t,onSelect:i,toggleDialog:a})=>{const{t:n}=L("clients"),s=Kn(),l=u.exports.useMemo(()=>t?s(t,Mn("name")):[],[t]);return e(_e,{"aria-labelledby":n("addPredefinedMappers"),variant:tt.medium,header:r(Oe,{children:[e(ue,{component:Nn.h1,children:n("chooseAPolicyType")}),e(ue,{children:n("chooseAPolicyTypeInstructions")})]}),isOpen:!0,onClose:a,children:r(Ne,{"aria-label":n("policies"),variant:"compact",children:[e(De,{children:r(le,{children:[e(W,{children:n("common:name")}),e(W,{children:n("common:description")})]})}),e(Ue,{children:l.map(o=>r(le,{"data-testid":o.type,onRowClick:()=>i(o),isHoverable:!0,children:[e(K,{children:o.name}),e(K,{children:_i(o.type)&&n(`policyProvider.${o.type}`)})]},o.type))})]})})},Hs=({clientId:t})=>{const{t:i}=L("clients"),{adminClient:a}=ne(),{addAlert:n,addError:s}=de(),{realm:l}=pe(),o=Ze(),[c,p]=u.exports.useState(),[h,d]=u.exports.useState(),[y,f]=u.exports.useState(),[m,S]=u.exports.useState(0),x=()=>S(m+1),[T,g]=u.exports.useState(10),[k,Y]=u.exports.useState(0),[J,_]=u.exports.useState({}),[G,q]=ve();oe(async()=>{const v=await a.clients.listPolicies({first:k,max:T+1,id:t,permission:"false",...J});return await Promise.all([a.clients.listPolicyProviders({id:t}),...(v||[]).map(async P=>{const E=await a.clients.listDependentPolicies({id:t,policyId:P.id});return{...P,dependentPolicies:E,isExpanded:!1}})])},([v,...P])=>{f(v.filter(E=>E.type!=="resource"&&E.type!=="scope")),p(P)},[m,J,k,T]);const A=({row:v})=>r(j,{children:[v.dependentPolicies?.[0]?.name," ",e(pt,{array:v.dependentPolicies})]}),[B,U]=xe({titleKey:"clients:deletePolicy",children:r(j,{children:[i("deletePolicyConfirm"),h?.dependentPolicies&&h.dependentPolicies.length>0&&e(qe,{variant:"warning",isInline:!0,isPlain:!0,title:i("deletePolicyWarning"),className:"pf-u-pt-lg",children:e("p",{className:"pf-u-pt-xs",children:h.dependentPolicies.map(v=>e("strong",{className:"pf-u-pr-md",children:v.name},v.id))})})]}),continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await a.clients.delPolicy({id:t,policyId:h?.id}),n(i("policyDeletedSuccess"),ee.success),x()}catch(v){s("clients:policyDeletedError",v)}}});if(!c)return e(we,{});const z=c.length===0,C=Object.keys(J).length!==0;return r(me,{variant:"light",className:"pf-u-p-0",children:[e(U,{}),(!z||C)&&r(j,{children:[G&&e(Sn,{policyProviders:y,onSelect:v=>o(tn({id:t,realm:l,policyType:v.type})),toggleDialog:q}),e(Tt,{count:c.length,first:k,max:T,onNextClick:Y,onPreviousClick:Y,onPerPageSelect:(v,P)=>{Y(v),g(P)},toolbarItem:r(j,{children:[e(ge,{children:e(Xt,{types:y,search:J,onSearch:_})}),e(ge,{children:e(D,{"data-testid":"createPolicy",onClick:q,children:i("createPolicy")})})]}),children:!z&&r(Ne,{"aria-label":i("resources"),variant:"compact",children:[e(De,{children:r(le,{children:[e(W,{}),e(W,{children:i("common:name")}),e(W,{children:i("common:type")}),e(W,{children:i("dependentPermission")}),e(W,{children:i("common:description")}),e(W,{})]})}),c.map((v,P)=>r(Ue,{isExpanded:v.isExpanded,children:[r(le,{children:[e(K,{expand:{rowIndex:P,isExpanded:v.isExpanded,onToggle:(E,O)=>{const w=c.map((H,he)=>he===O?{...H,isExpanded:!H.isExpanded}:H);p(w)}}}),e(K,{"data-testid":`name-column-${v.name}`,children:e(fe,{to:jt({realm:l,id:t,policyType:v.type,policyId:v.id}),children:v.name})}),e(K,{children:St(v.type)}),e(K,{children:e(A,{row:v})}),e(K,{children:v.description}),e(K,{actions:{items:[{title:i("common:delete"),onClick:async()=>{d(v),B()}}]}})]}),r(le,{isExpanded:v.isExpanded,children:[e(K,{}),e(K,{colSpan:4,children:e(it,{children:v.isExpanded&&e(nt,{isHorizontal:!0,className:"keycloak_resource_details",children:e(Ve,{name:"dependentPermission",array:v.dependentPolicies,convert:E=>E.name,link:E=>mt({realm:l,id:t,permissionId:E.id,permissionType:E.type})})})})})]},`child-${v.id}`)]},v.id))]})})]}),z&&C&&e(Ce,{isSearchVariant:!0,message:i("common:noSearchResults"),instructions:i("common:noSearchResultsInstructions")}),z&&!C&&r(j,{children:[G&&e(Sn,{policyProviders:y?.filter(v=>v.type!=="aggregate"),onSelect:v=>o(tn({id:t,realm:l,policyType:v.type})),toggleDialog:q}),e(Ce,{message:i("emptyPolicies"),instructions:i("emptyPoliciesInstructions"),primaryActionText:i("createPolicy"),onPrimaryAction:q})]})]})},vn=({permissionType:t,disabled:i=!1,clientId:a})=>{const{t:n}=L("clients"),{realm:s}=pe(),l=Ze();return e(D,{"data-testid":`create-${t}`,className:i?"keycloak__permissions__empty_state ":"pf-u-m-sm",variant:"secondary",onClick:()=>!i&&l(dt({realm:s,id:a,permissionType:t})),children:n(`create${St(t)}BasedPermission`)})},In=({permissionType:t,disabled:i,...a})=>{const{t:n}=L("clients");return i?e(qt,{content:n(`no${St(t)}CreateHint`),children:e(vn,{...a,disabled:i,permissionType:t})}):e(vn,{...a,disabled:i,permissionType:t})},$s=({clientId:t,isResourceEnabled:i,isScopeEnabled:a})=>{const{t:n}=L("clients");return r(Fn,{"data-testid":"empty-state",variant:"large",children:[e(es,{icon:qn}),e($t,{headingLevel:"h1",size:"lg",children:n("emptyPermissions")}),e(Bn,{children:n("emptyPermissionInstructions")}),e(In,{permissionType:"resource",disabled:i,clientId:t}),e("br",{}),e(In,{permissionType:"scope",disabled:a,clientId:t})]})};const Ws=({clientId:t})=>{const{t:i}=L("clients"),a=Ze(),{adminClient:n}=ne(),{addAlert:s,addError:l}=de(),{realm:o}=pe(),[c,p]=u.exports.useState(),[h,d]=u.exports.useState(),[y,f]=u.exports.useState(),[m,S]=u.exports.useState(),[x,T]=ve(),[g,k]=u.exports.useState({}),[Y,J]=u.exports.useState(0),_=()=>J(Y+1),[G,q]=u.exports.useState(10),[A,B]=u.exports.useState(0),U=({row:E})=>r(j,{children:[E.associatedPolicies?.[0]?.name," ",e(pt,{array:E.associatedPolicies})]});oe(async()=>{const E=await n.clients.findPermissions({first:A,max:G+1,id:t,...g});return await Promise.all(E.map(async O=>{const w=await n.clients.getAssociatedPolicies({id:t,permissionId:O.id});return{...O,associatedPolicies:w,isExpanded:!1}}))},p,[Y,g,A,G]),oe(async()=>{const E={first:0,max:1},[O,w,H]=await Promise.all([n.clients.listPolicyProviders({id:t}),n.clients.listResources({...E,id:t}),n.clients.listAllScopes({...E,id:t})]);return{policies:O.filter(he=>he.type==="resource"||he.type==="scope"),resources:w.length!==1,scopes:H.length!==1}},({policies:E,resources:O,scopes:w})=>{f(E),S({resources:O,scopes:w})},[]);const[z,C]=xe({titleKey:"clients:deletePermission",messageKey:i("deletePermissionConfirm",{permission:h?.name}),continueButtonVariant:ye.danger,continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await n.clients.delPermission({id:t,type:h?.type,permissionId:h?.id}),s(i("permissionDeletedSuccess"),ee.success),_()}catch(E){l("clients:permissionDeletedError",E)}}});if(!c)return e(we,{});const v=c.length===0,P=Object.keys(g).length!==0;return r(me,{variant:"light",className:"pf-u-p-0",children:[e(C,{}),(!v||P)&&e(Tt,{count:c.length,first:A,max:G,onNextClick:B,onPreviousClick:B,onPerPageSelect:(E,O)=>{B(E),q(O)},toolbarItem:r(j,{children:[e(ge,{children:e(Xt,{types:y,search:g,onSearch:k})}),e(ge,{children:e(zt,{toggle:e(On,{onToggle:T,isPrimary:!0,"data-testid":"permissionCreateDropdown",children:i("createPermission")}),isOpen:x,dropdownItems:[e($e,{"data-testid":"create-resource",isDisabled:m?.resources,component:"button",onClick:()=>a(dt({realm:o,id:t,permissionType:"resource"})),children:i("createResourceBasedPermission")},"createResourceBasedPermission"),e(ri,{},"separator"),r($e,{"data-testid":"create-scope",isDisabled:m?.scopes,component:"button",onClick:()=>a(dt({realm:o,id:t,permissionType:"scope"})),children:[i("createScopeBasedPermission"),m?.scopes&&e(qe,{className:"pf-u-mt-sm",variant:"warning",isInline:!0,isPlain:!0,title:i("noScopeCreateHint")})]},"createScopeBasedPermission")]})})]}),children:!v&&r(Ne,{"aria-label":i("resources"),variant:"compact",children:[e(De,{children:r(le,{children:[e(W,{}),e(W,{children:i("common:name")}),e(W,{children:i("common:type")}),e(W,{children:i("associatedPolicy")}),e(W,{children:i("common:description")}),e(W,{})]})}),c.map((E,O)=>r(Ue,{isExpanded:E.isExpanded,children:[r(le,{children:[e(K,{expand:{rowIndex:O,isExpanded:E.isExpanded,onToggle:(w,H)=>{const he=c.map((Re,ke)=>ke===H?{...Re,isExpanded:!Re.isExpanded}:Re);p(he)}}}),e(K,{"data-testid":`name-column-${E.name}`,children:e(fe,{to:mt({realm:o,id:t,permissionType:E.type,permissionId:E.id}),children:E.name})}),e(K,{children:y?.find(w=>w.type===E.type)?.name}),e(K,{children:e(U,{row:E})}),e(K,{children:E.description}),e(K,{actions:{items:[{title:i("common:delete"),onClick:async()=>{d(E),z()}}]}})]}),r(le,{isExpanded:E.isExpanded,children:[e(K,{}),e(K,{colSpan:5,children:e(it,{children:E.isExpanded&&e(nt,{isHorizontal:!0,className:"keycloak_resource_details",children:e(Ve,{name:"associatedPolicy",array:E.associatedPolicies,convert:w=>w.name,link:w=>jt({id:t,realm:o,policyId:w.id,policyType:w.type})})})})})]},`child-${E.id}`)]},E.id))]})}),v&&!P&&e($s,{clientId:t,isResourceEnabled:m?.resources,isScopeEnabled:m?.scopes}),v&&P&&e(Ce,{isSearchVariant:!0,message:i("common:noSearchResults"),instructions:i("common:noSearchResultsInstructions")})]})};const Js=({name:t,rowIndex:i,attribute:a,selectableValues:n,resources:s})=>{const{t:l}=L("common"),{control:o,register:c,getValues:p}=ae(),[h,d]=u.exports.useState([!1]),y=(x,T)=>{const g=[...h];g[x]=T,d(g)},f=u.exports.useMemo(()=>{let x=[];return n&&(x=Vn.find(T=>T.key===p().context?.[i]?.key)?.values),x},[p]),m=()=>{const x=s?.find(T=>T.name===p().resources?.[i]?.key)?.scopes;if(f?.length&&!s)return f.map(T=>e(V,{value:T.key,children:T.name},T.key));if(x?.length)return x.map(T=>e(V,{value:T.name,children:T.name},T.name))},S=x=>ts(x).replace(/\W/g,"");return e(K,{children:s||f?.length?e(M,{name:`${t}[${i}].value`,defaultValue:[],control:o,render:({onChange:x,value:T})=>e(X,{id:`${a.id}-value`,className:"kc-attribute-value-selectable",name:`${t}[${i}].value`,chipGroupProps:{numChips:1,expandedText:l("common:hide"),collapsedText:l("common:showRemaining")},toggleId:`group-${t}`,onToggle:g=>y(i,g),isOpen:h[i],variant:Q.typeahead,typeAheadAriaLabel:l("clients:selectOrTypeAKey"),placeholderText:l("clients:selectOrTypeAKey"),selections:T,onSelect:(g,k)=>{x(k),y(i,!1)},children:m()})}):e(Z,{id:`${S(a.key)}-value`,className:"value-input",name:`${t}[${i}].value`,ref:c(),defaultValue:a.value,"data-testid":"attribute-value-input"})})},Tn=({name:t,selectableValues:i,resources:a})=>{const{t:n}=L("common"),{control:s,watch:l}=ae(),{fields:o,append:c,remove:p}=yi({control:s,name:t}),[h,d]=u.exports.useState([!1]),y=(m,S)=>{const x=[...h];x[m]=S,d(x)};u.exports.useEffect(()=>{o.length||c({key:"",value:""},!1)},[o]);const f=l(`${t}[${o.length-1}].value`,"");return r(Ne,{className:"kc-attributes__table","aria-label":"Role attribute keys and values",variant:"compact",borders:!1,children:[e(De,{children:r(le,{children:[e(W,{id:"key",width:40,children:n("key")}),e(W,{id:"value",width:40,children:n("value")})]})}),r(Ue,{children:[o.map((m,S)=>r(le,{"data-testid":"attribute-row",children:[e(K,{children:e(M,{name:`${t}[${S}].key`,defaultValue:m.key,control:s,render:({onChange:x,value:T})=>e(X,{id:`${t}[${S}].key`,className:"kc-attribute-key-selectable",name:`${t}[${S}].key`,toggleId:`group-${t}`,onToggle:g=>y(S,g),isOpen:h[S],variant:Q.typeahead,typeAheadAriaLabel:n("clients:selectOrTypeAKey"),placeholderText:n("clients:selectOrTypeAKey"),selections:T,onSelect:(g,k)=>{x(k.toString()),y(S,!1)},children:i?.map(g=>e(V,{selected:g.name===T,value:a?g.name:g.key,children:g.name},g.key))})})}),e(Js,{name:t,attribute:m,rowIndex:S,selectableValues:i,resources:a}),e(K,{id:`kc-minus-button-${S}`,children:e(D,{id:`minus-button-${S}`,variant:"link",className:"kc-attributes__minus-icon",onClick:()=>p(S),children:e(ns,{})})},"minus-button")]},m.id)),e(le,{children:e(K,{children:e(D,{"aria-label":n("addAttribute"),id:"plus-icon",variant:"link",className:"kc-attributes__plus-icon",onClick:()=>{c({key:"",value:""}),d([...h,!1])},icon:e(qn,{}),isDisabled:!f,"data-testid":"attribute-add-row",children:n("addAttribute")})})})]})]})};var Nt;(function(t){t.AFFIRMATIVE="AFFIRMATIVE",t.UNANIMOUS="UNANIMOUS",t.CONSENSUS="CONSENSUS"})(Nt=Nt||(Nt={}));var ct;(function(t){t.Permit="PERMIT",t.Deny="DENY"})(ct=ct||(ct={}));var Dt;(function(t){t.POSITIVE="POSITIVE",t.NEGATIVE="NEGATIVE"})(Dt=Dt||(Dt={}));const Ys=({idx:t,rowIndex:i,outerPolicy:a,resource:n})=>{const[s,l]=u.exports.useState(!1),{t:o}=L("clients"),{realm:c}=pe(),{clientId:p}=Gt();return r(Ue,{isExpanded:s,children:[r(le,{children:[e(K,{expand:{rowIndex:i,isExpanded:s,onToggle:()=>l(h=>!h)}}),e(K,{"data-testid":`name-column-${n.resource}`,children:e(fe,{to:mt({realm:c,id:p,permissionType:a.policy?.type,permissionId:a.policy?.id}),children:a.policy?.name})}),e(K,{id:a.status?.toLowerCase(),children:o(a.status?.toLowerCase())}),e(K,{children:o(`${a.policy?.decisionStrategy?.toLowerCase()}`)}),e(K,{children:a.status===ct.Permit?n.policies?.[i]?.scopes?.join(", "):"-"}),e(K,{children:a.status===ct.Deny&&n.policies?.[i]?.scopes?.length?n.policies[i].scopes?.join(", "):"-"})]}),r(le,{isExpanded:s,children:[e(K,{}),e(K,{colSpan:5,children:s&&e(it,{children:e(nt,{isHorizontal:!0,className:"keycloak_resource_details",children:e(Oe,{children:e(Gn,{children:a.associatedPolicies?.map(h=>r(Hn,{children:[e(fe,{to:jt({realm:c,id:p,policyType:h.policy?.type,policyId:h.policy?.id}),children:h.policy?.name}),o("votedToStatus",{status:ci(h.status)})]},"policyDetails"))})})})})})]},`child-${n.resource}`)]},t)},Qs=({rowIndex:t,resource:i,evaluateResults:a})=>{const[n,s]=u.exports.useState(!1),{t:l}=L("clients");return r(Ue,{isExpanded:n,children:[r(le,{children:[e(K,{expand:{rowIndex:t,isExpanded:n,onToggle:()=>s(o=>!o)}}),e(K,{"data-testid":`name-column-${i.resource}`,children:i.resource?.name}),e(K,{id:i.status?.toLowerCase(),children:l(`${i.status?.toLowerCase()}`)}),e(K,{children:i.allowedScopes?.length?i.allowedScopes.map(o=>o.name):"-"})]}),r(le,{isExpanded:n,children:[e(K,{}),e(K,{colSpan:5,children:e(it,{children:n&&e(nt,{isHorizontal:!0,className:"keycloak_resource_details",children:r(Ne,{"aria-label":l("evaluationResults"),children:[e(De,{children:r(le,{children:[e(W,{}),e(W,{children:l("permission")}),e(W,{children:l("results")}),e(W,{children:l("decisionStrategy")}),e(W,{children:l("grantedScopes")}),e(W,{children:l("deniedScopes")}),e(W,{})]})}),Object.values(a[t].policies).map((o,c)=>e(Ys,{idx:c,rowIndex:t,outerPolicy:o,resource:i},c))]})})})})]},`child-${i.resource}`)]})},Xs=({data:t})=>{const{t:i}=L("clients"),[a,n]=ve();return r(j,{children:[e(D,{"data-testid":"authorization-revert",onClick:n,variant:"secondary",children:i("showAuthData")}),e(_e,{variant:tt.medium,isOpen:a,"aria-label":i("authData"),header:r(Oe,{children:[e(ue,{component:Nn.h1,children:i("authData")}),e(ue,{children:i("authDataDescription")})]}),onClose:n,actions:[e(D,{"data-testid":"cancel",id:"modal-cancel",onClick:n,children:i("common:cancel")},"cancel")],children:e(et,{readOnly:!0,rows:20,value:He(t)})})]})};function Zs(t,i){switch(i){case"STATUS_PERMITTED":return t.filter(({status:a})=>a==="PERMIT");case"STATUS_DENIED":return t.filter(({status:a})=>a==="DENY");default:return t}}const ea=({evaluateResult:t,refresh:i,back:a})=>{const{t:n}=L("clients"),[s,l]=ve(),[o,c]=u.exports.useState("ALL"),[p,h]=u.exports.useState(""),[d,y]=u.exports.useState(""),f=()=>{h(d)},m=g=>{g.key==="Enter"&&f()},S=u.exports.useMemo(()=>Zs(t.results,o).filter(({resource:g})=>g?.name?.includes(p)??!1),[t.results,o,p]),x=t.results.length===0,T=S.length===0;return r(me,{children:[e(Si,{children:r(vi,{className:"providers-toolbar",children:[e(ge,{children:r(Vt,{children:[e(di,{name:"inputGroupName",id:"inputGroupName",type:"search","aria-label":n("common:search"),placeholder:n("common:search"),onChange:y,onKeyDown:m}),e(D,{variant:ye.control,"aria-label":n("common:search"),onClick:()=>f(),children:e(ui,{})})]})}),e(ge,{children:r(X,{width:300,"data-testid":"filter-type-select",isOpen:s,className:"kc-filter-type-select",variant:Q.single,onToggle:l,onSelect:(g,k)=>{c(k),l(),i()},selections:o,children:[e(V,{"data-testid":"all-results-option",value:"ALL",isPlaceholder:!0,children:n("allResults")}),e(V,{"data-testid":"result-permit-option",value:"STATUS_PERMITTED",children:n("resultPermit")}),e(V,{"data-testid":"result-deny-option",value:"STATUS_DENIED",children:n("resultDeny")})]})})]})}),!T&&r(Ne,{"aria-label":n("evaluationResults"),children:[e(De,{children:r(le,{children:[e(W,{}),e(W,{children:n("resource")}),e(W,{children:n("overallResults")}),e(W,{children:n("scopes")}),e(W,{})]})}),S.map((g,k)=>e(Qs,{rowIndex:k,resource:g,evaluateResults:t.results},k))]}),(T||x)&&r(j,{children:[e(Be,{}),e(Ce,{isSearchVariant:!0,message:n("common:noSearchResults"),instructions:n("common:noSearchResultsInstructions")})]}),r(be,{className:"kc-evaluated-options",children:[e(D,{"data-testid":"authorization-eval",id:"back-btn",onClick:a,children:n("common:back")}),e(D,{"data-testid":"authorization-reevaluate",id:"reevaluate-btn",variant:"secondary",onClick:i,children:n("clients:reevaluate")}),e(Xs,{data:t.rpt})]})]})};const ta=({client:t})=>{const i=Ee({mode:"onChange"}),{control:a,register:n,reset:s,errors:l,trigger:o,formState:{isValid:c}}=i,{t:p}=L("clients"),{adminClient:h}=ne(),d=pe(),[y,f]=u.exports.useState(!1),[m,S]=u.exports.useState(!1),[x,T]=u.exports.useState(!1),[g,k]=u.exports.useState(!1),[Y,J]=u.exports.useState([]),[_,G]=u.exports.useState([]),[q,A]=u.exports.useState(),[B,U]=u.exports.useState([]),{hasAccess:z}=ze();if(!z("view-users"))return e(pi,{permissionNeeded:"view-users"});oe(()=>h.roles.find(),v=>{U(v)},[]),oe(()=>Promise.all([h.clients.listResources({id:t.id}),h.clients.listAllScopes({id:t.id})]),([v,P])=>{J(v),G(P)},[]);const C=async()=>{if(!await o())return;const v=i.getValues(),P=v.resources?.map(({key:w})=>w),E={roleIds:v.roleIds??[],clientId:v.client.id,userId:v.user[0],resources:v.resources?.filter(w=>P?.includes(w.name)),entitlements:!1,context:{attributes:Object.fromEntries(v.context.attributes.filter(w=>w.key||w.value!=="").map(({key:w,value:H})=>[w,H]))}},O=await h.clients.evaluateResource({id:t.id,realm:d.realm},E);return A(O),O};return q?e(ea,{evaluateResult:q,refresh:C,back:()=>A(void 0)}):e(me,{children:r(Le,{...i,children:[e(Mt,{className:"kc-identity-information",title:p("clients:identityInformation"),children:r(re,{isHorizontal:!0,role:"view-clients",children:[e(is,{name:"client",label:"client",namespace:"clients",helpText:"clients-help:client",defaultValue:t.clientId}),e(Ni,{name:"user",label:"users",helpText:"clients-help:selectUser",defaultValue:"",variant:Q.typeahead,isRequired:!0}),e(b,{label:p("roles"),labelIcon:e(I,{helpText:"clients-help:roles",fieldLabelId:"clients:roles"}),fieldId:"realmRole",validated:l.roleIds?"error":"default",helperTextInvalid:p("common:required"),isRequired:!0,children:e(M,{name:"roleIds",placeholderText:p("selectARole"),control:a,defaultValue:[],rules:{validate:v=>v.length>0},render:({onChange:v,value:P})=>e(X,{variant:Q.typeaheadMulti,toggleId:"role",onToggle:S,selections:P,onSelect:(E,O)=>{const w=O.toString();P.includes(w)?v(P.filter(H=>H!==w)):v([...P,w]),S(!1)},onClear:E=>{E.stopPropagation(),v([])},"aria-label":p("realmRole"),isOpen:m,children:B.map(E=>e(V,{selected:E.name===P,value:E.name},E.name))})})})]})}),r(Mt,{className:"kc-permissions",title:p("common:permissions"),children:[r(re,{isHorizontal:!0,role:"view-clients",children:[e(b,{label:p("applyToResourceType"),fieldId:"applyToResourceType",labelIcon:e(I,{helpText:"clients-help:applyToResourceType",fieldLabelId:"clients:applyToResourceType"}),children:e(ce,{id:"applyToResource-switch",label:p("common:on"),labelOff:p("common:off"),isChecked:g,onChange:k,"aria-label":p("applyToResourceType")})}),g?r(j,{children:[e(b,{label:p("resourceType"),isRequired:!0,labelIcon:e(I,{helpText:"clients-help:resourceType",fieldLabelId:"clients:resourceType"}),fieldId:"client",validated:i.errors.alias?"error":"default",helperTextInvalid:p("common:required"),children:e(Z,{type:"text",id:"alias",name:"alias","data-testid":"alias",ref:n({required:!0})})}),e(b,{label:p("authScopes"),labelIcon:e(I,{helpText:"clients-help:scopesSelect",fieldLabelId:"clients:client"}),fieldId:"authScopes",children:e(M,{name:"authScopes",defaultValue:[],control:a,render:({onChange:v,value:P})=>e(X,{toggleId:"authScopes",onToggle:f,onSelect:(E,O)=>{const w=O.toString();P.includes(w)?v(P.filter(H=>H!==w)):v([...P,w]),f(!1)},selections:P,variant:Q.typeaheadMulti,"aria-label":p("authScopes"),isOpen:y,children:_.map(E=>e(V,{selected:E.name===P,value:E.name},E.id))})})})]}):e(b,{label:p("resourcesAndAuthScopes"),id:"resourcesAndAuthScopes",isRequired:!0,labelIcon:e(I,{helpText:p("clients-help:contextualAttributes"),fieldLabelId:"resourcesAndAuthScopes"}),helperTextInvalid:p("common:required"),fieldId:"resourcesAndAuthScopes",children:e(Tn,{selectableValues:Y.map(v=>({name:v.name,key:v._id})),resources:Y,name:"resources"})}),e(Dn,{toggleText:p("contextualInfo"),onToggle:()=>T(!x),isExpanded:x,children:e(b,{label:p("contextualAttributes"),id:"contextualAttributes",labelIcon:e(I,{helpText:p("clients-help:contextualAttributes"),fieldLabelId:"contextualAttributes"}),helperTextInvalid:p("common:required"),fieldId:"contextualAttributes",children:e(Tn,{selectableValues:Vn,name:"context.attributes"})})})]}),r(be,{children:[e(D,{"data-testid":"authorization-eval",id:"authorization-eval",className:"pf-u-mr-md",isDisabled:!c,onClick:()=>C(),children:p("evaluate")}),e(D,{"data-testid":"authorization-revert",id:"authorization-revert",className:"pf-u-mr-md",variant:"link",onClick:()=>s(),children:p("common:revert")})]})]})]})})};const na=()=>{const{t}=L("clients"),{adminClient:i}=ne(),{clientId:a}=Gt(),{addAlert:n,addError:s}=de(),[l,o]=u.exports.useState(),[c,p]=u.exports.useState();oe(()=>i.clients.exportResource({id:a}),d=>{o(JSON.stringify(d,null,2)),p(d)},[]);const h=()=>{try{Qe.saveAs(new Blob([He(c)],{type:"application/json"}),"test-authz-config.json"),n(t("exportAuthDetailsSuccess"),ee.success)}catch(d){s("exportAuthDetailsError",d)}};return l?e(me,{children:r(re,{isHorizontal:!0,role:"view-realm",className:"pf-u-mt-lg",children:[e(b,{label:t("authDetails"),labelIcon:e(I,{helpText:"clients-help:authDetails",fieldLabelId:"clients:authDetails"}),fieldId:"client",children:e(et,{id:"authorizationDetails",readOnly:!0,resizeOrientation:"vertical",value:l,"aria-label":t("authDetails")})}),r(be,{children:[e(D,{"data-testid":"authorization-export-download",onClick:()=>h(),children:t("common:download")}),e(D,{"data-testid":"authorization-export-copy",variant:"secondary",onClick:async()=>{try{await navigator.clipboard.writeText(l),n(t("copied"),ee.success)}catch(d){s(t("copyError"),d)}},children:t("copy")})]})]})}):e(we,{})},ia=({onChange:t,value:i,save:a,client:n,toggleDownloadDialog:s,toggleDeleteDialog:l})=>{const{t:o}=L("clients"),[c,p]=xe({titleKey:"clients:disableConfirmTitle",messageKey:"clients:disableConfirm",continueButtonLabel:"common:disable",onConfirm:()=>{t(!i),a()}}),h=u.exports.useMemo(()=>{const m=$i(o,n.protocol??"openid-connect");return[{text:n.bearerOnly?e(qt,{"data-testid":"bearer-only-explainer-tooltip",content:o("explainBearerOnly"),children:e(Ut,{"data-testid":"bearer-only-explainer-label",icon:e(Rn,{}),children:m})}):e(Ut,{children:m})}]},[n,o]),{hasAccess:d}=ze(),y=d("manage-clients")||n.access?.configure,f=[e($e,{onClick:s,children:o("downloadAdapterConfig")},"download"),e($e,{onClick:()=>fi(n),children:o("common:export")},"export"),...!gt(n)&&y?[e(Be,{},"divider"),e($e,{"data-testid":"delete-client",onClick:l,children:o("common:delete")},"delete")]:[]];return r(j,{children:[e(p,{}),e(xi,{titleKey:n.clientId,subKey:"clients:clientsExplain",badges:h,divider:!1,isReadOnly:!y,helpTextKey:"clients-help:enableDisable",dropdownItems:f,isEnabled:i,onToggle:m=>{m?(t(m),a()):c()}})]})};function kl(){const{t}=L("clients"),{adminClient:i}=ne(),{addAlert:a,addError:n}=de(),{realm:s}=pe(),{profileInfo:l}=Ye(),{hasAccess:o}=ze(),c=!l?.disabledFeatures?.includes("ADMIN_FINE_GRAINED_AUTHZ")&&o("manage-authorization"),p=o("manage-clients"),h=o("view-users"),d=mi(),y=Ze(),[f,m]=ve(),[S,x]=ve(),T=Ee({shouldUnregister:!1}),{clientId:g}=Gt(),[k,Y]=u.exports.useState(0),J=vt({control:T.control,name:"clientAuthenticatorType",defaultValue:"client-secret"}),[_,G]=u.exports.useState(),q=async()=>{const P=await i.clients.listRoles({id:g});return kn(P,E=>E.name?.toUpperCase())},[A,B]=xe({titleKey:"clients:clientDeleteConfirmTitle",messageKey:"clients:clientDeleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:ye.danger,onConfirm:async()=>{try{await i.clients.del({id:g}),a(t("clientDeletedSuccess"),ee.success),y(hi({realm:s}))}catch(P){n("clients:clientDeleteError",P)}}}),U=P=>{T.reset({...P}),gi(P,T.setValue),T.setValue(N("attributes.request.uris"),At(P.attributes?.["request.uris"])),P.attributes?.["acr.loa.map"]&&T.setValue(N("attributes.acr.loa.map"),Object.entries(JSON.parse(P.attributes["acr.loa.map"])).flatMap(([E,O])=>({key:E,value:O}))),P.attributes?.["default.acr.values"]&&T.setValue(N("attributes.default.acr.values"),At(P.attributes["default.acr.values"])),P.attributes?.["post.logout.redirect.uris"]&&T.setValue(N("attributes.post.logout.redirect.uris"),At(P.attributes["post.logout.redirect.uris"]))};oe(()=>i.clients.findOne({id:g}),P=>{if(!P)throw new Error(t("common:notFound"));G(bi(P)),U(P)},[g,k]);const z=async({confirmed:P=!1,messageKey:E="clientSaveSuccess"}={confirmed:!1,messageKey:"clientSaveSuccess"})=>{if(await T.trigger()){if(!_?.publicClient&&_?.clientAuthenticatorType!==J&&!P){x();return}const O=sn(T.getValues());O.attributes?.["request.uris"]&&(O.attributes["request.uris"]=Ot(O.attributes["request.uris"])),O.attributes?.["default.acr.values"]&&(O.attributes["default.acr.values"]=Ot(O.attributes["default.acr.values"])),O.attributes?.["post.logout.redirect.uris"]&&(O.attributes["post.logout.redirect.uris"]=Ot(O.attributes["post.logout.redirect.uris"]));const w=sn(O);w.attributes?.["acr.loa.map"]&&(w.attributes["acr.loa.map"]=JSON.stringify(Object.fromEntries(w.attributes["acr.loa.map"].filter(({key:H})=>H!=="").map(({key:H,value:he})=>[H,he]))));try{const H={..._,...w};H.clientId=H.clientId?.trim(),await i.clients.update({id:g},H),U(H),G(H),a(t(E),ee.success)}catch(H){n("clients:clientSaveError",H)}}};if(!_)return e(we,{});const C=P=>ht({to:Cn({realm:s,clientId:g,tab:P}),history:d}),v=P=>ht({to:nn({realm:s,clientId:g,tab:P}),history:d});return r(j,{children:[e(Ht,{continueButtonLabel:"common:yes",cancelButtonLabel:"common:no",titleKey:t("changeAuthenticatorConfirmTitle",{clientAuthenticatorType:J}),open:S,toggleDialog:x,onConfirm:()=>z({confirmed:!0}),children:e(j,{children:t("changeAuthenticatorConfirm",{clientAuthenticatorType:J})})}),e(B,{}),f&&e(as,{id:_.id,protocol:_.protocol,open:!0,toggleDialog:m}),e(M,{name:"enabled",control:T.control,defaultValue:!0,render:({onChange:P,value:E})=>e(ia,{value:E,onChange:P,client:_,save:z,toggleDeleteDialog:A,toggleDownloadDialog:m})}),e(me,{variant:"light",className:"pf-u-p-0",children:e(Le,{...T,children:r(Rt,{"data-testid":"client-tabs",isBox:!0,mountOnEnter:!0,children:[e(ie,{id:"settings","data-testid":"clientSettingsTab",title:e(se,{children:t("common:settings")}),...C("settings"),children:e(vs,{client:_,save:()=>z(),reset:()=>U(_)})}),(!_.publicClient&&!gt(_)||_.protocol==="saml")&&r(ie,{id:"keys","data-testid":"keysTab",title:e(se,{children:t("keys")}),...C("keys"),children:[_.protocol==="openid-connect"&&e(ws,{clientId:g,save:z,hasConfigureAccess:_.access?.configure}),_.protocol==="saml"&&e(Fs,{clientId:g,save:z})]}),!_.publicClient&&!gt(_)&&(p||_.access?.configure)&&e(ie,{id:"credentials",title:e(se,{children:t("credentials")}),...C("credentials"),children:e(Cs,{client:_,save:z,refresh:()=>Y(k+1)},k)}),e(ie,{id:"roles","data-testid":"rolesTab",title:e(se,{children:t("roles")}),...C("roles"),children:e(ki,{loader:q,paginated:!1,messageBundle:"clients",isReadOnly:!(p||_.access?.configure)})}),!gt(_)&&!_.bearerOnly&&e(ie,{id:"clientScopes","data-testid":"clientScopesTab",title:e(se,{children:t("clientScopes")}),...C("clientScopes"),children:r(Rt,{defaultLocation:kt({realm:s,clientId:g,tab:"setup"}),children:[e(ie,{id:"setup",title:e(se,{children:t("setup")}),...ht({to:kt({realm:s,clientId:g,tab:"setup"}),history:d}),children:e(Es,{clientName:_.clientId,clientId:g,protocol:_.protocol,fineGrainedAccess:_.access?.manage})}),e(ie,{id:"evaluate",title:e(se,{children:t("evaluate")}),...ht({to:kt({realm:s,clientId:g,tab:"evaluate"}),history:d}),children:e(_s,{clientId:g,protocol:_.protocol})})]})}),_.authorizationServicesEnabled&&e(ie,{id:"authorization","data-testid":"authorizationTab",title:e(se,{children:t("authorization")}),...C("authorization"),children:r(Rt,{mountOnEnter:!0,unmountOnExit:!0,defaultLocation:nn({realm:s,clientId:g,tab:"settings"}),children:[e(ie,{id:"settings","data-testid":"authorizationSettings",title:e(se,{children:t("settings")}),...v("settings"),children:e(Vs,{clientId:g})}),e(ie,{id:"resources","data-testid":"authorizationResources",title:e(se,{children:t("resources")}),...v("resources"),children:e(js,{clientId:g})}),e(ie,{id:"scopes","data-testid":"authorizationScopes",title:e(se,{children:t("scopes")}),...v("scopes"),children:e(Gs,{clientId:g})}),e(ie,{id:"policies","data-testid":"authorizationPolicies",title:e(se,{children:t("policies")}),...v("policies"),children:e(Hs,{clientId:g})}),e(ie,{id:"permissions","data-testid":"authorizationPermissions",title:e(se,{children:t("common:permissions")}),...v("permissions"),children:e(Ws,{clientId:g})}),e(ie,{id:"evaluate","data-testid":"authorizationEvaluate",title:e(se,{children:t("evaluate")}),...v("evaluate"),children:e(ta,{client:_,save:z})}),e(ie,{id:"export","data-testid":"authorizationExport",title:e(se,{children:t("common:export")}),...v("export"),children:e(na,{})})]})}),_.serviceAccountsEnabled&&h&&e(ie,{id:"serviceAccount","data-testid":"serviceAccountTab",title:e(se,{children:t("serviceAccount")}),...C("serviceAccount"),children:e(Ns,{client:_})}),e(ie,{id:"sessions","data-testid":"sessionsTab",title:e(se,{children:t("sessions")}),...C("sessions"),children:e(Is,{client:_})}),c&&(p||_.access?.manage)&&e(ie,{id:"permissions","data-testid":"permissionsTab",title:e(se,{children:t("common:permissions")}),...C("permissions"),children:e(ss,{id:_.id,type:"clients"})}),e(ie,{id:"advanced","data-testid":"advancedTab",title:e(se,{children:t("advanced")}),...C("advanced"),children:e(hs,{save:z,client:_})})]})})})]})}export{kl as default};
