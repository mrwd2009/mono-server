import{r as b,ay as P,bA as R,aw as j,l as B,u as E,az as N,a_ as U,ae as z,aY as C,cX as x,j as e,K as G,h as l,F as _,ap as $,P as W,av as V,s as A,aC as X,aB as Y}from"./index.0cb2e516.js";import{V as J}from"./ViewHeader.2586557f.js";import{u as Q,b as Z,C as ee,F as te}from"./index.esm.6af887f8.js";import{H as v}from"./HelpItem.e440d5db.js";import{F as re}from"./FormAccess.bee4f1e0.js";import{D as ae}from"./DynamicComponents.3dd18b3b.js";import{K as c}from"./KeycloakTextInput.b4d5b2db.js";import{u as oe}from"./ConfirmDialog.f8013bbb.js";import{a as f,F as pe,A as ie}from"./FormGroup.3d5f3f16.js";import{S as ne,b as se,a as me}from"./Select.5a6b39aa.js";import"./Text.c38ffb52.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./KeycloakTextArea.f5e2440a.js";import"./useToggle.8c992bea.js";import"./AddRoleMappingModal.4adc845a.js";import"./KeycloakDataTable.4e517788.js";import"./TableToolbar.c27bcd3c.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Modal.6593dfcc.js";import"./useLocaleSort.84ea7ec0.js";import"./resource.df4d2bbd.js";import"./joinPath.69b856b1.js";import"./filter-icon.fec9f70e.js";import"./KeyValueInput.cb1ae3e8.js";import"./FlexItem.308d9f82.js";import"./minus-circle-icon.de526f05.js";import"./CodeEditor.16ebafa0.js";import"./ClientSelect.a855e118.js";import"./MultiLineInput.e27bc560.js";import"./GroupPickerDialog.f5430678.js";import"./DataListItemRow.8f458244.js";import"./data-list.f7ff2ea7.js";import"./FileUpload.18e1e495.js";import"./PasswordInput.34ff6dd3.js";function Je(){const r=Q(),[s,L]=b.exports.useState(),[g,O]=b.exports.useState(),{adminClient:d}=P(),{id:y,mapperId:p}=R(),u=j(),{realm:h}=B(),{t:a}=E("user-federation"),{addAlert:w,addError:k}=N(),[D,S]=b.exports.useState(!1);U(async()=>{const t=await d.components.listSubComponents({id:y,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(p&&p!=="new"){const o=await d.components.findOne({id:p});return{components:t,fetchedMapper:o}}return{components:t}},({components:t,fetchedMapper:o})=>{if(L(o),O(t),p!=="new"&&!o)throw new Error(a("common:notFound"));o&&F(o)},[]);const F=t=>{Y(t,r.setValue)},q=async t=>{const o=X(t),n={...o,config:Object.entries(o.config||{}).reduce((m,[M,I])=>(m[M]=Array.isArray(I)?I:[I],m),{})};try{p==="new"?(await d.components.create(n),u(x({realm:h,id:t.parentId,tab:"mappers"}))):await d.components.update({id:p},n),F(n),w(a(p==="new"?"common:mappingCreatedSuccess":"common:mappingUpdatedSuccess"),C.success)}catch(m){k(p==="new"?"common:mappingCreatedError":"common:mappingUpdatedError",m)}},[H,K]=oe({titleKey:"common:deleteMappingTitle",messageKey:"common:deleteMappingConfirm",continueButtonLabel:"common:delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{await d.components.del({id:s.id}),w(a("common:mappingDeletedSuccess"),C.success),u(x({id:y,realm:h,tab:"mappers"}))}catch(t){k("common:mappingDeletedError",t)}}}),T=Z({control:r.control,name:"providerId"}),i=p==="new";return g?l(_,{children:[e(K,{}),e(J,{titleKey:s?s.name:a("common:createNewMapper"),dropdownItems:i?void 0:[e($,{onClick:H,children:a("common:delete")},"delete")]}),l(W,{variant:"light",isFilled:!0,children:[l(re,{role:"manage-realm",isHorizontal:!0,children:[!i&&e(f,{label:a("common:id"),fieldId:"kc-ldap-mapper-id",children:e(c,{isDisabled:!0,type:"text",id:"kc-ldap-mapper-id","data-testid":"ldap-mapper-id",name:"id",ref:r.register})}),l(f,{label:a("common:name"),labelIcon:e(v,{helpText:"user-federation-help:nameHelp",fieldLabelId:"name"}),fieldId:"kc-ldap-mapper-name",isRequired:!0,children:[e(c,{isDisabled:!i,isRequired:!0,type:"text",id:"kc-ldap-mapper-name","data-testid":"ldap-mapper-name",name:"name",ref:r.register({required:!0}),validated:r.errors.name?V.error:V.default}),e(c,{hidden:!0,defaultValue:i?y:s?s.parentId:"",type:"text",id:"kc-ldap-parentId","data-testid":"ldap-mapper-parentId",name:"parentId",ref:r.register}),e(c,{hidden:!0,defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper",type:"text",id:"kc-ldap-provider-type","data-testid":"ldap-mapper-provider-type",name:"providerType",ref:r.register})]}),i?e(f,{label:a("common:mapperType"),labelIcon:e(v,{helpText:"user-federation-help:mapperTypeHelp",fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:e(ee,{name:"providerId",defaultValue:"",control:r.control,"data-testid":"ldap-mapper-type-select",render:({onChange:t,value:o})=>e(ne,{toggleId:"kc-providerId",required:!0,onToggle:()=>S(!D),isOpen:D,onSelect:(n,m)=>{t(m),S(!1)},selections:o,variant:se.typeahead,children:g.map(n=>e(me,{value:n.id},n.id))})})}):e(f,{label:a("common:mapperType"),labelIcon:e(v,{helpText:"user-federation-help:mapperTypeHelp",fieldLabelId:"mapperType"}),fieldId:"kc-ldap-mapper-type",isRequired:!0,children:e(c,{isDisabled:!i,isRequired:!0,type:"text",id:"kc-ldap-mapper-type","data-testid":"ldap-mapper-type-fld",name:"providerId",ref:r.register})}),e(te,{...r,children:!!T&&e(ae,{properties:g.find(t=>t.id===T)?.properties})})]}),e(pe,{onSubmit:r.handleSubmit(()=>q(r.getValues())),children:l(ie,{children:[e(A,{isDisabled:!r.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:a("common:save")}),e(A,{variant:"link",onClick:()=>u(i?-1:`/${h}/user-federation/ldap/${s.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:a("common:cancel")})]})})]})]}):e(G,{})}export{Je as default};
