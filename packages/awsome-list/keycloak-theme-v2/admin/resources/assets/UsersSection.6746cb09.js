import{u as se,ay as te,az as re,l as ae,n as oe,aw as ne,r as o,aD as ie,a_ as le,ae as g,aY as E,j as s,K as ce,h as r,F as n,s as U,an as de,am as me,ap as P,b2 as ue,P as pe,d5 as v,ag as he,ad as be,af as fe,T as ye,bD as k,b4 as ge,bW as Ue,L as I,aV as ke,a4 as Se,aT as Te,d6 as Ce}from"./index.0cb2e516.js";import{u as R}from"./ConfirmDialog.f8013bbb.js";import{K as Ke,L as De}from"./KeycloakDataTable.4e517788.js";import{V as xe}from"./ViewHeader.2586557f.js";import{P as Fe}from"./PermissionTab.13062542.js";import{R as we,r as Ae}from"./RoutableTabs.f3cff418.js";import{c as Ee}from"./resource.df4d2bbd.js";import{c as u,a as Pe,b as ve}from"./HelpItem.e440d5db.js";import{T as L,a as N}from"./Tabs.3d61d369.js";import{E as Ie}from"./EmptyStateBody.a0363fe4.js";import{T as Re}from"./Text.c38ffb52.js";import{W as Le}from"./warning-triangle-icon.00f0aca5.js";import"./Modal.6593dfcc.js";import"./TableToolbar.c27bcd3c.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./FormGroup.3d5f3f16.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./useLocaleSort.84ea7ec0.js";import"./Trans.ec4d13b3.js";import"./Card.32e78d5f.js";import"./CardTitle.42e61ef4.js";import"./CardBody.a2e5e179.js";import"./joinPath.69b856b1.js";import"./plus-icon.407671b4.js";import"./MenuList.288a98b4.js";function ms(){const{t}=se("users"),{adminClient:i}=te(),{addAlert:S,addError:c}=re(),{realm:l}=ae(),V=oe(),B=ne(),[p,O]=o.exports.useState(),[_,j]=o.exports.useState(),[T,W]=o.exports.useState(),[H,h]=o.exports.useState(!1),[d,b]=o.exports.useState([]),[C,z]=o.exports.useState(0),m=()=>z(C+1),{hasAccess:G}=ie(),M=G("manage-users");le(async()=>{const e={type:"org.keycloak.storage.UserStorageProvider"};try{return await Promise.all([i.components.find(e),i.realms.findOne({realm:l})])}catch{return[[],{}]}},([e,a])=>{O(e),W(a)},[]);const Y=e=>s(ge,{to:Ue({realm:l,id:e.id,tab:"settings"}),children:e.username},e.username),$=async(e,a,ee)=>{const w={first:e,max:a},y=ee||_||"";if(y&&(w.search=y),!D&&!y)return[];try{return await Ee({adminClient:i,briefRepresentation:!0,...w})}catch(A){return p?.length?c("users:noUsersFoundErrorStorage",A):c("users:noUsersFoundError",A),[]}},[q,J]=R({titleKey:"users:unlockAllUsers",messageKey:"users:unlockUsersConfirm",continueButtonLabel:"users:unlock",onConfirm:async()=>{try{await i.attackDetection.delAll(),m(),S(t("unlockUsersSuccess"),E.success)}catch(e){c("users:unlockUsersError",e)}}}),[f,Q]=R({titleKey:"users:deleteConfirm",messageKey:t("deleteConfirmDialog",{count:d.length}),continueButtonLabel:"delete",continueButtonVariant:g.danger,onConfirm:async()=>{try{for(const e of d)await i.users.del({id:e.id});b([]),m(),S(t("userDeletedSuccess"),E.success)}catch(e){c("users:userDeletedError",e)}}}),X=e=>r(n,{children:[!e.enabled&&s(I,{color:"red",icon:s(ke,{}),children:t("disabled")},e.id),e.bruteForceStatus?.disabled&&s(I,{color:"orange",icon:s(Le,{}),children:t("temporaryDisabled")},e.id),e.enabled&&!e.bruteForceStatus?.disabled&&"\u2014"]}),Z=e=>r(n,{children:[!e.emailVerified&&s(Se,{content:s(n,{children:t("notVerified")}),children:s(Te,{className:"keycloak__user-section__email-verified"})},`email-verified-${e.id}`)," ",k()(e.email)]}),K=()=>B(Ce({realm:l}));if(!p||!T)return s(ce,{});const D=!(p.length>0),x=r(n,{children:[s(u,{children:s(U,{"data-testid":"add-user",onClick:K,children:t("addUser")})}),T.bruteForceProtected?s(u,{children:s(de,{toggle:s(me,{onToggle:e=>h(e)}),isOpen:H,isPlain:!0,dropdownItems:[s(P,{component:"button",isDisabled:d.length===0,onClick:()=>{f(),h(!1)},children:t("deleteUser")},"deleteUser"),s(P,{component:"button",onClick:()=>{q(),h(!1)},children:t("unlockAllUsers")},"unlock")]})}):s(u,{children:s(U,{variant:g.link,onClick:f,"data-testid":"delete-user-btn",isDisabled:d.length===0,children:t("deleteUser")})})]}),F=e=>Ae({to:v({realm:l,tab:e}),history:V});return r(n,{children:[s(Q,{}),s(J,{}),s(xe,{titleKey:"users:title",subKey:"users:usersExplain",helpUrl:ue.usersUrl,divider:!1}),s(pe,{"data-testid":"users-page",variant:"light",className:"pf-u-p-0",children:r(we,{"data-testid":"user-tabs",defaultLocation:v({realm:l,tab:"list"}),isBox:!0,mountOnEnter:!0,children:[s(L,{id:"list","data-testid":"listTab",title:s(N,{children:t("userList")}),...F("list"),children:s(Ke,{loader:$,isPaginated:!0,ariaLabelKey:"users:title",searchPlaceholderKey:"users:searchForUser",canSelectAll:!0,onSelect:e=>b([...e]),emptyState:D?s(De,{message:t("noUsersFound"),instructions:t("emptyInstructions"),primaryActionText:t("createNewUser"),onPrimaryAction:K}):r(n,{children:[s(Pe,{children:r(ve,{children:[s(u,{children:r(he,{children:[s(be,{name:"search-input",type:"search","aria-label":t("search"),placeholder:t("users:searchForUser"),onChange:e=>{j(e)},onKeyDown:e=>{e.key==="Enter"&&m()}}),s(U,{variant:g.control,"aria-label":t("common:search"),onClick:m,children:s(fe,{})})]})}),x]})}),s(Ie,{"data-testid":"empty-state",variant:"large",children:s(ye,{className:"kc-search-users-text",children:s(Re,{children:t("searchForUserDescription")})})})]}),toolbarItem:M?x:void 0,actionResolver:e=>{const a=e.data;return a.access?.manage?[{title:t("common:delete"),onClick:()=>{b([a]),f()}}]:[]},columns:[{name:"username",displayKey:"users:username",cellRenderer:Y},{name:"email",displayKey:"users:email",cellRenderer:Z},{name:"lastName",displayKey:"users:lastName",cellFormatters:[k()]},{name:"firstName",displayKey:"users:firstName",cellFormatters:[k()]},{name:"status",displayKey:"users:status",cellRenderer:X}]},C)}),s(L,{id:"permissions","data-testid":"permissionsTab",title:s(N,{children:t("common:permissions")}),...F("permissions"),children:s(Fe,{type:"users"})})]})})]})}export{ms as default};
