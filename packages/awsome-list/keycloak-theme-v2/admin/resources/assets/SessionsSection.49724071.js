import{u as x,az as D,l as F,ay as O,r as S,a_ as q,h as R,j as t,s as p,ae as I,T as P,av as f,cA as V,aY as r,ap as N,F as E,b2 as K,P as U}from"./index.0cb2e516.js";import{V as M}from"./ViewHeader.2586557f.js";import{u as j}from"./index.esm.6af887f8.js";import{K as L}from"./KeycloakTextInput.b4d5b2db.js";import{M as z,a as H}from"./Modal.6593dfcc.js";import{F as G,a as Y}from"./FormGroup.3d5f3f16.js";import{S as _}from"./SessionsTable.1482375a.js";import{u as $}from"./ConfirmDialog.f8013bbb.js";import"./HelpItem.e440d5db.js";import"./Text.c38ffb52.js";import"./KeycloakDataTable.4e517788.js";import"./TableToolbar.c27bcd3c.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./useFormatDate.53169b6c.js";import"./ListItem.f69883ba.js";const J=({handleModalToggle:a,save:h})=>{const{t:e}=x("sessions"),{addAlert:o}=D(),{realm:n}=F(),{adminClient:i}=O(),{register:v,handleSubmit:g,formState:{errors:m}}=j(),[c,y]=S.exports.useState(),[w,C]=S.exports.useState(0),d=()=>{C(new Date().getTime())};q(()=>i.realms.findOne({realm:n}),s=>{y(s)},[w]);const l=(s,B)=>{const T=s.successRequests?.length||0,A=s.failedRequests?.length||0;T===0&&A===0?o(e("clients:noAdminUrlSet"),r.warning):A>0?(o(e("clients:"+B+"Success",{successNodes:s.successRequests}),r.success),o(e("clients:"+B+"Fail",{failedNodes:s.failedRequests}),r.danger)):o(e("clients:"+B+"Success",{successNodes:s.successRequests}),r.success)},u=async()=>{try{await i.realms.update({realm:n},{realm:n,notBefore:Date.now()/1e3}),o(e("notBeforeSuccess"),r.success)}catch(s){o(e("setToNowError",{error:s}),r.danger)}},b=async()=>{try{await i.realms.update({realm:n},{realm:n,notBefore:0}),o(e("notBeforeClearedSuccess"),r.success),d()}catch(s){o(e("notBeforeError",{error:s}),r.danger)}},k=async()=>{const s=await i.realms.pushRevocation({realm:n});l(s,"notBeforePush"),d()};return R(z,{variant:H.small,title:e("revocation"),isOpen:!0,onClose:a,actions:[t(p,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{u(),a()},form:"revocation-modal-form",children:e("setToNow")},"set-to-now"),t(p,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{b(),a()},form:"revocation-modal-form",children:e("clear")},"clear"),t(p,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{k(),a()},form:"revocation-modal-form",children:e("push")},"push"),t(p,{id:"modal-cancel","data-testid":"cancel",variant:I.link,onClick:()=>{a()},children:e("common:cancel")},"cancel")],children:[t(P,{className:"kc-revocation-description-text",children:e("revocationDescription")}),t(G,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:g(h),children:t(Y,{className:"kc-revocation-modal-form-group",label:e("notBefore"),name:"notBefore",fieldId:"not-before",validated:m.email?f.error:f.default,children:t(L,{"data-testid":"not-before-input",ref:v({required:!0,pattern:V}),autoFocus:!0,isReadOnly:!0,value:c?.notBefore===0?e("none"):new Date(c?.notBefore*1e3).toString(),type:"text",id:"not-before",name:"notBefore",validated:m.email?f.error:f.default})})})]})};function ve(){const{t:a}=x("sessions"),{keycloak:h,adminClient:e}=O(),{addError:o}=D(),{realm:n}=F(),[i,v]=S.exports.useState(!1),[g,m]=S.exports.useState(!1),c=()=>{v(!i)},y=async()=>{const l=await e.sessions.find(),u=(await Promise.all(l.map(s=>e.clients.listSessions({id:s.id})))).flat();m(u.length===0);const b=Array.from(new Set(u.map(s=>s.userId)));return(await Promise.all(b.map(s=>e.users.listSessions({id:s})))).flat()},[w,C]=$({titleKey:"sessions:logoutAllSessions",messageKey:"sessions:logoutAllDescription",continueButtonLabel:"common:confirm",onConfirm:async()=>{try{await e.realms.logoutAll({realm:n}),h.logout({redirectUri:""})}catch(l){o("sessions:logoutAllSessionsError",l)}}}),d=[t(N,{"data-testid":"revocation",component:"button",onClick:()=>c(),children:a("revocation")},"toggle-modal"),t(N,{"data-testid":"logout-all",component:"button",isDisabled:g,onClick:w,children:a("signOutAllActiveSessions")},"delete-role")];return R(E,{children:[t(C,{}),t(M,{dropdownItems:d,titleKey:"sessions:title",subKey:"sessions:sessionExplain",helpUrl:K.sessionsUrl}),R(U,{variant:"light",className:"pf-u-p-0",children:[i&&t(J,{handleModalToggle:c,save:()=>{c()}}),t(_,{loader:y})]})]})}export{ve as default};
