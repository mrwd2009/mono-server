import{u as $,az as L,aw as R,l as U,r as c,bA as Y,g as q,ay as J,a_ as K,j as n,P as M,h as v,s as x,cF as b,aY as Q}from"./index.0cb2e516.js";import{u as W,C as X,F as Z}from"./index.esm.6af887f8.js";import{F as tt}from"./FormAccess.bee4f1e0.js";import{F as it}from"./FormPanel.4ba67868.js";import{H as ot}from"./HelpItem.e440d5db.js";import{D as et}from"./DynamicComponents.3dd18b3b.js";import{c as F}from"./camelCase.2add9c33.js";import{a as nt,A as rt}from"./FormGroup.3d5f3f16.js";import{S as st,b as at,a as ct}from"./Select.5a6b39aa.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./CardHeader.f162738f.js";import"./Card.32e78d5f.js";import"./CardTitle.42e61ef4.js";import"./CardBody.a2e5e179.js";import"./KeycloakTextInput.b4d5b2db.js";import"./KeycloakTextArea.f5e2440a.js";import"./useToggle.8c992bea.js";import"./AddRoleMappingModal.4adc845a.js";import"./KeycloakDataTable.4e517788.js";import"./TableToolbar.c27bcd3c.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Modal.6593dfcc.js";import"./useLocaleSort.84ea7ec0.js";import"./resource.df4d2bbd.js";import"./joinPath.69b856b1.js";import"./filter-icon.fec9f70e.js";import"./ConfirmDialog.f8013bbb.js";import"./KeyValueInput.cb1ae3e8.js";import"./FlexItem.308d9f82.js";import"./minus-circle-icon.de526f05.js";import"./CodeEditor.16ebafa0.js";import"./ClientSelect.a855e118.js";import"./MultiLineInput.e27bc560.js";import"./GroupPickerDialog.f5430678.js";import"./DataListItemRow.8f458244.js";import"./data-list.f7ff2ea7.js";import"./FileUpload.18e1e495.js";import"./PasswordInput.34ff6dd3.js";import"./capitalize.388ec7cb.js";function ii(){const{t:e}=$("realm-settings"),{addAlert:A,addError:I}=L(),f=R(),{realm:C}=U(),[D,g]=c.exports.useState(!1),[N,y]=c.exports.useState([]),[k,w]=c.exports.useState([]),[V,j]=c.exports.useState(),[l,B]=c.exports.useState(""),[h,P]=c.exports.useState([]),{policyName:d,conditionName:o}=Y(),E=q(),m=W({shouldUnregister:!1}),S=E.componentTypes?.["org.keycloak.services.clientpolicy.condition.ClientPolicyConditionProvider"],{adminClient:T}=J(),H=a=>{m.reset({config:a.configuration||{}})};K(()=>T.clientPolicies.listPolicies(),a=>{if(y(a.policies??[]),o){const i=a.policies?.find(t=>t.name===d)?.conditions?.find(t=>t.condition===o),r=S?.find(t=>t.id===o);j(i),P(r?.properties),H(i)}},[]);const O=async a=>{const p=a.config,i=()=>h.reduce((t,s)=>(t[s.name]=p[s.name],t),{}),r=N.map(t=>{if(t.name!==d)return t;let s=t.conditions??[];if(o){const z={condition:V?.condition,configuration:i()},u=s.findIndex(_=>o===_.condition);if(u===-1)return;const G=[...s.slice(0,u),z,...s.slice(u+1)];return{...t,conditions:G}}return s=s.concat({condition:k[0].condition,configuration:i()}),{...t,conditions:s}});try{await T.clientPolicies.updatePolicy({policies:r}),y(r),f(b({realm:C,policyName:d})),A(e(o?"realm-settings:updateClientConditionSuccess":"realm-settings:createClientConditionSuccess"),Q.success)}catch(t){I("realm-settings:createClientConditionError",t)}};return n(M,{variant:"light",children:n(it,{className:"kc-login-screen",title:e(o?"editCondition":"addCondition"),children:v(tt,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:m.handleSubmit(O),children:[n(nt,{label:e("conditionType"),fieldId:"conditionType",labelIcon:n(ot,{helpText:l?`realm-settings-help:${F(l.replace(/-/g," "))}`:"realm-settings-help:conditions",fieldLabelId:"realm-settings:conditionType"}),children:n(X,{name:"conditions",defaultValue:"any-client",control:m.control,render:({onChange:a,value:p})=>n(st,{placeholderText:e("selectACondition"),className:"kc-conditionType-select","data-testid":"conditionType-select",toggleId:"provider",isDisabled:!!o,onToggle:i=>g(i),onSelect:(i,r)=>{a(r),P(r.properties),B(r.id),w([{condition:r.id}]),g(!1)},selections:o||l,variant:at.single,"aria-label":e("conditionType"),isOpen:D,children:S?.map(i=>n(ct,{selected:i.id===p,description:e(`realm-settings-help:${F(i.id.replace(/-/g," "))}`),value:i,children:i.id},i.id))})})}),n(Z,{...m,children:n(et,{properties:h})}),v(rt,{children:[n(x,{variant:"primary",type:"submit","data-testid":"addCondition-saveBtn",isDisabled:l===""&&!o,children:e(o?"common:save":"common:add")}),n(x,{variant:"link","data-testid":"addCondition-cancelBtn",onClick:()=>f(b({realm:C,policyName:d})),children:e("common:cancel")})]})]})})})}export{ii as default};
