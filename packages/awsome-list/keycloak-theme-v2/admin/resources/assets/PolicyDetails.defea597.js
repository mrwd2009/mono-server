import{r as y,A,_ as je,w as Be,j as e,ad as ze,q as Y,br as We,h as I,ag as Ye,z as Je,ac as Qe,u as k,s as w,ae as X,an as se,ar as Xe,aF as oe,ah as Ce,ap as de,F as D,bA as Me,ay as G,a_ as K,av as M,b0 as Ae,b1 as B,aw as Ze,az as et,K as tt,P as it,b4 as nt,c5 as be,c2 as st,aY as ve}from"./index.0cb2e516.js";import{a as R,C as P,u as ot,F as rt}from"./index.esm.6af887f8.js";import{V as lt}from"./ViewHeader.2586557f.js";import{u as at}from"./ConfirmDialog.f8013bbb.js";import{F as ct}from"./FormAccess.bee4f1e0.js";import{H as v}from"./HelpItem.e440d5db.js";import{R as dt}from"./ResourcesPolicySelect.0de4bf6f.js";import{a as $,A as pt}from"./FormGroup.3d5f3f16.js";import{R as Z}from"./Radio.cfe305aa.js";import{a as z,S as me,b as ee,d as ut}from"./Select.5a6b39aa.js";import{u as pe}from"./useToggle.8c992bea.js";import{K as te}from"./KeycloakTextInput.b4d5b2db.js";import{K as mt}from"./KeycloakTextArea.f5e2440a.js";import{h as ht}from"./ClientScopeTypes.9d1fc6d4.js";import{K as ft,L as gt}from"./KeycloakDataTable.4e517788.js";import{g as St}from"./utils.988d95db.js";import{M as It,a as Tt}from"./Modal.6593dfcc.js";import{F as $e}from"./filter-icon.fec9f70e.js";import{u as xt,m as yt}from"./useLocaleSort.84ea7ec0.js";import{a as he,b as fe,c as U,d as L,e as ge,f as V}from"./TableToolbar.c27bcd3c.js";import{C as Se}from"./Checkbox.2dc73ed3.js";import{M as Ie}from"./minus-circle-icon.de526f05.js";import{G as Ct}from"./GroupPickerDialog.f5430678.js";import{A as bt,S as vt}from"./AddRoleMappingModal.4adc845a.js";import{d as J,D as $t}from"./DatePicker.3081625b.js";import{m as re,a as Ot,b as kt,c as Dt,M as Pt}from"./MenuList.288a98b4.js";import{F as Rt,a as Oe}from"./FlexItem.308d9f82.js";import{N as Mt}from"./NumberInput.331c7b85.js";import{C as At,L as wt}from"./CodeEditor.16ebafa0.js";const N=" AM",_=" PM",Nt=(i,a,s,c,p,d)=>{const r=[],h=new Date(new Date().setHours(0,0,0,0)),g=h.getDay();for(;h.getDay()===g;){let m=h.getHours(),t=N;a&&(m===0?m=12:m>=12&&(t=_),m>12&&(m%=12)),m=a?m.toString():m.toString().padStart(2,"0");const o=h.getMinutes().toString().padStart(2,"0"),l=`${m}${s}${o}${a?t:""}`;Ne(c,p,l,s,d)&&r.push(l),h.setMinutes(h.getMinutes()+i)}return r},E=(i,a,s,c,p)=>{const d=new Date(i);if(!isNaN(d.getDate())&&(i instanceof Date||i.includes("T"))){const r=c?`${d.getHours()>12?d.getHours()-12:d.getHours()}`:`${d.getHours()}`.padStart(2,"0"),h=`${d.getMinutes()}`.padStart(2,"0"),g=p?`${d.getSeconds()}`.padStart(2,"0"):"",m=g?`${s}${g}`:"";let t="";return c&&d.getHours()>11?t=_:c&&(t=N),`${r}${s}${h}${m}${t}`}else if(typeof i=="string"&&(i=i.trim(),i!==""&&we(i,a,s,c))){const[,r,h,g,m=""]=a.exec(i),t=p?`${s}${g??"00"}`:"";let o="";if(c){const l=m.toUpperCase();l===N.toUpperCase().trim()?o=N:l===_.toUpperCase().trim()?o=_:o=new Date().getHours()>11?_:N}return`${r}${s}${h}${t}${o}`}return i.toString()},we=(i,a,s,c)=>{const p=new Date(i);if(!isNaN(p.getDate())&&i.includes("T"))return!0;const d=parseInt(i.split(s)[0]),r=d>=(c?1:0)&&d<=(c?12:23);return i===""||a.test(i)&&r},_t=(i,a)=>{const s=i.match(a);return s&&s.length?/pm/i.test(s[4])?parseInt(s[1])===12?parseInt(s[1]):parseInt(s[1])+12:/am/i.test(s[4])&&parseInt(s[1])===12?0:parseInt(s[1]):null},Lt=(i,a)=>{const s=i.match(a);return s&&s.length?parseInt(s[2]):null},Vt=(i,a)=>{var s;const c=(s=i.match(a))===null||s===void 0?void 0:s[3];return c?parseInt(c):null},Ne=(i,a,s,c,p)=>{if(s.trim()==="")return!0;const d=le(i,c,p),r=le(s,c,p),h=le(a,c,p);return d<=r&&r<=h},le=(i,a,s)=>{const p=new RegExp(`^\\s*(\\d\\d?)${a}([0-5]\\d)${a}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(i);if(!p||!p.length)return;let d=p[1].padStart(2,"0");const r=p[2];let h=p[3]?`${a}${p[3]}`:"";!h&&s&&(h=`${a}00`);const g=p[4]||"";return g.toUpperCase()==="PM"&&d!=="12"?d=`${parseInt(d)+12}`:g.toUpperCase()==="AM"&&d==="12"&&(d="00"),`${d}${a}${r}${h}`};class Te extends y.exports.Component{constructor(a){super(a),this.baseComponentRef=y.exports.createRef(),this.toggleRef=y.exports.createRef(),this.inputRef=y.exports.createRef(),this.menuRef=y.exports.createRef(),this.onDocClick=t=>{var o,l,n,u;const f=(l=(o=this.toggleRef)===null||o===void 0?void 0:o.current)===null||l===void 0?void 0:l.contains(t.target),S=(u=(n=this.menuRef)===null||n===void 0?void 0:n.current)===null||u===void 0?void 0:u.contains(t.target);this.state.isTimeOptionsOpen&&!(f||S)&&this.onToggle(!1)},this.handleGlobalKeys=t=>{var o,l,n,u;const{isTimeOptionsOpen:f,focusedIndex:S,scrollIndex:b}=this.state;!((l=(o=this.inputRef)===null||o===void 0?void 0:o.current)===null||l===void 0)&&l.contains(t.target)?!f&&t.key!==A.Tab&&t.key!==A.Escape?this.onToggle(!0):f&&(t.key===A.Escape||t.key===A.Tab?this.onToggle(!1):t.key===A.Enter?S!==null?(this.focusSelection(S),t.stopPropagation()):this.onToggle(!1):(t.key===A.ArrowDown||t.key===A.ArrowUp)&&(this.focusSelection(b),this.updateFocusedIndex(0),t.preventDefault())):!((u=(n=this.menuRef)===null||n===void 0?void 0:n.current)===null||u===void 0)&&u.contains(t.target)&&(t.key===A.ArrowDown?(this.updateFocusedIndex(1),t.preventDefault()):t.key===A.ArrowUp?(this.updateFocusedIndex(-1),t.preventDefault()):(t.key===A.Escape||t.key===A.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=t=>{this.setState(o=>{const l=this.getOptions().length-1;let n=o.focusedIndex!==null?o.focusedIndex+t:o.scrollIndex+t;return n<0?n=l:n>l&&(n=0),this.scrollToIndex(n),{focusedIndex:n}})},this.getIndexToScroll=t=>this.props.menuAppendTo==="inline"?t>0?t-1:0:t,this.scrollToIndex=t=>{this.getOptions()[t].closest(`.${re.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(t)].offsetTop},this.focusSelection=t=>{var o;const l=t!==-1?t:0;!((o=this.menuRef)===null||o===void 0)&&o.current&&this.getOptions()[l].querySelector(`.${re.menuItem}`).focus()},this.scrollToSelection=t=>{const{delimiter:o,is24Hour:l}=this.props;let n=t.split(this.props.delimiter),u=null;if(n.length<2?(t=`${t}${o}00`,n=t.split(o)):n.length>2&&(t=E(t,this.state.timeRegex,o,!l,!1),n=t.split(o)),!l&&n.length>1&&n[1].length<2){const S=n[1].length===0?"00":n[1]+"0";t=`${n[0]}${o}${S}${new Date().getHours()>11?_:N}`}else!l&&n.length>1&&n[1].length===2&&!t.toUpperCase().includes(N.toUpperCase().trim())&&!t.toUpperCase().includes(_.toUpperCase().trim())&&(t=`${t}${new Date().getHours()>11?_:N}`);let f=this.getOptions().findIndex(S=>S.textContent===t);if(f!==-1)this.scrollToIndex(f),u=f;else if(n.length===2){let S="";l||(n[1].toUpperCase().includes("P")?S=_:n[1].toUpperCase().includes("A")&&(S=N)),t=`${n[0]}${o}00${S}`,f=this.getOptions().findIndex(b=>b.textContent===t),f!==-1&&this.scrollToIndex(f)}this.setState({focusedIndex:u,scrollIndex:f})},this.getRegExp=(t=!0)=>{const{is24Hour:o,delimiter:l}=this.props;let n=`\\s*(\\d\\d?)${l}([0-5]\\d)`;return t&&(n+=`${l}?([0-5]\\d)?`),new RegExp(`^${n}${o?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var t;return!((t=this.menuRef)===null||t===void 0)&&t.current?Array.from(this.menuRef.current.querySelectorAll(`.${re.menuListItem}`)):[]},this.isValidFormat=t=>{if(this.props.validateTime)return this.props.validateTime(t);const{delimiter:o,is24Hour:l,includeSeconds:n}=this.props;return we(t,this.getRegExp(n),o,!l)},this.isValidTime=t=>{const{delimiter:o,includeSeconds:l}=this.props,{minTimeState:n,maxTimeState:u}=this.state;return Ne(n,u,t,o,l)},this.isValid=t=>this.isValidFormat(t)&&this.isValidTime(t),this.onToggle=t=>{this.setState(o=>{const{timeRegex:l,isInvalid:n}=o,{delimiter:u,is24Hour:f,includeSeconds:S}=this.props,b=E(o.timeState,l,u,!f,S);return{isTimeOptionsOpen:t,timeState:b,isInvalid:t?n:!this.isValid(b)}}),this.props.setIsOpen(t),t||this.inputRef.current.focus()},this.onSelect=t=>{const{timeRegex:o,timeState:l}=this.state,{delimiter:n,is24Hour:u,includeSeconds:f,setIsOpen:S}=this.props,b=E(t.target.textContent,o,n,!u,f);b!==l&&this.onInputChange(b),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),S(!1)},this.onInputClick=t=>{this.state.isTimeOptionsOpen||this.onToggle(!0),t.stopPropagation()},this.onInputChange=t=>{const{onChange:o}=this.props,{timeRegex:l}=this.state;o&&o(t,_t(t,l),Lt(t,l),Vt(t,l),this.isValid(t)),this.scrollToSelection(t),this.setState({timeState:t})},this.onBlur=t=>{const{timeRegex:o}=this.state,{delimiter:l,is24Hour:n,includeSeconds:u}=this.props,f=E(t.currentTarget.value,o,l,!n,u);this.setState({isInvalid:!this.isValid(f)})};const{is24Hour:s,delimiter:c,time:p,includeSeconds:d,isOpen:r}=this.props;let{minTime:h,maxTime:g}=this.props;if(h===""){const t=d?`${c}00`:"";h=s?`00${c}00${t}`:`12${c}00${t} AM`}if(g===""){const t=d?`${c}59`:"";g=s?`23${c}59${t}`:`11${c}59${t} PM`}const m=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:r,timeState:E(p,m,c,!s,d),focusedIndex:null,scrollIndex:0,timeRegex:m,minTimeState:E(h,m,c,!s,d),maxTimeState:E(g,m,c,!s,d)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys)}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(a,s){const{timeState:c,isTimeOptionsOpen:p,isInvalid:d,timeRegex:r}=this.state,{time:h,is24Hour:g,delimiter:m,includeSeconds:t,isOpen:o}=this.props;a.isOpen!==o&&this.onToggle(o),p&&!s.isTimeOptionsOpen&&c&&!d&&this.scrollToSelection(c),m!==a.delimiter&&this.setState({timeRegex:this.getRegExp()}),h!==""&&h!==a.time&&this.setState({timeState:E(h,r,m,!g,t)})}render(){const a=this.props,{"aria-label":s,isDisabled:c,className:p,placeholder:d,id:r,menuAppendTo:h,is24Hour:g,invalidFormatErrorMessage:m,invalidMinMaxErrorMessage:t,stepMinutes:o,width:l,delimiter:n,inputProps:u,onChange:f,setIsOpen:S,isOpen:b,time:x,validateTime:T,minTime:O,maxTime:j,includeSeconds:q,removeFindDomNode:H}=a,C=je(a,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","removeFindDomNode"]),{timeState:F,isTimeOptionsOpen:ie,isInvalid:xe,minTimeState:Le,maxTimeState:Ve}=this.state,Fe={"--pf-c-date-picker__input--c-form-control--Width":l},Ee=Nt(o,!g,n,Le,Ve,q),qe=this.isValidFormat(F),ne=r||Be("time-picker"),He=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,Ue=e(Ot,{ref:this.menuRef,isScrollable:!0,children:e(kt,{maxMenuHeight:"200px",children:e(Dt,{"aria-label":s,children:Ee.map((ye,Ke)=>e(Pt,{onClick:this.onSelect,id:`${ne}-option-${Ke}`,children:ye},ye))})})}),Ge=e(ze,{...Object.assign({"aria-haspopup":"menu",className:Y(We.formControl),id:`${ne}-input`,"aria-label":s,validated:xe?"error":"default",placeholder:d,value:F||"",type:"text",iconVariant:"clock",onClick:this.onInputClick,onChange:this.onInputChange,onBlur:this.onBlur,autoComplete:"off",isDisabled:c,ref:this.inputRef},u)});let W;switch(h){case"inline":W=()=>this.toggleRef.current;break;case"parent":W=He;break;default:W=h}return e("div",{ref:this.baseComponentRef,className:Y(J.datePicker,p),children:I("div",{...Object.assign({className:Y(J.datePickerInput),style:Fe},C),children:[e(Ye,{children:e("div",{id:ne,children:e("div",{ref:this.toggleRef,style:{paddingLeft:"0"},children:e(Je,{appendTo:W,trigger:Ge,popper:Ue,isVisible:ie,removeFindDomNode:H})})})}),xe&&e("div",{className:Y(J.datePickerHelperText,J.modifiers.error),children:qe?t:m})]})})}}Te.displayName="TimePicker";Te.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},removeFindDomNode:!1};const Ft={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},Et=Qe(Ft);const qt=({clientScopes:i,clientName:a,open:s,toggleDialog:c,onAdd:p,isClientScopesConditionType:d})=>{const{t:r}=k("clients"),[h,g]=y.exports.useState(!1),[m,t]=y.exports.useState([]),[o,l]=y.exports.useState("Name"),[n,u]=y.exports.useState("All"),[f,S]=pe(),[b,x]=pe(!1),T=y.exports.useMemo(()=>n==="OpenID Connect"?i.filter(C=>C.protocol==="openid-connect"):n==="SAML"?i.filter(C=>C.protocol==="saml"):i,[i,o,n]),O=C=>{const F=m.map(ie=>({scope:ie,type:C}));p(F),g(!1),c()},j=C=>{C==="Name"?l("Protocol"):C==="Protocol"&&(l("Name"),u("All")),S()},q=C=>{C==="SAML"?u("SAML"):C==="OpenID Connect"?u("OpenID Connect"):C==="All"&&u("All"),x()},H=[e(z,{value:"SAML",children:r("protocolTypes.saml")},1),e(z,{value:"OpenID Connect",children:r("protocolTypes.openIdConnect")},2),e(z,{value:"All",isPlaceholder:!0,children:r("protocolTypes.all")},3)];return e(It,{variant:Tt.medium,title:d?r("addClientScope"):r("addClientScopesTo",{clientName:a}),isOpen:s,onClose:c,actions:d?[e(w,{id:"modal-add","data-testid":"confirm",variant:X.primary,onClick:()=>{const C=m.map(F=>({scope:F}));p(C),c()},isDisabled:m.length===0,children:r("common:add")},"add"),e(w,{id:"modal-cancel","data-testid":"cancel",variant:X.link,onClick:()=>{t([]),c()},children:r("common:cancel")},"cancel")]:[e(se,{className:"keycloak__client-scopes-add__add-dropdown",id:"add-dropdown",direction:Xe.up,isOpen:h,toggle:e(oe,{isDisabled:m.length===0,onToggle:()=>g(!h),isPrimary:!0,toggleIndicator:Et,id:"add-scope-toggle",children:r("common:add")}),dropdownItems:ht(r,O)},"add-dropdown"),e(w,{id:"modal-cancel",variant:X.link,onClick:()=>{t([]),c()},children:r("common:cancel")},"cancel")],children:e(ft,{loader:T,ariaLabelKey:"client-scopes:chooseAMapperType",searchPlaceholderKey:o==="Name"?"client-scopes:searchFor":void 0,isSearching:o!=="Name",searchTypeComponent:e(se,{onSelect:()=>{j(o)},"data-testid":"filter-type-dropdown",toggle:e(oe,{id:"toggle-id-9",onToggle:S,toggleIndicator:Ce,icon:e($e,{}),children:o}),isOpen:f,dropdownItems:[e(de,{"data-testid":"filter-type-dropdown-item",children:r(o==="Name"?"protocol":"common:name")},"filter-type")]}),toolbarItem:o==="Protocol"&&I(D,{children:[e(se,{onSelect:()=>{j(o)},"data-testid":"filter-type-dropdown",toggle:e(oe,{id:"toggle-id-9",onToggle:S,toggleIndicator:Ce,icon:e($e,{}),children:o}),isOpen:f,dropdownItems:[e(de,{"data-testid":"filter-type-dropdown-item",children:r("common:name")},"filter-type")]}),e(me,{variant:ee.single,className:"kc-protocolType-select","aria-label":"Select Input",onToggle:x,onSelect:(C,F)=>q(F.toString()),selections:n,isOpen:b,direction:ut.down,children:H})]}),canSelectAll:!0,onSelect:C=>t(C),columns:[{name:"name"},{name:"protocol",displayKey:"clients:protocol",cellRenderer:C=>St(r,C.protocol??"openid-connect")},{name:"description"}],emptyState:e(gt,{message:r("emptyAddClientScopes"),instructions:r("emptyAddClientScopesInstructions")})})})},ae=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],Ht=({helpLabel:i,isLimited:a=!1})=>{const{t:s}=k("clients"),{control:c}=R();return e($,{label:s("decisionStrategy"),labelIcon:e(v,{helpText:`clients-help:${i||"decisionStrategy"}`,fieldLabelId:"clients:decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(P,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:ae[0],control:c,render:({onChange:p,value:d})=>e(D,{children:(a?ae.slice(0,2):ae).map(r=>e(Z,{id:r,"data-testid":r,isChecked:d===r,name:"decisionStrategy",onChange:()=>p(r),label:s(`decisionStrategies.${r}`),className:"pf-u-mb-md"},r))})})})},Ut=()=>{const{t:i}=k("clients"),{id:a}=Me();return I(D,{children:[e($,{label:i("applyPolicy"),fieldId:"policies",labelIcon:e(v,{helpText:"clients-help:applyPolicy",fieldLabelId:"clients:policies"}),children:e(dt,{name:"policies",clientId:a})}),e(Ht,{helpLabel:"policyDecisionStagey"})]})},Gt=()=>{const{t:i}=k("clients"),{control:a,getValues:s,formState:{errors:c}}=R(),p=s("clients"),[d,r]=y.exports.useState(!1),[h,g]=y.exports.useState([]),[m,t]=y.exports.useState(""),{adminClient:o}=G();K(async()=>{const n={max:20};return m&&(n.clientId=m,n.search=!0),p?.length&&!m?await Promise.all(p.map(u=>o.clients.findOne({id:u}))):await o.clients.find(n)},g,[m]);const l=n=>n.map(u=>e(z,{value:u.id,selected:p?.includes(u.id),children:u.clientId},u.id));return e($,{label:i("clients"),labelIcon:e(v,{helpText:"clients-help:policyClient",fieldLabelId:"clients:client"}),fieldId:"clients",helperTextInvalid:i("requiredClient"),validated:c.clients?"error":"default",isRequired:!0,children:e(P,{name:"clients",defaultValue:[],control:a,rules:{validate:n=>n.length>0},render:({onChange:n,value:u})=>e(me,{toggleId:"clients",variant:ee.typeaheadMulti,onToggle:f=>r(f),isOpen:d,selections:u,onFilter:(f,S)=>(t(S),l(h)),onSelect:(f,S)=>{const b=S.toString();u.includes(b)?n(u.filter(x=>x!==b)):n([...u,b]),r(!1)},"aria-label":i("clients"),children:l(h)})})})},Kt=({name:i,label:a,helpText:s,defaultValue:c,isRequired:p,variant:d=ee.typeaheadMulti})=>{const{t:r}=k("clients"),{control:h,getValues:g,formState:{errors:m}}=R(),t=g(i),[o,l]=pe(),[n,u]=y.exports.useState([]),[f,S]=y.exports.useState(""),{adminClient:b}=G();K(()=>{const T={max:20};return f&&(T.username=f),t?.length&&!f?Promise.all(t.map(O=>b.users.findOne({id:O}))):b.users.find(T)},u,[f]);const x=T=>T.filter(O=>O!==void 0).map(O=>e(z,{value:O.id,selected:t?.includes(O.id),children:O.username},O.id));return e($,{label:r(a),isRequired:p,labelIcon:e(v,{helpText:s,fieldLabelId:`clients:${a}`}),fieldId:i,validated:m[i]?"error":"default",helperTextInvalid:r("common:required"),children:e(P,{name:i,defaultValue:c,control:h,rules:p&&d===ee.typeaheadMulti?{validate:T=>T.length>0}:p?{required:!0}:{},render:({onChange:T,value:O})=>e(me,{toggleId:i,variant:d,placeholderText:r("selectAUser"),onToggle:l,isOpen:o,selections:O,onFilter:(j,q)=>(S(q),x(n)),onSelect:(j,q)=>{const H=q.toString();O.includes(H)?T(O.filter(C=>C!==H)):T([...O,H]),l()},"aria-label":r(i),children:x(n)})})})},jt=()=>e(Kt,{name:"users",label:"users",helpText:"clients-help:policyUsers",defaultValue:[],isRequired:!0}),Bt=({prefix:i})=>{const{t:a}=k("clients"),{register:s,formState:{errors:c}}=R();return I(D,{children:[e($,{label:a("common:name"),fieldId:"kc-name",helperTextInvalid:a("common:required"),validated:c.name?M.error:M.default,isRequired:!0,labelIcon:e(v,{helpText:`clients-help:${i}-name`,fieldLabelId:"name"}),children:e(te,{type:"text",id:"kc-name",name:"name","data-testid":"name",ref:s({required:!0}),validated:c.name?M.error:M.default})}),e($,{label:a("common:description"),fieldId:"kc-description",labelIcon:e(v,{helpText:`clients-help:${i}-description`,fieldLabelId:"description"}),validated:c.description?M.error:M.default,helperTextInvalid:c.description?.message,children:e(mt,{ref:s({maxLength:{value:255,message:a("common:maxLength",{length:255})}}),type:"text",id:"kc-description",name:"description","data-testid":"description",validated:c.description?M.error:M.default})})]})},ke=["POSITIVE","NEGATIVE"],zt=()=>{const{t:i}=k("clients"),{control:a}=R();return e($,{label:i("logic"),labelIcon:e(v,{helpText:"clients-help:logic",fieldLabelId:"clients:logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e(P,{name:"logic","data-testid":"logic",defaultValue:ke[0],control:a,render:({onChange:s,value:c})=>e(D,{children:ke.map(p=>e(Z,{id:p,"data-testid":p,isChecked:c===p,name:"logic",onChange:()=>s(p),label:i(`logicType.${p.toLowerCase()}`),className:"pf-u-mb-md"},p))})})})},Wt=()=>{const{t:i}=k("clients"),{control:a,getValues:s,setValue:c,formState:{errors:p}}=R(),[d,r]=y.exports.useState(!1),[h,g]=y.exports.useState([]),[m,t]=y.exports.useState([]),{adminClient:o}=G(),l=xt();return K(()=>o.clientScopes.find(),n=>{t(s("clientScopes").map(u=>n.find(f=>f.id===u.id))),g(l(n,yt("name")))},[]),I($,{label:i("clientScopes"),labelIcon:e(v,{helpText:"clients-help:clientScopes",fieldLabelId:"clients:clientScopes"}),fieldId:"clientScopes",helperTextInvalid:i("requiredClientScope"),validated:p.clientScopes?"error":"default",isRequired:!0,children:[e(P,{name:"clientScopes",control:a,defaultValue:[],rules:{validate:n=>n.filter(u=>u.id).length>0},render:({onChange:n,value:u})=>I(D,{children:[d&&e(qt,{clientScopes:h.filter(f=>!u.map(S=>S.id).includes(f.id)),isClientScopesConditionType:!0,open:d,toggleDialog:()=>r(!d),onAdd:f=>{t([...m,...f.map(S=>S.scope)]),n([...u,...f.map(S=>S.scope).map(S=>({id:S.id,required:!1}))])}}),e(w,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{r(!0)},children:i("addClientScopes")})]})}),m.length>0&&I(he,{variant:"compact",children:[e(fe,{children:I(U,{children:[e(L,{children:i("clientScope")}),e(L,{children:i("required")}),e(L,{})]})}),e(ge,{children:m.map((n,u)=>I(U,{children:[e(V,{children:n.name}),e(V,{children:e(P,{name:`clientScopes[${u}].required`,defaultValue:!1,control:a,render:({onChange:f,value:S})=>e(Se,{id:"required","data-testid":"standard",name:"required",isChecked:S,onChange:f})})}),e(V,{children:e(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Ie,{}),onClick:()=>{c("clientScopes",[...s("clientScopes").filter(f=>f.id!==n.id)]),t([...m.filter(f=>f.id!==n.id)])}})})]},n.id))})]})]})},Yt=()=>{const{t:i}=k("clients"),{control:a,register:s,getValues:c,setValue:p,formState:{errors:d}}=R(),r=c("groups"),[h,g]=y.exports.useState(!1),[m,t]=y.exports.useState([]),{adminClient:o}=G();return K(()=>r&&r.length>0?Promise.all(r.map(l=>o.groups.findOne({id:l.id}))):Promise.resolve([]),l=>{const n=l.filter(u=>u);t(n)},[]),I(D,{children:[e($,{label:i("groupsClaim"),labelIcon:e(v,{helpText:"clients-help:groupsClaim",fieldLabelId:"clients:groupsClaim"}),fieldId:"groups",children:e(te,{type:"text",id:"groupsClaim",name:"groupsClaim","data-testid":"groupsClaim",ref:s})}),I($,{label:i("groups"),labelIcon:e(v,{helpText:"clients-help:policyGroups",fieldLabelId:"clients:groups"}),fieldId:"groups",helperTextInvalid:i("requiredGroups"),validated:d.groups?"error":"default",isRequired:!0,children:[e(P,{name:"groups",control:a,defaultValue:[],rules:{validate:l=>l.filter(({id:n})=>n).length>0},render:({onChange:l,value:n})=>I(D,{children:[h&&e(Ct,{type:"selectMany",text:{title:"clients:addGroupsToGroupPolicy",ok:"common:add"},onConfirm:u=>{l([...n,...(u||[]).map(({id:f})=>({id:f}))]),t([...m,...u||[]]),g(!1)},onClose:()=>{g(!1)},filterGroups:m.map(({name:u})=>u)}),e(w,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{g(!0)},children:i("addGroups")})]})}),m.length>0&&I(he,{variant:"compact",children:[e(fe,{children:I(U,{children:[e(L,{children:i("groups")}),e(L,{children:i("extendToChildren")}),e(L,{})]})}),e(ge,{children:m.map((l,n)=>I(U,{children:[e(V,{children:l.path}),e(V,{children:e(P,{name:`groups[${n}].extendChildren`,defaultValue:!1,control:a,render:({onChange:u,value:f})=>e(Se,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:f,onChange:u,isDisabled:l.subGroups?.length===0})})}),e(V,{children:e(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Ie,{}),onClick:()=>{p("groups",[...(r||[]).filter(({id:u})=>u!==l.id)]),t([...m.filter(({id:u})=>u!==l.id)])}})})]},l.id))})]})]})]})},Jt=()=>{const{t:i}=k("clients"),{register:a,formState:{errors:s}}=R();return I(D,{children:[e($,{label:i("targetClaim"),fieldId:"targetClaim",helperTextInvalid:i("common:required"),validated:s.targetClaim?"error":"default",isRequired:!0,labelIcon:e(v,{helpText:"clients-help:targetClaim",fieldLabelId:"clients:targetClaim"}),children:e(te,{type:"text",id:"targetClaim",name:"targetClaim","data-testid":"targetClaim",ref:a({required:!0}),validated:s.targetClaim?"error":"default"})}),e($,{label:i("regexPattern"),fieldId:"pattern",labelIcon:e(v,{helpText:"clients-help:regexPattern",fieldLabelId:"clients:regexPattern"}),isRequired:!0,validated:s.pattern?"error":"default",helperTextInvalid:i("common:required"),children:e(te,{ref:a({required:!0}),type:"text",id:"pattern",name:"pattern","data-testid":"regexPattern",validated:s.pattern?"error":"default"})})]})},Qt=()=>{const{t:i}=k("clients"),{control:a,getValues:s,setValue:c,formState:{errors:p}}=R(),d=s("roles"),[r,h]=y.exports.useState(!1),[g,m]=y.exports.useState([]),{adminClient:t}=G();return K(async()=>{if(d&&d.length>0){const o=await Promise.all(d.map(l=>t.roles.findOneById({id:l.id})));return Promise.all(o.map(async l=>({role:l,client:l.clientRole?await t.clients.findOne({id:l?.containerId}):void 0})))}return Promise.resolve([])},m,[]),I($,{label:i("roles"),labelIcon:e(v,{helpText:"clients-help:policyRoles",fieldLabelId:"clients:roles"}),fieldId:"roles",helperTextInvalid:i("requiredRoles"),validated:p.roles?"error":"default",isRequired:!0,children:[e(P,{name:"roles",control:a,defaultValue:[],rules:{validate:o=>o.filter(l=>l.id).length>0},render:({onChange:o,value:l})=>I(D,{children:[r&&e(bt,{id:"role",type:"roles",onAssign:n=>{o([...l,...n.map(u=>({id:u.role.id}))]),m([...g,...n]),h(!1)},onClose:()=>{h(!1)},isLDAPmapper:!0}),e(w,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>{h(!0)},children:i("addRoles")})]})}),g.length>0&&I(he,{variant:"compact",children:[e(fe,{children:I(U,{children:[e(L,{children:i("roles")}),e(L,{children:i("required")}),e(L,{})]})}),e(ge,{children:g.map((o,l)=>I(U,{children:[e(V,{children:e(vt,{role:o.role,client:o.client})}),e(V,{children:e(P,{name:`roles[${l}].required`,defaultValue:!1,control:a,render:({onChange:n,value:u})=>e(Se,{id:"required","data-testid":"standard",name:"required",isChecked:u,onChange:n})})}),e(V,{children:e(w,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Ie,{}),onClick:()=>{c("roles",[...(d||[]).filter(n=>n.id!==o.role.id)]),m([...g.filter(n=>n.role.id!==o.role.id)])}})})]},o.role.id))})]})]})},ce=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,De=i=>i.toString().padStart(2,"0"),Pe=({name:i})=>{const{control:a}=R(),s=(p,d)=>{if(!d)return p;const r=p.match(ce);return`${[d.getFullYear(),De(d.getMonth()+1),De(d.getDate())].join("-")} ${r?r[2]:"00"}:${r?r[3]:"00"}:00`},c=(p,d,r)=>{const h=p.match(ce);return r!=null?`${h?h[1]:""} ${d}:${r<10?`0${r}`:r}:00`:p};return e(P,{name:i,defaultValue:"",control:a,rules:{required:!0},render:({onChange:p,value:d})=>{const r=d.match(ce)||["","","0","00"];return I(Ae,{hasGutter:!0,id:i,children:[e(B,{children:e($t,{value:r[1],onChange:(h,g)=>{p(s(d,g))}})}),e(B,{children:e(Te,{time:`${r[2]}:${r[3]}`,onChange:(h,g,m)=>p(c(d,g,m)),is24Hour:!0})})]})}})},Re=({name:i,min:a,max:s})=>{const{control:c}=R(),p=d=>Math.min(d,s);return e(P,{name:i,defaultValue:"",control:c,render:({onChange:d,value:r})=>e(Mt,{id:i,value:r,min:a,max:s,onPlus:()=>d(Number(r)+1),onMinus:()=>d(Number(r)-1),onChange:h=>{const g=Number(h.currentTarget.value);d(p(isNaN(g)?0:g))}})})},Q=({name:i,...a})=>{const{t:s}=k("clients");return e($,{label:s(i),fieldId:i,labelIcon:e(v,{helpText:`clients-help:${i}`,fieldLabelId:`clients:${i}`}),children:I(Ae,{hasGutter:!0,children:[e(B,{children:e(Re,{name:i,...a})}),e(B,{children:s("common:to")}),e(B,{children:e(Re,{name:`${i}End`,...a})})]})})},Xt=()=>{const{t:i}=k("clients"),{getValues:a,errors:s}=R(),[c,p]=y.exports.useState(a("month"));return I(D,{children:[e($,{label:i("repeat"),fieldId:"repeat",labelIcon:e(v,{helpText:"clients-help:repeat",fieldLabelId:"clients:repeat"}),children:I(Rt,{children:[e(Oe,{children:e(Z,{id:"notRepeat","data-testid":"notRepeat",isChecked:!c,name:"repeat",onChange:()=>p(!1),label:i("notRepeat"),className:"pf-u-mb-md"})}),e(Oe,{children:e(Z,{id:"repeat","data-testid":"repeat",isChecked:c,name:"repeat",onChange:()=>p(!0),label:i("repeat"),className:"pf-u-mb-md"})})]})}),c&&I(D,{children:[e(Q,{name:"month",min:1,max:12}),e(Q,{name:"dayMonth",min:1,max:31}),e(Q,{name:"hour",min:0,max:23}),e(Q,{name:"minute",min:0,max:59})]}),e($,{label:i("startTime"),fieldId:"notBefore",labelIcon:e(v,{helpText:"clients-help:startTime",fieldLabelId:"clients:startTime"}),isRequired:!0,helperTextInvalid:i("common:required"),validated:s.notBefore?M.error:M.default,children:e(Pe,{name:"notBefore"})}),e($,{label:i("expireTime"),fieldId:"notOnOrAfter",labelIcon:e(v,{helpText:"clients-help:expireTime",fieldLabelId:"clients:expireTime"}),isRequired:!0,helperTextInvalid:i("common:required"),validated:s.notOnOrAfter?M.error:M.default,children:e(Pe,{name:"notOnOrAfter"})})]})},Zt=()=>{const{t:i}=k("clients"),{control:a}=R();return e($,{label:i("code"),labelIcon:e(v,{helpText:"clients-help:policyCode",fieldLabelId:"clients:code"}),fieldId:"code",isRequired:!0,children:e(P,{name:"code",defaultValue:"",control:a,render:({onChange:s,value:c})=>e(At,{id:"code","data-testid":"code",type:"text",onChange:s,code:c,height:"600px",language:wt.javascript})})})};const ue={aggregate:Ut,client:Gt,user:jt,"client-scope":Wt,group:Yt,regex:Jt,role:Qt,time:Xt,js:Zt},_e=i=>i in ue;function ei(){const{t:i}=k("clients"),{id:a,realm:s,policyId:c,policyType:p}=Me(),d=Ze(),r=ot({shouldUnregister:!1}),{reset:h,handleSubmit:g}=r,{adminClient:m}=G(),{addAlert:t,addError:o}=et(),[l,n]=y.exports.useState();K(async()=>{if(c){const x=await Promise.all([m.clients.findOnePolicy({id:a,type:p,policyId:c}),m.clients.getAssociatedPolicies({id:a,permissionId:c})]);if(!x[0])throw new Error(i("common:notFound"));return{policy:x[0],policies:x[1].map(T=>T.id)}}return{}},({policy:x,policies:T})=>{h({...x,policies:T}),n(x)},[]);const u=async x=>{x.groups=x.groups?.filter(T=>T.id),x.clientScopes=x.clientScopes?.filter(T=>T.id),x.roles=x.roles?.filter(T=>T.id).map(T=>({...T,required:T.required||!1}));try{if(c)await m.clients.updatePolicy({id:a,type:p,policyId:c},x);else{const T=await m.clients.createPolicy({id:a,type:p},x);d(st({realm:s,id:a,policyType:p,policyId:T.id}))}t(i((c?"update":"create")+"PolicySuccess"),ve.success)}catch(T){o("clients:policySaveError",T)}},[f,S]=at({titleKey:"clients:deletePolicy",messageKey:"clients:deletePolicyConfirm",continueButtonLabel:"clients:confirm",onConfirm:async()=>{try{await m.clients.delPolicy({id:a,policyId:c}),t(i("policyDeletedSuccess"),ve.success),d(be({realm:s,clientId:a,tab:"policies"}))}catch(x){o("clients:policyDeletedError",x)}}});if(c&&!l)return e(tt,{});const b=_e(p)?ue[p]:ue.js;return I(D,{children:[e(S,{}),e(lt,{titleKey:c?l?.name:i("clients:createPolicyOfType",{policyType:p}),dropdownItems:c?[e(de,{"data-testid":"delete-policy",onClick:()=>f(),children:i("common:delete")},"delete")]:void 0}),e(it,{variant:"light",children:I(ct,{isHorizontal:!0,onSubmit:g(u),role:"view-clients",children:[I(rt,{...r,children:[e(Bt,{prefix:"policy"}),e(b,{}),e(zt,{})]}),e(pt,{children:I("div",{className:"pf-u-mt-md",children:[e(w,{variant:X.primary,className:"pf-u-mr-md",type:"submit","data-testid":"save",children:i("common:save")}),e(w,{variant:"link","data-testid":"cancel",component:x=>e(nt,{...x,to:be({realm:s,clientId:a,tab:"policies"})}),children:i("common:cancel")})]})})]})})]})}const Ri=Object.freeze(Object.defineProperty({__proto__:null,isValidComponentType:_e,default:ei},Symbol.toStringTag,{value:"Module"}));export{qt as A,Ht as D,Ri as P,Kt as U,_e as i};
