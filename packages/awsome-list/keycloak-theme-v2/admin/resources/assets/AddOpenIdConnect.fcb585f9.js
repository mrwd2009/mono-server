import{u as h,ay as g,l as I,h as m,F as b,j as e,b6 as k,b7 as S,aw as C,bM as E,az as A,P as D,s as v,b4 as O,cr as P,aY as T,cs as w}from"./index.0cb2e516.js";import{a as x,u as j,F as H}from"./index.esm.6af887f8.js";import{F as U}from"./FormAccess.bee4f1e0.js";import{V}from"./ViewHeader.2586557f.js";import{D as z,O as $,a as G}from"./OIDCAuthentication.fcec663d.js";import{T as J,H as K}from"./HelpItem.e440d5db.js";import{J as L}from"./JsonFileUpload.41ab83b4.js";import{D as N}from"./DiscoveryEndpointField.309a86da.js";import{a as B,A as M}from"./FormGroup.3d5f3f16.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./Text.c38ffb52.js";import"./discovery-settings.18f66d94.js";import"./KeycloakTextInput.b4d5b2db.js";import"./ExpandableSection.ed768772.js";import"./Select.5a6b39aa.js";import"./check.51c67984.js";import"./star-icon.97692015.js";import"./DisplayOrder.76153bb4.js";import"./ClientIdSecret.0917a328.js";import"./PasswordInput.34ff6dd3.js";import"./FileUploadForm.9e6f7b27.js";import"./FileUpload.18e1e495.js";import"./CodeEditor.16ebafa0.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Modal.6593dfcc.js";const R=()=>{const{t:i}=h("identity-providers"),p="oidc",{adminClient:c}=g(),{realm:l}=I(),{setValue:s,setError:n,clearErrors:u,formState:{errors:d}}=x(),y=r=>{Object.keys(r).map(t=>s(`config.${t}`,r[t]))},f=async r=>{if(u("discoveryError"),!r)return;const t=new FormData;t.append("providerId",p),t.append("file",new Blob([JSON.stringify(r)]));try{const o=await fetch(`${k(c.baseUrl)}admin/realms/${l}/identity-provider/import-config`,{method:"POST",body:t,headers:S(await c.getAccessToken())});if(o.ok){const a=await o.json();y(a)}else n("discoveryError",{type:"manual",message:o.statusText})}catch(o){n("discoveryError",{type:"manual",message:o.message})}};return m(b,{children:[e(J,{headingLevel:"h4",size:"xl",className:"kc-form-panel__title",children:i("oidcSettings")}),e(N,{id:"oidc",fileUpload:e(B,{label:i("importConfig"),fieldId:"kc-import-config",labelIcon:e(K,{helpText:"identity-providers-help:importConfig",fieldLabelId:"identity-providers:importConfig"}),validated:d.discoveryError?"error":"default",helperTextInvalid:d.discoveryError?.message,children:e(L,{id:"kc-import-config",helpText:"identity=providers-help:jsonFileUpload",hideDefaultPreview:!0,unWrap:!0,validated:d.discoveryError?"error":"default",onChange:r=>f(r)})}),children:r=>e(z,{readOnly:r})})]})};function be(){const{t:i}=h("identity-providers"),p=C(),{url:c}=E(),l=c.includes("keycloak-oidc"),s=`${l?"keycloak-":""}oidc`,n=j({defaultValues:{alias:s}}),{handleSubmit:u,formState:{isDirty:d}}=n,{adminClient:y}=g(),{addAlert:f,addError:r}=A(),{realm:t}=I(),o=async a=>{delete a.discoveryEndpoint;try{await y.identityProviders.create({...a,providerId:s}),f(i("createSuccess"),T.success),p(w({realm:t,providerId:s,alias:a.alias,tab:"settings"}))}catch(F){r("identity-providers:createError",F)}};return m(b,{children:[e(V,{titleKey:i(l?"addKeycloakOpenIdProvider":"addOpenIdProvider")}),e(D,{variant:"light",children:e(H,{...n,children:m(U,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:u(o),children:[e($,{id:s}),e(R,{}),e(G,{}),m(M,{children:[e(v,{isDisabled:!d,variant:"primary",type:"submit","data-testid":"createProvider",children:i("common:add")}),e(v,{variant:"link","data-testid":"cancel",component:a=>e(O,{...a,to:P({realm:t})}),children:i("common:cancel")})]})]})})})]})}export{be as default};
