import{u as D,l as $,bH as W,r as C,bA as J,bB as x,aB as Y,h as O,j as e,av as h,aA as B,s as N,b4 as Q,bI as X,n as Z,aw as ee,ay as te,az as oe,a_ as ne,ae,aY as v,K as re,F as ie,ap as se,P as K,bJ as H,aC as ce,bK as q}from"./index.0cb2e516.js";import{V as le}from"./ViewHeader.2586557f.js";import{M as de}from"./MapperList.1ce3dbd8.js";import{u as pe,b as me,C as k}from"./index.esm.6af887f8.js";import{a as j,c as ue,b as _}from"./ClientScopeTypes.9d1fc6d4.js";import{H as b}from"./HelpItem.e440d5db.js";import{g as fe}from"./utils.988d95db.js";import{F as he}from"./FormAccess.bee4f1e0.js";import{K as E}from"./KeycloakTextInput.b4d5b2db.js";import{K as be}from"./KeycloakTextArea.f5e2440a.js";import{a as y,A as ye}from"./FormGroup.3d5f3f16.js";import{S as z,b as G,a as ge}from"./Select.5a6b39aa.js";import{u as Se}from"./ConfirmDialog.f8013bbb.js";import{R as Te}from"./AddRoleMappingModal.4adc845a.js";import{R as Ie,r as xe}from"./RoutableTabs.f3cff418.js";import{T as P,a as R}from"./Tabs.3d61d369.js";import"./Text.c38ffb52.js";import"./KeycloakDataTable.4e517788.js";import"./TableToolbar.c27bcd3c.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Modal.6593dfcc.js";import"./useLocaleSort.84ea7ec0.js";import"./DataListItemRow.8f458244.js";import"./data-list.f7ff2ea7.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./resource.df4d2bbd.js";import"./joinPath.69b856b1.js";import"./filter-icon.fec9f70e.js";import"./plus-icon.407671b4.js";import"./MenuList.288a98b4.js";const U=({clientScope:r,save:a})=>{const{t:o}=D("client-scopes"),{t:F}=D("clients"),{register:T,control:p,handleSubmit:c,setValue:n,formState:{errors:m}}=pe(),{realm:g}=$(),u=W(),[M,w]=C.exports.useState(!1),[V,I]=C.exports.useState(!1),{id:L}=J(),A=me({control:p,name:x("attributes.display.on.consent.screen"),defaultValue:r.attributes?.["display.on.consent.screen"]??(L?"false":"true")});return C.exports.useEffect(()=>{Y(r,n)},[r]),O(he,{isHorizontal:!0,onSubmit:c(a),role:"manage-clients",children:[e(y,{label:o("common:name"),labelIcon:e(b,{helpText:"client-scopes-help:name",fieldLabelId:"name"}),fieldId:"kc-name",isRequired:!0,validated:m.name?h.error:h.default,helperTextInvalid:o("common:required"),children:e(E,{ref:T({required:!0,validate:i=>!!i.trim()||o("common:required").toString()}),type:"text",id:"kc-name",name:"name",validated:m.name?h.error:h.default})}),e(y,{label:o("common:description"),labelIcon:e(b,{helpText:"client-scopes-help:description",fieldLabelId:"description"}),fieldId:"kc-description",validated:m.description?h.error:h.default,helperTextInvalid:o("common:maxLength",{length:255}),children:e(E,{ref:T({maxLength:255}),validated:m.description?h.error:h.default,type:"text",id:"kc-description",name:"description"})}),e(y,{label:o("type"),labelIcon:e(b,{helpText:"client-scopes-help:type",fieldLabelId:"client-scopes:type"}),fieldId:"type",children:e(k,{name:"type",defaultValue:j[0],control:p,render:({onChange:i,value:d})=>e(z,{id:"type",variant:G.single,isOpen:V,selections:d,onToggle:I,onSelect:(l,S)=>{i(S),I(!1)},children:ue(o,j)})})}),!L&&e(y,{label:o("protocol"),labelIcon:e(b,{helpText:"client-scopes-help:protocol",fieldLabelId:"client-scopes:protocol"}),fieldId:"kc-protocol",children:e(k,{name:"protocol",defaultValue:u[0],control:p,render:({onChange:i,value:d})=>e(z,{toggleId:"kc-protocol",required:!0,onToggle:w,onSelect:(l,S)=>{i(S),w(!1)},selections:d,variant:G.single,"aria-label":o("selectEncryptionType"),isOpen:M,children:u.map(l=>e(ge,{selected:l===d,value:l,"data-testid":`option-${l}`,children:fe(F,l)},l))})})}),e(y,{hasNoPaddingTop:!0,label:o("displayOnConsentScreen"),labelIcon:e(b,{helpText:"client-scopes-help:displayOnConsentScreen",fieldLabelId:"client-scopes:displayOnConsentScreen"}),fieldId:"kc-display.on.consent.screen",children:e(k,{name:x("attributes.display.on.consent.screen"),control:p,defaultValue:A,render:({onChange:i,value:d})=>e(B,{id:"kc-display.on.consent.screen-switch",label:o("common:on"),labelOff:o("common:off"),isChecked:d==="true",onChange:l=>i(""+l),"aria-label":o("displayOnConsentScreen")})})}),A==="true"&&e(y,{label:o("consentScreenText"),labelIcon:e(b,{helpText:"client-scopes-help:consentScreenText",fieldLabelId:"client-scopes:consentScreenText"}),fieldId:"kc-consent-screen-text",children:e(be,{ref:T,type:"text",id:"kc-consent-screen-text",name:x("attributes.consent.screen.text")})}),e(y,{hasNoPaddingTop:!0,label:o("includeInTokenScope"),labelIcon:e(b,{helpText:"client-scopes-help:includeInTokenScope",fieldLabelId:"client-scopes:includeInTokenScope"}),fieldId:"includeInTokenScope",children:e(k,{name:x("attributes.include.in.token.scope"),control:p,defaultValue:"true",render:({onChange:i,value:d})=>e(B,{id:"includeInTokenScope-switch",label:o("common:on"),labelOff:o("common:off"),isChecked:d==="true",onChange:l=>i(""+l),"aria-label":o("includeInTokenScope")})})}),e(y,{label:o("guiOrder"),labelIcon:e(b,{helpText:"client-scopes-help:guiOrder",fieldLabelId:"client-scopes:guiOrder"}),fieldId:"kc-gui-order",children:e(k,{name:x("attributes.gui.order"),defaultValue:"",control:p,render:({onChange:i,value:d})=>e(E,{id:"kc-gui-order",type:"number",value:d,"data-testid":"displayOrder",min:0,onChange:i})})}),O(ye,{children:[e(N,{variant:"primary",type:"submit",children:o("common:save")}),e(N,{variant:"link",component:i=>e(Q,{...i,to:X({realm:g})}),children:o("common:cancel")})]})]})};function it(){const{t:r}=D("client-scopes"),[a,o]=C.exports.useState(),F=Z(),T=ee(),{realm:p}=$(),{adminClient:c}=te(),{id:n,type:m}=J(),{addAlert:g,addError:u}=oe(),[M,w]=C.exports.useState(0),V=()=>w(new Date().getTime());ne(async()=>{if(n){const t=await c.clientScopes.findOne({id:n});if(!t)throw new Error(r("common:notFound"));return{...t,type:m}}},t=>{o(t)},[M,n]);const I=async t=>{try{if(t.name=t.name?.trim().replace(/ /g,"_"),t=ce(t),n)await c.clientScopes.update({id:n},t),_(c,{...t,id:n,type:m},t.type);else{await c.clientScopes.create(t);const s=await c.clientScopes.findOneByName({name:t.name});if(!s)throw new Error(r("common:notFound"));_(c,{...t,id:s.id},t.type),T(q({realm:p,id:s.id,type:t.type||"none",tab:"settings"}))}g(r((n?"update":"create")+"Success"),v.success)}catch(s){u(`client-scopes:${n?"update":"create"}Error`,s)}},[L,A]=Se({titleKey:r("deleteClientScope",{count:1,name:a?.name}),messageKey:"client-scopes:deleteConfirm",continueButtonLabel:"common:delete",continueButtonVariant:ae.danger,onConfirm:async()=>{try{await c.clientScopes.del({id:n}),g(r("deletedSuccess"),v.success)}catch(t){u("client-scopes:deleteError",t)}}}),i=async t=>{try{const s=t.filter(f=>f.client===void 0).map(f=>f.role).flat();await c.clientScopes.addRealmScopeMappings({id:n},s),await Promise.all(t.filter(f=>f.client!==void 0).map(f=>c.clientScopes.addClientScopeMappings({id:n,client:f.client.id},[f.role]))),g(r("roleMappingUpdatedSuccess"),v.success)}catch(s){u("client-scopes:roleMappingUpdatedError",s)}},d=async t=>{if(Array.isArray(t))try{await c.clientScopes.addMultipleProtocolMappers({id:a.id},t),V(),g(r("common:mappingCreatedSuccess"),v.success)}catch(s){u("common:mappingCreatedError",s)}else{const s=t;T(H({realm:p,id:a.id,type:m,mapperId:s.id}))}},l=async t=>{try{await c.clientScopes.delProtocolMapper({id:a.id,mapperId:t.id}),g(r("common:mappingDeletedSuccess"),v.success),V()}catch(s){u("common:mappingDeletedError",s)}return!0};if(n&&!a)return e(re,{});const S=t=>xe({to:q({realm:p,id:n,tab:t,type:m}),history:F});return O(ie,{children:[e(A,{}),e(le,{titleKey:a?a.name:"client-scopes:createClientScope",dropdownItems:a?[e(se,{onClick:L,children:r("common:delete")},"delete")]:void 0,badges:[{text:a?a.protocol:void 0}],divider:!n}),O(K,{variant:"light",className:"pf-u-p-0",children:[!n&&e(K,{variant:"light",children:e(U,{save:I,clientScope:{}})}),n&&a&&O(Ie,{isBox:!0,children:[e(P,{id:"settings","data-testid":"settings",title:e(R,{children:r("common:settings")}),...S("settings"),children:e(K,{variant:"light",children:e(U,{save:I,clientScope:a})})}),e(P,{id:"mappers","data-testid":"mappers",title:e(R,{children:r("common:mappers")}),...S("mappers"),children:e(de,{model:a,onAdd:d,onDelete:l,detailLink:t=>H({realm:p,id:a.id,type:m,mapperId:t})})}),e(P,{id:"scope","data-testid":"scopeTab",title:e(R,{children:r("scope")}),...S("scope"),children:e(Te,{id:n,name:a.name,type:"clientScopes",save:i})})]})]})]})}export{it as default};
