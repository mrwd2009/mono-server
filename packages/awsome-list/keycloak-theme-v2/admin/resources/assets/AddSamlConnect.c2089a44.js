import{u as b,ay as S,l as E,h as m,F,j as e,m as x,b6 as T,b7 as C,aw as k,az as w,P as A,s as y,b4 as D,cr as V,aY as g,cs as j}from"./index.0cb2e516.js";import{a as H,u as U,F as $}from"./index.esm.6af887f8.js";import{F as z}from"./FormAccess.bee4f1e0.js";import{V as L}from"./ViewHeader.2586557f.js";import{D as q,S as G}from"./SamlGeneralSettings.423673f3.js";import{T as K,H as h}from"./HelpItem.e440d5db.js";import{F as O}from"./FileUploadForm.9e6f7b27.js";import{D as B}from"./DiscoveryEndpointField.309a86da.js";import{K as N}from"./KeycloakTextInput.b4d5b2db.js";import{a as I,A as R}from"./FormGroup.3d5f3f16.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./Text.c38ffb52.js";import"./discovery-settings.18f66d94.js";import"./ExpandableSection.ed768772.js";import"./Select.5a6b39aa.js";import"./check.51c67984.js";import"./star-icon.97692015.js";import"./DisplayOrder.76153bb4.js";import"./FileUpload.18e1e495.js";import"./CodeEditor.16ebafa0.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Modal.6593dfcc.js";const _=()=>{const{t}=b("identity-providers"),p="saml",{adminClient:a}=S(),{realm:n}=E(),{setValue:v,register:u,setError:l,clearErrors:c,formState:{errors:i}}=H(),f=r=>{Object.entries(r).map(([d,s])=>v(`config.${d}`,s))},o=async r=>{if(c("discoveryError"),!r)return;const d=new FormData;d.append("providerId",p),d.append("file",new Blob([r]));try{const s=await fetch(`${T(a.baseUrl)}admin/realms/${n}/identity-provider/import-config`,{method:"POST",body:d,headers:C(await a.getAccessToken())});if(s.ok){const P=await s.json();f(P)}else l("discoveryError",{type:"manual",message:s.statusText})}catch(s){l("discoveryError",{type:"manual",message:s.message})}};return m(F,{children:[e(K,{headingLevel:"h4",size:"xl",className:"kc-form-panel__title",children:t("samlSettings")}),e(I,{label:t("serviceProviderEntityId"),fieldId:"kc-service-provider-entity-id",labelIcon:e(h,{helpText:"identity-providers-help:serviceProviderEntityId",fieldLabelId:"identity-providers:serviceProviderEntityId"}),isRequired:!0,helperTextInvalid:t("common:required"),validated:i.config?.entityId?"error":"default",children:e(N,{type:"text",name:"config.entityId","data-testid":"serviceProviderEntityId",id:"kc-service-provider-entity-id",ref:u({required:!0}),validated:i.config?.entityId?"error":"default",defaultValue:`${x.authServerUrl}/realms/${n}`})}),e(B,{id:"saml",fileUpload:e(I,{label:t("importConfig"),fieldId:"kc-import-config",labelIcon:e(h,{helpText:"identity-providers-help:importConfig",fieldLabelId:"identity-providers:importConfig"}),validated:i.discoveryError?"error":"default",helperTextInvalid:i.discoveryError?.message,children:e(O,{id:"kc-import-config",extension:".xml",hideDefaultPreview:!0,unWrap:!0,validated:i.discoveryError?"error":"default",onChange:r=>o(r)})}),children:r=>e(q,{readOnly:r})})]})};function ge(){const{t}=b("identity-providers"),p=k(),a="saml",n=U({defaultValues:{alias:a,config:{allowCreate:"true"}}}),{handleSubmit:v,formState:{isDirty:u}}=n,{adminClient:l}=S(),{addAlert:c}=w(),{realm:i}=E(),f=async o=>{delete o.discoveryEndpoint;try{await l.identityProviders.create({...o,providerId:a}),c(t("createSuccess"),g.success),p(j({realm:i,providerId:a,alias:o.alias,tab:"settings"}))}catch(r){c(t("createError",{error:r.response?.data?.errorMessage||r}),g.danger)}};return m(F,{children:[e(L,{titleKey:t("addSamlProvider")}),e(A,{variant:"light",children:e($,{...n,children:m(z,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:v(f),children:[e(G,{id:a}),e(_,{}),m(R,{children:[e(y,{isDisabled:!u,variant:"primary",type:"submit","data-testid":"createProvider",children:t("common:add")}),e(y,{variant:"link","data-testid":"cancel",component:o=>e(D,{...o,to:V({realm:i})}),children:t("common:cancel")})]})]})})})]})}export{ge as default};
