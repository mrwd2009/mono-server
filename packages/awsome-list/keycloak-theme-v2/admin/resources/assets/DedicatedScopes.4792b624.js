import{u as M,ay as T,az as C,r as x,aD as v,h,P as D,j as i,aA as E,F as I,H as P,aY as A,n as R,aw as F,bA as H,a_ as K,K as L,bV as g,ch as b}from"./index.0cb2e516.js";import{M as O}from"./MapperList.1ce3dbd8.js";import{V}from"./ViewHeader.2586557f.js";import{R as j,r as k}from"./RoutableTabs.f3cff418.js";import{F as N}from"./FormAccess.bee4f1e0.js";import{H as z}from"./HelpItem.e440d5db.js";import{R as G}from"./AddRoleMappingModal.4adc845a.js";import{a as B}from"./FormGroup.3d5f3f16.js";import{T as w,a as y}from"./Tabs.3d61d369.js";import"./KeycloakDataTable.4e517788.js";import"./TableToolbar.c27bcd3c.js";import"./star-icon.97692015.js";import"./check.51c67984.js";import"./grip-vertical-icon.1b75ab8f.js";import"./Checkbox.2dc73ed3.js";import"./plus-circle-icon.32cdf4dc.js";import"./EmptyStateBody.a0363fe4.js";import"./EmptyStateSecondaryActions.1a804d56.js";import"./Modal.6593dfcc.js";import"./useLocaleSort.84ea7ec0.js";import"./Text.c38ffb52.js";import"./DataListItemRow.8f458244.js";import"./data-list.f7ff2ea7.js";import"./index.esm.6af887f8.js";import"./copy-icon.cf10e1f5.js";import"./GridItem.0db472b0.js";import"./resource.df4d2bbd.js";import"./joinPath.69b856b1.js";import"./filter-icon.fec9f70e.js";import"./ConfirmDialog.f8013bbb.js";import"./plus-icon.407671b4.js";import"./MenuList.288a98b4.js";const Y=({client:n})=>{const{t:o}=M("clients"),{adminClient:d}=T(),{addAlert:s,addError:p}=C(),[t,u]=x.exports.useState(n),{hasAccess:f}=v(),a=f("manage-clients")||t.access?.manage,m=async r=>{try{const l=r.filter(e=>e.client===void 0).map(e=>e.role).flat();await Promise.all([d.clients.addRealmScopeMappings({id:t.id},l),...r.filter(e=>e.client!==void 0).map(e=>d.clients.addClientScopeMappings({id:t.id,client:e.client.id},[e.role]))]),s(o("clientScopeSuccess"),A.success)}catch(l){p("clients:clientScopeError",l)}},S=async()=>{const r={...t,fullScopeAllowed:!t.fullScopeAllowed};try{await d.clients.update({id:t.id},r),s(o("clientScopeSuccess"),A.success),u(r)}catch(l){p("clients:clientScopeError",l)}};return h(D,{children:[i(N,{role:"manage-clients",fineGrainedAccess:t.access?.manage,isHorizontal:!0,children:i(B,{hasNoPaddingTop:!0,label:o("fullScopeAllowed"),labelIcon:i(z,{helpText:"clients-help:fullScopeAllowed",fieldLabelId:"clients:fullScopeAllowed"}),fieldId:"fullScopeAllowed",children:i(E,{id:"fullScopeAllowed",label:o("common:on"),labelOff:o("common:off"),isChecked:t.fullScopeAllowed,onChange:S,"aria-label":o("fullScopeAllowed")})})}),!t.fullScopeAllowed&&h(I,{children:[i(P,{}),i(G,{name:t.clientId,id:t.id,type:"clients",save:m,isManager:a})]})]})};function Te(){const{t:n}=M("clients"),o=R(),d=F(),{realm:s,clientId:p}=H(),{adminClient:t}=T(),{addAlert:u,addError:f}=C(),[a,m]=x.exports.useState();K(()=>t.clients.findOne({id:p}),m,[]);const S=e=>k({to:g({realm:s,clientId:p,tab:e}),history:o});if(!a)return i(L,{});const r=async e=>{if(Array.isArray(e))try{await t.clients.addMultipleProtocolMappers({id:a.id},e),m(await t.clients.findOne({id:a.id})),u(n("common:mappingCreatedSuccess"),A.success)}catch(c){f("common:mappingCreatedError",c)}else{const c=e;d(b({realm:s,id:a.id,mapperId:c.id}))}},l=async e=>{try{await t.clients.delProtocolMapper({id:a.id,mapperId:e.id}),m({...a,protocolMappers:a.protocolMappers?.filter(c=>c.id!==e.id)}),u(n("common:mappingDeletedSuccess"),A.success)}catch(c){f("common:mappingDeletedError",c)}return!0};return h(I,{children:[i(V,{titleKey:a.clientId,subKey:"clients-help:dedicatedScopeExplain",divider:!1}),i(D,{variant:"light",className:"pf-u-p-0",children:h(j,{isBox:!0,mountOnEnter:!0,defaultLocation:g({realm:s,clientId:p,tab:"mappers"}),children:[i(w,{title:i(y,{children:n("mappers")}),"data-testid":"mappersTab",...S("mappers"),children:i(O,{model:a,onAdd:r,onDelete:l,detailLink:e=>b({realm:s,id:a.id,mapperId:e})})}),i(w,{title:i(y,{children:n("scope")}),"data-testid":"scopeTab",...S("scope"),children:i(Y,{client:a})})]})})]})}export{Te as default};
